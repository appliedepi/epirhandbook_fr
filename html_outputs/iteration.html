<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>16 Itération, boucles et listes | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="16 Itération, boucles et listes | The Epidemiologist R Handbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="16 Itération, boucles et listes | The Epidemiologist R Handbook" />
  
  <meta name="twitter:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.2/transition.js"></script>
    <script src="libs/bs3compat-0.4.2/tabs.js"></script>
    <script src="libs/bs3compat-0.4.2/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.27/datatables.js"></script>
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
    <script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.9/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.1/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="iteration" class="section level1" number="16">
<h1><span class="header-section-number">16</span> Itération, boucles et listes</h1>
<p>Les épidémiologistes sont souvent confrontés à la répétition d’analyses sur des sous-groupes tels que des pays, des districts ou des groupes d’âge. Ce ne sont là que quelques-unes des nombreuses situations impliquant l’itération. Le codage de vos opérations itératives à l’aide des approches ci-dessous vous aidera à effectuer ces tâches répétitives plus rapidement, à réduire les risques d’erreur et à réduire la longueur du code.</p>
<p>Cette page présente deux approches des opérations itératives : l’utilisation de boucles <em>for</em> et l’utilisation du package <strong>purrr</strong>.</p>
<ol style="list-style-type: decimal">
<li>Les boucles <em>for</em> permettent d’itérer le code sur une série d’entrées, mais sont moins courantes en R que dans d’autres langages de programmation. Néanmoins, nous les introduisons ici en tant qu’outil d’apprentissage et de référence.<br />
</li>
<li>Le paquet <strong>purrr</strong> est l’approche <strong>tidyverse</strong> des opérations itératives - il fonctionne en “mappant” une fonction sur plusieurs entrées (valeurs, colonnes, ensembles de données, etc.).</li>
</ol>
<p>En cours de route, nous montrerons des exemples tels que :</p>
<ul>
<li>L’importation et l’exportation de plusieurs fichiers<br />
</li>
<li>Création d’épicurves pour plusieurs juridictions<br />
</li>
<li>Exécution de tests T pour plusieurs colonnes dans un cadre de données.</li>
</ul>
<p>Dans la section <strong>purrr</strong> <a href="iteration.html#iter_purrr">section</a>, nous fournirons également plusieurs exemples de création et de manipulation de <code>listes</code>.</p>
<div id="préparation-1" class="section level2" number="16.1">
<h2><span class="header-section-number">16.1</span> Préparation</h2>
<div id="chargement-des-paquets-1" class="section level3 unnumbered">
<h3>Chargement des paquets</h3>
<p>Ce morceau de code montre le chargement des paquets nécessaires aux analyses. Dans ce manuel, nous mettons l’accent sur <code>p_load()</code> de <strong>pacman</strong>, qui installe le paquet si nécessaire <em>et</em> le charge pour l’utiliser. Vous pouvez également charger les paquets installés avec <code>library()</code> de <strong>base</strong> R. Voir la page sur <a href="rbasics.html#rbasics">bases de R</a> pour plus d’informations sur les paquets R.</p>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb758-1"><a href="iteration.html#cb758-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb758-2"><a href="iteration.html#cb758-2" aria-hidden="true" tabindex="-1"></a>     rio, <span class="co"># import/export</span></span>
<span id="cb758-3"><a href="iteration.html#cb758-3" aria-hidden="true" tabindex="-1"></a>     here, <span class="co"># localisateur de fichiers</span></span>
<span id="cb758-4"><a href="iteration.html#cb758-4" aria-hidden="true" tabindex="-1"></a>     purrr, <span class="co"># itération</span></span>
<span id="cb758-5"><a href="iteration.html#cb758-5" aria-hidden="true" tabindex="-1"></a>     tidyverse, <span class="co"># gestion et visualisation des données</span></span>
<span id="cb758-6"><a href="iteration.html#cb758-6" aria-hidden="true" tabindex="-1"></a>     grates</span>
<span id="cb758-7"><a href="iteration.html#cb758-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="importer-des-données-1" class="section level3 unnumbered">
<h3>Importer des données</h3>
<p>Nous importons le jeu de données des cas d’une épidémie d’Ebola simulée. Si vous voulez suivre le mouvement, <a href='https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds' class='download-button'>cliquez pour télécharger la linelist “propre”</a> (en tant que fichier .rds). Importez des données avec la fonction <code>import()</code> du paquet <strong>rio</strong> (elle gère de nombreux types de fichiers comme .xlsx, .csv, .rds - voir la page <a href="import_export.html#import_export">Importation et exportation</a> pour plus de détails).</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="iteration.html#cb759-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importez la liste de cas</span></span>
<span id="cb759-2"><a href="iteration.html#cb759-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist_cleaned.rds&quot;</span>)</span></code></pre></div>
<p>Les 50 premières lignes de la linelist sont affichées ci-dessous.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-27667ac27fb628c6960f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-27667ac27fb628c6960f">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
</div>
</div>
<div id="for-loops" class="section level2" number="16.2">
<h2><span class="header-section-number">16.2</span> <em>for loops</em></h2>
<div id="iter_loops" class="section level3 unnumbered">
<h3><em>for loops</em> en R</h3>
<p>Les <em>for loops</em> ne sont pas mis en avant dans R, mais sont courants dans d’autres langages de programmation. En tant que débutant, elles peuvent être utiles à l’apprentissage et à la pratique car elles sont plus faciles à “explorer”, à “déboguer” et à comprendre exactement ce qui se passe à chaque itération, en particulier lorsque vous n’êtes pas encore à l’aise pour écrire vos propres fonctions.</p>
<p>Vous pouvez passer rapidement des boucles <em>for</em> à l’itération avec des fonctions mappées avec <strong>purrr</strong> (voir <a href="iteration.html#iter_purrr">section ci-dessous</a>).</p>
</div>
<div id="composants-principaux" class="section level3 unnumbered">
<h3>Composants principaux</h3>
<p>Une <em>boucle for</em> comporte trois éléments essentiels :</p>
<ol style="list-style-type: decimal">
<li>la <strong>séquence</strong> d’éléments à parcourir par itération<br />
</li>
<li>Les <strong>opérations</strong> à effectuer pour chaque élément de la séquence.<br />
</li>
<li>le <strong>contenu</strong> des résultats (facultatif).</li>
</ol>
<p>La syntaxe de base est la suivante : <code>pour (élément dans la séquence) {faire des opérations avec l'élément}</code>. Notez les parenthèses et les accolades. Les résultats peuvent être imprimés sur la console, ou stockés dans un objet R conteneur.</p>
<p>Voici un exemple simple de <em>boucle for</em>.</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb760-1"><a href="iteration.html#cb760-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (num <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)) { <span class="co"># la SEQUENCE est définie (numéros 1 à 5) et la boucle est ouverte avec &quot;{&quot;</span></span>
<span id="cb760-2"><a href="iteration.html#cb760-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(num <span class="sc">+</span> <span class="dv">2</span>) <span class="co"># Les OPERATIONS (ajouter deux à chaque numéro de séquence et imprimer)</span></span>
<span id="cb760-3"><a href="iteration.html#cb760-3" aria-hidden="true" tabindex="-1"></a>}                            <span class="co"># La boucle est fermée avec &quot;}&quot;                            </span></span></code></pre></div>
<pre><code>## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7</code></pre>
<div class="sourceCode" id="cb762"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb762-1"><a href="iteration.html#cb762-1" aria-hidden="true" tabindex="-1"></a>                             <span class="co"># Il n&#39;y a pas de &quot;conteneur&quot; dans cet exemple.</span></span></code></pre></div>
</div>
<div id="séquence-.unnumbered-sans-numéro" class="section level3" number="16.2.1">
<h3><span class="header-section-number">16.2.1</span> Séquence {.unnumbered} (sans numéro)</h3>
<p>Il s’agit de la partie “for” d’une <em>boucle for</em> - les opérations seront exécutées “pour” chaque élément de la séquence. La séquence peut être une série de valeurs (par exemple, des noms de juridictions, de maladies, des noms de colonnes, des éléments de listes, etc), ou bien une série de nombres consécutifs (par exemple, 1,2,3,4,5). Chaque approche a ses propres utilitaires, décrits ci-dessous.</p>
<p>La structure de base d’une déclaration de séquence est <code>item in vector</code>.</p>
<ul>
<li>Vous pouvez écrire n’importe quel caractère ou mot à la place de “item” (par exemple “i”, “num”, “hosp”, “district”, etc.). La valeur de cet “item” change à chaque itération de la boucle, en passant par chaque valeur du vecteur.<br />
</li>
<li>Le <em>vecteur</em> peut être constitué de valeurs de caractères, de noms de colonnes, ou peut-être d’une séquence de nombres - ce sont les valeurs qui changeront à chaque itération. Vous pouvez les utiliser dans les opérations <em>for loop</em> en utilisant le terme “item”.</li>
</ul>
<p><strong>Exemple : séquence de valeurs de caractères</strong></p>
<p>Dans cet exemple, une boucle est exécutée pour chaque valeur d’un vecteur de caractères prédéfini de noms d’hôpitaux.</p>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb763-1"><a href="iteration.html#cb763-1" aria-hidden="true" tabindex="-1"></a><span class="co"># faire un vecteur des noms d&#39;hôpitaux</span></span>
<span id="cb763-2"><a href="iteration.html#cb763-2" aria-hidden="true" tabindex="-1"></a>hospital_names <span class="ot">&lt;-</span> <span class="fu">unique</span>(linelist<span class="sc">$</span>hospital)</span>
<span id="cb763-3"><a href="iteration.html#cb763-3" aria-hidden="true" tabindex="-1"></a>hospital_names <span class="co"># print</span></span></code></pre></div>
<pre><code>## [1] &quot;Other&quot;                                &quot;Missing&quot;                              &quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;
## [4] &quot;Port Hospital&quot;                        &quot;Military Hospital&quot;                    &quot;Central Hospital&quot;</code></pre>
<p>Nous avons choisi le terme <code>hosp</code> pour représenter les valeurs du vecteur <code>hospital_names</code>. Pour la première itération de la boucle, la valeur de <code>hosp</code> sera <code>hospital_names[[1]]</code>. Pour la deuxième boucle, elle sera <code>noms_hospitaliers[[2]]</code>. Et ainsi de suite…</p>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="iteration.html#cb765-1" aria-hidden="true" tabindex="-1"></a><span class="co"># une &#39;boucle for&#39; avec une séquence de caractères</span></span>
<span id="cb765-2"><a href="iteration.html#cb765-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb765-3"><a href="iteration.html#cb765-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (hosp <span class="cf">in</span> hospital_names){ <span class="co"># séquence</span></span>
<span id="cb765-4"><a href="iteration.html#cb765-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb765-5"><a href="iteration.html#cb765-5" aria-hidden="true" tabindex="-1"></a>       <span class="co"># OPÉRATIONS ICI</span></span>
<span id="cb765-6"><a href="iteration.html#cb765-6" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<p><strong>Exemple : séquence de noms de colonnes</strong></p>
<p>Il s’agit d’une variation de la séquence de caractères ci-dessus, dans laquelle les noms d’un objet R existant sont extraits et deviennent le vecteur. Par exemple, les noms des colonnes d’un cadre de données. De façon pratique, dans le code d’opérations de la <em>boucle for</em>, les noms de colonnes peuvent être utilisés pour <em>indexer</em> (sous-ensemble) leur cadre de données original.</p>
<p>Ci-dessous, la séquence est constituée des <code>names()</code> (noms des colonnes) du cadre de données <code>linelist</code>. Notre nom d’“élément” est <code>col</code>, qui représentera chaque nom de colonne au fur et à mesure que les boucles se déroulent.</p>
<p>Pour les besoins de l’exemple, nous incluons le code des opérations à l’intérieur de la boucle <em>for</em>, qui est exécutée pour chaque valeur de la séquence. Dans ce code, les valeurs de la séquence (noms de colonnes) sont utilisées pour <em>indexer</em> (sous-ensemble) <code>linelist</code>, une par une. Comme enseigné dans la page <a href="rbasics.html#rbasics">bases de R</a>, les doubles branchements <code>[[ ]]</code> sont utilisés pour sous-indexer. La colonne résultante est passée à <code>is.na()</code>, puis à <code>sum()</code> pour produire le nombre de valeurs manquantes dans la colonne. Le résultat est imprimé sur la console - un nombre pour chaque colonne.</p>
<p>Une remarque sur l’indexation avec les noms de colonnes - lorsque vous faites référence à la colonne elle-même, <em>ne vous contentez pas d’écrire “col”!</em> <code>col</code> ne représente que le nom de la colonne en caractères! Pour faire référence à la colonne entière, vous devez utiliser le nom de la colonne comme <em>index</em> sur <code>linelist</code> via <code>linelist[[col]]</code>.</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb766-1"><a href="iteration.html#cb766-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">names</span>(linelist)){ <span class="co"># La boucle est exécutée pour chaque colonne de la linelist ; le nom de la colonne est représenté par &quot;col&quot;. </span></span>
<span id="cb766-2"><a href="iteration.html#cb766-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb766-3"><a href="iteration.html#cb766-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exemple de code d&#39;opérations - impression du nombre de valeurs manquantes dans la colonne</span></span>
<span id="cb766-4"><a href="iteration.html#cb766-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(linelist[[col]])))  <span class="co"># La linelist est indexée par la valeur actuelle de &quot;col&quot;.</span></span>
<span id="cb766-5"><a href="iteration.html#cb766-5" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb766-6"><a href="iteration.html#cb766-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 0
## [1] 0
## [1] 2087
## [1] 256
## [1] 0
## [1] 936
## [1] 1323
## [1] 278
## [1] 86
## [1] 0
## [1] 86
## [1] 86
## [1] 86
## [1] 0
## [1] 0
## [1] 0
## [1] 2088
## [1] 2088
## [1] 0
## [1] 0
## [1] 0
## [1] 249
## [1] 249
## [1] 249
## [1] 249
## [1] 249
## [1] 149
## [1] 765
## [1] 0
## [1] 256</code></pre>
<p><strong>Séquence de nombres</strong></p>
<p>Dans cette approche, la séquence est une série de nombres consécutifs. Ainsi, la valeur de l’“item” n’est pas une valeur de caractère (par exemple, “Central Hospital” ou “date_onset”) mais un nombre. Ceci est utile pour boucler des cadres de données, car vous pouvez utiliser le numéro de “item” dans la <em>boucle for</em> pour indexer le cadre de données par <em>numéro de ligne</em>.</p>
<p>Par exemple, disons que vous souhaitez parcourir chaque ligne de votre cadre de données et extraire certaines informations. Vos “éléments” seraient des numéros de ligne numériques. Dans ce cas, les “éléments” sont souvent écrits sous la forme <code>i</code>.</p>
<p>Le processus <em>for loop</em> pourrait s’expliquer par la phrase suivante: “pour chaque élément d’une séquence de nombres allant de 1 au nombre total de lignes de mon cadre de données, faire X”. Pour la première itération de la boucle, la valeur de l’“élément” <code>i</code> sera 1. Pour la deuxième itération, <code>i</code> sera 2, etc.</p>
<p>Voici à quoi ressemble la séquence en code: <code>for (i in 1:nrow(linelist)) {CODE DES OPERATIONS}</code> où <code>i</code> représente l’“élément” et <code>1:nrow(linelist)</code> produit une séquence de nombres consécutifs allant de 1 au nombre de lignes de <code>linelist</code>.</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb768-1"><a href="iteration.html#cb768-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(linelist)) { <span class="co"># utilisation sur un cadre de données</span></span>
<span id="cb768-2"><a href="iteration.html#cb768-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OPÉRATIONS ICI</span></span>
<span id="cb768-3"><a href="iteration.html#cb768-3" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
<p>Si vous voulez que la séquence soit des nombres, mais que vous partez d’un vecteur (et non d’un cadre de données), utilisez le raccourci <code>seq_along()</code> pour retourner une séquence de nombres pour chaque élément du vecteur. Par exemple, <code>for (i in seq_along(hospital_names) {CODE D'OPÉRATIONS}</code>.</p>
<p>Le code ci-dessous renvoie en fait des nombres, qui deviendront la valeur de <code>i</code> dans leur boucle respective.</p>
<div class="sourceCode" id="cb769"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb769-1"><a href="iteration.html#cb769-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq_along</span>(hospital_names) <span class="co"># utilisation sur un vecteur nommé</span></span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6</code></pre>
<p>Un avantage de l’utilisation de nombres dans la séquence est qu’il est facile d’utiliser le nombre <code>i</code> pour indexer un <em>conteneur</em> qui stocke les sorties de la boucle. Il y a un exemple de ceci dans la section Opérations ci-dessous.</p>
</div>
<div id="opérations" class="section level3 unnumbered">
<h3>Opérations</h3>
<p>C’est le code entre les crochets <code>{ }</code> de la <em>boucle for</em>. Vous voulez que ce code soit exécuté pour chaque “élément” de la <em>séquence</em>. Par conséquent, faites attention à ce que chaque partie de votre code qui change en fonction de l’“item” soit correctement codée pour qu’elle change réellement ! Par exemple, n’oubliez pas d’utiliser <code>[[ ]]</code> pour l’indexation.</p>
<p>Dans l’exemple ci-dessous, nous itérons à travers chaque ligne de la <code>linelist</code>. Les valeurs <code>gender</code> et <code>age</code> de chaque ligne sont collées ensemble et stockées dans le vecteur de caractères conteneur <code>cases_demographics</code>. Notez comment nous utilisons également l’indexation <code>[[i]]</code> pour enregistrer la sortie de la boucle à la bonne position dans le vecteur “conteneur”.</p>
<div class="sourceCode" id="cb771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb771-1"><a href="iteration.html#cb771-1" aria-hidden="true" tabindex="-1"></a><span class="co"># créer un conteneur pour stocker les résultats - un vecteur de caractères</span></span>
<span id="cb771-2"><a href="iteration.html#cb771-2" aria-hidden="true" tabindex="-1"></a>cases_demographics <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;character&quot;</span>, <span class="at">length =</span> <span class="fu">nrow</span>(linelist))</span>
<span id="cb771-3"><a href="iteration.html#cb771-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-4"><a href="iteration.html#cb771-4" aria-hidden="true" tabindex="-1"></a><span class="co"># la boucle for</span></span>
<span id="cb771-5"><a href="iteration.html#cb771-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(linelist)){</span>
<span id="cb771-6"><a href="iteration.html#cb771-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb771-7"><a href="iteration.html#cb771-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OPERATIONS</span></span>
<span id="cb771-8"><a href="iteration.html#cb771-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extraire les valeurs de la linelist pour la ligne i, en utilisant les parenthèses pour l&#39;indexation.</span></span>
<span id="cb771-9"><a href="iteration.html#cb771-9" aria-hidden="true" tabindex="-1"></a>  row_gender <span class="ot">&lt;-</span> linelist<span class="sc">$</span>gender[[i]]</span>
<span id="cb771-10"><a href="iteration.html#cb771-10" aria-hidden="true" tabindex="-1"></a>  row_age <span class="ot">&lt;-</span> linelist<span class="sc">$</span>age_years[[i]]    <span class="co"># n&#39;oubliez pas d&#39;indexer!</span></span>
<span id="cb771-11"><a href="iteration.html#cb771-11" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb771-12"><a href="iteration.html#cb771-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combinez sexe-âge et stockez dans un vecteur conteneur à l&#39;emplacement indexé</span></span>
<span id="cb771-13"><a href="iteration.html#cb771-13" aria-hidden="true" tabindex="-1"></a>  cases_demographics[[i]] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(row_gender, row_age, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>) </span>
<span id="cb771-14"><a href="iteration.html#cb771-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-15"><a href="iteration.html#cb771-15" aria-hidden="true" tabindex="-1"></a>}  <span class="co"># fin de la boucle for</span></span>
<span id="cb771-16"><a href="iteration.html#cb771-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-17"><a href="iteration.html#cb771-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-18"><a href="iteration.html#cb771-18" aria-hidden="true" tabindex="-1"></a><span class="co"># affiche les 10 premières lignes du conteneur</span></span>
<span id="cb771-19"><a href="iteration.html#cb771-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cases_demographics, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;m,2&quot;  &quot;f,3&quot;  &quot;m,56&quot; &quot;f,18&quot; &quot;m,3&quot;  &quot;f,16&quot; &quot;f,16&quot; &quot;f,0&quot;  &quot;m,61&quot; &quot;f,27&quot;</code></pre>
</div>
<div id="conteneur" class="section level3 unnumbered">
<h3>Conteneur</h3>
<p>Parfois, les résultats de votre <em>boucle for</em> seront imprimés sur la console ou dans le panneau Plots de RStudio. D’autres fois, vous voudrez stocker les résultats dans un “conteneur” pour une utilisation ultérieure. Ce conteneur peut être un vecteur, un cadre de données ou même une liste.</p>
<p>Il est plus efficace de créer le conteneur pour les résultats <em>avant même</em> de commencer la <em>boucle for</em>. En pratique, cela signifie créer un vecteur, un cadre de données ou une liste vide. On peut les créer avec les fonctions <code>vector()</code> pour les vecteurs ou les listes, ou avec <code>matrix()</code> et <code>data.frame()</code> pour un cadre de données.</p>
<p><strong>Vecteur vide</strong></p>
<p>Utilisez <code>vector()</code> et spécifiez le <code>mode =</code> en fonction de la classe attendue des objets que vous allez insérer - soit “double” (pour contenir des nombres), “caractère”, ou “logique”. Vous devez également définir la valeur <code>length =</code> à l’avance. Il s’agit de la longueur de votre séquence <em>for loop</em>.</p>
<p>Disons que vous voulez stocker le délai médian d’admission pour chaque hôpital. Vous utiliserez “double” et définirez la longueur comme étant le nombre de sorties attendues (le nombre d’hôpitaux uniques dans l’ensemble de données).</p>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb773-1"><a href="iteration.html#cb773-1" aria-hidden="true" tabindex="-1"></a>delays <span class="ot">&lt;-</span> <span class="fu">vector</span>(</span>
<span id="cb773-2"><a href="iteration.html#cb773-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;double&quot;</span>, <span class="co"># nous nous attendons à stocker des nombres</span></span>
<span id="cb773-3"><a href="iteration.html#cb773-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">length =</span> <span class="fu">length</span>(<span class="fu">unique</span>(linelist<span class="sc">$</span>hospital))) <span class="co"># le nombre d&#39;hôpitaux uniques dans l&#39;ensemble de données</span></span></code></pre></div>
<p>**Cadre de données vide</p>
<p>Vous pouvez créer un cadre de données vide en spécifiant le nombre de lignes et de colonnes comme ceci :</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb774-1"><a href="iteration.html#cb774-1" aria-hidden="true" tabindex="-1"></a>delays <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">3</span>))</span></code></pre></div>
<p><strong>Liste vide</strong></p>
<p>Vous pouvez vouloir stocker certains graphiques créés par une <em>boucle for</em> dans une liste. Une liste est comme un vecteur, mais elle contient d’autres objets R qui peuvent être de différentes classes. Les éléments d’une liste peuvent être un nombre unique, un cadre de données, un vecteur et même une autre liste.</p>
<p>Vous pouvez initialiser une liste vide en utilisant la même commande <code>vector()</code> que ci-dessus, mais avec <code>mode = "list"</code>. Spécifiez la longueur comme vous le souhaitez.</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="iteration.html#cb775-1" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="dv">16</span>)</span></code></pre></div>
</div>
<div id="impression" class="section level3 unnumbered">
<h3>Impression</h3>
<p>Notez que pour imprimer à partir d’une <em>boucle for</em>, vous aurez probablement besoin d’envelopper explicitement avec la fonction <code>print()</code>.</p>
<p>Dans l’exemple ci-dessous, la séquence est un vecteur de caractères explicite, qui est utilisé pour sous-titrer la linelist par hôpital. Les résultats ne sont pas stockés dans un conteneur, mais sont imprimés sur la console avec la fonction <code>print()</code>.</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb776-1"><a href="iteration.html#cb776-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (hosp <span class="cf">in</span> hospital_names){ </span>
<span id="cb776-2"><a href="iteration.html#cb776-2" aria-hidden="true" tabindex="-1"></a>     hospital_cases <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hospital <span class="sc">==</span> hosp)</span>
<span id="cb776-3"><a href="iteration.html#cb776-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(<span class="fu">nrow</span>(hospital_cases))</span>
<span id="cb776-4"><a href="iteration.html#cb776-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 885
## [1] 1469
## [1] 422
## [1] 1762
## [1] 896
## [1] 454</code></pre>
</div>
<div id="tester-votre-boucle-for" class="section level3 unnumbered">
<h3>Tester votre boucle for</h3>
<p>Pour tester votre boucle, vous pouvez lancer une commande pour effectuer une affectation temporaire de l’“élément”, comme <code>i &lt;- 10</code> ou <code>hosp &lt;- "Central Hospital"</code>. Faites cela <em>en dehors de la boucle</em>, puis exécutez votre code d’opérations uniquement (le code entre les accolades) pour voir si les résultats attendus sont produits.</p>
</div>
<div id="plots-de-bouclage" class="section level3 unnumbered">
<h3>Plots de bouclage</h3>
<p>Pour rassembler les trois composants (conteneur, séquence et opérations), essayons de tracer une épicurve pour chaque hôpital (voir la page sur les <a href="epicurves.html#epicurves">Courbes épidémiques</a>).</p>
<p>Nous pouvons faire une belle épicurve de <em>tous</em> les cas par sexe en utilisant le paquet <strong>incidence2</strong> comme ci-dessous:</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb778-1"><a href="iteration.html#cb778-1" aria-hidden="true" tabindex="-1"></a><span class="co"># créer un objet &#39;incidence</span></span>
<span id="cb778-2"><a href="iteration.html#cb778-2" aria-hidden="true" tabindex="-1"></a>outbreak <span class="ot">&lt;-</span> incidence2<span class="sc">::</span><span class="fu">incidence</span>(   </span>
<span id="cb778-3"><a href="iteration.html#cb778-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> linelist, <span class="co"># dataframe - linelist complet</span></span>
<span id="cb778-4"><a href="iteration.html#cb778-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">date_index =</span> <span class="st">&quot;date_onset&quot;</span>, <span class="co"># colonne de date</span></span>
<span id="cb778-5"><a href="iteration.html#cb778-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">interval =</span> <span class="st">&quot;week&quot;</span>, <span class="co"># aggregate counts weekly</span></span>
<span id="cb778-6"><a href="iteration.html#cb778-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">groups =</span> <span class="st">&quot;gender&quot;</span>) <span class="co"># regroupe les valeurs par sexe</span></span>
<span id="cb778-7"><a href="iteration.html#cb778-7" aria-hidden="true" tabindex="-1"></a>     <span class="co">#na_as_group = TRUE , deprecated incidence version 2.0.0</span></span>
<span id="cb778-8"><a href="iteration.html#cb778-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb778-9"><a href="iteration.html#cb778-9" aria-hidden="true" tabindex="-1"></a><span class="co"># tracer la courbe d&#39;épidémie</span></span>
<span id="cb778-10"><a href="iteration.html#cb778-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(outbreak, <span class="co"># nom de l&#39;objet d&#39;incidence</span></span>
<span id="cb778-11"><a href="iteration.html#cb778-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">x =</span> date_index, <span class="co">#aesthetiques et axes</span></span>
<span id="cb778-12"><a href="iteration.html#cb778-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> count, </span>
<span id="cb778-13"><a href="iteration.html#cb778-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> gender), <span class="co"># couleur des barres par sexe</span></span>
<span id="cb778-14"><a href="iteration.html#cb778-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;black&quot;</span>      <span class="co"># couleur de contour des barres</span></span>
<span id="cb778-15"><a href="iteration.html#cb778-15" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span>  </span>
<span id="cb778-16"><a href="iteration.html#cb778-16" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb778-17"><a href="iteration.html#cb778-17" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="sc">~</span>gender) <span class="sc">+</span></span>
<span id="cb778-18"><a href="iteration.html#cb778-18" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb778-19"><a href="iteration.html#cb778-19" aria-hidden="true" tabindex="-1"></a>     <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Outbreak of all cases&quot;</span>, <span class="co">#titre</span></span>
<span id="cb778-20"><a href="iteration.html#cb778-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="st">&quot;Counts&quot;</span>, </span>
<span id="cb778-21"><a href="iteration.html#cb778-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">&quot;Date&quot;</span>, </span>
<span id="cb778-22"><a href="iteration.html#cb778-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">&quot;Gender&quot;</span>, </span>
<span id="cb778-23"><a href="iteration.html#cb778-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">&quot;Gender&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-593-1.png" width="672" /></p>
<p>Pour produire un graphique distinct pour les cas de chaque hôpital, nous pouvons placer ce code épicurve dans une <em>boucle for</em>.</p>
<p>Tout d’abord, nous enregistrons un vecteur nommé des noms uniques des hôpitaux, <code>hospital_names</code>. La <em>boucle for</em> sera exécutée une fois pour chacun de ces noms : <code>for (hosp in hospital_names)</code>. A chaque itération de la <em>boucle for</em>, le nom de l’hôpital actuel du vecteur sera représenté par <code>hosp</code> pour être utilisé dans la boucle.</p>
<p>Dans les opérations de la boucle, vous pouvez écrire du code R comme d’habitude, mais utiliser l’“élément” (<code>hosp</code> dans ce cas) en sachant que sa valeur va changer. Dans cette boucle :</p>
<ul>
<li>Un <code>filter()</code> est appliqué à <code>linelist</code>, de telle sorte que la colonne <code>hospital</code> doit être égale à la valeur actuelle de <code>hosp</code>.<br />
</li>
<li>L’objet incidence est créé sur la liste de lignes filtrée.<br />
</li>
<li>Le graphique de l’hôpital actuel est créé, avec un titre auto-ajustable qui utilise <code>hosp</code>.<br />
</li>
<li>Le graphique de l’hôpital actuel est temporairement sauvegardé puis imprimé.<br />
</li>
<li>La boucle se répète ensuite avec l’hôpital suivant dans <code>hospital_names</code>.</li>
</ul>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="iteration.html#cb779-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fabrique un vecteur des noms d&#39;hôpitaux</span></span>
<span id="cb779-2"><a href="iteration.html#cb779-2" aria-hidden="true" tabindex="-1"></a>hospital_names <span class="ot">&lt;-</span> <span class="fu">unique</span>(linelist<span class="sc">$</span>hospital)</span>
<span id="cb779-3"><a href="iteration.html#cb779-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb779-4"><a href="iteration.html#cb779-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pour chaque nom (&quot;hosp&quot;) dans hospital_names, créer et imprimer la courbe épi</span></span>
<span id="cb779-5"><a href="iteration.html#cb779-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (hosp <span class="cf">in</span> hospital_names) {</span>
<span id="cb779-6"><a href="iteration.html#cb779-6" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb779-7"><a href="iteration.html#cb779-7" aria-hidden="true" tabindex="-1"></a>     <span class="co"># créer un objet d&#39;incidence spécifique à l&#39;hôpital actuel</span></span>
<span id="cb779-8"><a href="iteration.html#cb779-8" aria-hidden="true" tabindex="-1"></a>     outbreak_hosp <span class="ot">&lt;-</span> incidence2<span class="sc">::</span><span class="fu">incidence</span>(</span>
<span id="cb779-9"><a href="iteration.html#cb779-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hospital <span class="sc">==</span> hosp), <span class="co"># linelist est filtré sur l&#39;hôpital actuel</span></span>
<span id="cb779-10"><a href="iteration.html#cb779-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">date_index =</span> <span class="st">&quot;date_onset&quot;</span>,</span>
<span id="cb779-11"><a href="iteration.html#cb779-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">interval =</span> <span class="st">&quot;week&quot;</span>, </span>
<span id="cb779-12"><a href="iteration.html#cb779-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">groups =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb779-13"><a href="iteration.html#cb779-13" aria-hidden="true" tabindex="-1"></a>          <span class="co">#na_as_group = TRUE , deprecated incidence version 2.0.0</span></span>
<span id="cb779-14"><a href="iteration.html#cb779-14" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb779-15"><a href="iteration.html#cb779-15" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb779-16"><a href="iteration.html#cb779-16" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb779-17"><a href="iteration.html#cb779-17" aria-hidden="true" tabindex="-1"></a>     <span class="co"># tracer la courbe d&#39;épidémie</span></span>
<span id="cb779-18"><a href="iteration.html#cb779-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb779-19"><a href="iteration.html#cb779-19" aria-hidden="true" tabindex="-1"></a>     plot_hosp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(outbreak_hosp, <span class="co"># nom de l&#39;objet d&#39;incidence</span></span>
<span id="cb779-20"><a href="iteration.html#cb779-20" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">aes</span>(<span class="at">x =</span> date_index, <span class="co">#aesthetiques et axes</span></span>
<span id="cb779-21"><a href="iteration.html#cb779-21" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y =</span> count, </span>
<span id="cb779-22"><a href="iteration.html#cb779-22" aria-hidden="true" tabindex="-1"></a>                             <span class="at">fill =</span> gender), <span class="co"># couleur des barres par sexe</span></span>
<span id="cb779-23"><a href="iteration.html#cb779-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> <span class="st">&quot;black&quot;</span>      <span class="co"># couleur de contour des barres</span></span>
<span id="cb779-24"><a href="iteration.html#cb779-24" aria-hidden="true" tabindex="-1"></a>                         ) <span class="sc">+</span>  </span>
<span id="cb779-25"><a href="iteration.html#cb779-25" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb779-26"><a href="iteration.html#cb779-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_wrap</span>(<span class="sc">~</span>gender) <span class="sc">+</span></span>
<span id="cb779-27"><a href="iteration.html#cb779-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb779-28"><a href="iteration.html#cb779-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">title =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">&quot;Epidemic of cases admitted to {hosp}&quot;</span>), <span class="co">#titre</span></span>
<span id="cb779-29"><a href="iteration.html#cb779-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">x =</span> <span class="st">&quot;Counts&quot;</span>, </span>
<span id="cb779-30"><a href="iteration.html#cb779-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="st">&quot;Date&quot;</span>, </span>
<span id="cb779-31"><a href="iteration.html#cb779-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">&quot;Gender&quot;</span>, </span>
<span id="cb779-32"><a href="iteration.html#cb779-32" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">&quot;Gender&quot;</span>)</span>
<span id="cb779-33"><a href="iteration.html#cb779-33" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb779-34"><a href="iteration.html#cb779-34" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Créez et enregistrez le graphique. Le titre s&#39;ajuste automatiquement à l&#39;hôpital actuel</span></span>
<span id="cb779-35"><a href="iteration.html#cb779-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot_hosp &lt;- plot(</span></span>
<span id="cb779-36"><a href="iteration.html#cb779-36" aria-hidden="true" tabindex="-1"></a><span class="co">#       outbreak_hosp,</span></span>
<span id="cb779-37"><a href="iteration.html#cb779-37" aria-hidden="true" tabindex="-1"></a><span class="co">#       fill = &quot;gender&quot;,</span></span>
<span id="cb779-38"><a href="iteration.html#cb779-38" aria-hidden="true" tabindex="-1"></a><span class="co">#       color = &quot;black&quot;,</span></span>
<span id="cb779-39"><a href="iteration.html#cb779-39" aria-hidden="true" tabindex="-1"></a><span class="co">#       title = stringr::str_glue(&quot;Epidemic of cases admitted to {hosp}&quot;)</span></span>
<span id="cb779-40"><a href="iteration.html#cb779-40" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb779-41"><a href="iteration.html#cb779-41" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb779-42"><a href="iteration.html#cb779-42" aria-hidden="true" tabindex="-1"></a>     <span class="co"># imprimer le graphique pour l&#39;hôpital actuel</span></span>
<span id="cb779-43"><a href="iteration.html#cb779-43" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(plot_hosp)</span>
<span id="cb779-44"><a href="iteration.html#cb779-44" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb779-45"><a href="iteration.html#cb779-45" aria-hidden="true" tabindex="-1"></a>} <span class="co"># terminez la boucle for lorsqu&#39;elle a été exécutée pour chaque hôpital dans hospital_names </span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-594-1.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-594-2.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-594-3.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-594-4.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-594-5.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-594-6.png" width="50%" /></p>
</div>
<div id="suivi-de-la-progression-dune-boucle" class="section level3 unnumbered">
<h3>Suivi de la progression d’une boucle</h3>
<p>Une boucle comportant de nombreuses itérations peut s’exécuter pendant plusieurs minutes, voire plusieurs heures. Ainsi, il peut être utile d’imprimer la progression dans la console R. L’instruction <code>if</code> ci-dessous peut être placée <em>dans</em> les opérations de la boucle pour imprimer chaque 100ème nombre. Il suffit de l’ajuster pour que <code>i</code> soit l’“élément” de votre boucle.</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb780-1"><a href="iteration.html#cb780-1" aria-hidden="true" tabindex="-1"></a><span class="co"># boucle avec code pour imprimer la progression toutes les 100 itérations</span></span>
<span id="cb780-2"><a href="iteration.html#cb780-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(linelist))){</span>
<span id="cb780-3"><a href="iteration.html#cb780-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb780-4"><a href="iteration.html#cb780-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># imprimer la progression</span></span>
<span id="cb780-5"><a href="iteration.html#cb780-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">%%</span> <span class="dv">100</span><span class="sc">==</span><span class="dv">0</span>){ <span class="co"># L&#39;opérateur %% est le restant</span></span>
<span id="cb780-6"><a href="iteration.html#cb780-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(i)</span>
<span id="cb780-7"><a href="iteration.html#cb780-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb780-8"><a href="iteration.html#cb780-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="iter_purrr" class="section level2" number="16.3">
<h2><span class="header-section-number">16.3</span> <strong>purrr</strong> et listes</h2>
<p>Une autre approche des opérations itératives est le paquet <strong>purrr</strong> - c’est l’approche <strong>tidyverse</strong> de l’itération.</p>
<p>Si vous devez effectuer la même tâche plusieurs fois, il est probablement utile de créer une solution généralisée que vous pouvez utiliser sur plusieurs entrées. Par exemple, produire des tracés pour plusieurs juridictions, ou importer et combiner de nombreux fichiers.</p>
<p>Il y a aussi quelques autres avantages à <strong>purrr</strong> - vous pouvez l’utiliser avec des tubes <code>%&gt;%</code>, il gère mieux les erreurs que les <em>boucles for</em> normales, et la syntaxe est assez propre et simple ! Si vous utilisez une <em>boucle for</em>, vous pouvez probablement le faire plus clairement et succinctement avec <strong>purrr</strong> !</p>
<p>Gardez à l’esprit que <strong>purrr</strong> est un outil de programmation <em>fonctionnel</em>. C’est-à-dire que les opérations qui doivent être appliquées de manière itérative sont regroupées dans des <em>fonctions</em>. Consultez la page <a href="writing_functions.html#writing_functions">Écrire des fonctions</a> pour apprendre à écrire vos propres fonctions.</p>
<p><strong>purrr</strong> est également presque entièrement basé sur des <em>listes</em> et des <em>vecteurs</em> - pensez-y comme si vous appliquiez une fonction à chaque élément de cette liste/ce vecteur !</p>
<div id="chargement-des-paquets-2" class="section level3 unnumbered">
<h3>Chargement des paquets</h3>
<p><strong>purrr</strong> fait partie de <strong>tidyverse</strong>, il n’y a donc pas besoin d’installer/charger un paquet séparé.</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="iteration.html#cb781-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb781-2"><a href="iteration.html#cb781-2" aria-hidden="true" tabindex="-1"></a>     rio, <span class="co"># import/export</span></span>
<span id="cb781-3"><a href="iteration.html#cb781-3" aria-hidden="true" tabindex="-1"></a>     here, <span class="co"># chemins de fichiers relatifs</span></span>
<span id="cb781-4"><a href="iteration.html#cb781-4" aria-hidden="true" tabindex="-1"></a>     tidyverse, <span class="co"># gestion et visualisation des données</span></span>
<span id="cb781-5"><a href="iteration.html#cb781-5" aria-hidden="true" tabindex="-1"></a>     writexl, <span class="co"># écriture d&#39;un fichier Excel à feuilles multiples</span></span>
<span id="cb781-6"><a href="iteration.html#cb781-6" aria-hidden="true" tabindex="-1"></a>     readxl <span class="co"># importer Excel avec plusieurs feuilles</span></span>
<span id="cb781-7"><a href="iteration.html#cb781-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="map" class="section level3 unnumbered">
<h3><code>map()</code></h3>
<p>Une fonction essentielle de <strong>purrr</strong> est <code>map()</code>, qui “mappe” (applique) une fonction à chaque élément d’entrée d’une liste/vecteur que vous fournissez.</p>
<p>La syntaxe de base est <code>map(.x = SEQUENCE, .f = FONCTION, AUTRES ARGUMENTS)</code>. Un peu plus en détail :</p>
<ul>
<li><code>.x =</code> sont les <em>entrées</em> sur lesquelles la fonction <code>.f</code> sera appliquée de manière itérative - par exemple un vecteur de noms de juridiction, des colonnes dans un cadre de données, ou une liste de cadres de données.<br />
</li>
<li><code>.f =</code> est la <em>fonction</em> à appliquer à chaque élément de l’entrée <code>.x</code> - cela peut être une fonction comme <code>print()</code> qui existe déjà, ou une fonction personnalisée que vous définissez. La fonction est souvent écrite après un tilde <code>~</code> (détails ci-dessous).</li>
</ul>
<p>Quelques notes supplémentaires sur la syntaxe :</p>
<ul>
<li>Si la fonction n’a pas besoin de spécifier d’autres arguments, elle peut être écrite sans parenthèses et sans tilde (par exemple, <code>.f = mean</code>). Pour fournir des arguments qui auront la même valeur à chaque itération, fournissez-les dans <code>map()</code> mais en dehors de l’argument <code>.f =</code>, comme le <code>na.rm = T</code> dans <code>map(.x = ma_liste, .f = mean, na.rm=T)</code>.<br />
</li>
<li>Vous pouvez utiliser <code>.x</code> (ou simplement <code>.</code>) * à l’intérieur* de la fonction <code>.f =</code> comme substitut pour la valeur <code>.x</code> de cette itération.<br />
</li>
<li>Utilisez la syntaxe du tilde (<code>~</code>) pour avoir un meilleur contrôle sur la fonction - écrivez la fonction normalement avec des parenthèses, par exemple : <code>map(.x = ma_liste, .f = ~mean(., na.rm = T))</code>. Utilisez cette syntaxe particulièrement si la valeur d’un argument change à chaque itération, ou si c’est la valeur <code>.x</code> elle-même (voir les exemples ci-dessous)</li>
</ul>
<p><strong>Le résultat de l’utilisation de <code>map()</code> est une <em>liste</em> </strong> - une liste est une classe d’objets comme un vecteur mais dont les éléments peuvent être de classes différentes. Ainsi, une liste produite par <code>map()</code> peut contenir de nombreux cadres de données, ou de nombreux vecteurs, de nombreuses valeurs individuelles, ou même de nombreuses listes ! Il existe des versions alternatives de <code>map()</code> expliquées ci-dessous qui produisent d’autres types de sorties (par exemple, <code>map_dfr()</code> pour produire un cadre de données, <code>map_chr()</code> pour produire des vecteurs de caractères, et <code>map_dbl()</code> pour produire des vecteurs numériques).</p>
<div id="iter_combined" class="section level4 unnumbered">
<h4>Exemple - Importer et combiner des feuilles Excel</h4>
<p><strong>Démontrons avec une tâche courante d’épidémiologiste:</strong> - *Vous voulez importer un classeur Excel avec des données de cas, mais les données sont réparties sur différentes feuilles nommées dans le classeur. Comment importer et combiner efficacement les feuilles en un seul cadre de données ?</p>
<p>Imaginons que l’on nous envoie le classeur Excel ci-dessous. Chaque feuille contient les cas d’un hôpital donné.</p>
<p><img src="images/hospital_linelists_excel_sheets.png" width="615" style="display: block; margin: auto;" /></p>
<p>Voici une approche qui utilise <code>map()</code> :</p>
<ol style="list-style-type: decimal">
<li><code>map()</code> la fonction <code>import()</code> pour qu’elle s’exécute pour chaque feuille Excel.<br />
</li>
<li>Combinez les cadres de données importés en un seul en utilisant <code>bind_rows()</code>.<br />
</li>
<li>En cours de route, conservez le nom de la feuille originale pour chaque ligne, en stockant cette information dans une nouvelle colonne du cadre de données final.</li>
</ol>
<p>Tout d’abord, nous devons extraire les noms des feuilles et les enregistrer. Nous fournissons le chemin du fichier du classeur Excel à la fonction <code>excel_sheets()</code> du package <strong>readxl</strong>, qui extrait les noms des feuilles. Nous les stockons dans un vecteur de caractères appelé <code>sheet_names</code>.</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="iteration.html#cb782-1" aria-hidden="true" tabindex="-1"></a>sheet_names <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">excel_sheets</span>(<span class="st">&quot;hospital_linelists.xlsx&quot;</span>)</span></code></pre></div>
<p>Voici les noms :</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb783-1"><a href="iteration.html#cb783-1" aria-hidden="true" tabindex="-1"></a>sheet_names</span></code></pre></div>
<pre><code>## [1] &quot;Central Hospital&quot;              &quot;Military Hospital&quot;             &quot;Missing&quot;                       &quot;Other&quot;                        
## [5] &quot;Port Hospital&quot;                 &quot;St. Mark&#39;s Maternity Hospital&quot;</code></pre>
<p>Maintenant que nous avons ce vecteur de noms, <code>map()</code> peut les fournir un par un à la fonction <code>import()</code>. Dans cet exemple, les <code>sheet_names</code> sont <code>.x</code> et <code>import()</code> est la fonction <code>.f</code>.</p>
<p>Rappelez-vous de la page <a href="import_export.html#import_export">Importation et exportation</a> que lorsqu’il est utilisé sur des classeurs Excel, <code>import()</code> peut accepter l’argument <code>which =</code> spécifiant la feuille à importer. Dans la fonction <code>.f</code> <code>import()</code>, nous fournissons <code>which = .x</code>, dont la valeur changera à chaque itération dans le vecteur <code>sheet_names</code> - d’abord “Central Hospital”, puis “Military Hospital”, etc.</p>
<p>A noter - parce que nous avons utilisé <code>map()</code>, les données de chaque feuille Excel seront enregistrées comme un cadre de données séparé dans une liste. Nous voulons que chacun de ces éléments de liste (cadres de données) ait un <em>nom</em>, donc avant de passer <code>sheet_names</code> à <code>map()</code>, nous le passons à travers <code>set_names()</code> de <strong>purrr</strong>, ce qui garantit que chaque élément de liste reçoit le nom approprié.</p>
<p>Nous enregistrons la liste de sortie comme <code>combined</code> (<code>combiné</code> en francais).</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb785-1"><a href="iteration.html#cb785-1" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> sheet_names <span class="sc">%&gt;%</span> </span>
<span id="cb785-2"><a href="iteration.html#cb785-2" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">set_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb785-3"><a href="iteration.html#cb785-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="at">.f =</span> <span class="sc">~</span><span class="fu">import</span>(<span class="st">&quot;hospital_linelists.xlsx&quot;</span>, <span class="at">which =</span> .x))</span></code></pre></div>
<p>Lorsque nous inspectons la sortie, nous voyons que les données de chaque feuille Excel sont enregistrées dans la liste avec un nom. C’est bien, mais nous n’avons pas tout à fait terminé.</p>
<p><img src="images/sheets_as_list.png" width="544" style="display: block; margin: auto;" /></p>
<p>Enfin, nous utilisons la fonction <code>bind_rows()</code> (de <strong>dplyr</strong>) qui accepte la liste des cadres de données structurés de manière similaire et les combine en un seul cadre de données. Pour créer une nouvelle colonne à partir de l’élément de liste <em>names</em>, nous utilisons l’argument <code>.id =</code> et lui fournissons le nom souhaité pour la nouvelle colonne.</p>
<p>Voici la séquence complète des commandes :</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="iteration.html#cb786-1" aria-hidden="true" tabindex="-1"></a>sheet_names <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">excel_sheets</span>(<span class="st">&quot;hospital_linelists.xlsx&quot;</span>) <span class="co"># extrait les noms des feuilles</span></span>
<span id="cb786-2"><a href="iteration.html#cb786-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb786-3"><a href="iteration.html#cb786-3" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> sheet_names <span class="sc">%&gt;%</span> <span class="co"># commence avec les noms de feuilles</span></span>
<span id="cb786-4"><a href="iteration.html#cb786-4" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">set_names</span>() <span class="sc">%&gt;%</span> <span class="co"># définit leurs noms</span></span>
<span id="cb786-5"><a href="iteration.html#cb786-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="at">.f =</span> <span class="sc">~</span><span class="fu">import</span>(<span class="st">&quot;hospital_linelists.xlsx&quot;</span>, <span class="at">which =</span> .x)) <span class="sc">%&gt;%</span> <span class="co"># itère, importe, sauvegarde dans la liste</span></span>
<span id="cb786-6"><a href="iteration.html#cb786-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">&quot;origin_sheet&quot;</span>) <span class="co"># combine la liste des cadres de données, en préservant l&#39;origine dans une nouvelle colonne  </span></span></code></pre></div>
<p>Et maintenant nous avons un cadre de données avec une colonne contenant la feuille d’origine !</p>
<p><img src="images/sheets_as_df.png" width="543" style="display: block; margin: auto;" /></p>
<p>Il existe des variantes de <code>map()</code> que vous devez connaître. Par exemple, <code>map_dfr()</code> renvoie un cadre de données, et non une liste. Ainsi, nous aurions pu l’utiliser pour la tâche ci-dessus et ne pas avoir à lier les rangées. Mais alors nous n’aurions pas été en mesure de capturer de quelle feuille (hôpital) chaque cas provenait.</p>
<p>D’autres variations incluent <code>map_chr()</code>, <code>map_dbl()</code>. Ces fonctions sont très utiles pour deux raisons. Premièrement, elles convertissent automatiquement la sortie d’une fonction itérative en un vecteur (et non en une liste). Deuxièmement, elles peuvent contrôler explicitement la classe dans laquelle les données reviennent - vous vous assurez que vos données reviennent sous forme de vecteur de caractères avec <code>map_chr()</code>, ou de vecteur numérique avec <code>map_dbl()</code>. Nous y reviendrons plus tard dans cette section !</p>
<p>Les fonctions <code>map_at()</code> et <code>map_if()</code> sont aussi très utiles pour l’itération - elles vous permettent de spécifier quels éléments d’une liste vous devez itérer ! Elles fonctionnent en appliquant simplement un vecteur d’index/noms (dans le cas de <code>map_at()</code>) ou un test logique (dans le cas de <code>map_if()</code>).</p>
<p>Prenons un exemple où nous ne voulons pas lire la première feuille de données de l’hôpital. Nous utilisons <code>map_at()</code> au lieu de <code>map()</code>, et spécifions l’argument <code>.at =</code> à <code>c(-1)</code> ce qui signifie <em>ne pas</em> utiliser le premier élément de <code>.x</code>. Alternativement, vous pouvez fournir un vecteur de nombres positifs, ou de noms, à <code>.at =</code> pour spécifier les éléments à utiliser.</p>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb787-1"><a href="iteration.html#cb787-1" aria-hidden="true" tabindex="-1"></a>sheet<span class="sc">-</span>names <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">excel_sheets</span>(<span class="st">&quot;hospital_linelinest.xlsx&quot;</span>)</span>
<span id="cb787-2"><a href="iteration.html#cb787-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb787-3"><a href="iteration.html#cb787-3" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> sheet_names <span class="sc">%&gt;%</span> </span>
<span id="cb787-4"><a href="iteration.html#cb787-4" aria-hidden="true" tabindex="-1"></a>     purrr<span class="sc">::</span><span class="fu">set_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb787-5"><a href="iteration.html#cb787-5" aria-hidden="true" tabindex="-1"></a>     <span class="co"># exclure la première feuille</span></span>
<span id="cb787-6"><a href="iteration.html#cb787-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">map_at</span>(<span class="at">.f =</span> <span class="sc">~</span><span class="fu">import</span>( <span class="st">&quot;hospital_linelists.xlsx&quot;</span>, <span class="at">which =</span> .x),</span>
<span id="cb787-7"><a href="iteration.html#cb787-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">.at =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>))</span></code></pre></div>
<p>Notez que le nom de la première feuille apparaîtra toujours comme un élément de la liste de sortie - mais ce n’est qu’un nom à un seul caractère (pas un cadre de données). Vous devrez supprimer cet élément avant de lier les lignes. Nous verrons comment supprimer et modifier des éléments de liste dans une section ultérieure.</p>
</div>
</div>
<div id="diviser-lensemble-de-données-et-exporter" class="section level3 unnumbered">
<h3>Diviser l’ensemble de données et exporter</h3>
<p>Ci-dessous, nous donnons un exemple de la façon de diviser un jeu de données en plusieurs parties, puis d’utiliser l’itération <code>map()</code> pour exporter chaque partie comme une feuille Excel séparée, ou comme un fichier CSV séparé.</p>
<div id="diviser-lensemble-de-données" class="section level4 unnumbered">
<h4>Diviser l’ensemble de données</h4>
<p>Disons que nous avons le cas complet <code>linelist</code> en tant que cadre de données, et que nous voulons maintenant créer une linelist séparée pour chaque hôpital et l’exporter comme un fichier CSV séparé. Ci-dessous, nous effectuons les étapes suivantes :</p>
<p>Utilisez <code>group_split()</code> (de <strong>dplyr</strong>) pour diviser le cadre de données <code>linelist</code> par des valeurs uniques dans la colonne <code>hospital</code>. La sortie est une liste contenant un cadre de données par sous-ensemble hospitalier.</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb788-1"><a href="iteration.html#cb788-1" aria-hidden="true" tabindex="-1"></a>linelist_split <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb788-2"><a href="iteration.html#cb788-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_split</span>(hospital)</span></code></pre></div>
<p>Nous pouvons exécuter <code>View(linelist_split)</code> et voir que cette liste contient 6 cadres de données (“tibbles”), chacun représentant les cas d’un hôpital.</p>
<p><img src="images/purrr_linelist_split.png" width="574" style="display: block; margin: auto;" /></p>
<p>Cependant, notez que les cadres de données de la liste n’ont pas de nom par défaut ! Nous voulons que chacun d’eux ait un nom, et que ce nom soit utilisé lors de l’enregistrement du fichier CSV.</p>
<p>Une approche pour extraire les noms est d’utiliser <code>pull()</code> (de <strong>dplyr</strong>) pour extraire la colonne <code>hospital</code> de chaque cadre de données dans la liste. Ensuite, pour être sûr, nous convertissons les valeurs en caractères et utilisons ensuite <code>unique()</code> pour obtenir le nom de ce cadre de données particulier. Toutes ces étapes sont appliquées à chaque cadre de données via <code>map()</code>.</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="iteration.html#cb789-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist_split) <span class="ot">&lt;-</span> linelist_split <span class="sc">%&gt;%</span> <span class="co"># Affectation aux noms des blocs de données listés </span></span>
<span id="cb789-2"><a href="iteration.html#cb789-2" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Extrayez les noms en effectuant ce qui suit pour chaque cadre de données : </span></span>
<span id="cb789-3"><a href="iteration.html#cb789-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">map</span>(<span class="at">.f =</span> <span class="sc">~</span><span class="fu">pull</span>(.x, hospital)) <span class="sc">%&gt;%</span> <span class="co"># Extraire la colonne hôpital</span></span>
<span id="cb789-4"><a href="iteration.html#cb789-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">map</span>(<span class="at">.f =</span> <span class="sc">~</span><span class="fu">as.character</span>(.x)) <span class="sc">%&gt;%</span> <span class="co"># Convertir en caractères, juste au cas où</span></span>
<span id="cb789-5"><a href="iteration.html#cb789-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">map</span>(<span class="at">.f =</span> <span class="sc">~</span><span class="fu">unique</span>(.x))                    <span class="co"># Prendre le nom unique de l&#39;hôpital</span></span></code></pre></div>
<p>Nous pouvons maintenant voir que chacun des éléments de la liste a un nom. On peut accéder à ces noms via `names(linelist_split)``.</p>
<p><img src="images/purrr_linelist_split_named.png" width="575" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb790-1"><a href="iteration.html#cb790-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist_split)</span></code></pre></div>
<pre><code>## [1] &quot;Central Hospital&quot;                     &quot;Military Hospital&quot;                    &quot;Missing&quot;                             
## [4] &quot;Other&quot;                                &quot;Port Hospital&quot;                        &quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</code></pre>
<div id="plus-dune-colonne-group_split" class="section level5 unnumbered">
<h5>Plus d’une colonne <code>group_split()</code></h5>
<p>Si vous souhaitez diviser la linelist par <em>plusieurs colonnes de regroupement</em>, par exemple pour produire un sous-ensemble linelist par intersection de l’hôpital ET du sexe, vous aurez besoin d’une approche différente pour nommer les éléments de la liste. Cela implique de collecter les “clés de groupe” uniques en utilisant <code>group_keys()</code> de <strong>dplyr</strong> - elles sont retournées comme un cadre de données. Vous pouvez ensuite combiner les clés de groupe en valeurs avec <code>unite()</code> comme indiqué ci-dessous, et attribuer ces noms de conglomérat à <code>linelist_split</code>.</p>
<div class="sourceCode" id="cb792"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb792-1"><a href="iteration.html#cb792-1" aria-hidden="true" tabindex="-1"></a><span class="co"># divise la linelist par les combinaisons uniques hôpital-sexe</span></span>
<span id="cb792-2"><a href="iteration.html#cb792-2" aria-hidden="true" tabindex="-1"></a>linelist_split <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb792-3"><a href="iteration.html#cb792-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_split</span>(hospital, gender)</span>
<span id="cb792-4"><a href="iteration.html#cb792-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb792-5"><a href="iteration.html#cb792-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extraire group_keys() sous forme de dataframe</span></span>
<span id="cb792-6"><a href="iteration.html#cb792-6" aria-hidden="true" tabindex="-1"></a>groupings <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb792-7"><a href="iteration.html#cb792-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(hospital, gender) <span class="sc">%&gt;%</span>       </span>
<span id="cb792-8"><a href="iteration.html#cb792-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_keys</span>()</span>
<span id="cb792-9"><a href="iteration.html#cb792-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb792-10"><a href="iteration.html#cb792-10" aria-hidden="true" tabindex="-1"></a>groupings <span class="co"># montre les groupements uniques </span></span></code></pre></div>
<pre><code>## # A tibble: 18 × 2
##    hospital                             gender
##    &lt;chr&gt;                                &lt;chr&gt; 
##  1 Central Hospital                     f     
##  2 Central Hospital                     m     
##  3 Central Hospital                     &lt;NA&gt;  
##  4 Military Hospital                    f     
##  5 Military Hospital                    m     
##  6 Military Hospital                    &lt;NA&gt;  
##  7 Missing                              f     
##  8 Missing                              m     
##  9 Missing                              &lt;NA&gt;  
## 10 Other                                f     
## 11 Other                                m     
## 12 Other                                &lt;NA&gt;  
## 13 Port Hospital                        f     
## 14 Port Hospital                        m     
## 15 Port Hospital                        &lt;NA&gt;  
## 16 St. Mark&#39;s Maternity Hospital (SMMH) f     
## 17 St. Mark&#39;s Maternity Hospital (SMMH) m     
## 18 St. Mark&#39;s Maternity Hospital (SMMH) &lt;NA&gt;</code></pre>
<p>Maintenant nous combinons les groupements ensemble, séparés par des tirets, et nous les assignons comme noms des éléments de la liste dans <code>linelist_split</code>. Cela prend quelques lignes supplémentaires car nous remplaçons <code>NA</code> par “Missing”, nous utilisons <code>unite()</code> de <strong>dplyr</strong> pour combiner les valeurs des colonnes ensemble (séparées par des tirets), puis nous les convertissons en un vecteur sans nom pour qu’il puisse être utilisé comme noms de <code>linelist_split</code>.</p>
<div class="sourceCode" id="cb794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb794-1"><a href="iteration.html#cb794-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinez en une seule valeur de nom </span></span>
<span id="cb794-2"><a href="iteration.html#cb794-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist_split) <span class="ot">&lt;-</span> groupings <span class="sc">%&gt;%</span> </span>
<span id="cb794-3"><a href="iteration.html#cb794-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), replace_na, <span class="st">&quot;Missing&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># Remplacer NA par &quot;Missing&quot; dans toutes les colonnes</span></span>
<span id="cb794-4"><a href="iteration.html#cb794-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">unite</span>(<span class="st">&quot;combined&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># Réunit toutes les valeurs des colonnes en une seule</span></span>
<span id="cb794-5"><a href="iteration.html#cb794-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">setNames</span>(<span class="cn">NULL</span>) <span class="sc">%&gt;%</span> <span class="co"># d&#39;unification de toutes les valeurs de colonnes en une seule </span></span>
<span id="cb794-6"><a href="iteration.html#cb794-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">as_vector</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb794-7"><a href="iteration.html#cb794-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">as.list</span>()</span></code></pre></div>
</div>
</div>
<div id="exporter-en-tant-que-feuilles-excel" class="section level4 unnumbered">
<h4>Exporter en tant que feuilles Excel</h4>
<p>Pour exporter les listes de lignes de l’hôpital comme <em>un classeur Excel avec une liste de lignes par feuille</em>, nous pouvons simplement fournir la liste nommée <code>linelist_split</code> à la fonction <code>write_xlsx()</code> du paquet <strong>writexl</strong>. Cela permet d’enregistrer un classeur Excel avec plusieurs feuilles. Les noms des éléments de la liste sont automatiquement appliqués comme noms de feuilles.</p>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="iteration.html#cb795-1" aria-hidden="true" tabindex="-1"></a>linelist_split <span class="sc">%&gt;%</span> </span>
<span id="cb795-2"><a href="iteration.html#cb795-2" aria-hidden="true" tabindex="-1"></a>     writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(<span class="at">path =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;hospital_linelists.xlsx&quot;</span>))</span></code></pre></div>
<p>Vous pouvez maintenant ouvrir le fichier Excel et voir que chaque hôpital a sa propre feuille.</p>
<p><img src="images/purrr_export_sheets.png" width="652" style="display: block; margin: auto;" /></p>
</div>
<div id="exportation-en-fichiers-csv" class="section level4 unnumbered">
<h4>Exportation en fichiers CSV</h4>
<p>C’est une commande un peu plus complexe, mais vous pouvez également exporter chaque liste de lignes spécifique à un hôpital sous forme de fichier CSV distinct, avec un nom de fichier spécifique à l’hôpital.</p>
<p>Encore une fois, nous utilisons <code>map()</code> : nous prenons le vecteur des noms des éléments de la liste (montré ci-dessus) et utilisons <code>map()</code> pour les parcourir, en appliquant <code>export()</code> (du paquet <strong>rio</strong>, voir la page <a href="import_export.html#import_export">Importation et exportation</a>) sur le cadre de données dans la liste <code>linelist_split</code> qui a ce nom. Nous utilisons également le nom pour créer un nom de fichier unique. Voici comment cela fonctionne :</p>
<ul>
<li>Nous commençons avec le vecteur de noms de caractères, passé à <code>map()</code> sous la forme <code>.x</code>.<br />
</li>
<li>La fonction <code>.f</code> est <code>export()</code>, qui requiert un cadre de données et un chemin de fichier pour l’écriture.<br />
</li>
<li>L’entrée <code>.x</code> (le nom de l’hôpital) est utilisée *dans <code>.f</code> pour extraire/indexer cet élément spécifique de la liste <code>linelist_split</code>. Il en résulte qu’un seul cadre de données à la fois est fourni à <code>export()</code>.<br />
</li>
<li>Par exemple, lorsque <code>map()</code> cherche “Military Hospital”, alors <code>linelist_split[[.x]]</code> est en fait <code>linelist_split[["Military Hospital"]]</code>, retournant ainsi le deuxième élément de <code>linelist_split</code> - qui est tous les cas de Military Hospital.<br />
</li>
<li>Le chemin du fichier fourni à <code>export()</code> est dynamique grâce à l’utilisation de <code>str_glue()</code> (voir la page <a href="character_strings.html#character_strings">Caractères et chaînes de caractères</a>) :
<ul>
<li><code>here()</code> est utilisé pour obtenir la base du chemin du fichier et spécifier le dossier “data” (notez les guillemets simples pour ne pas interrompre les guillemets doubles de <code>str_glue()</code>).<br />
</li>
</ul></li>
<li>Puis une barre oblique <code>/</code>, et encore le <code>.x</code> qui imprime le nom de l’hôpital actuel pour rendre le fichier identifiable<br />
</li>
<li>Enfin, l’extension “.csv” que <code>export()</code> utilise pour créer un fichier CSV.</li>
</ul>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb796-1"><a href="iteration.html#cb796-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist_split) <span class="sc">%&gt;%</span></span>
<span id="cb796-2"><a href="iteration.html#cb796-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">map</span>(<span class="at">.f =</span> <span class="sc">~</span><span class="fu">export</span>(linelist_split[[.x]], <span class="at">file =</span> <span class="fu">str_glue</span>(<span class="st">&quot;{here(&#39;data&#39;)}/{.x}.csv&quot;</span>)))</span></code></pre></div>
<p>Maintenant vous pouvez voir que chaque fichier est enregistré dans le dossier “data” du projet R “Epi_R_handbook” !</p>
<p><img src="images/purrr_export_csv.png" width="632" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="fonctions-personnalisées" class="section level3 unnumbered">
<h3>Fonctions personnalisées</h3>
<p>Vous pouvez créer votre propre fonction à fournir à <code>map()</code>.</p>
<p>Disons que nous voulons créer des courbes épidémiques pour les cas de chaque hôpital. Pour faire cela en utilisant <strong>purrr</strong>, notre fonction <code>.f</code> peut être <code>ggplot()</code> et les extensions avec <code>+</code> comme d’habitude. Comme la sortie de <code>map()</code> est toujours une liste, les graphiques sont stockés dans une liste. Comme ce sont des tracés, ils peuvent être extraits et tracés avec la fonction <code>ggarrange()</code> du paquet <strong>ggpubr</strong> ( <a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">documentation</a>).</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="iteration.html#cb797-1" aria-hidden="true" tabindex="-1"></a><span class="co"># charger le paquetage pour tracer les éléments d&#39;une liste</span></span>
<span id="cb797-2"><a href="iteration.html#cb797-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggpubr)</span>
<span id="cb797-3"><a href="iteration.html#cb797-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb797-4"><a href="iteration.html#cb797-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cartographier le vecteur des 6 &quot;noms&quot; d&#39;hôpitaux (créé précédemment)</span></span>
<span id="cb797-5"><a href="iteration.html#cb797-5" aria-hidden="true" tabindex="-1"></a><span class="co"># utiliser la fonction ggplot spécifiée</span></span>
<span id="cb797-6"><a href="iteration.html#cb797-6" aria-hidden="true" tabindex="-1"></a><span class="co"># la sortie est une liste avec 6 ggplots</span></span>
<span id="cb797-7"><a href="iteration.html#cb797-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb797-8"><a href="iteration.html#cb797-8" aria-hidden="true" tabindex="-1"></a>hospital_names <span class="ot">&lt;-</span> <span class="fu">unique</span>(linelist<span class="sc">$</span>hospital)</span>
<span id="cb797-9"><a href="iteration.html#cb797-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb797-10"><a href="iteration.html#cb797-10" aria-hidden="true" tabindex="-1"></a>my_plots <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb797-11"><a href="iteration.html#cb797-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> hospital_names,</span>
<span id="cb797-12"><a href="iteration.html#cb797-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span><span class="fu">ggplot</span>(<span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hospital <span class="sc">==</span> .x)) <span class="sc">+</span></span>
<span id="cb797-13"><a href="iteration.html#cb797-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> date_onset)) <span class="sc">+</span></span>
<span id="cb797-14"><a href="iteration.html#cb797-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">labs</span>(<span class="at">title =</span> .x)</span>
<span id="cb797-15"><a href="iteration.html#cb797-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb797-16"><a href="iteration.html#cb797-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb797-17"><a href="iteration.html#cb797-17" aria-hidden="true" tabindex="-1"></a><span class="co"># imprimer les ggplots (ils sont stockés dans une liste)</span></span>
<span id="cb797-18"><a href="iteration.html#cb797-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> my_plots, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-620-1.png" width="672" /></p>
<p>Si ce code <code>map()</code> vous semble trop compliqué, vous pouvez obtenir le même résultat en enregistrant votre commande <code>ggplot()</code> spécifique comme une fonction personnalisée définie par l’utilisateur, par exemple nous pouvons la nommer <code>make_epicurve())</code>. Cette fonction est ensuite utilisée dans la fonction <code>map()</code>. <code>.x</code> sera itérativement remplacé par le nom de l’hôpital, et utilisé comme <code>hosp_name</code> dans la fonction <code>make_epicurve()</code>. Voir la page sur les <a href="writing_functions.html#writing_functions">Fonctions d’écriture</a>.</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="iteration.html#cb798-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer une fonction</span></span>
<span id="cb798-2"><a href="iteration.html#cb798-2" aria-hidden="true" tabindex="-1"></a>make_epicurve <span class="ot">&lt;-</span> <span class="cf">function</span>(hosp_name){</span>
<span id="cb798-3"><a href="iteration.html#cb798-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb798-4"><a href="iteration.html#cb798-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hospital <span class="sc">==</span> hosp_name)) <span class="sc">+</span></span>
<span id="cb798-5"><a href="iteration.html#cb798-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> date_onset)) <span class="sc">+</span></span>
<span id="cb798-6"><a href="iteration.html#cb798-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb798-7"><a href="iteration.html#cb798-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> hosp_name)</span>
<span id="cb798-8"><a href="iteration.html#cb798-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb798-9"><a href="iteration.html#cb798-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="iteration.html#cb799-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cartographie</span></span>
<span id="cb799-2"><a href="iteration.html#cb799-2" aria-hidden="true" tabindex="-1"></a>my_plots <span class="ot">&lt;-</span> <span class="fu">map</span>(hospital_names, <span class="sc">~</span><span class="fu">make_epicurve</span>(<span class="at">hosp_name =</span> .x))</span>
<span id="cb799-3"><a href="iteration.html#cb799-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-4"><a href="iteration.html#cb799-4" aria-hidden="true" tabindex="-1"></a><span class="co"># imprimer les ggplots (ils sont stockés dans une liste)</span></span>
<span id="cb799-5"><a href="iteration.html#cb799-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> my_plots, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span></code></pre></div>
</div>
<div id="mappage-dune-fonction-sur-plusieurs-colonnes" class="section level3 unnumbered">
<h3>Mappage d’une fonction sur plusieurs colonnes</h3>
<p>Un autre cas d’utilisation courant est de mapper une fonction sur plusieurs colonnes. Ci-dessous, nous <code>mappons()</code> la fonction <code>t.test()</code> sur les colonnes numériques du cadre de données <code>linelist</code>, en comparant les valeurs numériques par sexe.</p>
<p>Rappelez-vous de la page sur les <a href="stats_test.html#stats_test">Tests statistiques simples</a> que <code>t.test()</code> peut prendre des entrées dans un format de formule, comme <code>t.test(colonne numérique ~ colonne binaire)</code>. Dans cet exemple, nous faisons ce qui suit :</p>
<ul>
<li>Les colonnes numériques intéressantes sont sélectionnées dans <code>linelist</code> - elles deviennent les entrées <code>.x</code> de <code>map()</code>.<br />
</li>
<li>La fonction <code>t.test()</code> est fournie comme fonction <code>.f</code>, qui est appliquée à chaque colonne numérique.<br />
</li>
<li>Dans les parenthèses de <code>t.test()</code>:
<ul>
<li>le premier <code>~</code> précède la fonction <code>.f</code> que <code>map()</code> va itérer sur <code>.x</code><br />
</li>
<li>Le <code>.x</code> représente la colonne courante fournie à la fonction <code>t.test()</code>.<br />
</li>
<li>Le deuxième <code>~</code> fait partie de l’équation du test t décrit ci-dessus.<br />
</li>
<li>La fonction <code>t.test()</code> attend une colonne binaire du côté droit de l’équation. Nous fournissons le vecteur <code>linelist$gender</code> indépendamment et statiquement (notez qu’il n’est pas inclus dans <code>select()</code>).</li>
</ul></li>
</ul>
<p><code>map()</code> retourne une liste, donc la sortie est une liste de résultats de tests t - un élément de liste pour chaque colonne numérique analysée.</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="iteration.html#cb800-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les résultats sont enregistrés sous forme de liste</span></span>
<span id="cb800-2"><a href="iteration.html#cb800-2" aria-hidden="true" tabindex="-1"></a>t.test_results <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb800-3"><a href="iteration.html#cb800-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age, wt_kg, ht_cm, ct_blood, temp) <span class="sc">%&gt;%</span> <span class="co"># Ne garder que certaines colonnes numériques pour les mapper entre elles</span></span>
<span id="cb800-4"><a href="iteration.html#cb800-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="at">.f =</span> <span class="sc">~</span><span class="fu">t.test</span>(.x <span class="sc">~</span> linelist<span class="sc">$</span>gender))        <span class="co"># fonction t.test, avec équation NUMERIC ~ CATEGORICAL</span></span></code></pre></div>
<p>Voici à quoi ressemble la liste <code>t.test_results</code> lorsqu’elle est ouverte (visualisée) dans RStudio. Nous avons mis en évidence les parties qui sont importantes pour les exemples de cette page.</p>
<ul>
<li>Vous pouvez voir en haut que la liste entière est nommée <code>t.test_results</code> et a cinq éléments. Ces cinq éléments sont nommés <code>age</code>, <code>wt_km</code>, <code>ht_cm</code>, <code>ct_blood</code>, <code>temp</code> après chaque variable qui a été utilisée dans un test t avec <code>gender</code> de la <code>linelist</code>.<br />
</li>
<li>Chacun de ces cinq éléments sont eux-mêmes des listes, avec des éléments à l’intérieur comme <code>p.value</code> et <code>conf.int</code>. Certains de ces éléments, comme <code>p.value</code>, sont des nombres simples, tandis que d’autres, comme <code>estimate</code>, sont composés de deux éléments ou plus (<code>mean in group f</code> et <code>mean in group m</code>).</li>
</ul>
<p><img src="images/purrr_ttest.png" width="286" height="150%" /></p>
<p>Remarque : N’oubliez pas que si vous voulez appliquer une fonction à certaines colonnes seulement d’un cadre de données, vous pouvez aussi utiliser simplement <code>mutate()</code> et <code>across()</code>, comme expliqué dans la page <a href="cleaning_data.html#cleaning_data">Nettoyage des données et fonctions de base</a>. Vous trouverez ci-dessous un exemple d’application de <code>as.character()</code> aux seules colonnes “age”. Notez l’emplacement des parenthèses et des virgules.</p>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb801-1"><a href="iteration.html#cb801-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convertit les colonnes dont le nom contient &quot;age&quot; en classe Character</span></span>
<span id="cb801-2"><a href="iteration.html#cb801-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb801-3"><a href="iteration.html#cb801-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">contains</span>(<span class="st">&quot;age&quot;</span>), <span class="at">.fns =</span> as.character))  </span></code></pre></div>
</div>
<div id="extraire-des-listes" class="section level3 unnumbered">
<h3>Extraire des listes</h3>
<p>Comme <code>map()</code> produit une sortie de la classe List, nous allons passer un peu de temps à discuter de la façon d’extraire des données de listes en utilisant les fonctions <strong>purrr</strong> qui les accompagnent. Pour le démontrer, nous allons utiliser la liste <code>t.test_results</code> de la section précédente. C’est une liste de 5 listes - chacune des 5 listes contient les résultats d’un test t entre une colonne du cadre de données <code>linelist</code> et sa colonne binaire <code>gender</code>. Voir l’image dans la section ci-dessus pour un visuel de la structure de la liste.</p>
<div id="noms-des-éléments" class="section level4 unnumbered">
<h4>Noms des éléments</h4>
<p>Pour extraire les noms des éléments eux-mêmes, utilisez simplement <code>names()</code> de <strong>base</strong> R. Dans ce cas, nous utilisons <code>names()</code> sur <code>t.test_results</code> pour retourner les noms de chaque sous-liste, qui sont les noms des 5 variables qui ont eu des tests t effectués.</p>
<div class="sourceCode" id="cb802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="iteration.html#cb802-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(t.test_results)</span></code></pre></div>
<pre><code>## [1] &quot;age&quot;      &quot;wt_kg&quot;    &quot;ht_cm&quot;    &quot;ct_blood&quot; &quot;temp&quot;</code></pre>
</div>
<div id="éléments-par-nom-ou-par-position" class="section level4 unnumbered">
<h4>Éléments par nom ou par position</h4>
<p>Pour extraire les éléments d’une liste par nom ou par position, vous pouvez utiliser des crochets “[[ ]]” comme décrit dans la page <a href="rbasics.html#rbasics">bases de R</a>. Ci-dessous, nous utilisons des doubles crochets pour indexer la liste <code>t.tests_results</code> et afficher le premier élément qui est le résultat du test t sur <code>age</code>.</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="iteration.html#cb804-1" aria-hidden="true" tabindex="-1"></a>t.test_results[[<span class="dv">1</span>]] <span class="co"># premier élément par position</span></span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  .x by linelist$gender
## t = -21.3, df = 4902.9, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means between group f and group m is not equal to 0
## 95 percent confidence interval:
##  -7.544409 -6.272675
## sample estimates:
## mean in group f mean in group m 
##        12.66085        19.56939</code></pre>
<div class="sourceCode" id="cb806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb806-1"><a href="iteration.html#cb806-1" aria-hidden="true" tabindex="-1"></a>t.test_results[[<span class="dv">1</span>]][ <span class="st">&quot;p.value&quot;</span>] <span class="co"># retourne l&#39;élément nommé &quot;p.value&quot; à partir du premier élément  </span></span></code></pre></div>
<pre><code>## $p.value
## [1] 2.350374e-96</code></pre>
<p>Cependant, nous allons démontrer ci-dessous l’utilisation des fonctions <strong>purrr</strong> simples et flexibles <code>map()</code> et <code>pluck()</code> pour obtenir les mêmes résultats.</p>
</div>
<div id="pluck" class="section level4 unnumbered">
<h4><code>pluck()</code></h4>
<p><code>pluck()</code> extrait les éléments par nom ou par position. Par exemple - pour extraire les résultats du test t pour l’âge, vous pouvez utiliser <code>pluck()</code> comme ceci :</p>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb808-1"><a href="iteration.html#cb808-1" aria-hidden="true" tabindex="-1"></a>t.test_results <span class="sc">%&gt;%</span> </span>
<span id="cb808-2"><a href="iteration.html#cb808-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">&quot;age&quot;</span>) <span class="co"># Ou bien, utilisez pluck(1)</span></span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  .x by linelist$gender
## t = -21.3, df = 4902.9, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means between group f and group m is not equal to 0
## 95 percent confidence interval:
##  -7.544409 -6.272675
## sample estimates:
## mean in group f mean in group m 
##        12.66085        19.56939</code></pre>
<p>Indexez des niveaux plus profonds en spécifiant les autres niveaux avec des virgules. L’exemple ci-dessous extrait l’élément nommé “p.value” de la liste <code>age</code> dans la liste <code>t.test_results</code>. Vous pouvez également utiliser des nombres à la place des noms de caractères.</p>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb810-1"><a href="iteration.html#cb810-1" aria-hidden="true" tabindex="-1"></a>t.test_results <span class="sc">%&gt;%</span> </span>
<span id="cb810-2"><a href="iteration.html#cb810-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;p.value&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 2.350374e-96</code></pre>
<p>Vous pouvez extraire ces éléments internes de <em>tous</em> les éléments de premier niveau en utilisant <code>map()</code> pour exécuter la fonction <code>pluck()</code> sur chaque élément de premier niveau. Par exemple, le code ci-dessous extrait les éléments “p.value” de toutes les listes de <code>t.test_results</code>. La liste des résultats du test t est le <code>.x</code> itéré, <code>pluck()</code> est la fonction <code>.f</code> itérée, et la valeur “p-value” est fournie à la fonction.</p>
<div class="sourceCode" id="cb812"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb812-1"><a href="iteration.html#cb812-1" aria-hidden="true" tabindex="-1"></a>t.test_results <span class="sc">%&gt;%</span></span>
<span id="cb812-2"><a href="iteration.html#cb812-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(pluck, <span class="st">&quot;p.value&quot;</span>) <span class="co"># renvoie chaque valeur p</span></span></code></pre></div>
<pre><code>## $age
## [1] 2.350374e-96
## 
## $wt_kg
## [1] 2.664367e-182
## 
## $ht_cm
## [1] 3.515713e-144
## 
## $ct_blood
## [1] 0.4473498
## 
## $temp
## [1] 0.5735923</code></pre>
<p>Comme autre alternative, <code>map()</code> offre un raccourci qui vous permet d’écrire le nom de l’élément entre guillemets, et il le récupérera. Si vous utilisez <code>map()</code>, la sortie sera une liste, alors que si vous utilisez <code>map_chr()</code>, ce sera un tableau de caractères nommé et si vous utilisez <code>map_dbl()</code>, ce sera un tableau numérique nommé.</p>
<div class="sourceCode" id="cb814"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb814-1"><a href="iteration.html#cb814-1" aria-hidden="true" tabindex="-1"></a>t.test_results <span class="sc">%&gt;%</span> </span>
<span id="cb814-2"><a href="iteration.html#cb814-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(<span class="st">&quot;p.value&quot;</span>) <span class="co"># renvoie les valeurs p sous la forme d&#39;un tableau numérique nommé</span></span></code></pre></div>
<pre><code>##           age         wt_kg         ht_cm      ct_blood          temp 
##  2.350374e-96 2.664367e-182 3.515713e-144  4.473498e-01  5.735923e-01</code></pre>
<p>Vous pouvez en savoir plus sur <code>pluck()</code> dans sa <strong>purrr</strong> <a href="https://purrr.tidyverse.org/reference/pluck.html">documentation</a>. Elle a une fonction sour <code>chuck()</code> qui retournera une erreur au lieu de NULL si un élément n’existe pas.</p>
</div>
</div>
<div id="convertir-une-liste-en-cadre-de-données" class="section level3 unnumbered">
<h3>Convertir une liste en cadre de données</h3>
<p>Ceci est un sujet complexe - voir la section Ressources pour des tutoriels plus complets. Néanmoins, nous allons démontrer la conversion de la liste des résultats du test t en un cadre de données. Nous allons créer un cadre de données avec des colonnes pour la variable, sa valeur p, et les moyennes des deux groupes (hommes et femmes).</p>
<p>Voici quelques-unes des nouvelles approches et fonctions qui seront utilisées :</p>
<ul>
<li>La fonction <code>tibble()</code> sera utilisée pour créer un tibble (comme un cadre de données).
<ul>
<li>Nous entourons la fonction <code>tibble()</code> de crochets <code>{ }</code> pour éviter que la totalité de <code>t.test_results</code> soit stockée dans la première colonne du tibble.<br />
</li>
</ul></li>
<li>Dans <code>tibble()</code>, chaque colonne est créée explicitement, de façon similaire à la syntaxe de <code>mutate()</code> :
<ul>
<li>Le <code>.</code> représente <code>t.test_results</code></li>
<li>Pour créer une colonne avec les noms des variables t-test (les noms de chaque élément de la liste), nous utilisons <code>names()</code> comme décrit ci-dessus.<br />
</li>
<li>Pour créer une colonne avec les valeurs p, nous utilisons <code>map_dbl()</code> comme décrit ci-dessus pour extraire les éléments <code>p.value</code> et les convertir en un tableau numérique.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb816"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb816-1"><a href="iteration.html#cb816-1" aria-hidden="true" tabindex="-1"></a>t.test_results <span class="sc">%&gt;%</span> {</span>
<span id="cb816-2"><a href="iteration.html#cb816-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb816-3"><a href="iteration.html#cb816-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables =</span> <span class="fu">names</span>(.),</span>
<span id="cb816-4"><a href="iteration.html#cb816-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">map_dbl</span>(., <span class="st">&quot;p.value&quot;</span>))</span>
<span id="cb816-5"><a href="iteration.html#cb816-5" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   variables         p
##   &lt;chr&gt;         &lt;dbl&gt;
## 1 age       2.35e- 96
## 2 wt_kg     2.66e-182
## 3 ht_cm     3.52e-144
## 4 ct_blood  4.47e-  1
## 5 temp      5.74e-  1</code></pre>
<p>Mais maintenant, ajoutons des colonnes contenant les moyennes pour chaque groupe (hommes et femmes).</p>
<p>Nous devrions extraire l’élément <code>estimate</code>, mais celui-ci contient en fait <em>deux</em> éléments (<code>mean in group f</code> et <code>mean in group m</code>). On ne peut donc pas le simplifier en vecteur avec <code>map_chr()</code> ou <code>map_dbl()</code>. A la place, nous utilisons <code>map()</code>, qui utilisé dans <code>tibble()</code> créera <em>une colonne de liste de classe dans le tibble</em> ! Oui, c’est possible !</p>
<div class="sourceCode" id="cb818"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb818-1"><a href="iteration.html#cb818-1" aria-hidden="true" tabindex="-1"></a>t.test_results <span class="sc">%&gt;%</span> </span>
<span id="cb818-2"><a href="iteration.html#cb818-2" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">tibble</span>(</span>
<span id="cb818-3"><a href="iteration.html#cb818-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables =</span> <span class="fu">names</span>(.),</span>
<span id="cb818-4"><a href="iteration.html#cb818-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">map_dbl</span>(., <span class="st">&quot;p.value&quot;</span>),</span>
<span id="cb818-5"><a href="iteration.html#cb818-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">means =</span> <span class="fu">map</span>(., <span class="st">&quot;estimation&quot;</span>))}</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   variables         p means       
##   &lt;chr&gt;         &lt;dbl&gt; &lt;named list&gt;
## 1 age       2.35e- 96 &lt;NULL&gt;      
## 2 wt_kg     2.66e-182 &lt;NULL&gt;      
## 3 ht_cm     3.52e-144 &lt;NULL&gt;      
## 4 ct_blood  4.47e-  1 &lt;NULL&gt;      
## 5 temp      5.74e-  1 &lt;NULL&gt;</code></pre>
<p>Une fois que vous avez cette colonne de liste, il existe plusieurs fonctions <strong>tidyr</strong> (faisant partie de <strong>tidyverse</strong>) qui vous aident à “rectangler” ou à “désimbriquer” ces colonnes de “liste imbriquée”. Vous pouvez en savoir plus à leur sujet <a href="">ici</a>, ou en exécutant <code>vignette("rectangle")</code>. En bref:</p>
<ul>
<li><code>unnest_wider()</code> - donne à chaque élément d’une colonne de liste sa propre colonne.<br />
</li>
<li><code>unnest_longer()</code> - donne à chaque élément d’une liste-colonne sa propre ligne</li>
<li><code>hoist()</code> - agit comme <code>unnest_wider()</code> mais vous spécifiez les éléments à dépiler.</li>
</ul>
<p>Ci-dessous, nous passons le tibble à <code>unnest_wider()</code> en spécifiant la colonne <code>means</code> du tibble (qui est une liste imbriquée). Le résultat est que <code>means</code> est remplacé par deux nouvelles colonnes, chacune reflétant les deux éléments qui étaient précédemment dans chaque cellule <code>means</code>.</p>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb820-1"><a href="iteration.html#cb820-1" aria-hidden="true" tabindex="-1"></a>t.test_results <span class="sc">%&gt;%</span> </span>
<span id="cb820-2"><a href="iteration.html#cb820-2" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">tibble</span>(</span>
<span id="cb820-3"><a href="iteration.html#cb820-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables =</span> <span class="fu">names</span>(.),</span>
<span id="cb820-4"><a href="iteration.html#cb820-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">map_dbl</span>(., <span class="st">&quot;p.value&quot;</span>),</span>
<span id="cb820-5"><a href="iteration.html#cb820-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">means =</span> <span class="fu">map</span>(., <span class="st">&quot;estimate&quot;</span>)</span>
<span id="cb820-6"><a href="iteration.html#cb820-6" aria-hidden="true" tabindex="-1"></a>    )} <span class="sc">%&gt;%</span> </span>
<span id="cb820-7"><a href="iteration.html#cb820-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(means)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
##   variables         p `mean in group f` `mean in group m`
##   &lt;chr&gt;         &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;
## 1 age       2.35e- 96              12.7              19.6
## 2 wt_kg     2.66e-182              45.8              59.6
## 3 ht_cm     3.52e-144             109.              142. 
## 4 ct_blood  4.47e-  1              21.2              21.2
## 5 temp      5.74e-  1              38.6              38.6</code></pre>
</div>
<div id="jeter-conserver-et-compacter-les-listes" class="section level3 unnumbered">
<h3>Jeter, conserver et compacter les listes</h3>
<p>Parce que le travail avec <strong>purrr</strong> implique si souvent des listes, nous allons explorer brièvement certaines fonctions <strong>purrr</strong> pour modifier les listes. Voir la section Ressources pour des tutoriels plus complets sur les fonctions <strong>purrr</strong>.</p>
<ul>
<li><code>list_modify()</code> a de nombreuses utilisations, dont l’une peut être de supprimer un élément de liste<br />
</li>
<li><code>keep()</code> conserve les éléments spécifiés dans <code>.p =</code>, ou lorsqu’une fonction fournie dans <code>.p =</code> évalue VRAI.<br />
</li>
<li><code>discard()</code> supprime les éléments spécifiés dans <code>.p</code>, ou lorsqu’une fonction fournie à <code>.p =</code> vaut VRAI.<br />
</li>
<li><code>compact()</code> supprime tous les éléments vides.</li>
</ul>
<p>Voici quelques exemples utilisant la liste <code>combined</code> créée dans la section ci-dessus sur <a href="iteration.html#iter_combined">l’utilisation de map() pour importer et combiner plusieurs fichiers</a> (elle contient 6 cadres de données de listes de cas) :</p>
<p>Les éléments peuvent être supprimés par leur nom avec <code>list_modify()</code> et en mettant le nom égal à <code>NULL</code>.</p>
<div class="sourceCode" id="cb822"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb822-1"><a href="iteration.html#cb822-1" aria-hidden="true" tabindex="-1"></a>combined <span class="sc">%&gt;%</span> </span>
<span id="cb822-2"><a href="iteration.html#cb822-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_modify</span>(<span class="st">&quot;Central Hospital&quot;</span> <span class="ot">=</span> <span class="cn">NULL</span>) <span class="co"># Suppression d&#39;un élément de liste par son nom</span></span></code></pre></div>
<p>Vous pouvez également supprimer des éléments par critère, en fournissant une équation “prédicat” à <code>.p =</code> (une équation qui évalue à VRAI ou FAUX). Placez un tilde <code>~</code> devant la fonction et utilisez <code>.x</code> pour représenter l’élément de la liste. En utilisant <code>keep()</code>, les éléments de la liste qui valent VRAI seront conservés. Inversement, si vous utilisez <code>discard()</code>, les éléments de la liste qui valent VRAI seront supprimés.</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb823-1"><a href="iteration.html#cb823-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ne conserve que les éléments de liste de plus de 500 lignes</span></span>
<span id="cb823-2"><a href="iteration.html#cb823-2" aria-hidden="true" tabindex="-1"></a>combined <span class="sc">%&gt;%</span> </span>
<span id="cb823-3"><a href="iteration.html#cb823-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(<span class="at">.p =</span> <span class="sc">~</span><span class="fu">nrow</span>(.x) <span class="sc">&gt;</span> <span class="dv">500</span>)  </span></code></pre></div>
<p>Dans l’exemple ci-dessous, les éléments de liste sont éliminés si leur classe n’est pas un cadre de données.</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb824-1"><a href="iteration.html#cb824-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppression des éléments de liste qui ne sont pas des cadres de données</span></span>
<span id="cb824-2"><a href="iteration.html#cb824-2" aria-hidden="true" tabindex="-1"></a>combinws <span class="sc">%&gt;%</span> </span>
<span id="cb824-3"><a href="iteration.html#cb824-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discard</span>(<span class="at">.p =</span> <span class="sc">~</span><span class="fu">class</span>(.x) <span class="sc">!=</span> <span class="st">&quot;data.frame&quot;</span>)</span></code></pre></div>
<p>Votre fonction prédicat peut également faire référence à des éléments/colonnes dans chaque élément de la liste. Par exemple, ci-dessous, les éléments de liste dont la moyenne de la colonne <code>ct_blood</code> est supérieure à 25 sont éliminés.</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb825-1"><a href="iteration.html#cb825-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ne conserve que les éléments de liste dont la moyenne de la colonne ct_blood est supérieure à 25</span></span>
<span id="cb825-2"><a href="iteration.html#cb825-2" aria-hidden="true" tabindex="-1"></a>combined <span class="sc">%&gt;%</span> </span>
<span id="cb825-3"><a href="iteration.html#cb825-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discard</span>(<span class="at">.p =</span> <span class="sc">~</span><span class="fu">mean</span>(.x<span class="sc">$</span>ct_blood) <span class="sc">&gt;</span> <span class="dv">25</span>)  </span></code></pre></div>
<p>Cette commande supprimerait tous les éléments de liste vides :</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="iteration.html#cb826-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprime tous les éléments de liste vides</span></span>
<span id="cb826-2"><a href="iteration.html#cb826-2" aria-hidden="true" tabindex="-1"></a>combined <span class="sc">%&gt;%</span> </span>
<span id="cb826-3"><a href="iteration.html#cb826-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compact</span>()</span></code></pre></div>
</div>
<div id="pmap" class="section level3 unnumbered">
<h3><code>pmap()</code></h3>
<p>CETTE SECTION EST EN CONSTRUCTION</p>
</div>
</div>
<div id="fonctions-dapplication" class="section level2" number="16.4">
<h2><span class="header-section-number">16.4</span> Fonctions d’application</h2>
<p>La famille de fonctions “apply” est une alternative <strong>base</strong> R à <strong>purrr</strong> pour les opérations itératives. Vous pouvez en savoir plus à leur sujet <a href="https://www.datacamp.com/community/tutorials/r-tutorial-apply-family">ici</a>.</p>
<!-- ======================================================= -->
</div>
<div id="resources-4" class="section level2" number="16.5">
<h2><span class="header-section-number">16.5</span> Resources</h2>
<p><a href="https://datacarpentry.org/semester-biology/materials/for-loops-R/">for loops with Data Carpentry</a></p>
<p>The <a href="https://r4ds.had.co.nz/iteration.html#iteration">R for Data Science page on iteration</a></p>
<p><a href="https://martinctc.github.io/blog/vignette-write-and-read-multiple-excel-files-with-purrr/">Vignette on write/read Excel files</a></p>
<p>A purrr <a href="https://jennybc.github.io/purrr-tutorial/index.html">tutorial</a> by jennybc</p>
<p>Another purrr <a href="http://www.rebeccabarter.com/blog/2019-08-19_purrr/">tutorial</a> by Rebecca Barter</p>
<p>A purrr <a href="http://zevross.com/blog/2019/06/11/the-power-of-three-purrr-poseful-iteration-in-r-with-map-pmap-and-imap/">tutorial</a> on map, pmap, and imap</p>
<p><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/master/pngs/thumbnails/purrr-cheatsheet-thumbs.png">purrr cheatsheet</a></p>
<p><a href="https://www.emilhvitfeldt.com/post/2018-01-08-purrr-tips-and-tricks/">purrr tips and tricks</a></p>
<p><a href="https://hookedondata.org/going-off-the-map/#keep-and-discard">keep and discard</a></p>

</div>
</div>



</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
