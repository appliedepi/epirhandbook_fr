<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>8 Nettoyage de données et fonctions essentielles | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="8 Nettoyage de données et fonctions essentielles | The Epidemiologist R Handbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Nettoyage de données et fonctions essentielles | The Epidemiologist R Handbook" />
  
  <meta name="twitter:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.2/transition.js"></script>
    <script src="libs/bs3compat-0.4.2/tabs.js"></script>
    <script src="libs/bs3compat-0.4.2/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.27/datatables.js"></script>
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
    <script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.9/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.1/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="cleaning_data" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Nettoyage de données et fonctions essentielles</h1>
<p><img src="images/cleaning.png" width="265" height="10%" style="display: block; margin: auto;" /></p>
<p>Cette page présente les étapes courantes du processus de “nettoyage” d’un jeu de données, et apporte également des explications sur l’utilisation de nombreuses fonctions essentielles dans le traitement des données R.</p>
<p>Pour expliquer le nettoyage des données, cette page commence par l’importation d’un jeu de données brutes de cas dénommé linelist, et présente le processus de nettoyage étape par étape. Dans le code R, cela se manifeste par une chaîne “pipe”, qui fait référence à l’opérateur “pipe” <code>%&gt;%</code> qui fait passer un jeu de données d’une opération à l’autre.</p>
<div id="fonctions-principales" class="section level3 unnumbered">
<h3>Fonctions principales</h3>
<p>Ce manuel met l’accent sur l’utilisation des fonctions provenant du package <a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a>, appartenant à la famille des packages de R. L’essentiel des fonctions de R présentées dans cette page sont listées ci-dessous.</p>
<p>Beaucoup de ces fonctions appartiennent au package R <a href="https://dplyr.tidyverse.org/"><strong>dplyr</strong></a>, qui fournit des fonctions “verbes” pour résoudre les problèmes de manipulation des données (le nom fait référence à un <a href="https://en.wikipedia.org/wiki/Pliers">“dataframe”- plier</a>. <strong>dplyr</strong> fait partie de la famille de packages R <strong>tidyverse</strong> (qui qui consiste de <strong>ggplot2</strong>, <strong>tidyr</strong>, <strong>stringr</strong>, <strong>tibble</strong>, <strong>purrr</strong>, <strong>magrittr</strong>, et <strong>forcats</strong> entre autres).</p>
<table>
<colgroup>
<col width="17%" />
<col width="46%" />
<col width="35%" />
</colgroup>
<thead>
<tr class="header">
<th>Fonction</th>
<th>Utilité</th>
<th>Package</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>%&gt;%</code></td>
<td>“pipe” (passe) les données d’une fonction à l’autre</td>
<td><strong>magrittr</strong></td>
</tr>
<tr class="even">
<td><code>mutate()</code></td>
<td>créer, transformer et redéfinir des colonnes</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><code>select()</code></td>
<td>conserver, supprimer, sélectionner ou renommer des colonnes</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>rename()</code></td>
<td>renommer des colonnes</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><code>clean_names()</code></td>
<td>standardiser la syntaxe des noms de colonnes</td>
<td><strong>janitor</strong></td>
</tr>
<tr class="even">
<td><code>as.character()</code>, <code>as.numeric()</code>, <code>as.Date()</code>, etc.</td>
<td>convertir la classe d’une colonne</td>
<td><strong>base</strong> R</td>
</tr>
<tr class="odd">
<td><code>across()</code></td>
<td>transformer plusieurs colonnes en même temps</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td>Fonctions <strong>tidyselect</strong></td>
<td>utiliser la logique pour sélectionner des colonnes</td>
<td><strong>tidyselect</strong>.</td>
</tr>
<tr class="odd">
<td><code>filter()</code></td>
<td>Ne conserver que certaines lignes</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>distinct()</code></td>
<td>dédupliquer des lignes</td>
<td><strong>dplyr</strong>*.</td>
</tr>
<tr class="odd">
<td><code>rowwise()</code></td>
<td>effectuer ds opérations par/dans chaque ligne</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>add_row()</code></td>
<td>ajouter manuellement des lignes</td>
<td><strong>tibble</strong></td>
</tr>
<tr class="odd">
<td><code>arrange()</code></td>
<td>ordonner des lignes</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>recode()</code></td>
<td>re-coder les valeurs dans une colonne</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><code>case_when()</code></td>
<td>re-coder les valeurs d’une colonne en utilisant des critères logiques plus complexes</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>replace_na()</code>, <code>na_if()</code>, <code>coalesce()</code></td>
<td>des fonctions spéciales pour le recodage</td>
<td><strong>tidyr</strong></td>
</tr>
<tr class="odd">
<td><code>age_categories()</code> et <code>cut()</code></td>
<td>créer des groupes catégoriels à partir d’une colonne numérique</td>
<td><strong>epikit</strong> et <strong>base</strong> R</td>
</tr>
<tr class="even">
<td><code>match_df()</code></td>
<td>re-coder/nettoyer des valeurs en utilisant un dictionnaire de données</td>
<td><strong>matchmaker</strong></td>
</tr>
<tr class="odd">
<td><code>which()</code></td>
<td>application de critères logiques ; retourne des indices</td>
<td><strong>base</strong> R</td>
</tr>
</tbody>
</table>
<p>Si vous souhaitez comparer ces fonctions aux commandes de Stata ou de SAS, consultez la page <a href="transition_to_r.html#transition_to_r">Transition vers R</a>.</p>
<p>Vous pouvez rencontrer une méthode alternative de gestion des données à partir du package R <strong>data.table</strong> avec des opérateurs comme <code>:=</code> et l’utilisation fréquente de crochets <code>[ ]</code>. Cette approche et cette syntaxe sont brièvement expliquées dans la page <a href="data_table.html#data_table">Data Table</a>.</p>
</div>
<div id="nomenclature-1" class="section level3 unnumbered">
<h3>Nomenclature</h3>
<p>Dans ce manuel, nous faisons généralement référence aux “colonnes” et aux “lignes” au lieu des “variables” et des “observations”. Comme l’explique cet introduction sur <a href="https://tidyr.tidyverse.org/articles/tidy-data.html">“tidy data”</a>, la plupart des jeux de données statistiques épidémiologiques sont sous le format de lignes, de colonnes et de valeurs.</p>
<p><em>Les variables</em> contiennent les valeurs qui mesurent le même attribut sous-jacent (comme le groupe d’âge, le résultat ou la date d’apparition). <em>Les observations</em> contiennent toutes les valeurs mesurées sur la même unité (par exemple, une personne, un site ou un échantillon de laboratoire). Ces aspects peuvent donc être plus difficiles à définir de manière précise.</p>
<p>Dans les jeux de données “tidy”, chaque colonne est une variable, chaque ligne est une observation et chaque cellule est une valeur unique. Cependant, certains jeu de données que vous rencontrerez ne correspondront pas à ce format - un jeu de données “étendu” (ou “large”) peut avoir une variable répartie sur plusieurs colonnes (voir un exemple dans la page <a href="pivoting_data.html#pivoting_data">Pivoter les données</a>). De même, les observations peuvent être réparties sur plusieurs lignes.</p>
<p>La majeure partie de ce manuel porte sur la gestion et la transformation des données, et il est donc plus pertinent de se référer aux structures de données concrètes que sont les lignes et les colonnes qu’aux observations et aux variables plus abstraites. Les exceptions se produisent principalement dans les pages sur l’analyse des données, où vous verrez davantage de références aux variables et aux observations.</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="méthodologie-de-nettoyage" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Méthodologie de nettoyage</h2>
<p><strong>Cette page passe en revue les étapes importantes du nettoyage, en les ajoutant séquentiellement à une “chaîne de nettoyage”.</strong></p>
<p>Dans l’analyse épidémiologique et le traitement des données, les étapes de nettoyage sont souvent effectuées de manière séquentielle, reliées entre elles. En R, cela se manifeste souvent sous la forme d’un “pipeline” de nettoyage, où <em>le jeu de données brutes est passé ou “pipé” d’une étape de nettoyage à une autre</em>.</p>
<p>De telles chaînes utilisent les fonctions “verbes” de <strong>dplyr</strong> et l’opérateur pipe <code>%&gt;%</code> de <strong>magrittr</strong>. Ce pipe commence avec les données “brutes” (“linelist_raw.xlsx”) et se termine avec un dataframe “propre” (<code>linelist</code>) qui peut être utilisé, enregistré, exporté, etc.</p>
<p>Dans un pipeline de nettoyage, l’ordre des étapes est important. Les étapes de nettoyage peuvent inclure :</p>
<ul>
<li>Importation des données<br />
</li>
<li>Nettoyage ou modification des noms de colonnes<br />
</li>
<li>Déduplication<br />
</li>
<li>Création et transformation de colonnes (par exemple, recodage ou normalisation des valeurs).<br />
</li>
<li>Sélection ou ajout de lignes</li>
</ul>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="charger-les-packages" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Charger les packages</h2>
<p>Ces lignes de code chargent les paquets nécessaires aux analyses. Dans ce guide, nous mettons l’accent sur <code>p_load()</code> de <strong>pacman</strong>, qui installe le paquet si nécessaire <em>puis</em> l’importe pour l’utiliser. Vous pouvez également charger les paquets installés avec <code>library()</code> de <strong>base</strong> R. Voir la page sur <a href="rbasics.html#rbasics">bases de R</a> pour plus d’informations sur les paquets R.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="cleaning_data.html#cb177-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb177-2"><a href="cleaning_data.html#cb177-2" aria-hidden="true" tabindex="-1"></a>  rio,        <span class="co"># importation données  </span></span>
<span id="cb177-3"><a href="cleaning_data.html#cb177-3" aria-hidden="true" tabindex="-1"></a>  here,       <span class="co"># chemins d&#39;accès relatifs aux fichiers  </span></span>
<span id="cb177-4"><a href="cleaning_data.html#cb177-4" aria-hidden="true" tabindex="-1"></a>  janitor,    <span class="co"># nettoyage des données et tables</span></span>
<span id="cb177-5"><a href="cleaning_data.html#cb177-5" aria-hidden="true" tabindex="-1"></a>  lubridate,  <span class="co"># manipuler les dates</span></span>
<span id="cb177-6"><a href="cleaning_data.html#cb177-6" aria-hidden="true" tabindex="-1"></a>  epikit,     <span class="co"># age_categories() fonction</span></span>
<span id="cb177-7"><a href="cleaning_data.html#cb177-7" aria-hidden="true" tabindex="-1"></a>  matchmaker, <span class="co"># nettoyage basé sur un dictionnaire</span></span>
<span id="cb177-8"><a href="cleaning_data.html#cb177-8" aria-hidden="true" tabindex="-1"></a>  tidyverse   <span class="co"># manipulation et visualisation  des donnees </span></span>
<span id="cb177-9"><a href="cleaning_data.html#cb177-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="import-data" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Import data</h2>
<div id="import" class="section level3 unnumbered">
<h3>Import</h3>
<p>Ici, nous importons le fichier Excel “brut” de cas linelist en utilisant la fonction <code>import()</code> du package <strong>rio</strong>. Cet dernier gère de manière flexible de nombreux types de fichiers (par exemple, .xlsx, .csv, .tsv, .rds). <a href="import_export">Importation et exportation des données</a> pour plus d’informations et des conseils sur les situations inhabituelles (par exemple, sauter des lignes, définir des valeurs manquantes, importer des feuilles Google, etc.)</p>
<p>Pour reproduire les étapes, <a href='https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_raw.xlsx' class='download-button'>cliquer pour télécharger le jeu de données “brutes” linelist</a> (comme fichier .xlsx ).</p>
<p>Si votre jeu de données est important et prend beaucoup de temps à s’importer, il peut valloir le coup de séparer la commande d’importation des étapes de nettoyage, pour que que la donnée “brute” soit enregistré dans un dataframe distinct. Cela permet également de comparer facilement les versions originales et nettoyées.</p>
<p>Ci-dessous, nous importons le fichier Excel brut et le sauvegardons dans le dataframe <code>linelist_raw</code>. Nous supposons que le fichier est situé dans votre répertoire de travail ou à la racine de votre projet R, et donc aucun sous-dossier n’est spécifié dans le chemin du fichier.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="cleaning_data.html#cb178-1" aria-hidden="true" tabindex="-1"></a>linelist_raw <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist.xlsx&quot;</span>)</span></code></pre></div>
<p>Vous pouvez visualiser les 50 premières lignes du dataframe ci-dessous. Remarque : la fonction de <strong>base</strong> de R <code>head(n)</code> vous permet de visualiser uniquement les <code>n</code> premières lignes dans la console R.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6aefdd95646ed426e9b4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6aefdd95646ed426e9b4">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08T00:00:00Z",null,null,"2014-05-04T00:00:00Z","2014-05-18T00:00:00Z","2014-05-03T00:00:00Z","2014-05-22T00:00:00Z","2014-05-28T00:00:00Z",null,null,"2014-05-30T00:00:00Z","2014-05-28T00:00:00Z","2014-06-14T00:00:00Z","2014-06-07T00:00:00Z","2014-06-09T00:00:00Z",null,null,null,"2014-06-23T00:00:00Z","2014-06-18T00:00:00Z","2014-06-24T00:00:00Z",null,null,"2014-07-03T00:00:00Z",null,"2014-07-10T00:00:00Z","2014-06-14T00:00:00Z",null,"2014-06-18T00:00:00Z","2014-06-29T00:00:00Z","2014-07-02T00:00:00Z","2014-07-12T00:00:00Z","2014-07-12T00:00:00Z","2014-06-13T00:00:00Z","2014-07-15T00:00:00Z","2014-06-20T00:00:00Z",null,null,"2014-07-20T00:00:00Z",null,"2014-07-12T00:00:00Z","2014-07-19T00:00:00Z","2014-07-18T00:00:00Z","2014-07-18T00:00:00Z","2014-07-27T00:00:00Z",null,"2014-07-19T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-17T00:00:00Z","2014-06-17T00:00:00Z","2014-06-20T00:00:00Z","2014-06-19T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-27T00:00:00Z","2014-06-28T00:00:00Z","2014-06-29T00:00:00Z","2014-07-03T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-17T00:00:00Z","2014-07-17T00:00:00Z","2014-07-18T00:00:00Z","2014-07-19T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-24T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z","2014-07-27T00:00:00Z","2014-07-25T00:00:00Z","2014-07-27T00:00:00Z","2014-07-31T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z"],[null,"2014-05-18T00:00:00Z","2014-05-30T00:00:00Z",null,"2014-05-29T00:00:00Z","2014-05-24T00:00:00Z","2014-06-01T00:00:00Z","2014-06-07T00:00:00Z","2014-06-18T00:00:00Z","2014-06-09T00:00:00Z","2014-06-15T00:00:00Z",null,"2014-07-09T00:00:00Z",null,"2014-06-30T00:00:00Z","2014-07-11T00:00:00Z","2014-07-01T00:00:00Z","2014-06-25T00:00:00Z","2014-07-06T00:00:00Z","2014-07-02T00:00:00Z","2014-07-09T00:00:00Z","2014-07-07T00:00:00Z","2014-07-20T00:00:00Z",null,"2014-07-22T00:00:00Z","2014-07-16T00:00:00Z","2014-07-14T00:00:00Z","2014-07-20T00:00:00Z","2014-07-16T00:00:00Z","2014-07-19T00:00:00Z","2014-07-27T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-07-26T00:00:00Z","2014-08-14T00:00:00Z","2014-08-01T00:00:00Z","2014-07-23T00:00:00Z","2014-08-28T00:00:00Z","2014-07-28T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-08-03T00:00:00Z",null,null,null,"2014-08-06T00:00:00Z","2014-08-21T00:00:00Z","2014-09-13T00:00:00Z","2014-08-04T00:00:00Z",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Marks Maternity Hopital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],["2","3","56","18","3","16","16","0","61","27","12","42","19","7","7","13","35","17","11","11","19","54","14","28","6","3","31","6","67","14","10","21","20","45","1","12","3","15","20","36","7","13","14","3","10","1","0","20","26","14"],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],["a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a"],["b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>infection date<\/th>\n      <th>date onset<\/th>\n      <th>hosp date<\/th>\n      <th>date_of_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>row_num<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>merged_header<\/th>\n      <th>...28<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,15,16,17,18,24]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="vue-densemble" class="section level3 unnumbered">
<h3>Vue d’ensemble</h3>
<p>Vous pouvez utiliser la fonction <code>skim()</code> du package <strong>skimr</strong> pour obtenir une vue d’ensemble du dataframe (voir la page sur les <a href="descriptive_tables.html#descriptive_tables">Tableaux descriptifs</a> pour plus d’informations). Les colonnes sont résumées par classe/type, telles que “chaîne de caractère”, “numérique”… Note : “POSIXct” est un type de classe de date brute (voir <a href="working_dates.html#working_dates">Working with dates</a>).</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="cleaning_data.html#cb179-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(linelist_raw)</span></code></pre></div>
<table style="width: auto;" class="table table-condensed">
<caption>
<span id="tab:unnamed-chunk-147">Table 8.1: </span>Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
linelist_raw
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
6611
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
28
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
POSIXct
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
max
</th>
<th style="text-align:right;">
empty
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:right;">
whitespace
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
case_id
</td>
<td style="text-align:right;">
137
</td>
<td style="text-align:right;">
0.98
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5888
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
date onset
</td>
<td style="text-align:right;">
293
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
580
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
outcome
</td>
<td style="text-align:right;">
1500
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
gender
</td>
<td style="text-align:right;">
324
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
hospital
</td>
<td style="text-align:right;">
1512
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
infector
</td>
<td style="text-align:right;">
2323
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2697
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
source
</td>
<td style="text-align:right;">
2323
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:right;">
107
</td>
<td style="text-align:right;">
0.98
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
age_unit
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
fever
</td>
<td style="text-align:right;">
258
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
chills
</td>
<td style="text-align:right;">
258
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
cough
</td>
<td style="text-align:right;">
258
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
aches
</td>
<td style="text-align:right;">
258
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
vomit
</td>
<td style="text-align:right;">
258
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
time_admission
</td>
<td style="text-align:right;">
844
</td>
<td style="text-align:right;">
0.87
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1091
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
merged_header
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
…28
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
generation
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
16.60
</td>
<td style="text-align:right;">
5.71
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
13.00
</td>
<td style="text-align:right;">
16.00
</td>
<td style="text-align:right;">
20.00
</td>
<td style="text-align:right;">
37.00
</td>
</tr>
<tr>
<td style="text-align:left;">
lon
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
-13.23
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
-13.27
</td>
<td style="text-align:right;">
-13.25
</td>
<td style="text-align:right;">
-13.23
</td>
<td style="text-align:right;">
-13.22
</td>
<td style="text-align:right;">
-13.21
</td>
</tr>
<tr>
<td style="text-align:left;">
lat
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
8.47
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
8.45
</td>
<td style="text-align:right;">
8.46
</td>
<td style="text-align:right;">
8.47
</td>
<td style="text-align:right;">
8.48
</td>
<td style="text-align:right;">
8.49
</td>
</tr>
<tr>
<td style="text-align:left;">
row_num
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
3240.91
</td>
<td style="text-align:right;">
1857.83
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1647.50
</td>
<td style="text-align:right;">
3241.00
</td>
<td style="text-align:right;">
4836.50
</td>
<td style="text-align:right;">
6481.00
</td>
</tr>
<tr>
<td style="text-align:left;">
wt_kg
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
52.69
</td>
<td style="text-align:right;">
18.59
</td>
<td style="text-align:right;">
-11.00
</td>
<td style="text-align:right;">
41.00
</td>
<td style="text-align:right;">
54.00
</td>
<td style="text-align:right;">
66.00
</td>
<td style="text-align:right;">
111.00
</td>
</tr>
<tr>
<td style="text-align:left;">
ht_cm
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
125.25
</td>
<td style="text-align:right;">
49.57
</td>
<td style="text-align:right;">
4.00
</td>
<td style="text-align:right;">
91.00
</td>
<td style="text-align:right;">
130.00
</td>
<td style="text-align:right;">
159.00
</td>
<td style="text-align:right;">
295.00
</td>
</tr>
<tr>
<td style="text-align:left;">
ct_blood
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
21.26
</td>
<td style="text-align:right;">
1.67
</td>
<td style="text-align:right;">
16.00
</td>
<td style="text-align:right;">
20.00
</td>
<td style="text-align:right;">
22.00
</td>
<td style="text-align:right;">
22.00
</td>
<td style="text-align:right;">
26.00
</td>
</tr>
<tr>
<td style="text-align:left;">
temp
</td>
<td style="text-align:right;">
158
</td>
<td style="text-align:right;">
0.98
</td>
<td style="text-align:right;">
38.60
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
35.20
</td>
<td style="text-align:right;">
38.30
</td>
<td style="text-align:right;">
38.80
</td>
<td style="text-align:right;">
39.20
</td>
<td style="text-align:right;">
40.80
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: POSIXct</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:left;">
min
</th>
<th style="text-align:left;">
max
</th>
<th style="text-align:left;">
median
</th>
<th style="text-align:right;">
n_unique
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
infection date
</td>
<td style="text-align:right;">
2322
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;">
2012-04-09
</td>
<td style="text-align:left;">
2015-04-27
</td>
<td style="text-align:left;">
2014-10-04
</td>
<td style="text-align:right;">
538
</td>
</tr>
<tr>
<td style="text-align:left;">
hosp date
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:left;">
2012-04-20
</td>
<td style="text-align:left;">
2015-04-30
</td>
<td style="text-align:left;">
2014-10-15
</td>
<td style="text-align:right;">
570
</td>
</tr>
<tr>
<td style="text-align:left;">
date_of_outcome
</td>
<td style="text-align:right;">
1068
</td>
<td style="text-align:right;">
0.84
</td>
<td style="text-align:left;">
2012-05-14
</td>
<td style="text-align:left;">
2015-06-04
</td>
<td style="text-align:left;">
2014-10-26
</td>
<td style="text-align:right;">
575
</td>
</tr>
</tbody>
</table>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="noms-de-colonnes" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Noms de colonnes</h2>
<p>En R, les <em>noms</em> de colonnes sont la valeur “d’en-tête” ou la “première cellule” d’une colonne. Ils sont utilisés pour faire référence aux colonnes dans le code et servent de labels par défaut dans les figures.</p>
<p>D’autres logiciels statistiques tels que SAS et STATA utilisent des <em>“labels”</em> qui représentent un format plus long et détaillé des noms de colonnes plus courts existants. Bien que R offre la possibilité d’ajouter des étiquettes de colonne aux données, cela n’est pas mis en avant en pratique. Pour rendre les noms de colonne explicites et descriptifs pour les figures, on ajuste généralement leur affichage dans les commandes de qui créent les graphiques (par exemple, les titres des axes ou des légendes d’une graphique, ou les en-têtes de colonne dans un tableau imprimé - voir la section <a href="ggplot_tips.html#ggplot_tips_scales">section échelles de la page Astuces de ggplot</a> et les pages <a href="tables_presentation.html#tables_presentation">Tableaux pour la présentation</a>). Si vous souhaitez attribuer des étiquettes de colonne dans les données, lisez la suite en ligne <a href="https://cran.r-project.org/web/packages/expss/vignettes/labels-support.html">ici</a> et <a href="https://cran.r-project.org/web/packages/labelled/vignettes/intro_labelled.html">ici</a>.</p>
<p>Comme les noms de colonnes sur R sont utilisés très souvent, ils doivent avoir une syntaxe “propre”. Nous suggérons ce qui suit :</p>
<ul>
<li>Noms courts<br />
</li>
<li>Pas d’espaces (remplacez-les par des traits de soulignement _ )<br />
</li>
<li>Pas de caractères inhabituels (&amp;, #, &lt;, &gt;, …)<br />
</li>
<li>Nomenclature homogène (par exemple, toutes les colonnes de date nommées comme <strong>date_</strong>apparition, <strong>date_</strong>rapport, <strong>date_</strong>mort…)</li>
</ul>
<p>Les noms des colonnes de <code>linelist_raw</code> sont affichés ci-dessous en utilisant la fonction <code>names()</code> de <strong>base</strong> R. On peut voir qu’initialement :</p>
<ul>
<li>Certains noms contiennent des espaces (par exemple <code>date d'infection</code>)<br />
</li>
<li>Des motifs de noms différents sont utilisés pour les dates (<code>date onset</code> vs. <code>infection date</code>).<br />
</li>
<li>Il doit y avoir un <em>même nom</em> attribué pour les deux dernières colonnes du fichier .xlsx. Nous le savons parce que le nom de deux colonnes fusionnées (“merged_header”) a été attribué par R à la première colonne, et que la deuxième colonne s’est vue attribuer un nom fictif “…28” (puisqu’elle était alors vide et qu’il s’agit de la 28ième colonne).</li>
</ul>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="cleaning_data.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist_raw)</span></code></pre></div>
<pre><code>##  [1] &quot;case_id&quot;         &quot;generation&quot;      &quot;infection date&quot;  &quot;date onset&quot;      &quot;hosp date&quot;       &quot;date_of_outcome&quot; &quot;outcome&quot;        
##  [8] &quot;gender&quot;          &quot;hospital&quot;        &quot;lon&quot;             &quot;lat&quot;             &quot;infector&quot;        &quot;source&quot;          &quot;age&quot;            
## [15] &quot;age_unit&quot;        &quot;row_num&quot;         &quot;wt_kg&quot;           &quot;ht_cm&quot;           &quot;ct_blood&quot;        &quot;fever&quot;           &quot;chills&quot;         
## [22] &quot;cough&quot;           &quot;aches&quot;           &quot;vomit&quot;           &quot;temp&quot;            &quot;time_admission&quot;  &quot;merged_header&quot;   &quot;...28&quot;</code></pre>
<p><span style="color : black ;"><strong><em>REMARQUE:</em></strong> Pour faire référence à un nom de colonne qui comprend des espaces, entourez le nom de contre-tirets, par exemple : linelist$<code>`'\x60infection date\x60'`</code>. Notez que sur votre clavier, le contre-tiret (`) est différent du guillemet simple (’).</span></p>
<div id="labels" class="section level3 unnumbered">
<h3>Labels</h3>
<p>D’autres logiciels statistiques tels que SAS ont des <em>labels</em> de variables.</p>
</div>
<div id="nettoyage-automatique" class="section level3 unnumbered">
<h3>Nettoyage automatique</h3>
<p>La fonction <code>clean_names()</code> du package <strong>janitor</strong> normalise les noms de colonnes et les rend uniques en effectuant les opérations suivantes :</p>
<ul>
<li>Convertit tous les noms pour qu’ils ne soient composés que de underscores (sous-tiret/tiret “bas”/tiret 8), de chiffres et de lettres.<br />
</li>
<li>Les caractères accentués sont translittérés en ASCII (par exemple, le o allemand avec tréma devient “o”, le “enye” espagnol devient “n”).<br />
</li>
<li>La préférence de capitalisation pour les nouveaux noms de colonnes peut être spécifiée en utilisant l’argument <code>case =</code> (“snake” est le défaut, les alternatives incluent “phrase”, “title”, “small_camel”…)<br />
</li>
<li>Vous pouvez spécifier des remplacements de noms spécifiques en fournissant un vecteur à l’argument <code>replace =</code> (par exemple, <code>replace = c(onset = "date_of_onset")</code>)</li>
</ul>
<p>Pour en savoir plus, voici la <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#cleaning">vignette</a> en ligne. .</p>
<p>Ci-dessous, le pipeline de nettoyage commence par utiliser <code>clean_names()</code> sur le dataframe contenant les données brutes.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="cleaning_data.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pipe le jeu de données brutes à travers clean_names(), puis assigne le resultat à un nouveau dataframe, &quot;linelist&quot;  </span></span>
<span id="cb182-2"><a href="cleaning_data.html#cb182-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span> </span>
<span id="cb182-3"><a href="cleaning_data.html#cb182-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb182-4"><a href="cleaning_data.html#cb182-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-5"><a href="cleaning_data.html#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="co"># voir les nouveaux noms de colonnes</span></span>
<span id="cb182-6"><a href="cleaning_data.html#cb182-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist)</span></code></pre></div>
<pre><code>##  [1] &quot;case_id&quot;         &quot;generation&quot;      &quot;infection_date&quot;  &quot;date_onset&quot;      &quot;hosp_date&quot;       &quot;date_of_outcome&quot; &quot;outcome&quot;        
##  [8] &quot;gender&quot;          &quot;hospital&quot;        &quot;lon&quot;             &quot;lat&quot;             &quot;infector&quot;        &quot;source&quot;          &quot;age&quot;            
## [15] &quot;age_unit&quot;        &quot;row_num&quot;         &quot;wt_kg&quot;           &quot;ht_cm&quot;           &quot;ct_blood&quot;        &quot;fever&quot;           &quot;chills&quot;         
## [22] &quot;cough&quot;           &quot;aches&quot;           &quot;vomit&quot;           &quot;temp&quot;            &quot;time_admission&quot;  &quot;merged_header&quot;   &quot;x28&quot;</code></pre>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> le dernier nom de colonne “…28” est changé pour devenir “x28”.</span></p>
</div>
<div id="nettoyage-manuel-des-noms" class="section level3 unnumbered">
<h3>Nettoyage manuel des noms</h3>
<p>Il est souvent nécessaire de renommer les colonnes manuellement, même après l’étape de normalisation ci-dessus. Ci-dessous, le changement de nom est effectué en utilisant la fonction <code>rename()</code> du package <strong>dplyr</strong>, dans une chaine de commandes pipées. <code>rename()</code> utilise le style <code>NEW = OLD</code> - le nouveau nom de colonne est donné avant l’ancien nom de colonne.</p>
<p>Ci-dessous, une commande de re-nommage est ajoutée au pipeline de nettoyage. Des espaces ont été ajoutés stratégiquement pour aligner le code afin de faciliter la lecture.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="cleaning_data.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NETTOYAGE: enchainement de commandes  &#39;PIPE&#39;  (debute avec la donnée brute  et suivi de  pipes avec les commandes pour le nettoyage)</span></span>
<span id="cb184-2"><a href="cleaning_data.html#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb184-3"><a href="cleaning_data.html#cb184-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb184-4"><a href="cleaning_data.html#cb184-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb184-5"><a href="cleaning_data.html#cb184-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># standardiser la syntaxe des noms de colonnes </span></span>
<span id="cb184-6"><a href="cleaning_data.html#cb184-6" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb184-7"><a href="cleaning_data.html#cb184-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb184-8"><a href="cleaning_data.html#cb184-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># renommer manuellement les noms de colonnes</span></span>
<span id="cb184-9"><a href="cleaning_data.html#cb184-9" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Nouveau noms             # Ancien noms</span></span>
<span id="cb184-10"><a href="cleaning_data.html#cb184-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb184-11"><a href="cleaning_data.html#cb184-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb184-12"><a href="cleaning_data.html#cb184-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome)</span></code></pre></div>
<p>Vous pouvez maintenant voir que les noms des colonnes ont été modifiés :</p>
<pre><code>##  [1] &quot;case_id&quot;              &quot;generation&quot;           &quot;date_infection&quot;       &quot;date_onset&quot;           &quot;date_hospitalisation&quot;
##  [6] &quot;date_outcome&quot;         &quot;outcome&quot;              &quot;gender&quot;               &quot;hospital&quot;             &quot;lon&quot;                 
## [11] &quot;lat&quot;                  &quot;infector&quot;             &quot;source&quot;               &quot;age&quot;                  &quot;age_unit&quot;            
## [16] &quot;row_num&quot;              &quot;wt_kg&quot;                &quot;ht_cm&quot;                &quot;ct_blood&quot;             &quot;fever&quot;               
## [21] &quot;chills&quot;               &quot;cough&quot;                &quot;aches&quot;                &quot;vomit&quot;                &quot;temp&quot;                
## [26] &quot;time_admission&quot;       &quot;merged_header&quot;        &quot;x28&quot;</code></pre>
<div id="renommer-par-la-position-des-colonnes" class="section level4 unnumbered">
<h4>Renommer par la position des colonnes</h4>
<p>Vous pouvez également renommer par position de colonne, au lieu du nom de colonne, par exemple :</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="cleaning_data.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co">#rename(newNameForFirstColumn  = 1,</span></span>
<span id="cb186-2"><a href="cleaning_data.html#cb186-2" aria-hidden="true" tabindex="-1"></a>       <span class="co">#newNameForSecondColumn = 2)</span></span></code></pre></div>
</div>
<div id="renommer-via-select-et-summarise" class="section level4 unnumbered">
<h4>Renommer via <code>select()</code> et <code>summarise()</code></h4>
<p>Comme raccourci, vous pouvez aussi renommer les colonnes dans les fonctions <strong>dplyr</strong> <code>select()</code> et <code>summarise()</code>. <code>select()</code> est utilisé pour ne garder que certaines colonnes (et est couvert plus loin dans cette page). La fonction <code>summarise()</code> est traitée dans les pages <a href="grouping_data.html#grouping_data">Regroupement des données</a> et <a href="descriptive_tables.html#descriptive_tables">Tableaux descriptifs</a>. Ces fonctions utilisent également le format <code>nouveau_nom = ancien_nom</code>. Voici un exemple :</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="cleaning_data.html#cb187-1" aria-hidden="true" tabindex="-1"></a>linelist_raw <span class="sc">%&gt;%</span> </span>
<span id="cb187-2"><a href="cleaning_data.html#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="co"># NOUVEAU nom             # ANCIEN nom</span></span>
<span id="cb187-3"><a href="cleaning_data.html#cb187-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_infection       =</span> <span class="st">`</span><span class="at">infection date</span><span class="st">`</span>,    <span class="co"># renommer and CONSEVER  que  ces colonnes</span></span>
<span id="cb187-4"><a href="cleaning_data.html#cb187-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_hospitalisation =</span> <span class="st">`</span><span class="at">hosp date</span><span class="st">`</span>)</span></code></pre></div>
</div>
</div>
<div id="autres-challenges" class="section level3 unnumbered">
<h3>Autres challenges</h3>
<div id="fichiers-excels-sans-noms-de-colonnes" class="section level4 unnumbered">
<h4>fichiers excels sans noms de colonnes</h4>
<p>R ne peut pas travailler sur des jeux de données qui n’ont pas de noms de colonne (en-têtes). Ainsi, si vous importez un jeu de données Excel contenant des données mais pas d’en-tête de colonne, R remplira les en-têtes avec des noms tels que “…1” ou “…2”. Le chiffre représente le numéro de la colonne (par exemple, si la quatrième colonne de l’ensemble de données n’a pas d’en-tête, R la nommera “…4”).</p>
<p>Vous pouvez nettoyer ces noms manuellement en faisant référence à leur numéro de position (voir l’exemple ci-dessus), ou au nom qui leur est attribué (<code>linelist_raw$...1</code>).</p>
</div>
<div id="fusion-des-noms-de-colonnes-et-de-cellules-sur-excel" class="section level4 unnumbered">
<h4>Fusion des noms de colonnes et de cellules sur Excel</h4>
<p>La fusion de cellules dans un fichier Excel est un phénomène courant lors de la réception de données. Comme expliqué dans <a href="#transition_to_R">Transition vers R</a>, les cellules fusionnées peuvent être agréables pour la lecture humaine des données, mais ne sont pas des “tidy data” et posent de nombreux problèmes pour la lecture automatique des données. R ne peut pas prendre en compte les cellules fusionnées.</p>
<p>Rappelez aux personnes chargées de la saisie des données que <strong>les données lisibles par l’homme ne sont pas les mêmes que celles lisibles par la machine</strong>. Efforcez-vous de former les utilisateurs aux principes des [<strong>Tidy Data</strong>] (<a href="https://r4ds.had.co.nz/tidy-data.html" class="uri">https://r4ds.had.co.nz/tidy-data.html</a>). Dans la mesure du possible, essayez de modifier les procédures pour que les données arrivent dans un format tidy, sans cellules fusionnées.</p>
<ul>
<li>Chaque variable doit avoir sa propre colonne.<br />
</li>
<li>Chaque observation doit avoir sa propre ligne.<br />
</li>
<li>Chaque valeur doit avoir sa propre cellule.</li>
</ul>
<p>Lorsque vous utilisez la fonction <code>import()</code> de <strong>rio</strong>, la valeur d’une cellule fusionnée sera assignée à la première cellule et les cellules suivantes seront vides.</p>
<p>Une solution pour gérer les cellules fusionnées est d’importer les données avec la fonction <code>readWorkbook()</code> du package <strong>openxlsx</strong>. Définissez l’argument <code>fillMergedCells = TRUE</code>. Cela donne la valeur d’une cellule fusionnée à toutes les cellules de la plage de fusion.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="cleaning_data.html#cb188-1" aria-hidden="true" tabindex="-1"></a>linelist_raw <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">readWorkbook</span>(<span class="st">&quot;linelist_raw.xlsx&quot;</span>, <span class="at">fillMergedCells =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><span style="color: red;"><strong><em>DANGERS:</em></strong> Si les noms de colonnes sont fusionnés avec <code>readWorkbook()</code>, vous vous retrouverez avec des noms de colonnes en double, que vous devrez corriger manuellement - R ne fonctionne pas bien avec des noms de colonnes en double ! Vous pouvez les renommer en faisant référence à leur position (par exemple colonne 5), comme expliqué dans la section sur le nettoyage manuel des noms de colonnes.</span></p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="sélectionner-ou-réorganiser-les-colonnes" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Sélectionner ou réorganiser les colonnes</h2>
<p>Utilisez <code>select()</code> de <strong>dplyr</strong> pour sélectionner les colonnes que vous voulez conserver, et pour spécifier leur ordre dans le cadre de données.</p>
<p><span style="color: orange;"><strong><em>Avertissement:</em></strong> Dans les exemples ci-dessous, le dataframe <code>linelist</code> est modifié avec <code>select()</code> et affiché, mais pas enregistré. Ceci est pour les besoins de la démonstration. Les noms de colonnes modifiés sont renvoyés en passant (pipe)le dataframe dans <code>names()</code>.</span></p>
<p><strong>Voici TOUS les noms de colonnes dans la liste de lignes à ce stade de la chaîne de nettoyage :</strong>.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="cleaning_data.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist)</span></code></pre></div>
<pre><code>##  [1] &quot;case_id&quot;              &quot;generation&quot;           &quot;date_infection&quot;       &quot;date_onset&quot;           &quot;date_hospitalisation&quot;
##  [6] &quot;date_outcome&quot;         &quot;outcome&quot;              &quot;gender&quot;               &quot;hospital&quot;             &quot;lon&quot;                 
## [11] &quot;lat&quot;                  &quot;infector&quot;             &quot;source&quot;               &quot;age&quot;                  &quot;age_unit&quot;            
## [16] &quot;row_num&quot;              &quot;wt_kg&quot;                &quot;ht_cm&quot;                &quot;ct_blood&quot;             &quot;fever&quot;               
## [21] &quot;chills&quot;               &quot;cough&quot;                &quot;aches&quot;                &quot;vomit&quot;                &quot;temp&quot;                
## [26] &quot;time_admission&quot;       &quot;merged_header&quot;        &quot;x28&quot;</code></pre>
<div id="conserver-des-colonnes" class="section level3 unnumbered">
<h3>Conserver des colonnes</h3>
<p><strong>Selectionner uniquement les colonnes que vous voulez conserver</strong></p>
<p>Mettez leurs noms dans la commande <code>select()</code>, sans guillemets. Elles apparaîtront dans le dataframe dans l’ordre que vous avez indiqué. Notez que si vous incluez une colonne qui n’existe pas, R retournera une erreur (voir l’utilisation de <code>any_of()</code> ci-dessous si vous ne voulez pas d’erreur dans cette situation).</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="cleaning_data.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># jeu de donnée linelist est pipé  à travers la commande select() et names() affiche les noms de colones</span></span>
<span id="cb191-2"><a href="cleaning_data.html#cb191-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb191-3"><a href="cleaning_data.html#cb191-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_id, date_onset, date_hospitalisation, fever) <span class="sc">%&gt;%</span> </span>
<span id="cb191-4"><a href="cleaning_data.html#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()  <span class="co"># affiche le nom des colonnes</span></span></code></pre></div>
<pre><code>## [1] &quot;case_id&quot;              &quot;date_onset&quot;           &quot;date_hospitalisation&quot; &quot;fever&quot;</code></pre>
</div>
<div id="clean_tidyselect" class="section level3 unnumbered">
<h3>fonction d’aide “tidyselect”</h3>
<p>Ces fonctions d’aide existent pour faciliter la spécification des colonnes à conserver, à éliminer ou à transformer. Elles sont issues du package <strong>tidyselect</strong>, qui est inclus dans <strong>tidyverse</strong> et qui sous-tend la façon dont les colonnes sont sélectionnées dans les fonctions <strong>dplyr</strong>.</p>
<p>Par exemple, si vous voulez réordonner les colonnes, <code>everything()</code> est une fonction utile qui correspond à “toutes les autres colonnes non encore mentionnées”. La commande ci-dessous déplace les colonnes <code>date_onset</code> et <code>date_hospitalisation</code> au début (à gauche) du jeu de donnée, mais conserve toutes les autres colonnes par la suite. Notez que <code>everything()</code> est écrit avec des parenthèses vides :</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="cleaning_data.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># deplacer les colonnes data_onset et date_hospilisation au debut du jeu de donnée</span></span>
<span id="cb193-2"><a href="cleaning_data.html#cb193-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb193-3"><a href="cleaning_data.html#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date_onset, date_hospitalisation, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb193-4"><a href="cleaning_data.html#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;date_onset&quot;           &quot;date_hospitalisation&quot; &quot;case_id&quot;              &quot;generation&quot;           &quot;date_infection&quot;      
##  [6] &quot;date_outcome&quot;         &quot;outcome&quot;              &quot;gender&quot;               &quot;hospital&quot;             &quot;lon&quot;                 
## [11] &quot;lat&quot;                  &quot;infector&quot;             &quot;source&quot;               &quot;age&quot;                  &quot;age_unit&quot;            
## [16] &quot;row_num&quot;              &quot;wt_kg&quot;                &quot;ht_cm&quot;                &quot;ct_blood&quot;             &quot;fever&quot;               
## [21] &quot;chills&quot;               &quot;cough&quot;                &quot;aches&quot;                &quot;vomit&quot;                &quot;temp&quot;                
## [26] &quot;time_admission&quot;       &quot;merged_header&quot;        &quot;x28&quot;</code></pre>
<p>Voici d’autres fonctions d’aide “tidyselect” qui fonctionnent également <em>dans</em> les fonctions <strong>dplyr</strong> comme <code>select()</code>, <code>across()</code>, et <code>summarise()</code> :</p>
<ul>
<li><code>everything()</code> - toutes les autres colonnes non mentionnées<br />
</li>
<li><code>last_col()</code> - la dernière colonne<br />
</li>
<li><code>where()</code> - applique une fonction à toutes les colonnes et sélectionne celles qui sont VRAIES.<br />
</li>
<li><code>contains()</code> - colonnes contenant une chaîne de caractères.
<ul>
<li>Exemple : <code>select(contains("time"))</code>.<br />
</li>
</ul></li>
<li><code>starts_with()</code> - correspond à un préfixe spécifié.
<ul>
<li>Exemple : <code>select(starts_with("date_"))</code>.<br />
</li>
</ul></li>
<li><code>ends_with()</code> - correspond à un suffixe spécifié.
<ul>
<li>exemple : <code>select(ends_with("_post"))</code><br />
</li>
</ul></li>
<li><code>matches()</code> - pour appliquer une expression régulière (regex)
<ul>
<li>exemple : <code>select(matches("[pt]al"))</code><br />
</li>
</ul></li>
<li><code>num_range()</code> - une plage numérique comme x01, x02, x03<br />
</li>
<li><code>any_of()</code> - correspond si la colonne existe mais ne renvoie pas d’erreur si elle n’est pas trouvée.
<ul>
<li>Exemple : <code>select(any_of(date_onset, date_death, cardiac_arrest))</code>.</li>
</ul></li>
</ul>
<p>De plus, utilisez des opérateurs normaux tels que <code>c()</code> pour lister plusieurs colonnes, <code>:</code> pour des colonnes consécutives, <code>!</code> pour l’opposé, <code>&amp;</code> pour AND, et <code>|</code> pour OR.</p>
<p>Utilisez <code>where()</code> pour spécifier des critères logiques pour les colonnes. Si vous fournissez une fonction dans <code>where()</code>, n’incluez pas les parenthèses vides de la fonction. La commande ci-dessous sélectionne les colonnes de la classe Numeric.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="cleaning_data.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># selectionner les colonnes de classe Numeric</span></span>
<span id="cb195-2"><a href="cleaning_data.html#cb195-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb195-3"><a href="cleaning_data.html#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb195-4"><a href="cleaning_data.html#cb195-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;generation&quot; &quot;lon&quot;        &quot;lat&quot;        &quot;row_num&quot;    &quot;wt_kg&quot;      &quot;ht_cm&quot;      &quot;ct_blood&quot;   &quot;temp&quot;</code></pre>
<p>Utilisez <code>contains()</code> pour ne sélectionner que les colonnes dont le nom contient une chaîne de caractères donnée. <code>ends_with()</code> et <code>starts_with()</code> apportent plus de nuances.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="cleaning_data.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selectionner des colonnes qui contiennent une caractere defini</span></span>
<span id="cb197-2"><a href="cleaning_data.html#cb197-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb197-3"><a href="cleaning_data.html#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb197-4"><a href="cleaning_data.html#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;date_infection&quot;       &quot;date_onset&quot;           &quot;date_hospitalisation&quot; &quot;date_outcome&quot;</code></pre>
<p>La fonction <code>matches()</code> fonctionne de la même manière que <code>contains()</code> mais on peut lui fournir une expression régulière (voir la page sur les <a href="character_strings.html#character_strings">Caractères et chaînes de caractères</a>), comme plusieurs chaînes de caractères séparées par des barres OR à l’intérieur des parenthèses :</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="cleaning_data.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># searched for multiple character matches</span></span>
<span id="cb199-2"><a href="cleaning_data.html#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  rechercher plusieurs caracteres </span></span>
<span id="cb199-3"><a href="cleaning_data.html#cb199-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb199-4"><a href="cleaning_data.html#cb199-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&quot;onset|hosp|fev&quot;</span>)) <span class="sc">%&gt;%</span>   <span class="co"># noter le symbole de OR  &quot;|&quot;</span></span>
<span id="cb199-5"><a href="cleaning_data.html#cb199-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;date_onset&quot;           &quot;date_hospitalisation&quot; &quot;hospital&quot;             &quot;fever&quot;</code></pre>
<p><span style="color: orange;"><strong><em>AVERTISSEMENT:</em></strong> Si un nom de colonne que vous fournissez spécifiquement n’existe pas dans les données, il peut retourner une erreur et arrêter votre code. Pensez à utiliser <code>any_of()</code> pour citer des colonnes qui peuvent ou non exister, particulièrement utile dans les sélections négatives (enlever).</span></p>
<p>Une seule de ces colonnes existe, mais aucune erreur n’est produite et le code continue sans arrêter votre chaîne de nettoyage.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="cleaning_data.html#cb201-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb201-2"><a href="cleaning_data.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">&quot;date_onset&quot;</span>, <span class="st">&quot;village_origin&quot;</span>, <span class="st">&quot;village_detection&quot;</span>, <span class="st">&quot;village_residence&quot;</span>, <span class="st">&quot;village_travel&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb201-3"><a href="cleaning_data.html#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;date_onset&quot;</code></pre>
</div>
<div id="supprimer-colonnes" class="section level3 unnumbered">
<h3>Supprimer colonnes</h3>
<p><strong>Indiquez les colonnes à supprimer</strong> en plaçant un symbole moins “-” devant le nom de la colonne (par exemple, <code>select(-outcome)</code>), ou un vecteur de noms de colonnes (comme ci-dessous). Toutes les autres colonnes seront conservées.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="cleaning_data.html#cb203-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb203-2"><a href="cleaning_data.html#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(date_onset, fever<span class="sc">:</span>vomit)) <span class="sc">%&gt;%</span> <span class="co">#supprimer la colonne date_onset et tout les colonnes allant de fever à vomit</span></span>
<span id="cb203-3"><a href="cleaning_data.html#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;case_id&quot;              &quot;generation&quot;           &quot;date_infection&quot;       &quot;date_hospitalisation&quot; &quot;date_outcome&quot;        
##  [6] &quot;outcome&quot;              &quot;gender&quot;               &quot;hospital&quot;             &quot;lon&quot;                  &quot;lat&quot;                 
## [11] &quot;infector&quot;             &quot;source&quot;               &quot;age&quot;                  &quot;age_unit&quot;             &quot;row_num&quot;             
## [16] &quot;wt_kg&quot;                &quot;ht_cm&quot;                &quot;ct_blood&quot;             &quot;temp&quot;                 &quot;time_admission&quot;      
## [21] &quot;merged_header&quot;        &quot;x28&quot;</code></pre>
<p>Vous pouvez également supprimer une colonne en utilisant la syntaxe R <strong>base</strong>, en la définissant comme <code>NULL</code>. Par exemple :</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="cleaning_data.html#cb205-1" aria-hidden="true" tabindex="-1"></a>linelist<span class="sc">$</span>date_onset <span class="ot">&lt;-</span> <span class="cn">NULL</span>   </span>
<span id="cb205-2"><a href="cleaning_data.html#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="co"># supprimer colonne avec la syntaxe native de R</span></span></code></pre></div>
</div>
<div id="autres" class="section level3 unnumbered">
<h3>Autres</h3>
<p><code>select()</code> peut aussi être utilisé comme une commande indépendante (pas dans une chaîne de tuyaux). Dans ce cas, le premier argument est le dataframe original sur lequel on veut travailler.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="cleaning_data.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creer un nouvelle donnée linelist avec des colonnes  id et age-related</span></span>
<span id="cb206-2"><a href="cleaning_data.html#cb206-2" aria-hidden="true" tabindex="-1"></a>linelist_age <span class="ot">&lt;-</span> <span class="fu">select</span>(linelist, case_id, <span class="fu">contains</span>(<span class="st">&quot;age&quot;</span>))</span>
<span id="cb206-3"><a href="cleaning_data.html#cb206-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-4"><a href="cleaning_data.html#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="co"># afficher les noms de colonnes</span></span>
<span id="cb206-5"><a href="cleaning_data.html#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist_age)</span></code></pre></div>
<pre><code>## [1] &quot;case_id&quot;  &quot;age&quot;      &quot;age_unit&quot;</code></pre>
<div id="ajouter-à-la-chaine-de-commande-pipé" class="section level4 unnumbered">
<h4>ajouter à la chaine de commande pipé</h4>
<p>Dans la <code>linelist_raw</code>, il y a quelques colonnes dont nous n’avons pas besoin : <code>row_num</code>, <code>merged_header</code>, et <code>x28</code>. Nous les supprimons avec une commande <code>select()</code> dans la chaîne de nettoyage :</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="cleaning_data.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NETTOYAGE: enchainement de commandes  &#39;PIPE&#39;  (debute avec la donnée brute  et le  pipes avec les commandes pour le nettoyage)</span></span>
<span id="cb208-2"><a href="cleaning_data.html#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb208-3"><a href="cleaning_data.html#cb208-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-4"><a href="cleaning_data.html#cb208-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-5"><a href="cleaning_data.html#cb208-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Debuter le processus de Nettoyage pipé </span></span>
<span id="cb208-6"><a href="cleaning_data.html#cb208-6" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb208-7"><a href="cleaning_data.html#cb208-7" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb208-8"><a href="cleaning_data.html#cb208-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-9"><a href="cleaning_data.html#cb208-9" aria-hidden="true" tabindex="-1"></a>     <span class="co"># standardiser le syntaxe des noms de colonnes</span></span>
<span id="cb208-10"><a href="cleaning_data.html#cb208-10" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb208-11"><a href="cleaning_data.html#cb208-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-12"><a href="cleaning_data.html#cb208-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-13"><a href="cleaning_data.html#cb208-13" aria-hidden="true" tabindex="-1"></a>     <span class="co"># renommer manuellement les colonnes</span></span>
<span id="cb208-14"><a href="cleaning_data.html#cb208-14" aria-hidden="true" tabindex="-1"></a>           <span class="co"># NOUVEAU nom            # ANCIEN nom</span></span>
<span id="cb208-15"><a href="cleaning_data.html#cb208-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb208-16"><a href="cleaning_data.html#cb208-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb208-17"><a href="cleaning_data.html#cb208-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb208-18"><a href="cleaning_data.html#cb208-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-19"><a href="cleaning_data.html#cb208-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-20"><a href="cleaning_data.html#cb208-20" aria-hidden="true" tabindex="-1"></a>     <span class="co"># CI DESSUS LES ETAPES DU NETTOYAGE DEJA ABORDEES EN AMONT </span></span>
<span id="cb208-21"><a href="cleaning_data.html#cb208-21" aria-hidden="true" tabindex="-1"></a>    <span class="do">#####################################################</span></span>
<span id="cb208-22"><a href="cleaning_data.html#cb208-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-23"><a href="cleaning_data.html#cb208-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># supprimer des colonnes</span></span>
<span id="cb208-24"><a href="cleaning_data.html#cb208-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28))</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="deduplication" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> Deduplication</h2>
<p>Voir la page du manuel sur la <a href="cleaning_data.html#deduplication">déduplication</a> pour de nombreuses options sur la façon de dédupliquer les données. Seul un exemple très simple de déduplication de lignes est présenté ici.</p>
<p>Le package <strong>dplyr</strong> offre la fonction <code>distinct()</code>. Cette fonction examine chaque ligne et réduit le dataframe à seulement les lignes uniques. C’est-à-dire qu’elle supprime les lignes qui sont à 100% des doublons.</p>
<p>Lors de l’évaluation des lignes dupliquées, elle prend en compte un eventail de colonnes defini - par défaut, elle considère toutes les colonnes. Comme le montre la page dediée à la déduplication, vous pouvez ajuster cet eventail de colonnes afin que l’unicité des lignes ne soit évaluée que par rapport à certaines colonnes.</p>
<p>Dans cet exemple simple, nous ajoutons simplement la commande vide <code>distinct()</code> à la chaîne de commande pipé. Cela permet de s’assurer qu’il n’y a pas de lignes qui sont des doublons à 100% d’autres lignes (évaluées sur toutes les colonnes).</p>
<p>Nous commençons avec <code>nrow(linelist)</code> lignes dans <code>linelist</code>.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="cleaning_data.html#cb209-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb209-2"><a href="cleaning_data.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code></pre></div>
<p>Après la déduplication, il y a <code>nrow(linelist)</code> lignes. Toutes les lignes supprimées auraient été des doublons à 100% d’autres lignes.</p>
<p>Ci-dessous, la commande <code>distinct()</code> est ajoutée à la chaîne de nettoyage :</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="cleaning_data.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NETTOYAGE: enchainement de commandes  &#39;PIPE&#39;  (debute avec la donnée brute  et le  pipe avec les commandes pour le nettoyage)</span></span>
<span id="cb210-2"><a href="cleaning_data.html#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb210-3"><a href="cleaning_data.html#cb210-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-4"><a href="cleaning_data.html#cb210-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Debuter le processus de Nettoyage pipé </span></span>
<span id="cb210-5"><a href="cleaning_data.html#cb210-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-6"><a href="cleaning_data.html#cb210-6" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb210-7"><a href="cleaning_data.html#cb210-7" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb210-8"><a href="cleaning_data.html#cb210-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb210-9"><a href="cleaning_data.html#cb210-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># standardiser le syntaxe des noms de colonnes</span></span>
<span id="cb210-10"><a href="cleaning_data.html#cb210-10" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb210-11"><a href="cleaning_data.html#cb210-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb210-12"><a href="cleaning_data.html#cb210-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Renommer manuellement les noms de colonnes</span></span>
<span id="cb210-13"><a href="cleaning_data.html#cb210-13" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Nouveau nom             # Ancien nom</span></span>
<span id="cb210-14"><a href="cleaning_data.html#cb210-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb210-15"><a href="cleaning_data.html#cb210-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb210-16"><a href="cleaning_data.html#cb210-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb210-17"><a href="cleaning_data.html#cb210-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb210-18"><a href="cleaning_data.html#cb210-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># supprimer les colonnes</span></span>
<span id="cb210-19"><a href="cleaning_data.html#cb210-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb210-20"><a href="cleaning_data.html#cb210-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb210-21"><a href="cleaning_data.html#cb210-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CI DESSUS LES ETAPES DU NETTOYAGE DEJA ABORDEES EN AMONT </span></span>
<span id="cb210-22"><a href="cleaning_data.html#cb210-22" aria-hidden="true" tabindex="-1"></a>    <span class="do">#####################################################</span></span>
<span id="cb210-23"><a href="cleaning_data.html#cb210-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb210-24"><a href="cleaning_data.html#cb210-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Supprimer les doublons</span></span>
<span id="cb210-25"><a href="cleaning_data.html#cb210-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>()</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="creation-et-transformation-de-colonne" class="section level2" number="8.7">
<h2><span class="header-section-number">8.7</span> Creation et transformation de colonne</h2>
<p><strong>Nous recommandons d’utiliser la fonction <code>mutate()</code> du package dplyr pour ajouter une nouvelle colonne, ou pour modifier une colonne existante.</strong></p>
<p>Vous trouverez ci-dessous un exemple de création d’une nouvelle colonne avec <code>mutate()</code>. La syntaxe est la suivante : <code>mutate(nouveau_nom_de_colonne = valeur ou transformation)</code>.</p>
<p>Dans Stata, ceci est similaire à la commande <code>generate</code>, mais la fonction <code>mutate()</code> de R peut également être utilisée pour modifier une colonne existante.</p>
<div id="nouvelles-colonnes" class="section level3 unnumbered">
<h3>Nouvelles colonnes</h3>
<p>La commande <code>mutate()</code> la plus basique pour créer une nouvelle colonne peut ressembler à ceci. Elle crée une nouvelle colonne <code>new_col</code> dont la valeur dans chaque ligne est 10.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="cleaning_data.html#cb211-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb211-2"><a href="cleaning_data.html#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_col =</span> <span class="dv">10</span>)</span></code></pre></div>
<p>Vous pouvez également référencer des valeurs dans d’autres colonnes, pour effectuer des calculs. Ci-dessous, une nouvelle colonne <code>bmi</code> est créée pour contenir l’indice de masse corporelle (IMC) pour chaque cas - tel que calculé en utilisant la formule IMC = kg/m^2, en utilisant la colonne <code>ht_cm</code> et la colonne <code>wt_kg</code>.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="cleaning_data.html#cb212-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb212-2"><a href="cleaning_data.html#cb212-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<p>Si vous créez plusieurs nouvelles colonnes, séparez-les par une virgule et une nouvelle ligne. Vous trouverez ci-dessous des exemples de nouvelles colonnes, y compris celles qui sont constituées de valeurs provenant d’autres colonnes combinées à l’aide de <code>str_glue()</code> du package <strong>stringr</strong> (voir la page sur <a href="character_strings.html#character_strings">Caractères et chaînes de caractères</a>.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="cleaning_data.html#cb213-1" aria-hidden="true" tabindex="-1"></a>new_col_demo <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>                       </span>
<span id="cb213-2"><a href="cleaning_data.html#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb213-3"><a href="cleaning_data.html#cb213-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_var_dup    =</span> case_id,             </span>
<span id="cb213-4"><a href="cleaning_data.html#cb213-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># nouveau colonne= dupliquer ou copier une autre colonne existante</span></span>
<span id="cb213-5"><a href="cleaning_data.html#cb213-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_var_static =</span> <span class="dv">7</span>,                   <span class="co"># nouveau colonne = meme valeur sur toute les lignes</span></span>
<span id="cb213-6"><a href="cleaning_data.html#cb213-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_var_static =</span> new_var_static <span class="sc">+</span> <span class="dv">5</span>,  </span>
<span id="cb213-7"><a href="cleaning_data.html#cb213-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># On peut ecraser une colonne et le recreer par un calcul  utilisant d&#39;autres variables</span></span>
<span id="cb213-8"><a href="cleaning_data.html#cb213-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_var_paste  =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">&quot;{hospital} on ({date_hospitalisation})&quot;</span>) <span class="co"># nouveau colonne = pasting together values from other columns</span></span>
<span id="cb213-9"><a href="cleaning_data.html#cb213-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># regrouper les valeurs de differentes  colonnes</span></span>
<span id="cb213-10"><a href="cleaning_data.html#cb213-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb213-11"><a href="cleaning_data.html#cb213-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_id, hospital, date_hospitalisation, <span class="fu">contains</span>(<span class="st">&quot;new&quot;</span>))        </span>
<span id="cb213-12"><a href="cleaning_data.html#cb213-12" aria-hidden="true" tabindex="-1"></a><span class="co"># montrer seulement les nouveaux colonnes  pour besoin de demonstration</span></span></code></pre></div>
<p>Examinez les nouvelles colonnes. À des fins de démonstration, seules les nouvelles colonnes et les colonnes utilisées pour les créer sont affichées :</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d923ee29cca637d68f94" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d923ee29cca637d68f94">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Marks Maternity Hopital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],["2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-17T00:00:00Z","2014-06-17T00:00:00Z","2014-06-20T00:00:00Z","2014-06-19T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-27T00:00:00Z","2014-06-28T00:00:00Z","2014-06-29T00:00:00Z","2014-07-03T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-17T00:00:00Z","2014-07-17T00:00:00Z","2014-07-18T00:00:00Z","2014-07-19T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-24T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z","2014-07-27T00:00:00Z","2014-07-25T00:00:00Z","2014-07-27T00:00:00Z","2014-07-31T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z"],["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12],["Other on (2014-05-15)","NA on (2014-05-14)","St. Mark's Maternity Hospital (SMMH) on (2014-05-18)","Port Hospital on (2014-05-20)","Military Hospital on (2014-05-22)","Port Hospital on (2014-05-23)","NA on (2014-05-29)","NA on (2014-06-03)","NA on (2014-06-06)","NA on (2014-06-07)","Port Hospital on (2014-06-08)","Military Hospital on (2014-06-15)","NA on (2014-06-17)","NA on (2014-06-17)","Other on (2014-06-20)","Port Hospital on (2014-06-19)","Port Hospital on (2014-06-23)","Port Hospital on (2014-06-24)","NA on (2014-06-27)","Other on (2014-06-28)","Port Hospital on (2014-06-29)","Port Hospital on (2014-07-03)","St. Mark's Maternity Hospital (SMMH) on (2014-07-09)","NA on (2014-07-09)","Other on (2014-07-11)","NA on (2014-07-11)","St. Marks Maternity Hopital (SMMH) on (2014-07-13)","Military Hospital on (2014-07-14)","Port Hospital on (2014-07-14)","Central Hospital on (2014-07-13)","Military Hospital on (2014-07-14)","Central Hospital on (2014-07-17)","NA on (2014-07-17)","Military Hospital on (2014-07-18)","Other on (2014-07-19)","NA on (2014-07-20)","NA on (2014-07-20)","Port Hospital on (2014-07-22)","Port Hospital on (2014-07-24)","Port Hospital on (2014-07-26)","NA on (2014-07-24)","Central Hospital on (2014-07-27)","Military Hospital on (2014-07-25)","Other on (2014-07-27)","Other on (2014-07-31)","Other on (2014-08-01)","NA on (2014-08-03)","St. Mark's Maternity Hospital (SMMH) on (2014-08-02)","St. Mark's Maternity Hospital (SMMH) on (2014-08-02)","NA on (2014-08-04)"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>new_var_dup<\/th>\n      <th>new_var_static<\/th>\n      <th>new_var_paste<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><span style="color: darkgreen;"><strong><em>CONSEILS:</em></strong> Une variante de <code>mutate()</code> est la fonction <code>transmute()</code>. Cette fonction ajoute une nouvelle colonne comme <code>mutate()</code>, mais supprime également toutes les autres colonnes que vous ne mentionnez pas entre ses parenthèses..</span></p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="cleaning_data.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CACHER POUR LECTEUR</span></span>
<span id="cb214-2"><a href="cleaning_data.html#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer les nouveaux colonnes demo créees en haut</span></span>
<span id="cb214-3"><a href="cleaning_data.html#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="co"># linelist &lt;- linelist %&gt;% </span></span>
<span id="cb214-4"><a href="cleaning_data.html#cb214-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-contains(&quot;new_var&quot;))</span></span></code></pre></div>
</div>
<div id="convertir-la-classe-des-colonnes" class="section level3 unnumbered">
<h3>Convertir la classe des colonnes</h3>
<p>Les colonnes contenant des valeurs qui sont des dates, des nombres ou des valeurs logiques (VRAI/FAUX) ne se comporteront comme prévu que si elles sont dans la classe appropriée. Il y a une différence entre “2” de classe caractère et 2 de classe numérique !</p>
<p>Il existe des moyens de définir la classe des colonnes avec les commandes d’importation, mais cela est souvent fastidieux. Consultez la section <a href="rbasics.html#rbasics">Bases de R</a> sur les classes d’objets pour en savoir plus sur la conversion de la classe des objets et des colonnes.</p>
<p>Tout d’abord, effectuons quelques vérifications sur les colonnes importantes pour voir si elles sont de la bonne classe. Nous avons également vu cela au début lorsque nous avons lancé <code>skim()</code>.</p>
<p>Actuellement, la classe de la colonne <code>age</code> est un caractère. Pour effectuer des analyses quantitatives, nous avons besoin que ces nombres soient reconnus comme numériques !</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="cleaning_data.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>age)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>La classe de la colonne <code>date_onset</code> est aussi un caractère ! Pour effectuer des analyses, ces dates doivent être reconnues comme des dates!</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="cleaning_data.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>date_onset)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Pour résoudre ce problème, utilisez la capacité de <code>mutate()</code> pour redéfinir une colonne avec une transformation. Nous définissons la colonne comme elle-même, mais convertie en une classe différente. Voici un exemple de base, convertissons ou assurerons nous que la colonne <code>age</code> est de classe Numeric :</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="cleaning_data.html#cb219-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb219-2"><a href="cleaning_data.html#cb219-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">as.numeric</span>(age))</span></code></pre></div>
<p>De la même manière, vous pouvez utiliser <code>as.character()</code> et <code>as.logical()</code>. Pour convertir en classe Factor, vous pouvez utiliser <code>factor()</code> de <strong>base</strong> R ou <code>as_factor()</code> de <strong>forcats</strong>. Pour en savoir plus, consultez la page <a href="factors.html#factors">Facteurs</a>.</p>
<p>Vous devez faire attention lorsque vous convertissez en classe Date. Plusieurs méthodes sont expliquées sur la page <a href="working_dates.html#working_dates">Manipuler les dates</a>. En général, les valeurs brutes de la date doivent toutes être dans le même format pour que la conversion fonctionne correctement (par exemple “MM/JJ/AAAA”, ou “JJ MM AAAA”). Après la conversion en classe Date, vérifiez vos données pour confirmer que chaque valeur a été convertie correctement.</p>
</div>
<div id="données-groupées" class="section level3 unnumbered">
<h3>Données groupées</h3>
<p>Si votre dataframe est déjà <em>groupée</em> (voir la page sur <a href="grouping_data.html#grouping_data">Travailler sur des données groupées</a>), <code>mutate()</code> peut se comporter différemment que si la base de données n’est pas groupée. Toutes les fonctions de résumé, comme <code>mean()</code>, <code>median()</code>, <code>max()</code>, etc. seront calculées par groupe, et non par toutes les lignes.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="cleaning_data.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalisation de l&#39;age en fonction la moyenne</span></span>
<span id="cb220-2"><a href="cleaning_data.html#cb220-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb220-3"><a href="cleaning_data.html#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_norm =</span> age <span class="sc">/</span> <span class="fu">mean</span>(age, <span class="at">na.rm=</span>T))</span>
<span id="cb220-4"><a href="cleaning_data.html#cb220-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-5"><a href="cleaning_data.html#cb220-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-6"><a href="cleaning_data.html#cb220-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalisation de l&#39;age en fonction de la moyenne du jeu donne groupe  à partir de la colonne hospital</span></span>
<span id="cb220-7"><a href="cleaning_data.html#cb220-7" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb220-8"><a href="cleaning_data.html#cb220-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb220-9"><a href="cleaning_data.html#cb220-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_norm =</span> age <span class="sc">/</span> <span class="fu">mean</span>(age, <span class="at">na.rm=</span>T))</span></code></pre></div>
<p>Pour en savoir plus sur l’utilisation de <code>mutate ()</code> sur des blocs de données groupés, consultez la <a href="https://dplyr.tidyverse.org/reference/mutate.html">documentation tidyverse mutate</a>.</p>
</div>
<div id="clean_across" class="section level3 unnumbered">
<h3>Transformer plusieurs colonnes</h3>
<p>Souvent, pour écrire un code concis, vous voulez appliquer la même transformation à plusieurs colonnes à la fois. Une transformation peut être appliquée à plusieurs colonnes à la fois en utilisant la fonction <code>across()</code> du package <strong>dplyr</strong> (également contenu dans le package <strong>tidyverse</strong>). <code>across()</code> peut être utilisé avec n’importe quelle fonction <strong>dplyr</strong>, mais est couramment utilisé dans <code>select()</code>, <code>mutate()</code>, <code>filter()</code>, ou <code>summarise()</code>. Voir comment il est appliqué à <code>summarise()</code> dans la page sur les <a href="#decriptive_tables">Tableaux descriptifs</a>.</p>
<p>Spécifiez les colonnes à l’argument <code>.cols =</code> et la ou les fonctions à appliquer à <code>.fns =</code>. Tout argument supplémentaire à fournir à la fonction <code>.fns</code> peut être inclus après une virgule, toujours dans <code>across()</code>.</p>
<div id="across-selection-de-colonne" class="section level4 unnumbered">
<h4><code>across()</code> selection de colonne</h4>
<p>Spécifiez les colonnes à l’argument <code>.cols =</code>. Vous pouvez les nommer individuellement, ou utiliser les fonctions d’aide “tidyselect”. Spécifiez la fonction en argument <code>.fns =</code>. Notez qu’en utilisant le mode fonction démontré ci-dessous, la fonction est écrite <em>sans</em> ses parenthèses ( ).</p>
<p>Ici, la transformation <code>as.character()</code> est appliquée à des colonnes spécifiques nommées dans <code>across()</code>.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="cleaning_data.html#cb221-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb221-2"><a href="cleaning_data.html#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(temp, ht_cm, wt_kg), <span class="at">.fns =</span> as.character))</span></code></pre></div>
<p>Les fonctions d’aide “tidyselect” sont disponibles pour vous aider à spécifier les colonnes. Elles sont détaillées ci-dessus dans la section sur la sélection et le réordonnancement des colonnes, et elles incluent : <code>everything()</code>, <code>last_col()</code>, <code>where()</code>, <code>starts_with()</code>, <code>ends_with()</code>, <code>contains()</code>, <code>matches()</code>, <code>num_range()</code> et <code>any_of()</code>.</p>
<p>Voici un exemple de la façon dont on peut changer <strong>toutes les colonnes</strong> en classe de caractères :</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="cleaning_data.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Changer toutes les colonnes en classe caractère</span></span>
<span id="cb222-2"><a href="cleaning_data.html#cb222-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb222-3"><a href="cleaning_data.html#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), <span class="at">.fns =</span> as.character))</span></code></pre></div>
<p>Convertissez en caractères toutes les colonnes dont le nom contient la chaîne “date” (notez le placement des virgules et des parenthèses) :</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="cleaning_data.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Changer toutes les colonnes en classe caractère</span></span>
<span id="cb223-2"><a href="cleaning_data.html#cb223-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb223-3"><a href="cleaning_data.html#cb223-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>), <span class="at">.fns =</span> as.character))</span></code></pre></div>
<p>Ci-dessous, un exemple de mutation des colonnes qui sont actuellement de classe POSIXct (une classe de date brute qui montre les timestamps) - en d’autres termes, où la fonction <code>is.POSIXct()</code> évalue à <code>TRUE</code>. Ensuite, nous voulons appliquer la fonction <code>as.Date()</code> à ces colonnes pour les convertir en une classe normale de Date.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="cleaning_data.html#cb224-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb224-2"><a href="cleaning_data.html#cb224-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.POSIXct), <span class="at">.fns =</span> as.Date))</span></code></pre></div>
<ul>
<li>Notez que dans <code>across()</code>, nous utilisons également la fonction <code>where()</code> car <code>is.POSIXct</code> est évalué à TRUE ou FALSE.<br />
</li>
<li>Notez que <code>is.POSIXct()</code> fait partie du paquet <strong>lubridate</strong>. D’autres fonctions “is” similaires comme <code>is.character()</code>, <code>is.numeric()</code>, et <code>is.logical()</code> sont issues de <strong>base R</strong>.</li>
</ul>
</div>
<div id="fonction-across" class="section level4 unnumbered">
<h4>fonction <code>across()</code></h4>
<p>Vous pouvez lire la documentation avec <code>?across</code> pour des détails sur la façon de fournir des fonctions à <code>across()</code>. Quelques points récapitulatifs : il y a plusieurs façons de spécifier la ou les fonctions à exécuter sur une colonne et vous pouvez même définir vos propres fonctions :</p>
<ul>
<li>Vous pouvez fournir le nom de la fonction seul (par exemple <code>mean</code> ou <code>as.character</code>)<br />
</li>
<li>Vous pouvez fournir la fonction dans le style <strong>purrr</strong> (par exemple <code>~ mean(.x, na.rm = TRUE)</code>) (voir [cette page][#iteration])<br />
</li>
<li>Vous pouvez spécifier plusieurs fonctions en fournissant une liste (par exemple, <code>list(mean = mean, n_miss = ~ sum(is.na(.x))</code>).
<ul>
<li>Si vous fournissez plusieurs fonctions, plusieurs colonnes transformées seront retournées par colonne d’entrée, avec des noms uniques dans le format <code>col_fn</code>. Vous pouvez ajuster la façon dont les nouvelles colonnes sont nommées avec l’argument <code>.names =</code> en utilisant la syntaxe <strong>glue</strong> (voir la page sur <a href="character_strings.html#character_strings">Caractères et chaînes de caractères</a>) où <code>{.col}</code> et <code>{.fn}</code> sont des raccourcis pour la colonne d’entrée et la fonction.</li>
</ul></li>
</ul>
<p>Voici quelques ressources en ligne sur l’utilisation de <code>across()</code> : <a href="https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/">creator Hadley Wickham’s thoughts/rationale</a></p>
</div>
</div>
<div id="coalesce" class="section level3 unnumbered">
<h3><code>coalesce()</code></h3>
<p>Cette fonction <strong>dplyr</strong> trouve la première valeur non manquante à chaque position. Elle “remplit” les valeurs manquantes avec la première valeur disponible dans l’ordre que vous spécifiez.</p>
<p>Voici un exemple <em>En dehors du contexte de dataframe</em> : Disons que vous avez deux vecteurs, l’un contenant le village de détection du patient et l’autre contenant le village de résidence du patient. Vous pouvez utiliser coalesce pour choisir la première valeur non manquante pour chaque indice :</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="cleaning_data.html#cb225-1" aria-hidden="true" tabindex="-1"></a>village_detection <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="cn">NA</span>,  <span class="cn">NA</span>)</span>
<span id="cb225-2"><a href="cleaning_data.html#cb225-2" aria-hidden="true" tabindex="-1"></a>village_residence <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;d&quot;</span>)</span>
<span id="cb225-3"><a href="cleaning_data.html#cb225-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-4"><a href="cleaning_data.html#cb225-4" aria-hidden="true" tabindex="-1"></a>village <span class="ot">&lt;-</span> <span class="fu">coalesce</span>(village_detection, village_residence)</span>
<span id="cb225-5"><a href="cleaning_data.html#cb225-5" aria-hidden="true" tabindex="-1"></a>village    <span class="co"># print</span></span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;a&quot; &quot;d&quot;</code></pre>
<p>Cela fonctionne de la même manière si vous fournissez des colonnes de cadre de données : pour chaque ligne, la fonction attribuera la nouvelle valeur de la colonne avec la première valeur non manquante dans les colonnes que vous avez fournies (dans l’ordre fourni).</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="cleaning_data.html#cb227-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb227-2"><a href="cleaning_data.html#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">village =</span> <span class="fu">coalesce</span>(village_detection, village_residence))</span></code></pre></div>
<p>Il s’agit d’un exemple d’opération “ligne par ligne”. Pour des calculs par rangée plus complexes, voir la section ci-dessous sur les calculs par rangée.</p>
</div>
<div id="mathématique-cumulative" class="section level3 unnumbered">
<h3>mathématique cumulative</h3>
<p>Si vous voulez qu’une colonne reflète somme/moy/min/max cumulée etc. pour les differntes observations du dataframe, utilisez les fonctions suivantes :</p>
<p><code>cumsum()</code> renvoie la somme cumulée, comme indiqué ci-dessous :</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="cleaning_data.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">15</span>,<span class="dv">10</span>))     <span class="co"># retourne un nombre unique</span></span></code></pre></div>
<pre><code>## [1] 31</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="cleaning_data.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">15</span>,<span class="dv">10</span>))  <span class="co"># renvoie la somme cumulé a chaque élémenet parcouru du vecteur </span></span></code></pre></div>
<pre><code>## [1]  2  6 21 31</code></pre>
<p>Ceci peut être utilisé dans un dataframe lors de la création d’une nouvelle colonne. Par exemple, pour calculer le nombre cumulé de cas par jour dans une épidémie, envisagez un code comme celui-ci :</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="cleaning_data.html#cb232-1" aria-hidden="true" tabindex="-1"></a>cumulative_case_counts <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>  <span class="co"># Commencons avec la donnne linelist </span></span>
<span id="cb232-2"><a href="cleaning_data.html#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(date_onset) <span class="sc">%&gt;%</span>                 <span class="co"># Creons une colonne &#39;n&#39; qui totalise le nombre de ligne par jour   </span></span>
<span id="cb232-3"><a href="cleaning_data.html#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cumulative_cases =</span> <span class="fu">cumsum</span>(n))  <span class="co">#  nouveau colonne representant la somme cumulée par ligne</span></span></code></pre></div>
<p>Voici les 10 premières rangées :</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="cleaning_data.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cumulative_case_counts, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    date_onset n cumulative_cases
## 1  2012-04-15 1                1
## 2  2012-05-05 1                2
## 3  2012-05-08 1                3
## 4  2012-05-31 1                4
## 5  2012-06-02 1                5
## 6  2012-06-07 1                6
## 7  2012-06-14 1                7
## 8  2012-06-21 1                8
## 9  2012-06-24 1                9
## 10 2012-06-25 1               10</code></pre>
<p>Voir la page sur les <a href="epicurves.html#epicurves">Courbes épidémiques</a> pour savoir comment tracer l’incidence cumulée avec l’épicurve.</p>
<p>Voir aussi :<br />
<code>cumsum()</code>, <code>cummean()</code>, <code>cummin()</code>, <code>cummax()</code>, <code>cumany()</code>, <code>cumall()</code>.</p>
</div>
<div id="utiliser-les-fonctions-base-de-r" class="section level3 unnumbered">
<h3>Utiliser les fonctions <strong>base</strong> de R</h3>
<p>Pour définir une nouvelle colonne (ou redéfinir une colonne) en utilisant <strong>base</strong> R, écrivez le nom du cadre de données, relié par <code>$</code>, à la <em>nouvelle</em> colonne (ou à la colonne à modifier). Utilisez l’opérateur d’affectation <code>&lt;-</code> pour définir la ou les nouvelles valeurs. N’oubliez pas que lorsque vous utilisez <strong>base</strong> R, vous devez à chaque fois spécifier le nom du dataframe avant le nom de la colonne (par exemple, <code>dataframe$column</code>). Voici un exemple de création de la colonne <code>bmi</code> en utilisant <strong>base</strong> R :</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="cleaning_data.html#cb235-1" aria-hidden="true" tabindex="-1"></a>linelist<span class="sc">$</span>bmi <span class="ot">=</span> linelist<span class="sc">$</span>wt_kg <span class="sc">/</span> </span>
<span id="cb235-2"><a href="cleaning_data.html#cb235-2" aria-hidden="true" tabindex="-1"></a>     (linelist<span class="sc">$</span>ht_cm <span class="sc">/</span><span class="dv">100</span>) <span class="sc">^</span> <span class="dv">2</span></span></code></pre></div>
</div>
<div id="ajouter-à-la-chaine-de-commande-pipé-1" class="section level3 unnumbered">
<h3>Ajouter à la chaine de commande pipé</h3>
<p><strong>Au-dessous, une nouvelle colonne est ajoutée à la chaîne de tuyaux et certaines classes sont converties.</strong></p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="cleaning_data.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NETTOYAGE: enchainement de commandes  &#39;PIPE&#39;  (debute avec la donnée brute  et le  pipes avec les commandes pour le nettoyage)</span></span>
<span id="cb236-2"><a href="cleaning_data.html#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb236-3"><a href="cleaning_data.html#cb236-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-4"><a href="cleaning_data.html#cb236-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Debuter le processus de Nettoyage pipé</span></span>
<span id="cb236-5"><a href="cleaning_data.html#cb236-5" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb236-6"><a href="cleaning_data.html#cb236-6" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb236-7"><a href="cleaning_data.html#cb236-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb236-8"><a href="cleaning_data.html#cb236-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># standardiser le syntaxe des noms de colonnes</span></span>
<span id="cb236-9"><a href="cleaning_data.html#cb236-9" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb236-10"><a href="cleaning_data.html#cb236-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb236-11"><a href="cleaning_data.html#cb236-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># renommer manuellement les noms de colonnes</span></span>
<span id="cb236-12"><a href="cleaning_data.html#cb236-12" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Nouveau nom             # ANCIEN nom</span></span>
<span id="cb236-13"><a href="cleaning_data.html#cb236-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb236-14"><a href="cleaning_data.html#cb236-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb236-15"><a href="cleaning_data.html#cb236-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb236-16"><a href="cleaning_data.html#cb236-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb236-17"><a href="cleaning_data.html#cb236-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># supprimer colonne</span></span>
<span id="cb236-18"><a href="cleaning_data.html#cb236-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb236-19"><a href="cleaning_data.html#cb236-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb236-20"><a href="cleaning_data.html#cb236-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># supprimer les doublons</span></span>
<span id="cb236-21"><a href="cleaning_data.html#cb236-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb236-22"><a href="cleaning_data.html#cb236-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb236-23"><a href="cleaning_data.html#cb236-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb236-24"><a href="cleaning_data.html#cb236-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CI DESSUS LES ETAPES DU NETTOYAGE DEJA ABORDEES EN AMONT </span></span>
<span id="cb236-25"><a href="cleaning_data.html#cb236-25" aria-hidden="true" tabindex="-1"></a>    <span class="do">###################################################</span></span>
<span id="cb236-26"><a href="cleaning_data.html#cb236-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ajouter un nouveau colonne</span></span>
<span id="cb236-27"><a href="cleaning_data.html#cb236-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb236-28"><a href="cleaning_data.html#cb236-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb236-29"><a href="cleaning_data.html#cb236-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convertir les classes des colonnes</span></span>
<span id="cb236-30"><a href="cleaning_data.html#cb236-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb236-31"><a href="cleaning_data.html#cb236-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">generation =</span> <span class="fu">as.numeric</span>(generation),</span>
<span id="cb236-32"><a href="cleaning_data.html#cb236-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">age        =</span> <span class="fu">as.numeric</span>(age)) </span></code></pre></div>
</div>
</div>
<div id="re-coder-les-valeurs" class="section level2" number="8.8">
<h2><span class="header-section-number">8.8</span> Re-coder les valeurs</h2>
<p>Voici quelques situations dans lesquelles vous devez recoder (modifier) des valeurs :</p>
<ul>
<li>pour modifier une valeur spécifique (par exemple, une date dont l’année ou le format est incorrect)<br />
</li>
<li>pour uniformiser des valeurs dont l’orthographe n’est pas la même</li>
<li>pour créer une nouvelle colonne de valeurs catégorielles<br />
</li>
<li>pour créer une nouvelle colonne de catégories numériques (par exemple, des catégories d’âge).</li>
</ul>
<div id="valeurs-spécifiques" class="section level3 unnumbered">
<h3>Valeurs spécifiques</h3>
<p>Pour modifier les valeurs manuellement, vous pouvez utiliser la fonction <code>recode()</code> au sein de la fonction <code>mutate()</code>.</p>
<p>Imaginez qu’il y ait une date érronée dans les données (par exemple “2014-14-15”) : vous pouvez corriger la date manuellement dans les données brutes, ou vous pouvez operer le changement dans le pipeline de nettoyage via <code>mutate()</code> et <code>recode()</code>. Cette dernière solution est plus transparente et reproductible pour toute autre personne cherchant à comprendre ou à répéter votre analyse.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="cleaning_data.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Corriger  les valeurs erronnées                   # ancienne valeur        # nouvelle valeur</span></span>
<span id="cb237-2"><a href="cleaning_data.html#cb237-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb237-3"><a href="cleaning_data.html#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">recode</span>(date_onset, <span class="st">&quot;2014-14-15&quot;</span> <span class="ot">=</span> <span class="st">&quot;2014-04-15&quot;</span>))</span></code></pre></div>
<p>La ligne <code>mutate()</code> ci-dessus peut être lue comme : “muter la colonne <code>date_onset</code> pour qu’elle soit égale à la colonne <code>date_onset</code> recodée de façon à ce que l’ancienne Valeur soit changée en Nouvelle Valeur”. Notez que ce modèle (Ancienne = Nouvelle) pour <code>recode()</code> est l’opposé de la plupart des modèles R (new = old). La communauté de développement de R travaille à la révision de ce modèle.</p>
<p><strong>Voici un autre exemple de recodage de plusieurs valeurs dans une même colonne.</strong></p>
<p>Dans <code>linelist</code>, les valeurs de la colonne “hospital” doivent être nettoyées. Il y a plusieurs orthographes différentes et de nombreuses valeurs manquantes.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="cleaning_data.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>hospital, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)  </span></code></pre></div>
<pre><code>## 
##                      Central Hopital                     Central Hospital                           Hospital A 
##                                   11                                  457                                  290 
##                           Hospital B                     Military Hopital                    Military Hospital 
##                                  289                                   32                                  798 
##                     Mitylira Hopital                    Mitylira Hospital                                Other 
##                                    1                                   79                                  907 
##                         Port Hopital                        Port Hospital St. Mark&#39;s Maternity Hospital (SMMH) 
##                                   48                                 1756                                  417 
##   St. Marks Maternity Hopital (SMMH)                                 &lt;NA&gt; 
##                                   11                                 1512</code></pre>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="cleaning_data.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher un tableau avec toutes les valeurs uniques y compris les les valeurs manquantes</span></span></code></pre></div>
<p>La commande <code>recode()</code> ci-dessous redéfinit la colonne “hospital” comme la colonne actuelle “hospital”, mais avec les changements de recode spécifiés. N’oubliez pas les virgules après chacun d’eux !</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="cleaning_data.html#cb241-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb241-2"><a href="cleaning_data.html#cb241-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital,</span>
<span id="cb241-3"><a href="cleaning_data.html#cb241-3" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Pour reference: ANCIEN =NOUVEAU</span></span>
<span id="cb241-4"><a href="cleaning_data.html#cb241-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  <span class="ot">=</span><span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb241-5"><a href="cleaning_data.html#cb241-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> <span class="ot">=</span><span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb241-6"><a href="cleaning_data.html#cb241-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  <span class="ot">=</span><span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb241-7"><a href="cleaning_data.html#cb241-7" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      <span class="ot">=</span> <span class="st">&quot;Port Hospital&quot;</span>,</span>
<span id="cb241-8"><a href="cleaning_data.html#cb241-8" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   <span class="ot">=</span> <span class="st">&quot;Central Hospital&quot;</span>,</span>
<span id="cb241-9"><a href="cleaning_data.html#cb241-9" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;other&quot;</span>             <span class="ot">=</span> <span class="st">&quot;Other&quot;</span>,</span>
<span id="cb241-10"><a href="cleaning_data.html#cb241-10" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> <span class="ot">=</span> <span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb241-11"><a href="cleaning_data.html#cb241-11" aria-hidden="true" tabindex="-1"></a>                      ))</span></code></pre></div>
<p>Nous voyons maintenant que les orthographes de la colonne <code>hospital</code> ont été corrigées et consolidées :</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="cleaning_data.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>hospital, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##                     Central Hospital                           Hospital A                           Hospital B 
##                                  468                                  290                                  289 
##                    Military Hospital                                Other                        Port Hospital 
##                                  910                                  907                                 1804 
## St. Mark&#39;s Maternity Hospital (SMMH)                                 &lt;NA&gt; 
##                                  428                                 1512</code></pre>
<p><span style="color: darkgreen;"><strong><em>CONSEIL:</em></strong> Le nombre d’espaces avant et après un signe égal n’a pas d’importance. Rendez votre code plus facile à lire en alignant le signe = pour toutes ou la plupart des lignes. En outre, envisagez d’ajouter une ligne de commentaires afin de clarifier pour les futurs lecteurs quel côté est l’ANCIEN et quel côté est le NOUVEAU. </span></p>
<p><span style="color: darkgreen;"><strong><em>CONSEIL:</em></strong> Parfois, une valeur de caractère <em>vide</em> existe dans un jeu de donnée (non reconnue comme la valeur de R pour les manquants - <code>NA</code>). Vous pouvez référencer cette valeur avec deux guillemets sans espace entre eux (““).</span></p>
</div>
<div id="par-logique" class="section level3 unnumbered">
<h3>par logique</h3>
<p>Nous démontrons ci-dessous comment recoder les valeurs d’une colonne en utilisant la logique et les conditions :</p>
<ul>
<li>Utiliser <code>replace()</code>, <code>ifelse()</code> et <code>if_else()</code> pour une logique simple.</li>
<li>Utilisation de <code>case_when()</code> pour une logique plus complexe.</li>
</ul>
</div>
<div id="logique-simple" class="section level3 unnumbered">
<h3>Logique simple</h3>
<div id="replace" class="section level4 unnumbered">
<h4><code>replace()</code></h4>
<p>Pour recoder avec des critères logiques simples, vous pouvez utiliser <code>replace()</code> dans <code>mutate()</code>. <code>replace()</code> est une fonction de <strong>base</strong> R. Utilisez une condition logique pour spécifier les lignes à changer . La syntaxe générale est la suivante :</p>
<p><code>mutate(col_a_change = replace(col_a_changer, condition sur les lignes, nouvelle valeur))</code>.</p>
<p>Une situation courante pour utiliser <code>replace()</code> est <strong>la modification d’une seule valeur dans une ligne, en utilisant un identifiant propre à une ligne </strong>. Ci-dessous, le sexe est changé en “Female” dans la ligne où la colonne <code>case_id</code> est “2195”.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="cleaning_data.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemple : Changer en &quot;Female&quot; le genre pour une observation definie</span></span>
<span id="cb244-2"><a href="cleaning_data.html#cb244-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb244-3"><a href="cleaning_data.html#cb244-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">replace</span>(gender, case_id <span class="sc">==</span> <span class="st">&quot;2195&quot;</span>, <span class="st">&quot;Female&quot;</span>))</span></code></pre></div>
<p>La commande équivalente utilisant la syntaxe <strong>base</strong> R et les crochets d’indexation <code>[ ]</code> est presenté ci-dessous. Elle se lit comme suit : “Changez la valeur de la colonne <code>gender</code> du dataframe <code>linelist</code> (pour les lignes où la colonne <code>case_id</code> de <code>linelist</code> a la valeur ‘2195’) en ‘Female’”.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="cleaning_data.html#cb245-1" aria-hidden="true" tabindex="-1"></a>linelist<span class="sc">$</span>gender[linelist<span class="sc">$</span>case_id <span class="sc">==</span> <span class="st">&quot;2195&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Female&quot;</span></span></code></pre></div>
</div>
<div id="ifelse-et-if_else" class="section level4 unnumbered">
<h4><code>ifelse()</code> et <code>if_else()</code></h4>
<p>Une autre fonction pour la logique simple est <code>ifelse()</code> et son partenaire <code>if_else()</code>. Cependant, dans la plupart des cas de recodage, il est plus clair d’utiliser <code>case_when()</code> (détaillé ci-dessous). Ces commandes “if else” sont des versions simplifiées d’une instruction de programmation <code>if</code> et <code>else</code>. La syntaxe générale est la suivante :<br />
<code>ifelse(condition, valeur à renvoyer si la condition vaut VRAI, valeur à renvoyer si la condition vaut FAUX)</code>.</p>
<p>Ci-dessous, la colonne <code>source_known</code> est définie. Sa valeur dans une ligne donnée est définie comme “connue” si la valeur de la colonne <code>source</code> de cette ligne n’est pas <em>manquante</em>. Si la valeur de la colonne <code>source</code> <em>est</em> manquante, alors la valeur de la colonne <code>source_known</code> est définie comme “inconnue”.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="cleaning_data.html#cb246-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb246-2"><a href="cleaning_data.html#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source_known =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(source), <span class="st">&quot;known&quot;</span>, <span class="st">&quot;unknown&quot;</span>))</span></code></pre></div>
<p><code>if_else()</code> est une version spéciale de <strong>dplyr</strong> qui gère les dates. Notez que si la valeur “true” est une date, la valeur “false” doit aussi être une date, d’où l’utilisation de la valeur spéciale “NA_real_” au lieu de “NA”.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="cleaning_data.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creer une colonne nommé date of death qui a comme valeur NA si le patient n&#39;est pas mort</span></span>
<span id="cb247-2"><a href="cleaning_data.html#cb247-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb247-3"><a href="cleaning_data.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_death =</span> <span class="fu">if_else</span>(outcome <span class="sc">==</span> <span class="st">&quot;Death&quot;</span>, date_outcome, <span class="cn">NA_real_</span>))</span></code></pre></div>
<p><strong>Évitez d’enchaîner les commandes ifelse… utilisez plutôt <code>case_when()</code>!</strong> <code>case_when()</code> est beaucoup plus facile à lire et vous ferez moins d’erreurs.</p>
<p><img src="images/ifelse%20bad.png" width="100%" style="display: block; margin: auto;" /></p>
<p>En dehors du contexte d’un dataframe, si vous voulez qu’un objet utilisé dans votre code change de valeur, pensez à utiliser <code>switch()</code> une fonction <strong>base</strong> de R.</p>
</div>
</div>
<div id="clean_case_when" class="section level3 unnumbered">
<h3>Logique complexe</h3>
<p>Utilisez la fonction <code>case_when()</code> de <strong>dplyr</strong> si vous effectuez un recodage dans de nombreux nouveaux groupes, ou si vous devez utiliser des instructions logiques complexes pour recoder des valeurs. Cette fonction évalue chaque ligne du cadre de données, détermine si les lignes répondent aux critères spécifiés et attribue la nouvelle valeur correcte.</p>
<p>Les commandes <code>case_when()</code> sont des instructions qui ont un côté droit (CD) et un côté gauche (CG) séparés par un “tilde” <code>~</code>. Les critères logiques se trouvent dans la partie gauche et les valeurs d’application dans la partie droite de chaque instruction. Les déclarations sont séparées par des virgules.</p>
<p>Par exemple, ici nous utilisons les colonnes <code>age</code> et <code>age_unit</code> pour créer une colonne <code>age_years</code> :</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="cleaning_data.html#cb248-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb248-2"><a href="cleaning_data.html#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">case_when</span>(</span>
<span id="cb248-3"><a href="cleaning_data.html#cb248-3" aria-hidden="true" tabindex="-1"></a>            age_unit <span class="sc">==</span> <span class="st">&quot;years&quot;</span>  <span class="sc">~</span> age,       <span class="co"># Si l&#39;age est donné en années</span></span>
<span id="cb248-4"><a href="cleaning_data.html#cb248-4" aria-hidden="true" tabindex="-1"></a>            age_unit <span class="sc">==</span> <span class="st">&quot;months&quot;</span> <span class="sc">~</span> age<span class="sc">/</span><span class="dv">12</span>,    <span class="co"># si l&#39;age est donnée en mois, divise par 12</span></span>
<span id="cb248-5"><a href="cleaning_data.html#cb248-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">is.na</span>(age_unit)      <span class="sc">~</span> age))      <span class="co"># Si l&#39;unite d&#39;age est une valeur maquante, garde comme années</span></span>
<span id="cb248-6"><a href="cleaning_data.html#cb248-6" aria-hidden="true" tabindex="-1"></a>                                              <span class="co"># toute valeur non prise en compte par ces conditions seront consideres commme valeur NA (manquante)</span></span></code></pre></div>
<p>Lorsque chaque ligne des données est évaluée, les critères sont appliqués/évalués dans l’ordre où les instructions <code>case_when()</code> sont écrites - de haut en bas. Si le premier critère est évalué à <code>TRUE</code> pour une ligne donnée, la valeur CD est attribuée, et les autres critères ne sont même pas testés pour cette ligne. Il est donc préférable d’écrire les critères les plus restrictifs en premier, et les plus généraux en dernier. Une ligne de données qui ne répond à aucun des critères de droite se verra attribuer la valeur “NA” (manquante).</p>
<p>Parfois, vous pouvez écrire une instruction finale qui attribue une valeur pour tous les autres scénarios non décrits par l’une des lignes précédentes. Pour faire cela, placez <code>TRUE</code> sur le côté gauche, ce qui permettra de capturer toute ligne qui ne répond à aucun des critères précédents. Le côté droit de cette déclaration pourrait se voir attribuer une valeur comme “vérifiez-moi !” ou manquante.</p>
<p>Voici un autre exemple de <code>case_when()</code> utilisé pour créer une nouvelle colonne avec la classification du patient, selon une définition de cas pour les cas confirmés et suspectés :</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="cleaning_data.html#cb249-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb249-2"><a href="cleaning_data.html#cb249-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">case_status =</span> <span class="fu">case_when</span>(</span>
<span id="cb249-3"><a href="cleaning_data.html#cb249-3" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb249-4"><a href="cleaning_data.html#cb249-4" aria-hidden="true" tabindex="-1"></a>          <span class="co"># si le patient a fait un test de laboratoire et le test est positif,</span></span>
<span id="cb249-5"><a href="cleaning_data.html#cb249-5" aria-hidden="true" tabindex="-1"></a>          <span class="co"># il est marqué comme un cas confirmé </span></span>
<span id="cb249-6"><a href="cleaning_data.html#cb249-6" aria-hidden="true" tabindex="-1"></a>          ct_blood <span class="sc">&lt;</span> <span class="dv">20</span>                   <span class="sc">~</span> <span class="st">&quot;Confirmed&quot;</span>,</span>
<span id="cb249-7"><a href="cleaning_data.html#cb249-7" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb249-8"><a href="cleaning_data.html#cb249-8" aria-hidden="true" tabindex="-1"></a>          <span class="co"># étant donné qu&#39;un patient n&#39;a pas de résultat de laboratoire positif,</span></span>
<span id="cb249-9"><a href="cleaning_data.html#cb249-9" aria-hidden="true" tabindex="-1"></a>          <span class="co"># si le patient a une &quot;source&quot; (lien épidémiologique) ET a de la fièvre, </span></span>
<span id="cb249-10"><a href="cleaning_data.html#cb249-10" aria-hidden="true" tabindex="-1"></a>          <span class="co"># alors il est considéré comme un cas suspect</span></span>
<span id="cb249-11"><a href="cleaning_data.html#cb249-11" aria-hidden="true" tabindex="-1"></a>          <span class="sc">!</span><span class="fu">is.na</span>(source) <span class="sc">&amp;</span> fever <span class="sc">==</span> <span class="st">&quot;yes&quot;</span> <span class="sc">~</span> <span class="st">&quot;Suspect&quot;</span>,</span>
<span id="cb249-12"><a href="cleaning_data.html#cb249-12" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb249-13"><a href="cleaning_data.html#cb249-13" aria-hidden="true" tabindex="-1"></a>          <span class="co"># tout autre patient non traité ci-dessus </span></span>
<span id="cb249-14"><a href="cleaning_data.html#cb249-14" aria-hidden="true" tabindex="-1"></a>          <span class="co"># est marqué pour un suivi</span></span>
<span id="cb249-15"><a href="cleaning_data.html#cb249-15" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span>                            <span class="sc">~</span> <span class="st">&quot;To investigate&quot;</span>))</span></code></pre></div>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> <strong>Les valeurs du côté droit doivent toutes être de la même classe</strong> - soit numérique, caractère, date, logique, etc. Pour attribuer des valeurs manquantes (<code>NA</code>), Il est dnas certaine situation important d’utiliser des variantes spéciales de <code>NA</code> telles que <code>NA_caracter_</code>, <code>NA_real_</code> (pour les numériques ou POSIX), et <code>as.Date(NA)</code>. Pour en savoir plus, lisez <a href="working_dates.html#working_dates">Manipuler les dates</a>.</span></p>
</div>
<div id="valeurs-manquantes-1" class="section level3 unnumbered">
<h3>Valeurs manquantes</h3>
<p>Vous trouverez ci-dessous des fonctions spéciales pour le traitement des valeurs manquantes dans le cadre du nettoyage des données.</p>
<p>Voir la page sur les <a href="missing_data.html#missing_data">Données manquantes</a> pour des conseils plus détaillés sur l’identification et la gestion des valeurs manquantes. Par exemple, la fonction <code>is.na()</code> qui teste logiquement l’absence de données.</p>
<p><strong><code>replace_na()</code></strong></p>
<p>Pour changer les valeurs manquantes (<code>NA</code>) en une valeur spécifique, telle que “Missing”, utilisez la fonction <strong>dplyr</strong> <code>replace_na()</code> dans <code>mutate()</code>. Notez que cette fonction est utilisée de la même manière que <code>recode</code> ci-dessus - le nom de la variable doit être mentionnée dans <code>replace_na()</code>.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="cleaning_data.html#cb250-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb250-2"><a href="cleaning_data.html#cb250-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>))</span></code></pre></div>
<p><strong>fct_explicit_na()</strong></p>
<p>C’est une fonction du package <strong>forcats</strong> qui permet de manipuler les colonnes de la classe Factor. Les facteurs constitue la facon dont R gère les valeurs <em>ordonnées</em> telles que <code>c("Premier", "Deuxieme", "Troisieme")</code> ou pour définir l’ordre dans lequel les valeurs (par exemple les hôpitaux) apparaissent dans les tableaux et les graphiques. Voir la page sur les <a href="factors.html#factors">Facteurs</a>.</p>
<p>Si vos données sont de la classe Factor et que vous essayez de convertir <code>NA</code> en “Missing” en utilisant <code>replace_na()</code>, vous obtiendrez cette erreur : <code>invalid factor level, NA generated</code>. Vous avez essayé d’ajouter “Missing” comme valeur, alors qu’il n’était pas défini comme un niveau possible du facteur, et il a été rejeté.</p>
<p>La façon la plus simple de résoudre ce problème est d’utiliser la fonction <code>fct_explicit_na()</code> du package <strong>forcats</strong> qui convertit une colonne en classe facteur , et convertit les valeurs <code>NA</code> en caractère “(Missing)”.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="cleaning_data.html#cb251-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb251-2"><a href="cleaning_data.html#cb251-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">fct_explicit_na</span>(hospital))</span></code></pre></div>
<p>Une alternative plus lente serait d’ajouter le niveau du facteur en utilisant <code>fct_expand()</code> et ensuite de convertir les valeurs manquantes.</p>
<p><strong><code>na_if()</code></strong></p>
<p>Pour convertir une valeur <em>spécifique en</em> <code>NA</code>, utilisez la fonction <code>na_if()</code> de <strong>dplyr</strong>. La commande ci-dessous effectue l’opération inverse de <code>replace_na()</code>. Dans l’exemple ci-dessous, toutes les valeurs de “Missing” dans la colonne <code>hospital</code> sont converties en <code>NA</code>.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="cleaning_data.html#cb252-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb252-2"><a href="cleaning_data.html#cb252-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">na_if</span>(hospital, <span class="st">&quot;Missing&quot;</span>))</span></code></pre></div>
<p>Remarque : <code>na_if()</code> <strong>ne peut pas être utilisé pour des critères logiques</strong> (par exemple “toutes les valeurs &gt; 99”) - utilisez <code>replace()</code> ou <code>case_when()</code> pour cela :</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="cleaning_data.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remplacer les temperature superieure à 40 par NA</span></span>
<span id="cb253-2"><a href="cleaning_data.html#cb253-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb253-3"><a href="cleaning_data.html#cb253-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp =</span> <span class="fu">replace</span>(temp, temp <span class="sc">&gt;</span> <span class="dv">40</span>, <span class="cn">NA</span>))</span>
<span id="cb253-4"><a href="cleaning_data.html#cb253-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-5"><a href="cleaning_data.html#cb253-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert onset dates earlier than 1 Jan 2000 to missing</span></span>
<span id="cb253-6"><a href="cleaning_data.html#cb253-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir en valeur manquante toutes dates d&#39;appartion  avant le 1 Jan 2000 </span></span>
<span id="cb253-7"><a href="cleaning_data.html#cb253-7" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb253-8"><a href="cleaning_data.html#cb253-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">replace</span>(date_onset, date_onset <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;2000-01-01&quot;</span>), <span class="cn">NA</span>))</span></code></pre></div>
</div>
<div id="dictionnaire-contenant-les-parametres-de-nettoyage" class="section level3 unnumbered">
<h3>Dictionnaire contenant les parametres de nettoyage</h3>
<p>Utilisez le package <strong>matchmaker</strong> et sa fonction <code>match_df()</code> pour nettoyer un dataframe avec un <em>dictionnaire de nettoyage</em>.</p>
<ol style="list-style-type: decimal">
<li>Créez un dictionnaire de nettoyage avec 3 colonnes :
<ul>
<li>Une colonne “from” (la valeur incorrecte)<br />
</li>
<li>Une colonne “to” (la valeur correcte)<br />
</li>
<li>Une colonne spécifiant la colonne pour laquelle les changements doivent être appliqués (ou “.global” pour appliquer à toutes les colonnes).</li>
</ul></li>
</ol>
<p>Remarque : les entrées du dictionnaire .global seront remplacées par les entrées du dictionnaire spécifiques à la colonne.</p>
<p><img src="images/cleaning_dict.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Importez le fichier du dictionnaire dans R. Cet exemple peut être téléchargé via les instructions de la page <a href="download_book_data.html#download_book_data">Télécharger le manuel et les données</a>.</li>
</ol>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="cleaning_data.html#cb254-1" aria-hidden="true" tabindex="-1"></a>cleaning_dict <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">&quot;cleaning_dict.csv&quot;</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Pipez le jeu de donnée brute linelist à <code>match_df()</code>, en spécifiant à <code>dictionary =</code> le dataframe du dictionnaire de nettoyage.L’argument <code>from =</code> doit être le nom de la colonne du dictionnaire qui contient les “anciennes” valeurs, l’argument <code>by =</code> doit être la colonne du dictionnaire qui contient les “nouvelles” valeurs correspondantes, et la troisième colonne indique la colonne dans laquelle effectuer le changement. Utilisez <code>.global</code> dans la colonne <code>by =</code> pour appliquer un changement à toutes les colonnes. Une quatrième colonne de dictionnaire <code>order</code> peut être utilisée pour spécifier l’ordre des facteurs des nouvelles valeurs.<br />
Vous trouverez plus de détails dans la <a href="https://cran.r-project.org/web/packages/matchmaker/vignettes/intro.html">documentation du package</a> en exécutant <code>?match_df</code>. Notez que l’exécution de cette fonction peut prendre beaucoup de temps pour un grand jeu de données.</li>
</ol>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="cleaning_data.html#cb255-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> <span class="co"># fournissez ou pipez votre jeu de données</span></span>
<span id="cb255-2"><a href="cleaning_data.html#cb255-2" aria-hidden="true" tabindex="-1"></a>     matchmaker<span class="sc">::</span><span class="fu">match_df</span>(</span>
<span id="cb255-3"><a href="cleaning_data.html#cb255-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">dictionary =</span> cleaning_dict, <span class="co"># nom de votre dictionnaire</span></span>
<span id="cb255-4"><a href="cleaning_data.html#cb255-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">from =</span> <span class="st">&quot;from&quot;</span>, <span class="co"># colonne avec les valeurs à remplacer (par défaut, col 1)</span></span>
<span id="cb255-5"><a href="cleaning_data.html#cb255-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">to =</span> <span class="st">&quot;to&quot;</span>, <span class="co"># colonne avec les valeurs finales (par défaut col 2)</span></span>
<span id="cb255-6"><a href="cleaning_data.html#cb255-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="st">&quot;col&quot;</span>, <span class="co"># colonne avec les noms de colonnes (par défaut col 3)</span></span>
<span id="cb255-7"><a href="cleaning_data.html#cb255-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Maintenant, faites défiler vers la droite pour voir comment les valeurs ont changé - en particulier le <code>genre</code>(de minuscule à majuscule), et toutes les colonnes de symptômes ont été transformées de oui/non à 1/0.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-bd55fa650e4da9343bfb" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-bd55fa650e4da9343bfb">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["M","F","M","F","M","F","F","F","M","F","M","M","M","F","F","M","F","F","F","F","M","M","F","M","F","M","M","F","M","F","F","F","M","M","F","M","F","F","F","M","F","M","F","M","M","F","M","F","M","M"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","0","0","0",null,"0","0","0","0","0",null,"0","0","0",null,null,"0","0",null,"0","0",null,null,"0","0",null,"0","0",null,"0","0","0","0","0","0",null],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","0","1","0",null,"0","0","0","1","0",null,"0","0","1",null,null,"0","0",null,"0","0",null,null,"0","0",null,"0","0",null,"0","1","0","0","0","0",null],["1",null,null,"0","1","1",null,"1","1","1","1","1","1","1","1","1","1","1",null,"1","1","1","1","1",null,"1","1","1",null,null,"1","1",null,"1","1",null,null,"1","1",null,"1","1",null,"1","1","1","1","1","0",null],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","1","0","0",null,"0","0","0","0","0",null,"0","0","0",null,null,"0","0",null,"0","0",null,null,"1","1",null,"0","0",null,"0","0","0","0","0","0",null],["1",null,null,"0","1","1",null,"1","1","0","1","0","0","0","1","0","0","0",null,"0","1","0","0","0",null,"0","0","0",null,null,"0","1",null,"1","1",null,null,"1","1",null,"1","1",null,"1","1","0","1","1","1",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>age_years<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,13,15,16,17,23,25,26]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Notez que les noms de vos colonnes dans le dictionnaire de nettoyage doivent correspondre aux noms <em>à ce stade</em> dans votre script de nettoyage. Voir cette <a href="https://www.repidemicsconsortium.org/linelist/reference/clean_data.html">référence en ligne pour le package linelist</a> pour plus de détails.</p>
<div id="ajouter-à-la-chaine-de-commande-pipé-2" class="section level4 unnumbered">
<h4>Ajouter à la chaine de commande pipé</h4>
<p><strong>Ci dessous quelques nouveaux colonnes et des transformations operes sur les colonnes existantes sont implementés dans la chaine pipé.</strong></p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="cleaning_data.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NETTOYAGE: enchainement de commandes  &#39;PIPE&#39;  (debute avec la donnée brute  et le  pipe avec les commandes pour le nettoyage)</span></span>
<span id="cb256-2"><a href="cleaning_data.html#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb256-3"><a href="cleaning_data.html#cb256-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-4"><a href="cleaning_data.html#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Debuter le processus de Nettoyage pipé</span></span>
<span id="cb256-5"><a href="cleaning_data.html#cb256-5" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb256-6"><a href="cleaning_data.html#cb256-6" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb256-7"><a href="cleaning_data.html#cb256-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb256-8"><a href="cleaning_data.html#cb256-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># standardiser la syntaxe des noms de colonnes</span></span>
<span id="cb256-9"><a href="cleaning_data.html#cb256-9" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb256-10"><a href="cleaning_data.html#cb256-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb256-11"><a href="cleaning_data.html#cb256-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># renommer manuellement les noms de colonnes</span></span>
<span id="cb256-12"><a href="cleaning_data.html#cb256-12" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Nouveau nom             # Ancien nom</span></span>
<span id="cb256-13"><a href="cleaning_data.html#cb256-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb256-14"><a href="cleaning_data.html#cb256-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb256-15"><a href="cleaning_data.html#cb256-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb256-16"><a href="cleaning_data.html#cb256-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb256-17"><a href="cleaning_data.html#cb256-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># supprimer colonne</span></span>
<span id="cb256-18"><a href="cleaning_data.html#cb256-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb256-19"><a href="cleaning_data.html#cb256-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb256-20"><a href="cleaning_data.html#cb256-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># supprimer les doublon</span></span>
<span id="cb256-21"><a href="cleaning_data.html#cb256-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb256-22"><a href="cleaning_data.html#cb256-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb256-23"><a href="cleaning_data.html#cb256-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ajouter colonne</span></span>
<span id="cb256-24"><a href="cleaning_data.html#cb256-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span>     </span>
<span id="cb256-25"><a href="cleaning_data.html#cb256-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-26"><a href="cleaning_data.html#cb256-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convertir les classes des colonnes</span></span>
<span id="cb256-27"><a href="cleaning_data.html#cb256-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb256-28"><a href="cleaning_data.html#cb256-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">generation =</span> <span class="fu">as.numeric</span>(generation),</span>
<span id="cb256-29"><a href="cleaning_data.html#cb256-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">age        =</span> <span class="fu">as.numeric</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb256-30"><a href="cleaning_data.html#cb256-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb256-31"><a href="cleaning_data.html#cb256-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ajout colonnes: Delai de l&#39;apparition de la maladie et  l&#39;hospitalisation</span></span>
<span id="cb256-32"><a href="cleaning_data.html#cb256-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">days_onset_hosp =</span> <span class="fu">as.numeric</span>(date_hospitalisation <span class="sc">-</span> date_onset)) <span class="sc">%&gt;%</span> </span>
<span id="cb256-33"><a href="cleaning_data.html#cb256-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb256-34"><a href="cleaning_data.html#cb256-34" aria-hidden="true" tabindex="-1"></a>   <span class="co"># CI DESSUS LES ETAPES DU NETTOYAGE DEJA ABORDEES EN AMONT</span></span>
<span id="cb256-35"><a href="cleaning_data.html#cb256-35" aria-hidden="true" tabindex="-1"></a>   <span class="do">###################################################</span></span>
<span id="cb256-36"><a href="cleaning_data.html#cb256-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-37"><a href="cleaning_data.html#cb256-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nettoyer les  valeurs de la colonne hospital </span></span>
<span id="cb256-38"><a href="cleaning_data.html#cb256-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital,</span>
<span id="cb256-39"><a href="cleaning_data.html#cb256-39" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># ANCIEN = NOUVEAU</span></span>
<span id="cb256-40"><a href="cleaning_data.html#cb256-40" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb256-41"><a href="cleaning_data.html#cb256-41" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb256-42"><a href="cleaning_data.html#cb256-42" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb256-43"><a href="cleaning_data.html#cb256-43" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      <span class="ot">=</span> <span class="st">&quot;Port Hospital&quot;</span>,</span>
<span id="cb256-44"><a href="cleaning_data.html#cb256-44" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   <span class="ot">=</span> <span class="st">&quot;Central Hospital&quot;</span>,</span>
<span id="cb256-45"><a href="cleaning_data.html#cb256-45" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;other&quot;</span>             <span class="ot">=</span> <span class="st">&quot;Other&quot;</span>,</span>
<span id="cb256-46"><a href="cleaning_data.html#cb256-46" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> <span class="ot">=</span> <span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb256-47"><a href="cleaning_data.html#cb256-47" aria-hidden="true" tabindex="-1"></a>                      )) <span class="sc">%&gt;%</span> </span>
<span id="cb256-48"><a href="cleaning_data.html#cb256-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb256-49"><a href="cleaning_data.html#cb256-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb256-50"><a href="cleaning_data.html#cb256-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-51"><a href="cleaning_data.html#cb256-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># creer une colonne  age_years  (à partir des solonnes  age et age_unit)</span></span>
<span id="cb256-52"><a href="cleaning_data.html#cb256-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">case_when</span>(</span>
<span id="cb256-53"><a href="cleaning_data.html#cb256-53" aria-hidden="true" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">&quot;years&quot;</span> <span class="sc">~</span> age,</span>
<span id="cb256-54"><a href="cleaning_data.html#cb256-54" aria-hidden="true" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">&quot;months&quot;</span> <span class="sc">~</span> age<span class="sc">/</span><span class="dv">12</span>,</span>
<span id="cb256-55"><a href="cleaning_data.html#cb256-55" aria-hidden="true" tabindex="-1"></a>          <span class="fu">is.na</span>(age_unit) <span class="sc">~</span> age,</span>
<span id="cb256-56"><a href="cleaning_data.html#cb256-56" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>))</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="num_cats" class="section level2" number="8.9">
<h2><span class="header-section-number">8.9</span> Classes numeriques</h2>
<p>Nous décrivons ici quelques approches spéciales pour créer des catégories à partir de colonnes numériques. Les exemples les plus courants sont les catégories d’âge, les groupes de valeurs de laboratoire, etc. Nous discuterons ici :</p>
<ul>
<li><code>age_categories()</code>, du paquet <strong>epikit</strong>.<br />
</li>
<li><code>cut()</code>, du package <strong>base</strong> R<br />
</li>
<li><code>case_when()</code><br />
</li>
<li>Les ruptures quantiles avec <code>quantile()</code> et <code>ntile()</code>.</li>
</ul>
<div id="revoir-la-distribution" class="section level3 unnumbered">
<h3>Revoir la distribution</h3>
<p>Pour cet exemple, nous allons créer une colonne <code>age_cat</code> en utilisant la colonne <code>age_years</code>.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="cleaning_data.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verifions la class de la colonne age_years</span></span>
<span id="cb257-2"><a href="cleaning_data.html#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>age_years)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<p>Tout d’abord, examinez la distribution de vos données, afin de définir limites appropriés. Voir la page sur <a href="ggplot_basics.html#ggplot_basics">les bases de ggplot</a>.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="cleaning_data.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co"># examine the distribution</span></span>
<span id="cb259-2"><a href="cleaning_data.html#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(linelist<span class="sc">$</span>age_years)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-209-1.png" width="672" height="50%" /></p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="cleaning_data.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(linelist<span class="sc">$</span>age_years, <span class="at">na.rm=</span>T)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##    0.00    6.00   13.00   16.04   23.00   84.00     107</code></pre>
<p><span style="color: orange;"><strong><em>ATTENTION:</em></strong> Parfois, les variables numériques sont importées en tant que classe “character”. Cela se produit s’il y a des caractères non numériques dans certaines des valeurs, par exemple une entrée de “2 mois” pour l’âge, ou (en fonction des paramètres par defaut de R) si une virgule est utilisée à la place des décimales (par exemple “4,5” pour signifier quatre ans et demi)..</span></p>
<!-- ======================================================= -->
</div>
<div id="age_categories" class="section level3 unnumbered">
<h3><code>age_categories()</code></h3>
<p>Avec le packagge <strong>epikit</strong>, vous pouvez utiliser la fonction <code>age_categories()</code> pour catégoriser et étiqueter facilement les colonnes numériques (noté que cette fonction peut aussi être appliquée à des variables non numériques d’âge). En guise de bonus, la colonne de sortie est automatiquement une variable categorielle ordonnée.</p>
<p>Voici les entrées requises :</p>
<ul>
<li>Un tableau numérique (colonne)<br />
</li>
<li>L’argument <code>breakers =</code> - fournit un vecteur numérique de points de rupture pour les nouveaux groupes.</li>
</ul>
<p>Tout d’abord, l’exemple le plus simple :</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="cleaning_data.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemple basique</span></span>
<span id="cb262-2"><a href="cleaning_data.html#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="do">################</span></span>
<span id="cb262-3"><a href="cleaning_data.html#cb262-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(epikit)                    <span class="co"># chargerle  package</span></span>
<span id="cb262-4"><a href="cleaning_data.html#cb262-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-5"><a href="cleaning_data.html#cb262-5" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb262-6"><a href="cleaning_data.html#cb262-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb262-7"><a href="cleaning_data.html#cb262-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">age_categories</span>(             <span class="co"># creer un nouveau colonne</span></span>
<span id="cb262-8"><a href="cleaning_data.html#cb262-8" aria-hidden="true" tabindex="-1"></a>      age_years,                            <span class="co"># colonne numerique pour  concevoir des groupes</span></span>
<span id="cb262-9"><a href="cleaning_data.html#cb262-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>,        <span class="co"># les  bornes</span></span>
<span id="cb262-10"><a href="cleaning_data.html#cb262-10" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>)))</span>
<span id="cb262-11"><a href="cleaning_data.html#cb262-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-12"><a href="cleaning_data.html#cb262-12" aria-hidden="true" tabindex="-1"></a><span class="co"># afficher le tableau</span></span>
<span id="cb262-13"><a href="cleaning_data.html#cb262-13" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-39 40-49 50-59 60-69   70+  &lt;NA&gt; 
##  1227  1223  1048   827  1216   597   251    78    27     7   107</code></pre>
<p>Les valeurs de bornes que vous spécifiez sont par défaut les limites inférieures - c’est-à-dire qu’elles sont incluses dans le groupe “supérieur” / les groupes sont “ouverts” du côté inférieur/gauche. Comme indiqué ci-dessous, vous pouvez ajouter 1 à chaque valeur de rupture pour obtenir des groupes ouverts en haut/à droite.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="cleaning_data.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inclure les bornes superieures pour les memes classes</span></span>
<span id="cb264-2"><a href="cleaning_data.html#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb264-3"><a href="cleaning_data.html#cb264-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb264-4"><a href="cleaning_data.html#cb264-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb264-5"><a href="cleaning_data.html#cb264-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">age_categories</span>(</span>
<span id="cb264-6"><a href="cleaning_data.html#cb264-6" aria-hidden="true" tabindex="-1"></a>      age_years, </span>
<span id="cb264-7"><a href="cleaning_data.html#cb264-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">21</span>, <span class="dv">31</span>, <span class="dv">41</span>, <span class="dv">51</span>, <span class="dv">61</span>, <span class="dv">71</span>)))</span>
<span id="cb264-8"><a href="cleaning_data.html#cb264-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-9"><a href="cleaning_data.html#cb264-9" aria-hidden="true" tabindex="-1"></a><span class="co"># afficher le tableau</span></span>
<span id="cb264-10"><a href="cleaning_data.html#cb264-10" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-5  6-10 11-15 16-20 21-30 31-40 41-50 51-60 61-70   71+  &lt;NA&gt; 
##  1469  1195  1040   770  1149   547   231    70    24     6   107</code></pre>
<p>Vous pouvez ajuster la façon dont les étiquettes sont affichées avec <code>separator =</code>. La valeur par défaut est “-”.</p>
<p>Vous pouvez ajuster la façon dont les numéros supérieurs sont traités, avec l’argument <code>ceiling =</code>. Pour définir une coupure supérieure, mettez <code>ceiling = TRUE</code>. Dans cette utilisation, la valeur de rupture la plus élevée fournie est un “plafond” et une catégorie “XX+” n’est pas créée. Toutes les valeurs supérieures à la valeur de rupture la plus élevée (ou à <code>upper =</code>, s’il est défini) sont classées dans la catégorie <code>NA</code>. Voici un exemple avec <code>ceiling = TRUE</code>, de sorte qu’il n’y a pas de catégorie XX+ et que les valeurs supérieures à 70 (la valeur de rupture la plus élevée) sont classées comme NA.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="cleaning_data.html#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec l&#39;argument ceiling definit comme  TRUE</span></span>
<span id="cb266-2"><a href="cleaning_data.html#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="do">##########################</span></span>
<span id="cb266-3"><a href="cleaning_data.html#cb266-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb266-4"><a href="cleaning_data.html#cb266-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb266-5"><a href="cleaning_data.html#cb266-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">age_categories</span>(</span>
<span id="cb266-6"><a href="cleaning_data.html#cb266-6" aria-hidden="true" tabindex="-1"></a>      age_years, </span>
<span id="cb266-7"><a href="cleaning_data.html#cb266-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>),</span>
<span id="cb266-8"><a href="cleaning_data.html#cb266-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">ceiling =</span> <span class="cn">TRUE</span>)) <span class="co"># 70 is le plafond, toute valeur au dela  devient  NA</span></span>
<span id="cb266-9"><a href="cleaning_data.html#cb266-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-10"><a href="cleaning_data.html#cb266-10" aria-hidden="true" tabindex="-1"></a><span class="co"># afficher le tableau</span></span>
<span id="cb266-11"><a href="cleaning_data.html#cb266-11" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-39 40-49 50-59 60-70  &lt;NA&gt; 
##  1227  1223  1048   827  1216   597   251    78    28   113</code></pre>
<p>Alternativement, au lieu de <code>breakers =</code>, vous pouvez fournir tous les <code>lower =</code>, <code>upper =</code>, et <code>by =</code> :</p>
<ul>
<li><code>lower =</code> Le nombre le plus bas que vous voulez prendre en compte - la valeur par défaut est 0<br />
</li>
<li><code>upper =</code> Le nombre le plus élevé que vous voulez considérer<br />
</li>
<li><code>by =</code> Le nombre d’années entre les groupes</li>
</ul>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="cleaning_data.html#cb268-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb268-2"><a href="cleaning_data.html#cb268-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb268-3"><a href="cleaning_data.html#cb268-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">age_categories</span>(</span>
<span id="cb268-4"><a href="cleaning_data.html#cb268-4" aria-hidden="true" tabindex="-1"></a>      age_years, </span>
<span id="cb268-5"><a href="cleaning_data.html#cb268-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="dv">0</span>,</span>
<span id="cb268-6"><a href="cleaning_data.html#cb268-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="dv">100</span>,</span>
<span id="cb268-7"><a href="cleaning_data.html#cb268-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="dv">10</span>))</span>
<span id="cb268-8"><a href="cleaning_data.html#cb268-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-9"><a href="cleaning_data.html#cb268-9" aria-hidden="true" tabindex="-1"></a><span class="co"># afficher tableau</span></span>
<span id="cb268-10"><a href="cleaning_data.html#cb268-10" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-9 10-19 20-29 30-39 40-49 50-59 60-69 70-79 80-89 90-99  100+  &lt;NA&gt; 
##  2450  1875  1216   597   251    78    27     6     1     0     0   107</code></pre>
<p>Consultez la page d’aide de la fonction pour plus de détails (entrez <code>?age_categories</code> dans la console R).</p>
<!-- ======================================================= -->
</div>
<div id="cut" class="section level3 unnumbered">
<h3><code>cut()</code></h3>
<p><code>cut()</code> est une alternative à <code>age_categories()</code> présente dans les packages de <strong>base</strong> de R , vous verrez pourquoi <code>age_categories()</code> a été développé pour simplifier ce processus. Quelques différences notoires avec <code>age_categories()</code> sont :</p>
<ul>
<li>Vous n’avez pas besoin d’installer/charger un autre package<br />
</li>
<li>Vous pouvez spécifier si les groupes sont ouverts/fermés à droite/à gauche.<br />
</li>
<li>Vous devez fournir vous-même des étiquettes précises<br />
</li>
<li>Si vous voulez que 0 soit inclus dans le groupe le plus bas, vous devez le spécifier.</li>
</ul>
<p>La syntaxe de base de <code>cut()</code> est de fournir d’abord la colonne numérique à découper (<code>age_years</code>), puis l’argument <em>breaks</em>, qui est un vecteur numérique <code>c()</code> de points de rupture. En utilisant <code>cut()</code>, la colonne résultante est un facteur ordonné.</p>
<p>Par défaut, la catégorisation se produit de sorte que le côté droit/supérieur est “ouvert” et inclusif (et le côté gauche/inférieur est “fermé” ou exclusif). C’est le comportement opposé de la fonction <code>age_categories()</code>. Les étiquettes par défaut utilisent la notation “(A, B]”, ce qui signifie que A n’est pas inclus mais que B l’est. **Inversez ce comportement en fournissant l’argument <code>right = TRUE</code>.</p>
<p>Ainsi, par défaut, les valeurs “0” sont exclues du groupe le plus bas, et catégorisées comme <code>NA</code> ! Les valeurs “0” pourraient être des nourrissons codés comme ayant l’âge 0, alors faites attention ! Pour changer cela, ajoutez l’argument <code>include.lowest = TRUE</code> pour que toutes les valeurs “0” soient incluses dans le groupe le plus bas. L’étiquette générée automatiquement pour la catégorie la plus basse sera alors “[A],B]”. Notez que si vous incluez l’argument <code>include.lowest = TRUE</code> <strong>et</strong> <code>right = TRUE</code>, l’inclusion extrême s’appliquera maintenant à la valeur et à la catégorie du point de rupture <em>haut</em>, et non à la plus basse.</p>
<p>Vous pouvez fournir un vecteur d’étiquettes personnalisées en utilisant l’argument <code>labels =</code>. Comme ils sont écrits manuellement, faites très attention à ce qu’ils soient exacts ! Vérifiez votre travail en utilisant des tableaux croisés, comme décrit ci-dessous.</p>
<p>Voici un exemple de <code>cut()</code> appliqué à <code>age_years</code> pour créer la nouvelle variable <code>age_cat</code> :</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="cleaning_data.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creons une nouvelle variable en decoupant par interval la variable numerique age</span></span>
<span id="cb270-2"><a href="cleaning_data.html#cb270-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-3"><a href="cleaning_data.html#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="co">#La valeur de la borne inferieure est exclu mais la borne superieu est inclue dans chaque groupe</span></span>
<span id="cb270-4"><a href="cleaning_data.html#cb270-4" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb270-5"><a href="cleaning_data.html#cb270-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb270-6"><a href="cleaning_data.html#cb270-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">cut</span>(</span>
<span id="cb270-7"><a href="cleaning_data.html#cb270-7" aria-hidden="true" tabindex="-1"></a>      age_years,</span>
<span id="cb270-8"><a href="cleaning_data.html#cb270-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>,</span>
<span id="cb270-9"><a href="cleaning_data.html#cb270-9" aria-hidden="true" tabindex="-1"></a>                 <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">100</span>),</span>
<span id="cb270-10"><a href="cleaning_data.html#cb270-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">include.lowest =</span> <span class="cn">TRUE</span>         <span class="co"># inclu le 0 dans le premier interval crée</span></span>
<span id="cb270-11"><a href="cleaning_data.html#cb270-11" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb270-12"><a href="cleaning_data.html#cb270-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-13"><a href="cleaning_data.html#cb270-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Representer dans un tableau les nombres d&#39;observations en fonction des categories créee</span></span>
<span id="cb270-14"><a href="cleaning_data.html#cb270-14" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##    [0,5]   (5,10]  (10,15]  (15,20]  (20,30]  (30,50]  (50,70] (70,100]     &lt;NA&gt; 
##     1469     1195     1040      770     1149      778       94        6      107</code></pre>
<p>**Vérifiez que chaque valeur d’âge a été affectée à la bonne catégorie en croisant les colonnes numériques et de catégorie. Examinez l’attribution des valeurs limites (par exemple 15, si les catégories voisines sont 10-15 et 16-20).</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="cleaning_data.html#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross tabulation of the numeric and category columns. </span></span>
<span id="cb272-2"><a href="cleaning_data.html#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="co"># tableau croisé entre les colonnes numeriques et categorielles</span></span>
<span id="cb272-3"><a href="cleaning_data.html#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="st">&quot;Numeric Values&quot;</span> <span class="ot">=</span> linelist<span class="sc">$</span>age_years,   <span class="co"># names specified in table for clarity.</span></span>
<span id="cb272-4"><a href="cleaning_data.html#cb272-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Categories&quot;</span>     <span class="ot">=</span> linelist<span class="sc">$</span>age_cat,</span>
<span id="cb272-5"><a href="cleaning_data.html#cb272-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)                        </span></code></pre></div>
<pre><code>##                     Categories
## Numeric Values       [0,5] (5,10] (10,15] (15,20] (20,30] (30,50] (50,70] (70,100] &lt;NA&gt;
##   0                    136      0       0       0       0       0       0        0    0
##   0.0833333333333333     1      0       0       0       0       0       0        0    0
##   0.25                   2      0       0       0       0       0       0        0    0
##   0.333333333333333      6      0       0       0       0       0       0        0    0
##   0.416666666666667      1      0       0       0       0       0       0        0    0
##   0.5                    6      0       0       0       0       0       0        0    0
##   0.583333333333333      3      0       0       0       0       0       0        0    0
##   0.666666666666667      3      0       0       0       0       0       0        0    0
##   0.75                   3      0       0       0       0       0       0        0    0
##   0.833333333333333      1      0       0       0       0       0       0        0    0
##   0.916666666666667      1      0       0       0       0       0       0        0    0
##   1                    275      0       0       0       0       0       0        0    0
##   1.5                    2      0       0       0       0       0       0        0    0
##   2                    308      0       0       0       0       0       0        0    0
##   3                    246      0       0       0       0       0       0        0    0
##   4                    233      0       0       0       0       0       0        0    0
##   5                    242      0       0       0       0       0       0        0    0
##   6                      0    241       0       0       0       0       0        0    0
##   7                      0    256       0       0       0       0       0        0    0
##   8                      0    239       0       0       0       0       0        0    0
##   9                      0    245       0       0       0       0       0        0    0
##   10                     0    214       0       0       0       0       0        0    0
##   11                     0      0     220       0       0       0       0        0    0
##   12                     0      0     224       0       0       0       0        0    0
##   13                     0      0     191       0       0       0       0        0    0
##   14                     0      0     199       0       0       0       0        0    0
##   15                     0      0     206       0       0       0       0        0    0
##   16                     0      0       0     186       0       0       0        0    0
##   17                     0      0       0     164       0       0       0        0    0
##   18                     0      0       0     141       0       0       0        0    0
##   19                     0      0       0     130       0       0       0        0    0
##   20                     0      0       0     149       0       0       0        0    0
##   21                     0      0       0       0     158       0       0        0    0
##   22                     0      0       0       0     149       0       0        0    0
##   23                     0      0       0       0     125       0       0        0    0
##   24                     0      0       0       0     144       0       0        0    0
##   25                     0      0       0       0     107       0       0        0    0
##   26                     0      0       0       0     100       0       0        0    0
##   27                     0      0       0       0     117       0       0        0    0
##   28                     0      0       0       0      85       0       0        0    0
##   29                     0      0       0       0      82       0       0        0    0
##   30                     0      0       0       0      82       0       0        0    0
##   31                     0      0       0       0       0      68       0        0    0
##   32                     0      0       0       0       0      84       0        0    0
##   33                     0      0       0       0       0      78       0        0    0
##   34                     0      0       0       0       0      58       0        0    0
##   35                     0      0       0       0       0      58       0        0    0
##   36                     0      0       0       0       0      33       0        0    0
##   37                     0      0       0       0       0      46       0        0    0
##   38                     0      0       0       0       0      45       0        0    0
##   39                     0      0       0       0       0      45       0        0    0
##   40                     0      0       0       0       0      32       0        0    0
##   41                     0      0       0       0       0      34       0        0    0
##   42                     0      0       0       0       0      26       0        0    0
##   43                     0      0       0       0       0      31       0        0    0
##   44                     0      0       0       0       0      24       0        0    0
##   45                     0      0       0       0       0      27       0        0    0
##   46                     0      0       0       0       0      25       0        0    0
##   47                     0      0       0       0       0      16       0        0    0
##   48                     0      0       0       0       0      21       0        0    0
##   49                     0      0       0       0       0      15       0        0    0
##   50                     0      0       0       0       0      12       0        0    0
##   51                     0      0       0       0       0       0      13        0    0
##   52                     0      0       0       0       0       0       7        0    0
##   53                     0      0       0       0       0       0       4        0    0
##   54                     0      0       0       0       0       0       6        0    0
##   55                     0      0       0       0       0       0       9        0    0
##   56                     0      0       0       0       0       0       7        0    0
##   57                     0      0       0       0       0       0       9        0    0
##   58                     0      0       0       0       0       0       6        0    0
##   59                     0      0       0       0       0       0       5        0    0
##   60                     0      0       0       0       0       0       4        0    0
##   61                     0      0       0       0       0       0       2        0    0
##   62                     0      0       0       0       0       0       1        0    0
##   63                     0      0       0       0       0       0       5        0    0
##   64                     0      0       0       0       0       0       1        0    0
##   65                     0      0       0       0       0       0       5        0    0
##   66                     0      0       0       0       0       0       3        0    0
##   67                     0      0       0       0       0       0       2        0    0
##   68                     0      0       0       0       0       0       1        0    0
##   69                     0      0       0       0       0       0       3        0    0
##   70                     0      0       0       0       0       0       1        0    0
##   72                     0      0       0       0       0       0       0        1    0
##   73                     0      0       0       0       0       0       0        3    0
##   76                     0      0       0       0       0       0       0        1    0
##   84                     0      0       0       0       0       0       0        1    0
##   &lt;NA&gt;                   0      0       0       0       0       0       0        0  107</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="cleaning_data.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># N&#39;oublier pas d&#39;examiner les valeurs NA</span></span></code></pre></div>
<p><strong>Réétiquetage des valeurs <code>NA</code> </strong>.</p>
<p>Vous pouvez vouloir attribuer aux valeurs <code>NA</code> une étiquette telle que “Missing”. Comme la nouvelle colonne est de la classe Factor (valeurs restreintes), vous ne pouvez pas simplement la muter avec <code>replace_na()</code>, car cette valeur sera rejetée. A la place, utilisez <code>fct_explicit_na()</code> de <strong>forcats</strong> comme expliqué dans la page <a href="factors.html#factors">Facteurs</a>.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="cleaning_data.html#cb275-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb275-2"><a href="cleaning_data.html#cb275-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-3"><a href="cleaning_data.html#cb275-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cut() creates age_cat, automatically of class Factor      </span></span>
<span id="cb275-4"><a href="cleaning_data.html#cb275-4" aria-hidden="true" tabindex="-1"></a>     <span class="co"># cut() crée  automatique une colonne dénommée age_cat avec des valeurs categorielles </span></span>
<span id="cb275-5"><a href="cleaning_data.html#cb275-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_cat =</span> <span class="fu">cut</span>(</span>
<span id="cb275-6"><a href="cleaning_data.html#cb275-6" aria-hidden="true" tabindex="-1"></a>    age_years,</span>
<span id="cb275-7"><a href="cleaning_data.html#cb275-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">100</span>),          </span>
<span id="cb275-8"><a href="cleaning_data.html#cb275-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb275-9"><a href="cleaning_data.html#cb275-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,        </span>
<span id="cb275-10"><a href="cleaning_data.html#cb275-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0-4&quot;</span>, <span class="st">&quot;5-9&quot;</span>, <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>, <span class="st">&quot;20-29&quot;</span>, <span class="st">&quot;30-49&quot;</span>, <span class="st">&quot;50-69&quot;</span>, <span class="st">&quot;70-100&quot;</span>)),</span>
<span id="cb275-11"><a href="cleaning_data.html#cb275-11" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb275-12"><a href="cleaning_data.html#cb275-12" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb275-13"><a href="cleaning_data.html#cb275-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># nommer explicitemment les valeurs manquantes</span></span>
<span id="cb275-14"><a href="cleaning_data.html#cb275-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">fct_explicit_na</span>(</span>
<span id="cb275-15"><a href="cleaning_data.html#cb275-15" aria-hidden="true" tabindex="-1"></a>      age_cat,</span>
<span id="cb275-16"><a href="cleaning_data.html#cb275-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">na_level =</span> <span class="st">&quot;Missing age&quot;</span>)  <span class="co"># you can specify the label</span></span>
<span id="cb275-17"><a href="cleaning_data.html#cb275-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># on peut specifier les etiquettes</span></span>
<span id="cb275-18"><a href="cleaning_data.html#cb275-18" aria-hidden="true" tabindex="-1"></a>  )    </span>
<span id="cb275-19"><a href="cleaning_data.html#cb275-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-20"><a href="cleaning_data.html#cb275-20" aria-hidden="true" tabindex="-1"></a><span class="co"># tableau pour voir les effectifs</span></span>
<span id="cb275-21"><a href="cleaning_data.html#cb275-21" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##         0-4         5-9       10-14       15-19       20-29       30-49       50-69      70-100 Missing age        &lt;NA&gt; 
##        1227        1223        1048         827        1216         848         105           7         107           0</code></pre>
<p><strong>Créer des seuils de rupture et des étiquettes</strong></p>
<p>Pour une manière rapide de faire des pauses et de labelliser des vecteurs, utilisez quelque chose comme ci-dessous. Voir la page <a href="rbasics.html#rbasics">Bases de R</a> pour les références sur <code>seq()</code> et <code>rep()</code>.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="cleaning_data.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make break points from 0 to 90 by 5</span></span>
<span id="cb277-2"><a href="cleaning_data.html#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Crée un vecteur allant de 0 à 90 avec des pas de 5</span></span>
<span id="cb277-3"><a href="cleaning_data.html#cb277-3" aria-hidden="true" tabindex="-1"></a>age_seq <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb277-4"><a href="cleaning_data.html#cb277-4" aria-hidden="true" tabindex="-1"></a>age_seq</span>
<span id="cb277-5"><a href="cleaning_data.html#cb277-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-6"><a href="cleaning_data.html#cb277-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make labels for the above categories, assuming default cut() settings</span></span>
<span id="cb277-7"><a href="cleaning_data.html#cb277-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Créé des etiquettes pour les categories concues ci dessus avec les parametres de defaut de cut() </span></span>
<span id="cb277-8"><a href="cleaning_data.html#cb277-8" aria-hidden="true" tabindex="-1"></a>age_labels <span class="ot">=</span> <span class="fu">paste0</span>(age_seq <span class="sc">+</span> <span class="dv">1</span>, <span class="st">&quot;-&quot;</span>, age_seq <span class="sc">+</span> <span class="dv">5</span>)</span>
<span id="cb277-9"><a href="cleaning_data.html#cb277-9" aria-hidden="true" tabindex="-1"></a>age_labels</span>
<span id="cb277-10"><a href="cleaning_data.html#cb277-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-11"><a href="cleaning_data.html#cb277-11" aria-hidden="true" tabindex="-1"></a><span class="co"># check that both vectors are the same length</span></span>
<span id="cb277-12"><a href="cleaning_data.html#cb277-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Montrons que que les deux vecteurs sont de meme longueurs</span></span>
<span id="cb277-13"><a href="cleaning_data.html#cb277-13" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(age_seq) <span class="sc">==</span> <span class="fu">length</span>(age_labels)</span></code></pre></div>
<p>Lisez plus sur <code>cut()</code> dans sa page d’aide en entrant <code>?cut</code> dans la console R.</p>
</div>
<div id="seuil-de-rupture-par-le-quantile" class="section level3 unnumbered">
<h3>Seuil de rupture par le Quantile</h3>
<p>Dans le langage courant, les “quantiles” ou “percentiles” font généralement référence à une valeur en dessous de laquelle se situe une proportion de valeurs. Par exemple, le 95ème percentile des âges dans <code>linelist</code> serait l’âge en dessous duquel 95% de l’âge tombe.</p>
<p>Cependant, dans le langage courant, les “quartiles” et les “déciles” peuvent également faire référence aux <em>groupes de données</em> divisés de manière égale en 4 ou 10 groupes (notez qu’il y aura un point de rupture de plus que le groupe).</p>
<p>Pour obtenir les points de rupture des quantiles, vous pouvez utiliser <code>quantile()</code> du paquet <strong>stats</strong> de <strong>base</strong> R. Vous fournissez un vecteur numérique (par exemple une colonne dans un ensemble de données) et un vecteur de valeurs numériques de probabilité allant de 0 à 1,0. Les points de rupture sont renvoyés sous la forme d’un vecteur numérique. Explorez les détails des méthodologies statistiques en entrant <code>?quantile</code>.</p>
<ul>
<li>Si votre tableau numérique d’entrée a des valeurs manquantes, il est préférable de définir <code>na.rm = TRUE</code>.<br />
</li>
<li>Définissez <code>names = FALSE</code> pour obtenir un tableau numérique sans nom.</li>
</ul>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="cleaning_data.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(linelist<span class="sc">$</span>age_years,              <span class="co">#specifier le vecteur numerique sur lequel on travaille</span></span>
<span id="cb278-2"><a href="cleaning_data.html#cb278-2" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb278-3"><a href="cleaning_data.html#cb278-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">25</span>, .<span class="dv">50</span>, .<span class="dv">75</span>, .<span class="dv">90</span>, .<span class="dv">95</span>),  <span class="co">#specifier les centiles qui vous interesse</span></span>
<span id="cb278-4"><a href="cleaning_data.html#cb278-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)                            <span class="co"># ignorer les valeurs manquantes </span></span></code></pre></div>
<pre><code>##  0% 25% 50% 75% 90% 95% 
##   0   6  13  23  33  41</code></pre>
<p>Vous pouvez utiliser les résultats de <code>quantile()</code> comme points de rupture dans <code>age_categories()</code> ou <code>cut()</code>. Ci-dessous, nous créons une nouvelle colonne <code>déciles</code> en utilisant <code>cut()</code> où les ruptures sont définies en utilisant <code>quantiles()</code> sur <code>age_years</code>. Ci-dessous, nous affichons les résultats en utilisant <code>tabyl()</code> de <strong>janitor</strong> pour que vous puissiez voir les pourcentages (voir la page <a href="descriptive_tables.html#descriptive_tables">Tableaux descriptifs</a>). Notez comment ils ne sont pas exactement 10% dans chaque groupe.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="cleaning_data.html#cb280-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>                              <span class="co">#commencer avec la donnéé linelist</span></span>
<span id="cb280-2"><a href="cleaning_data.html#cb280-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deciles =</span> <span class="fu">cut</span>(age_years,           <span class="co"># creer un nouveau colonne decile qui represente des classes issues de l&#39;application de cut() sur age_years </span></span>
<span id="cb280-3"><a href="cleaning_data.html#cb280-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">quantile</span>(                      <span class="co">#definir les seuils  de la fonction cut en utilisant quantile()</span></span>
<span id="cb280-4"><a href="cleaning_data.html#cb280-4" aria-hidden="true" tabindex="-1"></a>      age_years,                               <span class="co"># utiliser  la colonne age_years</span></span>
<span id="cb280-5"><a href="cleaning_data.html#cb280-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>),             <span class="co"># 0.0 à 1.0 pas de  0.1</span></span>
<span id="cb280-6"><a href="cleaning_data.html#cb280-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span>),                           <span class="co"># ignorer les valeurs manquantes</span></span>
<span id="cb280-7"><a href="cleaning_data.html#cb280-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>             <span class="co">#Pour cut() inclure age 0</span></span>
<span id="cb280-8"><a href="cleaning_data.html#cb280-8" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">tabyl</span>(deciles)                   <span class="co"># piper pour obtenir un tableau à afficher</span></span></code></pre></div>
<pre><code>##  deciles   n    percent valid_percent
##    [0,2] 748 0.11319613    0.11505922
##    (2,5] 721 0.10911017    0.11090601
##    (5,7] 497 0.07521186    0.07644978
##   (7,10] 698 0.10562954    0.10736810
##  (10,13] 635 0.09609564    0.09767728
##  (13,17] 755 0.11425545    0.11613598
##  (17,21] 578 0.08746973    0.08890940
##  (21,26] 625 0.09458232    0.09613906
##  (26,33] 596 0.09019370    0.09167820
##  (33,84] 648 0.09806295    0.09967697
##     &lt;NA&gt; 107 0.01619249            NA</code></pre>
</div>
<div id="groupes-de-taille-égale" class="section level3 unnumbered">
<h3>Groupes de taille égale</h3>
<p>Un autre outil pour créer des groupes numériques est la fonction <strong>dplyr</strong> <code>ntile()</code>, qui tente de diviser vos données en n <em>groupes de taille égale</em> - <em>mais sachez que contrairement à <code>quantile()</code>, la même valeur peut apparaître dans plus d’un groupe.</em> Fournissez le tableau numérique et ensuite le nombre de groupes. Les valeurs dans la nouvelle colonne créée sont juste des “numéros” de groupe (par exemple 1 à 10), et non la plage de valeurs elle-même comme lors de l’utilisation de <code>cut()</code>.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="cleaning_data.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="co"># créer des classes avec ntile()</span></span>
<span id="cb282-2"><a href="cleaning_data.html#cb282-2" aria-hidden="true" tabindex="-1"></a>ntile_data <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb282-3"><a href="cleaning_data.html#cb282-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">even_groups =</span> <span class="fu">ntile</span>(age_years, <span class="dv">10</span>))</span>
<span id="cb282-4"><a href="cleaning_data.html#cb282-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-5"><a href="cleaning_data.html#cb282-5" aria-hidden="true" tabindex="-1"></a><span class="co"># créer un tableau avec les effectifs et les frequences des classes</span></span>
<span id="cb282-6"><a href="cleaning_data.html#cb282-6" aria-hidden="true" tabindex="-1"></a>ntile_table <span class="ot">&lt;-</span> ntile_data <span class="sc">%&gt;%</span> </span>
<span id="cb282-7"><a href="cleaning_data.html#cb282-7" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">tabyl</span>(even_groups)</span>
<span id="cb282-8"><a href="cleaning_data.html#cb282-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb282-9"><a href="cleaning_data.html#cb282-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-10"><a href="cleaning_data.html#cb282-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ajouter les valeurs min/max pour voir l&#39;etendu des classe</span></span>
<span id="cb282-11"><a href="cleaning_data.html#cb282-11" aria-hidden="true" tabindex="-1"></a>ntile_ranges <span class="ot">&lt;-</span> ntile_data <span class="sc">%&gt;%</span> </span>
<span id="cb282-12"><a href="cleaning_data.html#cb282-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(even_groups) <span class="sc">%&gt;%</span> </span>
<span id="cb282-13"><a href="cleaning_data.html#cb282-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb282-14"><a href="cleaning_data.html#cb282-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">min =</span> <span class="fu">min</span>(age_years, <span class="at">na.rm=</span>T),</span>
<span id="cb282-15"><a href="cleaning_data.html#cb282-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">max</span>(age_years, <span class="at">na.rm=</span>T)</span>
<span id="cb282-16"><a href="cleaning_data.html#cb282-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Warning: There were 2 warnings in `summarise()`.
## The first warning was:
## ℹ In argument: `min = min(age_years, na.rm = T)`.
## ℹ In group 11: `even_groups = NA`.
## Caused by warning in `min()`:
## ! no non-missing arguments to min; returning Inf
## ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="cleaning_data.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine and print - note that values are present in multiple groups</span></span>
<span id="cb284-2"><a href="cleaning_data.html#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb284-3"><a href="cleaning_data.html#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(ntile_table, ntile_ranges, <span class="at">by =</span> <span class="st">&quot;even_groups&quot;</span>)</span></code></pre></div>
<pre><code>##  even_groups   n    percent valid_percent min  max
##            1 651 0.09851695    0.10013844   0    2
##            2 650 0.09836562    0.09998462   2    5
##            3 650 0.09836562    0.09998462   5    7
##            4 650 0.09836562    0.09998462   7   10
##            5 650 0.09836562    0.09998462  10   13
##            6 650 0.09836562    0.09998462  13   17
##            7 650 0.09836562    0.09998462  17   21
##            8 650 0.09836562    0.09998462  21   26
##            9 650 0.09836562    0.09998462  26   33
##           10 650 0.09836562    0.09998462  33   84
##           NA 107 0.01619249            NA Inf -Inf</code></pre>
<!-- ======================================================= -->
</div>
<div id="case_when" class="section level3 unnumbered">
<h3><code>case_when()</code></h3>
<p>Il est possible d’utiliser la fonction <strong>dplyr</strong> <code>case_when()</code> pour créer des classes à partir d’une colonne numérique, mais il est plus facile d’utiliser <code>age_categories()</code> de <strong>epikit</strong> ou <code>cut()</code> car ceux-ci créeront un facteur ordonné automatiquement.</p>
<p>Si vous utilisez <code>case_when()</code>, veuillez revoir l’utilisation correcte comme décrit précédemment dans la section Re-coder les valeurs de cette page. Sachez également que toutes les valeurs du côté droit doivent être de la même classe. Ainsi, si vous voulez que <code>NA</code> figure à droite, vous devez soit écrire “Missing”, soit utiliser la valeur spéciale <code>NA</code>, <code>NA_character_</code>.</p>
</div>
<div id="ajouter-à-la-chaine-de-commande-pipé-3" class="section level3 unnumbered">
<h3>Ajouter à la chaine de commande pipé</h3>
<p>Ci-dessous, le code pour créer deux colonnes d’âge catégorique est ajouté à la chaîne de nettoyage :</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="cleaning_data.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NETTOYAGE: enchainement de commandes  &#39;PIPE&#39;  (debute avec la donnée brute  et suivi de  pipe avec les commandes pour le nettoyage)</span></span>
<span id="cb286-2"><a href="cleaning_data.html#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb286-3"><a href="cleaning_data.html#cb286-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-4"><a href="cleaning_data.html#cb286-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Debuter le nettoyage de la chaine de commande pipé</span></span>
<span id="cb286-5"><a href="cleaning_data.html#cb286-5" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb286-6"><a href="cleaning_data.html#cb286-6" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb286-7"><a href="cleaning_data.html#cb286-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb286-8"><a href="cleaning_data.html#cb286-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># standardiser la syntaxe des noms de colonnes</span></span>
<span id="cb286-9"><a href="cleaning_data.html#cb286-9" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb286-10"><a href="cleaning_data.html#cb286-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb286-11"><a href="cleaning_data.html#cb286-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># renommons manuellement les noms de colonnes</span></span>
<span id="cb286-12"><a href="cleaning_data.html#cb286-12" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Nouveau nom             # Ancien nom</span></span>
<span id="cb286-13"><a href="cleaning_data.html#cb286-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb286-14"><a href="cleaning_data.html#cb286-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb286-15"><a href="cleaning_data.html#cb286-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb286-16"><a href="cleaning_data.html#cb286-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb286-17"><a href="cleaning_data.html#cb286-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># supprimer colonne</span></span>
<span id="cb286-18"><a href="cleaning_data.html#cb286-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb286-19"><a href="cleaning_data.html#cb286-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb286-20"><a href="cleaning_data.html#cb286-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># supplimer les doublons</span></span>
<span id="cb286-21"><a href="cleaning_data.html#cb286-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb286-22"><a href="cleaning_data.html#cb286-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-23"><a href="cleaning_data.html#cb286-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ajouter colonnes</span></span>
<span id="cb286-24"><a href="cleaning_data.html#cb286-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span>     </span>
<span id="cb286-25"><a href="cleaning_data.html#cb286-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-26"><a href="cleaning_data.html#cb286-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convertir la classe des colonnes</span></span>
<span id="cb286-27"><a href="cleaning_data.html#cb286-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb286-28"><a href="cleaning_data.html#cb286-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">generation =</span> <span class="fu">as.numeric</span>(generation),</span>
<span id="cb286-29"><a href="cleaning_data.html#cb286-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">age        =</span> <span class="fu">as.numeric</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb286-30"><a href="cleaning_data.html#cb286-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb286-31"><a href="cleaning_data.html#cb286-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># creer colonne: retard d&#39;hospitalisation</span></span>
<span id="cb286-32"><a href="cleaning_data.html#cb286-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">days_onset_hosp =</span> <span class="fu">as.numeric</span>(date_hospitalisation <span class="sc">-</span> date_onset)) <span class="sc">%&gt;%</span> </span>
<span id="cb286-33"><a href="cleaning_data.html#cb286-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb286-34"><a href="cleaning_data.html#cb286-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rendre propre les valeurs contenu dans la colonne hospitalisation</span></span>
<span id="cb286-35"><a href="cleaning_data.html#cb286-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital,</span>
<span id="cb286-36"><a href="cleaning_data.html#cb286-36" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># OLD = NEW</span></span>
<span id="cb286-37"><a href="cleaning_data.html#cb286-37" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb286-38"><a href="cleaning_data.html#cb286-38" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb286-39"><a href="cleaning_data.html#cb286-39" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb286-40"><a href="cleaning_data.html#cb286-40" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      <span class="ot">=</span> <span class="st">&quot;Port Hospital&quot;</span>,</span>
<span id="cb286-41"><a href="cleaning_data.html#cb286-41" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   <span class="ot">=</span> <span class="st">&quot;Central Hospital&quot;</span>,</span>
<span id="cb286-42"><a href="cleaning_data.html#cb286-42" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;other&quot;</span>             <span class="ot">=</span> <span class="st">&quot;Other&quot;</span>,</span>
<span id="cb286-43"><a href="cleaning_data.html#cb286-43" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> <span class="ot">=</span> <span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb286-44"><a href="cleaning_data.html#cb286-44" aria-hidden="true" tabindex="-1"></a>                      )) <span class="sc">%&gt;%</span> </span>
<span id="cb286-45"><a href="cleaning_data.html#cb286-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb286-46"><a href="cleaning_data.html#cb286-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb286-47"><a href="cleaning_data.html#cb286-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-48"><a href="cleaning_data.html#cb286-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># creons la colonne age_years column (à partir des colonnes age et age_unit)</span></span>
<span id="cb286-49"><a href="cleaning_data.html#cb286-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">case_when</span>(</span>
<span id="cb286-50"><a href="cleaning_data.html#cb286-50" aria-hidden="true" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">&quot;years&quot;</span> <span class="sc">~</span> age,</span>
<span id="cb286-51"><a href="cleaning_data.html#cb286-51" aria-hidden="true" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">&quot;months&quot;</span> <span class="sc">~</span> age<span class="sc">/</span><span class="dv">12</span>,</span>
<span id="cb286-52"><a href="cleaning_data.html#cb286-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">is.na</span>(age_unit) <span class="sc">~</span> age)) <span class="sc">%&gt;%</span> </span>
<span id="cb286-53"><a href="cleaning_data.html#cb286-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb286-54"><a href="cleaning_data.html#cb286-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CI DESSUS LES ETAPES DU NETTOYAGE DEJA ABORDEES EN AMONT</span></span>
<span id="cb286-55"><a href="cleaning_data.html#cb286-55" aria-hidden="true" tabindex="-1"></a>    <span class="do">###################################################   </span></span>
<span id="cb286-56"><a href="cleaning_data.html#cb286-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb286-57"><a href="cleaning_data.html#cb286-57" aria-hidden="true" tabindex="-1"></a>          <span class="co"># age classe: difinition</span></span>
<span id="cb286-58"><a href="cleaning_data.html#cb286-58" aria-hidden="true" tabindex="-1"></a>          <span class="at">age_cat =</span> epikit<span class="sc">::</span><span class="fu">age_categories</span>(age_years, <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>)),</span>
<span id="cb286-59"><a href="cleaning_data.html#cb286-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb286-60"><a href="cleaning_data.html#cb286-60" aria-hidden="true" tabindex="-1"></a>          <span class="co"># age classe: 0 à 85 par pas de 5s</span></span>
<span id="cb286-61"><a href="cleaning_data.html#cb286-61" aria-hidden="true" tabindex="-1"></a>          <span class="at">age_cat5 =</span> epikit<span class="sc">::</span><span class="fu">age_categories</span>(age_years, <span class="at">breakers =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">85</span>, <span class="dv">5</span>)))</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="ajouter-des-lignes" class="section level2" number="8.10">
<h2><span class="header-section-number">8.10</span> Ajouter des lignes</h2>
<div id="une-à-une" class="section level3 unnumbered">
<h3>une à une</h3>
<p>Ajouter des lignes une par une manuellement est fastidieux mais peut être fait avec <code>add_row()</code> de <strong>dplyr</strong>. Rappelez-vous que chaque colonne doit contenir des valeurs d’une seule classe (soit caractère, numérique, logique, etc.). Ainsi, l’ajout d’une ligne nécessite de la nuance pour maintenir cela.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="cleaning_data.html#cb287-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb287-2"><a href="cleaning_data.html#cb287-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">row_num =</span> <span class="dv">666</span>,</span>
<span id="cb287-3"><a href="cleaning_data.html#cb287-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">case_id =</span> <span class="st">&quot;abc&quot;</span>,</span>
<span id="cb287-4"><a href="cleaning_data.html#cb287-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">generation =</span> <span class="dv">4</span>,</span>
<span id="cb287-5"><a href="cleaning_data.html#cb287-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">infection date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-10-10&quot;</span>),</span>
<span id="cb287-6"><a href="cleaning_data.html#cb287-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">.before =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>Utilisez <code>.before</code> et <code>.after.</code> pour spécifier le placement de la ligne que vous voulez ajouter. <code>.before = 3</code> placera la nouvelle ligne avant la 3ème ligne actuelle. Le comportement par défaut est d’ajouter la ligne à la fin. Les colonnes non spécifiées seront laissées vides (<code>NA</code>).</p>
<p>Le nouveau <em>numéro de ligne</em> peut sembler étrange (“…23”) mais les numéros de ligne dans les lignes préexistantes <em>ont changé</em>. Donc, si vous utilisez la commande deux fois, examinez/testez soigneusement l’insertion.</p>
<p>Si une classe que vous avez fournie est incorrecte, vous verrez une erreur comme celle-ci :</p>
<pre><code>Error: Can&#39;t combine ..1$infection date &lt;date&gt; and ..2$infection date &lt;character&gt;.</code></pre>
<p>(lorsque vous insérez une ligne avec une valeur de date, n’oubliez pas d’envelopper la date dans la fonction <code>as.Date()</code> comme <code>as.Date("2020-10-10")</code>.</p>
</div>
<div id="coller-des-lignes" class="section level3 unnumbered">
<h3>coller des lignes</h3>
<p>Pour combiner des ensembles de données ensemble en liant les lignes d’un cadre de données au bas d’un autre cadre de données, vous pouvez utiliser <code>bind_rows()</code> de <strong>dplyr</strong>. Ceci est expliqué plus en détail dans la page <a href="joining_matching.html#joining_matching">Joindre des données</a>.</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="filtrer-les-lignes" class="section level2" number="8.11">
<h2><span class="header-section-number">8.11</span> Filtrer les lignes</h2>
<p>Une étape typique de nettoyage après avoir nettoyé les colonnes et recodé les valeurs est de <em>filtrer</em> le cadre de données pour des lignes spécifiques en utilisant le verbe <strong>dplyr</strong> <code>filter()</code>.</p>
<p>Dans <code>filter()</code>, spécifiez la logique qui doit être <code>TRUE</code> pour qu’une ligne de l’ensemble de données soit conservée. Nous montrons ci-dessous comment filtrer des lignes sur la base de conditions logiques simples et complexes.</p>
<!-- ======================================================= -->
<div id="filtre-simple" class="section level3 unnumbered">
<h3>Filtre simple</h3>
<p>Cet exemple simple redéfinit le dataframe <code>linelist</code> comme lui-même, après avoir filtré les lignes pour répondre à une condition logique. **Seules les lignes où l’énoncé logique entre parenthèses est évalué à “VRAI” sont conservées.</p>
<p>Dans cet exemple, l’instruction logique est <code>gender == "f"</code>, qui demande si la valeur de la colonne <code>gender</code> est égale à “f” (sensible à la casse).</p>
<p>Avant que le filtre ne soit appliqué, le nombre de lignes dans <code>linelist</code> est <code>nrow(linelist)</code>.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="cleaning_data.html#cb289-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb289-2"><a href="cleaning_data.html#cb289-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gender <span class="sc">==</span> <span class="st">&quot;f&quot;</span>)   <span class="co"># garder unique les lignes ou le est egale à &quot;f&quot;</span></span></code></pre></div>
<p>Une fois le filtre appliqué, le nombre de lignes dans <code>linelist</code> est <code>linelist %&gt;% filter(gender == "f") %&gt;% nrow()</code>.</p>
</div>
<div id="filtrer-les-valeurs-manquantes" class="section level3 unnumbered">
<h3>Filtrer les valeurs manquantes</h3>
<p>Il est assez courant de vouloir filtrer les lignes qui ont des valeurs manquantes. Résistez à l’envie d’écrire <code>filter(!is.na(column) &amp; !is.na(column))</code> et utilisez plutôt la fonction <strong>tidyr</strong> qui est spécialement conçue à cet effet : <code>drop_na()</code>. Si elle est exécutée avec des parenthèses vides, elle supprime les lignes avec <em>toutes</em> les valeurs manquantes. Alternativement, vous pouvez fournir des noms de colonnes spécifiques à évaluer pour les valeurs manquantes, ou utiliser les fonctions d’aide “tidyselect” décrites <a href="cleaning_data.html#clean_tidyselect">ci-dessus</a>.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="cleaning_data.html#cb290-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb290-2"><a href="cleaning_data.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(case_id, age_years)  <span class="co"># enlever les lignes avec des valeurs manquantes pour les colonnes case_id ou age_years</span></span></code></pre></div>
<p>Voir la page sur les <a href="missing_data.html#missing_data">Données manquantes</a> pour de nombreuses techniques d’analyse et de gestion des données manquantes dans vos données.</p>
</div>
<div id="filtrer-par-numéro-de-ligne" class="section level3 unnumbered">
<h3>Filtrer par numéro de ligne</h3>
<p>Dans un cadre de données ou un tibble, chaque ligne aura généralement un “numéro de ligne” qui (vu dans R Viewer) apparaît à gauche de la première colonne. Ce n’est pas en soi une vraie colonne dans les données, mais il peut être utilisé dans une instruction <code>filter()</code>.</p>
<p>Pour filtrer sur la base du “numéro de ligne”, vous pouvez utiliser la fonction <strong>dplyr</strong> <code>row_number()</code> avec des parenthèses ouvertes dans le cadre d’une instruction de filtrage logique. Souvent, vous utiliserez l’opérateur <code>%in%</code> et une plage de nombres dans le cadre de cette instruction logique, comme indiqué ci-dessous. Pour voir les <em>premières</em> N lignes, vous pouvez également utiliser la fonction spéciale <strong>dplyr</strong> <code>head()</code>.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="cleaning_data.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co"># montrer les 100 premiere lignes</span></span>
<span id="cb291-2"><a href="cleaning_data.html#cb291-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">100</span>)     <span class="co"># ou utiliser tail() pour voir les n derniers lignes </span></span>
<span id="cb291-3"><a href="cleaning_data.html#cb291-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-4"><a href="cleaning_data.html#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="co"># afficher uniquement la cinquieme ligne</span></span>
<span id="cb291-5"><a href="cleaning_data.html#cb291-5" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">5</span>)</span>
<span id="cb291-6"><a href="cleaning_data.html#cb291-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-7"><a href="cleaning_data.html#cb291-7" aria-hidden="true" tabindex="-1"></a><span class="co"># voir la 2ème à la 20ème ligne et 3 colonnes specifiques</span></span>
<span id="cb291-8"><a href="cleaning_data.html#cb291-8" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">20</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(date_onset, outcome, age)</span></code></pre></div>
<p>Vous pouvez également convertir les numéros de ligne en une vraie colonne en passant votre cadre de données à la fonction <strong>tibble</strong> <code>rownames_to_column()</code> (ne mettez rien entre les parenthèses).</p>
<!-- ======================================================= -->
</div>
<div id="filtre-complexe" class="section level3 unnumbered">
<h3>Filtre complexe</h3>
<p>Des instructions logiques plus complexes peuvent être construites en utilisant les opérateurs parenthèses <code>( )</code>, OR <code>|</code>, négation <code>!</code>, <code>%in%</code>, et AND <code>&amp;</code>. Un exemple est donné ci-dessous :</p>
<p>Remarque : Vous pouvez utiliser l’opérateur <code>!</code> devant un critère logique pour le nier. Par exemple, <code>!is.na(column)</code> est évalué à true si la valeur de la colonne n’est <em>pas</em> manquante. De même, <code>!column %in% c("a", "b", "c")</code> est évalué comme vrai si la valeur de la colonne n’est <em>pas</em> dans le vecteur.</p>
<div id="examiner-la-donnée" class="section level4 unnumbered">
<h4>Examiner la donnée</h4>
<p>Vous trouverez ci-dessous une commande simple en une ligne pour créer un histogramme des dates d’apparition. Notez qu’une deuxième épidémie plus petite, datant de 2012-2013, est également incluse dans cet ensemble de données brutes. **Pour nos analyses, nous voulons supprimer les entrées de cette épidémie antérieure.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="cleaning_data.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(linelist<span class="sc">$</span>date_onset, <span class="at">breaks =</span> <span class="dv">50</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-227-1.png" width="50%" /></p>
</div>
<div id="comment-les-filtres-traitent-les-valeurs-numériques-et-les-dates-manquantes" class="section level4 unnumbered">
<h4>Comment les filtres traitent les valeurs numériques et les dates manquantes</h4>
<p>Peut-on simplement filtrer par <code>date_onset</code> les lignes après Juin 2013 ? <strong>Attention ! L’application du code <code>filter(date_onset &gt; as.Date("2013-06-01")))</code> supprimerait toutes les lignes de la dernière épidémie avec une date d’apparition manquante!</strong>.</p>
<p><span style="color: red;"><strong><em>DANGERS:</em></strong> Le fait de filtrer sur une date ou un nombre supérieur (&gt;) ou inférieur (&lt;) peut supprimer toutes les lignes contenant des valeurs manquantes (<code>NA</code>) ! En effet, <code>NA</code> est considéré comme infiniment grand et petit.</span></p>
<p><em>(Voir la page <a href="working_dates.html#working_dates">Manipuler les dates</a> pour plus d’informations sur le travail avec des dates et le paquet <strong>lubridate</strong>)</em>.</p>
</div>
<div id="concevoir-le-filtre" class="section level4 unnumbered">
<h4>Concevoir le filtre</h4>
<p>Examinez un tableau croisé pour vous assurer que nous excluons uniquement les bonnes lignes :</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="cleaning_data.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Hospital  =</span> linelist<span class="sc">$</span>hospital,                     <span class="co"># nom d&#39;hopital</span></span>
<span id="cb293-2"><a href="cleaning_data.html#cb293-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">YearOnset =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(linelist<span class="sc">$</span>date_onset),  <span class="co"># annee des dates d&#39;apparition </span></span>
<span id="cb293-3"><a href="cleaning_data.html#cb293-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">useNA     =</span> <span class="st">&quot;always&quot;</span>)                              <span class="co"># montrer les valeurs manquantes</span></span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2012 2013 2014 2015 &lt;NA&gt;
##   Central Hospital                        0    0  351   99   18
##   Hospital A                            229   46    0    0   15
##   Hospital B                            227   47    0    0   15
##   Military Hospital                       0    0  676  200   34
##   Missing                                 0    0 1117  318   77
##   Other                                   0    0  684  177   46
##   Port Hospital                           9    1 1372  347   75
##   St. Mark&#39;s Maternity Hospital (SMMH)    0    0  322   93   13
##   &lt;NA&gt;                                    0    0    0    0    0</code></pre>
<p>Quels autres critères pouvons-nous filtrer pour éliminer la première épidémie (en 2012 et 2013) de l’ensemble de données ? Nous constatons que :</p>
<ul>
<li>La première épidémie en 2012 &amp; 2013 a eu lieu à l’hôpital A, à l’hôpital B, et qu’il y avait aussi 10 cas à l’hôpital du Port.<br />
</li>
<li>Les hôpitaux A et B n’ont <em>pas</em> eu de cas lors de la deuxième épidémie, mais l’hôpital du Port en a eu.</li>
</ul>
<p>Nous voulons exclure :</p>
<ul>
<li>Les <code>nrow(linelist %&gt;% filter(hospital %in% c("Hospital A", "Hospital B") | date_onset &lt; as.Date("2013-06-01")))</code> lignes avec une apparition en 2012 et 2013 à l’hôpital A, B ou Port :
<ul>
<li>Exclure <code>nrow(linelist %&gt;% filter(date_onset &lt; as.Date("2013-06-01")))</code> les lignes dont l’apparition s’est produite en 2012 et 2013.</li>
<li>Exclure <code>nrow(linelist %&gt;% filter(hospital %in% c('Hospital A', 'Hospital B') &amp; is.na(date_onset)))</code> les lignes des hôpitaux A et B avec des dates de début manquantes.<br />
</li>
<li>Ne <strong>pas</strong> exclure <code>nrow(linelist %&gt;% filter(!hospital %in% c('Hospital A', 'Hospital B') &amp; is.na(date_onset)))</code> d’autres lignes avec des dates de début manquantes.</li>
</ul></li>
</ul>
<p>Nous commençons avec une linelist de `<code>nrow(linelist)</code>. Voici notre déclaration de filtre :</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="cleaning_data.html#cb295-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb295-2"><a href="cleaning_data.html#cb295-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-3"><a href="cleaning_data.html#cb295-3" aria-hidden="true" tabindex="-1"></a> <span class="co"># conserver les lignes où le début de la maladie est postérieur 1 June 2013 OU où le début de la maladie n&#39;a pas de valeur renseignée et où il s&#39;agissait d&#39;un hôpital AUTRE que l&#39;hôpital A ou B.</span></span>
<span id="cb295-4"><a href="cleaning_data.html#cb295-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date_onset <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;2013-06-01&quot;</span>) <span class="sc">|</span> (<span class="fu">is.na</span>(date_onset) <span class="sc">&amp;</span> <span class="sc">!</span>hospital <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Hospital A&quot;</span>, <span class="st">&quot;Hospital B&quot;</span>)))</span>
<span id="cb295-5"><a href="cleaning_data.html#cb295-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-6"><a href="cleaning_data.html#cb295-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(linelist)</span></code></pre></div>
<pre><code>## [1] 6019</code></pre>
<p>Lorsque nous refaisons le tableau croisé, nous constatons que les hôpitaux A et B sont complètement retirés, ainsi que les 10 cas de l’hôpital du Port de 2012 et 2013, et que toutes les autres valeurs sont les mêmes - exactement comme nous le voulions.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="cleaning_data.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Hospital  =</span> linelist<span class="sc">$</span>hospital,                     <span class="co"># nom de l&#39;hopital</span></span>
<span id="cb297-2"><a href="cleaning_data.html#cb297-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">YearOnset =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(linelist<span class="sc">$</span>date_onset),   <span class="co"># année d&#39;apparition de la maladie</span></span>
<span id="cb297-3"><a href="cleaning_data.html#cb297-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">useNA     =</span> <span class="st">&quot;always&quot;</span>)                              <span class="co"># montrer les valeurs manquantes</span></span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2014 2015 &lt;NA&gt;
##   Central Hospital                      351   99   18
##   Military Hospital                     676  200   34
##   Missing                              1117  318   77
##   Other                                 684  177   46
##   Port Hospital                        1372  347   75
##   St. Mark&#39;s Maternity Hospital (SMMH)  322   93   13
##   &lt;NA&gt;                                    0    0    0</code></pre>
<p>Plusieurs déclarations peuvent être incluses dans une commande de filtre (séparées par des virgules), ou vous pouvez toujours utiliser une commande filter() séparée pour plus de clarté.</p>
<p><em>Note : certains lecteurs peuvent remarquer qu’il serait plus facile de filtrer simplement par <code>date_hospitalisation</code> parce qu’il est 100% complet, sans valeurs manquantes. Ceci est vrai. Mais <code>date_onset</code> est utilisé dans le but de démontrer un filtre complexe.</em></p>
</div>
</div>
<div id="autres-complements" class="section level3 unnumbered">
<h3>Autres complements</h3>
<p>Le filtrage peut également être effectué comme une commande autonome (ne faisant pas partie d’une chaîne de tuyaux). Comme les autres verbes <strong>dplyr</strong>, dans ce cas, le premier argument doit être le jeu de données lui-même.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="cleaning_data.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dataframe &lt;- filter(dataframe, condition(s)pour les lignes à garder)</span></span>
<span id="cb299-2"><a href="cleaning_data.html#cb299-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-3"><a href="cleaning_data.html#cb299-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">filter</span>(linelist, <span class="sc">!</span><span class="fu">is.na</span>(case_id))</span></code></pre></div>
<p>Vous pouvez également utiliser <strong>base</strong> R pour effectuer un sous-ensemble en utilisant des crochets qui reflètent les [lignes, colonnes] que vous souhaitez conserver.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="cleaning_data.html#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dataframe &lt;- dataframe[lignes conditions, colonnes conditions] (vide signifie garder tous les colonnes ou lignes)</span></span>
<span id="cb300-2"><a href="cleaning_data.html#cb300-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-3"><a href="cleaning_data.html#cb300-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist[<span class="sc">!</span><span class="fu">is.na</span>(case_id), ]</span></code></pre></div>
</div>
<div id="examiner-rapidement-la-donnée" class="section level3 unnumbered">
<h3>Examiner rapidement la donnée</h3>
<p>Souvent, vous voulez examiner rapidement quelques enregistrements, pour seulement quelques colonnes. La fonction R <strong>base</strong> <code>View()</code> imprimera un cadre de données pour le visualiser dans votre RStudio.</p>
<p>Visualisez la liste des lignes dans RStudio :</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="cleaning_data.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(linelist)</span></code></pre></div>
<p>Voici deux exemples d’affichage de cellules spécifiques (lignes spécifiques et colonnes spécifiques) :</p>
<p><strong>Avec les fonctions dplyr <code>filter()</code> et <code>select()</code>:</strong></p>
<p>Dans <code>View()</code>, passez le jeu de données dans <code>filter()</code> pour conserver certaines lignes, puis dans <code>select()</code> pour conserver certaines colonnes. Par exemple, pour examiner les dates de début et d’hospitalisation de 3 cas spécifiques :</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="cleaning_data.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(linelist <span class="sc">%&gt;%</span></span>
<span id="cb302-2"><a href="cleaning_data.html#cb302-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">filter</span>(case_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;11f8ea&quot;</span>, <span class="st">&quot;76b97a&quot;</span>, <span class="st">&quot;47a5f5&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb302-3"><a href="cleaning_data.html#cb302-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">select</span>(date_onset, date_hospitalisation))</span></code></pre></div>
<p>Vous pouvez faire la même chose avec la syntaxe <strong>base</strong> de R, en utilisant les crochets `[ ]`` pour le sous-ensemble que vous voulez voir.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="cleaning_data.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(linelist[linelist<span class="sc">$</span>case_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;11f8ea&quot;</span>, <span class="st">&quot;76b97a&quot;</span>, <span class="st">&quot;47a5f5&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;date_onset&quot;</span>, <span class="st">&quot;date_hospitalisation&quot;</span>)])</span></code></pre></div>
<div id="ajouter-à-la-chaine-de-commande-pipé-to-pipé" class="section level4 unnumbered">
<h4>Ajouter à la chaine de commande pipé to pipé</h4>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="cleaning_data.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NETTOYAGE: enchainement de commandes  &#39;PIPE&#39;  (debute avec la donnée brute  et le  pipes avec les commandes pour le nettoyage)</span></span>
<span id="cb304-2"><a href="cleaning_data.html#cb304-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb304-3"><a href="cleaning_data.html#cb304-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-4"><a href="cleaning_data.html#cb304-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Debuter la chaine de commande pipé pour le nettoyage </span></span>
<span id="cb304-5"><a href="cleaning_data.html#cb304-5" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb304-6"><a href="cleaning_data.html#cb304-6" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb304-7"><a href="cleaning_data.html#cb304-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb304-8"><a href="cleaning_data.html#cb304-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># standardiser la syntaxe des noms de colonnes</span></span>
<span id="cb304-9"><a href="cleaning_data.html#cb304-9" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb304-10"><a href="cleaning_data.html#cb304-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb304-11"><a href="cleaning_data.html#cb304-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># manuallement renommer le noms des colonnes</span></span>
<span id="cb304-12"><a href="cleaning_data.html#cb304-12" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Nouveau nom             # Ancienne nom</span></span>
<span id="cb304-13"><a href="cleaning_data.html#cb304-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb304-14"><a href="cleaning_data.html#cb304-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb304-15"><a href="cleaning_data.html#cb304-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb304-16"><a href="cleaning_data.html#cb304-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb304-17"><a href="cleaning_data.html#cb304-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># supprimer les colonnes</span></span>
<span id="cb304-18"><a href="cleaning_data.html#cb304-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-19"><a href="cleaning_data.html#cb304-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-20"><a href="cleaning_data.html#cb304-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># supprimer les doublons</span></span>
<span id="cb304-21"><a href="cleaning_data.html#cb304-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb304-22"><a href="cleaning_data.html#cb304-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-23"><a href="cleaning_data.html#cb304-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ajouter colonne</span></span>
<span id="cb304-24"><a href="cleaning_data.html#cb304-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span>     </span>
<span id="cb304-25"><a href="cleaning_data.html#cb304-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-26"><a href="cleaning_data.html#cb304-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convertir la classe des colonnes</span></span>
<span id="cb304-27"><a href="cleaning_data.html#cb304-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb304-28"><a href="cleaning_data.html#cb304-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">generation =</span> <span class="fu">as.numeric</span>(generation),</span>
<span id="cb304-29"><a href="cleaning_data.html#cb304-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">age        =</span> <span class="fu">as.numeric</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-30"><a href="cleaning_data.html#cb304-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb304-31"><a href="cleaning_data.html#cb304-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ajout de colonne: retard d&#39;hospitalisation</span></span>
<span id="cb304-32"><a href="cleaning_data.html#cb304-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">days_onset_hosp =</span> <span class="fu">as.numeric</span>(date_hospitalisation <span class="sc">-</span> date_onset)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-33"><a href="cleaning_data.html#cb304-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb304-34"><a href="cleaning_data.html#cb304-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nettoyer les valeurs de la colonne hospitalisation</span></span>
<span id="cb304-35"><a href="cleaning_data.html#cb304-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital,</span>
<span id="cb304-36"><a href="cleaning_data.html#cb304-36" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># OLD = NEW</span></span>
<span id="cb304-37"><a href="cleaning_data.html#cb304-37" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb304-38"><a href="cleaning_data.html#cb304-38" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb304-39"><a href="cleaning_data.html#cb304-39" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb304-40"><a href="cleaning_data.html#cb304-40" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      <span class="ot">=</span> <span class="st">&quot;Port Hospital&quot;</span>,</span>
<span id="cb304-41"><a href="cleaning_data.html#cb304-41" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   <span class="ot">=</span> <span class="st">&quot;Central Hospital&quot;</span>,</span>
<span id="cb304-42"><a href="cleaning_data.html#cb304-42" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;other&quot;</span>             <span class="ot">=</span> <span class="st">&quot;Other&quot;</span>,</span>
<span id="cb304-43"><a href="cleaning_data.html#cb304-43" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> <span class="ot">=</span> <span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb304-44"><a href="cleaning_data.html#cb304-44" aria-hidden="true" tabindex="-1"></a>                      )) <span class="sc">%&gt;%</span> </span>
<span id="cb304-45"><a href="cleaning_data.html#cb304-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb304-46"><a href="cleaning_data.html#cb304-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-47"><a href="cleaning_data.html#cb304-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-48"><a href="cleaning_data.html#cb304-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># creer la colonne age_years (à partir de age et age_unit)</span></span>
<span id="cb304-49"><a href="cleaning_data.html#cb304-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">case_when</span>(</span>
<span id="cb304-50"><a href="cleaning_data.html#cb304-50" aria-hidden="true" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">&quot;years&quot;</span> <span class="sc">~</span> age,</span>
<span id="cb304-51"><a href="cleaning_data.html#cb304-51" aria-hidden="true" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">&quot;months&quot;</span> <span class="sc">~</span> age<span class="sc">/</span><span class="dv">12</span>,</span>
<span id="cb304-52"><a href="cleaning_data.html#cb304-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">is.na</span>(age_unit) <span class="sc">~</span> age)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-53"><a href="cleaning_data.html#cb304-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-54"><a href="cleaning_data.html#cb304-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb304-55"><a href="cleaning_data.html#cb304-55" aria-hidden="true" tabindex="-1"></a>          <span class="co"># age classe: definition</span></span>
<span id="cb304-56"><a href="cleaning_data.html#cb304-56" aria-hidden="true" tabindex="-1"></a>          <span class="at">age_cat =</span> epikit<span class="sc">::</span><span class="fu">age_categories</span>(age_years, <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>)),</span>
<span id="cb304-57"><a href="cleaning_data.html#cb304-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb304-58"><a href="cleaning_data.html#cb304-58" aria-hidden="true" tabindex="-1"></a>          <span class="co"># age classes: 0 à 85 par pas de 5s</span></span>
<span id="cb304-59"><a href="cleaning_data.html#cb304-59" aria-hidden="true" tabindex="-1"></a>          <span class="at">age_cat5 =</span> epikit<span class="sc">::</span><span class="fu">age_categories</span>(age_years, <span class="at">breakers =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">85</span>, <span class="dv">5</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb304-60"><a href="cleaning_data.html#cb304-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb304-61"><a href="cleaning_data.html#cb304-61" aria-hidden="true" tabindex="-1"></a>     <span class="co"># CI DESSUS LES ETAPES DU NETTOYAGE DEJA ABORDEES EN AMONT</span></span>
<span id="cb304-62"><a href="cleaning_data.html#cb304-62" aria-hidden="true" tabindex="-1"></a>    <span class="do">###################################################</span></span>
<span id="cb304-63"><a href="cleaning_data.html#cb304-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb304-64"><a href="cleaning_data.html#cb304-64" aria-hidden="true" tabindex="-1"></a>          <span class="co"># conserver uniquement les lignes ou les valeurs  case_id ne sont pas  manquantes</span></span>
<span id="cb304-65"><a href="cleaning_data.html#cb304-65" aria-hidden="true" tabindex="-1"></a>          <span class="sc">!</span><span class="fu">is.na</span>(case_id),  </span>
<span id="cb304-66"><a href="cleaning_data.html#cb304-66" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb304-67"><a href="cleaning_data.html#cb304-67" aria-hidden="true" tabindex="-1"></a>          <span class="co"># egalement filtrons pour garder uniquement la deuxieme pandemie</span></span>
<span id="cb304-68"><a href="cleaning_data.html#cb304-68" aria-hidden="true" tabindex="-1"></a>          date_onset <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;2013-06-01&quot;</span>) <span class="sc">|</span> (<span class="fu">is.na</span>(date_onset) <span class="sc">&amp;</span> <span class="sc">!</span>hospital <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Hospital A&quot;</span>, <span class="st">&quot;Hospital B&quot;</span>)))</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="calculs-par-rangée" class="section level2" number="8.12">
<h2><span class="header-section-number">8.12</span> Calculs par rangée</h2>
<p>Si vous voulez effectuer un calcul dans une ligne, vous pouvez utiliser <code>rowwise()</code> de <strong>dplyr</strong>. Voir cette vignette en ligne sur <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/rowwise.html">calculs par ligne</a>.<br />
Par exemple, ce code applique <code>rowwise()</code> et crée une nouvelle colonne qui additionne le nombre de colonnes de symptômes spécifiées qui ont la valeur “yes”, pour chaque ligne de la linelist. Les colonnes sont spécifiées dans <code>sum()</code> par leur nom dans un vecteur <code>c()</code>. <code>rowwise()</code> est essentiellement un type spécial de <code>group_by()</code>, il est donc préférable d’utiliser <code>ungroup()</code> lorsque vous avez terminé (page sur <a href="grouping_data.html#grouping_data">Travailler sur des données groupées</a>).</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="cleaning_data.html#cb305-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span></span>
<span id="cb305-2"><a href="cleaning_data.html#cb305-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb305-3"><a href="cleaning_data.html#cb305-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_symptoms =</span> <span class="fu">sum</span>(<span class="fu">c</span>(fever, chills, cough, aches, vomit) <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb305-4"><a href="cleaning_data.html#cb305-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb305-5"><a href="cleaning_data.html#cb305-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fever, chills, cough, aches, vomit, num_symptoms) <span class="co"># pour affichage</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 6
##    fever chills cough aches vomit num_symptoms
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        &lt;int&gt;
##  1 no    no     yes   no    yes              2
##  2 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  3 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  4 no    no     no    no    no               0
##  5 no    no     yes   no    yes              2
##  6 no    no     yes   no    yes              2
##  7 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  8 no    no     yes   no    yes              2
##  9 no    no     yes   no    yes              2
## 10 no    no     yes   no    no               1
## # ℹ 5,878 more rows</code></pre>
<p>Lorsque vous spécifiez la colonne à évaluer, vous pouvez utiliser les fonctions d’aide “tidyselect” décrites dans la section <code>select()</code> de cette page. Vous devez juste faire un ajustement (parce que vous ne les utilisez pas dans une fonction <strong>dplyr</strong> comme <code>select()</code> ou <code>summarise()</code>).</p>
<p>Placez les critères de spécification des colonnes dans la fonction <strong>dplyr</strong> <code>c_across()</code>. Ceci marche parce que <code>c_across</code> ( <a href="https://dplyr.tidyverse.org/reference/c_across.html">documentation</a>) est conçue pour fonctionner avec <code>rowwise()</code> spécifiquement. Par exemple, le code suivant :</p>
<ul>
<li>Applique <code>rowwise()</code> pour que l’opération suivante (<code>sum()</code>) soit appliquée à chaque ligne (sans additionner des colonnes entières)<br />
</li>
<li>Crée la nouvelle colonne <code>num_NA_dates</code>, définie pour chaque ligne comme le nombre de colonnes (dont le nom contient “date”) pour lesquelles <code>is.na()</code> a donné la valeur TRUE (ce sont des données manquantes).<br />
</li>
<li><code>ungroup()</code> pour supprimer les effets de <code>rowwise()</code> pour les étapes suivantes.</li>
</ul>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="cleaning_data.html#cb307-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span></span>
<span id="cb307-2"><a href="cleaning_data.html#cb307-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb307-3"><a href="cleaning_data.html#cb307-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_NA_dates =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(<span class="fu">c_across</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>))))) <span class="sc">%&gt;%</span> </span>
<span id="cb307-4"><a href="cleaning_data.html#cb307-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb307-5"><a href="cleaning_data.html#cb307-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(num_NA_dates, <span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>)) <span class="co"># pour affichage</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 5
##    num_NA_dates date_infection date_onset date_hospitalisation date_outcome
##           &lt;int&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;               &lt;date&gt;      
##  1            1 2014-05-08     2014-05-13 2014-05-15           NA          
##  2            1 NA             2014-05-13 2014-05-14           2014-05-18  
##  3            1 NA             2014-05-16 2014-05-18           2014-05-30  
##  4            1 2014-05-04     2014-05-18 2014-05-20           NA          
##  5            0 2014-05-18     2014-05-21 2014-05-22           2014-05-29  
##  6            0 2014-05-03     2014-05-22 2014-05-23           2014-05-24  
##  7            0 2014-05-22     2014-05-27 2014-05-29           2014-06-01  
##  8            0 2014-05-28     2014-06-02 2014-06-03           2014-06-07  
##  9            1 NA             2014-06-05 2014-06-06           2014-06-18  
## 10            1 NA             2014-06-05 2014-06-07           2014-06-09  
## # ℹ 5,878 more rows</code></pre>
<p>Vous pouvez également fournir d’autres fonctions, telles que <code>max()</code> pour obtenir la dernière ou la plus récente date pour chaque ligne :</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="cleaning_data.html#cb309-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span></span>
<span id="cb309-2"><a href="cleaning_data.html#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb309-3"><a href="cleaning_data.html#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">latest_date =</span> <span class="fu">max</span>(<span class="fu">c_across</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>)), <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb309-4"><a href="cleaning_data.html#cb309-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb309-5"><a href="cleaning_data.html#cb309-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(latest_date, <span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>))  <span class="co"># pour affichage </span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 5
##    latest_date date_infection date_onset date_hospitalisation date_outcome
##    &lt;date&gt;      &lt;date&gt;         &lt;date&gt;     &lt;date&gt;               &lt;date&gt;      
##  1 2014-05-15  2014-05-08     2014-05-13 2014-05-15           NA          
##  2 2014-05-18  NA             2014-05-13 2014-05-14           2014-05-18  
##  3 2014-05-30  NA             2014-05-16 2014-05-18           2014-05-30  
##  4 2014-05-20  2014-05-04     2014-05-18 2014-05-20           NA          
##  5 2014-05-29  2014-05-18     2014-05-21 2014-05-22           2014-05-29  
##  6 2014-05-24  2014-05-03     2014-05-22 2014-05-23           2014-05-24  
##  7 2014-06-01  2014-05-22     2014-05-27 2014-05-29           2014-06-01  
##  8 2014-06-07  2014-05-28     2014-06-02 2014-06-03           2014-06-07  
##  9 2014-06-18  NA             2014-06-05 2014-06-06           2014-06-18  
## 10 2014-06-09  NA             2014-06-05 2014-06-07           2014-06-09  
## # ℹ 5,878 more rows</code></pre>
</div>
<div id="arranger-et-trier" class="section level2" number="8.13">
<h2><span class="header-section-number">8.13</span> Arranger et trier</h2>
<p>Utilisez la fonction <strong>dplyr</strong> <code>arrange()</code> pour trier ou ordonner les lignes par les valeurs des colonnes.</p>
<p>Listez simplement les colonnes dans l’ordre où elles doivent être triées. Spécifiez <code>.by_group = TRUE</code> si vous voulez que le tri se fasse d’abord par tout <em>groupement</em> appliqué aux données (voir la page sur <a href="grouping_data.html#grouping_data">Travailler sur des données groupées</a>).</p>
<p>Par défaut, les colonnes seront triées dans l’ordre “ascendant” (ce qui s’applique aux colonnes numériques et aussi aux colonnes de caractères). Vous pouvez trier une variable dans l’ordre “descendant” en l’entourant de <code>desc()</code>.</p>
<p>Le tri des données avec <code>arrange()</code> est particulièrement utile lorsque vous créez des <a href="tables_presentation.html#tables_presentation">Tableaux de présentation</a>, lorsque vous utilisez <code>slice()</code> pour prendre les lignes “supérieures” par groupe, ou lorsque vous définissez l’ordre des niveaux de facteurs par ordre d’apparition.</p>
<p>Par exemple, pour trier les lignes de notre linelist par <code>hospital</code>, puis par <code>date_onset</code> en ordre décroissant, nous utiliserons :</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="cleaning_data.html#cb311-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb311-2"><a href="cleaning_data.html#cb311-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(hospital, <span class="fu">desc</span>(date_onset))</span></code></pre></div>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
