<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>25 Analyse d’enquête | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="25 Analyse d’enquête | The Epidemiologist R Handbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="25 Analyse d’enquête | The Epidemiologist R Handbook" />
  
  <meta name="twitter:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.2/transition.js"></script>
    <script src="libs/bs3compat-0.4.2/tabs.js"></script>
    <script src="libs/bs3compat-0.4.2/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.27/datatables.js"></script>
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
    <script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.9/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.1/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="survey_analysis" class="section level1" number="25">
<h1><span class="header-section-number">25</span> Analyse d’enquête</h1>
<!-- ======================================================= -->
<div id="aperçu-2" class="section level2" number="25.1">
<h2><span class="header-section-number">25.1</span> Aperçu</h2>
<p>Cette page démontre l’utilisation de plusieurs packages pour l’analyse d’enquêtes.</p>
<p>La plupart des paquets R d’enquête reposent sur le paquet <a href="https://cran.r-project.org/web/packages/survey/index.html"><strong>survey</strong></a> pour effectuer des analyses pondérées.
Nous utiliserons <strong>survey</strong> ainsi que <a href="https://cran.r-project.org/web/packages/srvyr/index.html"><strong>srvyr</strong></a> (une enveloppe pour <strong>survey</strong> permettant un codage de type tidyverse) et <a href="https://cran.r-project.org/web/packages/gtsummary/index.html"><strong>gtsummary</strong></a> (une enveloppe pour <strong>survey</strong> permettant de créer des tableaux prêts à être publiés).Bien que le paquet original <strong>survey</strong> ne permette pas le codage de style tidyverse, tidyverse, il présente l’avantage supplémentaire d’autoriser les modèles linéaires généralisés pondérés par les pondérés par les enquêtes (qui seront ajoutés à cette page à une date ultérieure). Nous allons également démontrer l’utilisation d’une fonction du paquet <a href="https://github.com/R4EPI/sitrep"><strong>sitrep</strong></a> pour créer des poids d’échantillonnage (<em>n.b</em> ce paquet n’est pas encore sur CRAN, mais peut être installé à partir de github).</p>
<p>La plupart de cette page est basée sur le travail effectué pour le projet <a href="https://r4epis.netlify.app/">“R4Epis”</a> ; pour le code détaillé et les modèles R-markdown, voir la page github [“R4Epis”] (<a href="https://github.com/R4EPI/sitrep" class="uri">https://github.com/R4EPI/sitrep</a>). Une partie du code basé sur le paquet <strong>survey</strong> est basé sur les premières versions de <a href="https://github.com/EPIET/RapidAssessmentSurveys">Études de cas EPIET</a>.</p>
<p>Pour l’instant, cette page ne traite pas du calcul de la taille des échantillons ou de l’échantillonnage. Pour un calculateur de taille d’échantillon simple à utiliser, voir <a href="https://www.openepi.com/Menu/OE_Menu.htm">OpenEpi</a>. La page <a href="https://epirhandbook.com/gis-basics.html">GIS basics</a> du manuel comportera éventuellement une section sur l’échantillonnage aléatoire spatial, et cette page comportera éventuellement une section sur les cadres d’échantillonnage. Cette page contiendra également une section sur les bases de sondage ainsi que sur le calcul de la taille des échantillons.</p>
<ol style="list-style-type: decimal">
<li>Données d’enquête</li>
<li>Temps d’observation</li>
<li>Pondération</li>
<li>Objets de la conception de l’enquête</li>
<li>Analyse descriptive</li>
<li>Proportions pondérées</li>
<li>Taux pondérés</li>
</ol>
<!-- ======================================================= -->
</div>
<div id="préparation-9" class="section level2" number="25.2">
<h2><span class="header-section-number">25.2</span> Préparation</h2>
<div id="paquets-1" class="section level3 unnumbered">
<h3>Paquets</h3>
<p>Ce morceau de code montre le chargement des paquets nécessaires aux analyses. Dans ce manuel, nous mettons l’accent sur <code>p_load()</code> de <strong>pacman</strong>, qui installe le paquet si nécessaire <em>et</em> le charge pour l’utiliser. Vous pouvez également charger des paquets avec <code>library()</code> depuis <strong>base</strong> R. Voir la page sur [R basics] pour plus d’informations sur les paquets R.<br />
Ici, nous démontrons également l’utilisation de la fonction <code>p_load_gh()</code> de <strong>pacman</strong> pour installer et charger un paquet de github qui n’a pas encore été publié sur CRAN.</p>
<div class="sourceCode" id="cb1236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1236-1"><a href="survey_analysis.html#cb1236-1" aria-hidden="true" tabindex="-1"></a><span class="do">## charger des paquets depuis CRAN</span></span>
<span id="cb1236-2"><a href="survey_analysis.html#cb1236-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(rio, <span class="co"># Importation du fichier</span></span>
<span id="cb1236-3"><a href="survey_analysis.html#cb1236-3" aria-hidden="true" tabindex="-1"></a>               here, <span class="co"># Localisation de fichiers</span></span>
<span id="cb1236-4"><a href="survey_analysis.html#cb1236-4" aria-hidden="true" tabindex="-1"></a>               tidyverse, <span class="co"># gestion des données + graphiques ggplot2</span></span>
<span id="cb1236-5"><a href="survey_analysis.html#cb1236-5" aria-hidden="true" tabindex="-1"></a>               tsibble, <span class="co"># gère les ensembles de données de séries temporelles</span></span>
<span id="cb1236-6"><a href="survey_analysis.html#cb1236-6" aria-hidden="true" tabindex="-1"></a>               survey, <span class="co"># pour les fonctions d&#39;enquête</span></span>
<span id="cb1236-7"><a href="survey_analysis.html#cb1236-7" aria-hidden="true" tabindex="-1"></a>               srvyr, <span class="co"># wrapper dplyr pour le paquet d&#39;enquête</span></span>
<span id="cb1236-8"><a href="survey_analysis.html#cb1236-8" aria-hidden="true" tabindex="-1"></a>               gtsummary, <span class="co"># wrapper pour le paquet d&#39;enquête pour produire des tableaux</span></span>
<span id="cb1236-9"><a href="survey_analysis.html#cb1236-9" aria-hidden="true" tabindex="-1"></a>               apyramid, <span class="co"># un paquet dédié à la création de pyramides des âges</span></span>
<span id="cb1236-10"><a href="survey_analysis.html#cb1236-10" aria-hidden="true" tabindex="-1"></a>               patchwork, <span class="co"># pour combiner des ggplots</span></span>
<span id="cb1236-11"><a href="survey_analysis.html#cb1236-11" aria-hidden="true" tabindex="-1"></a>               ggforce <span class="co"># pour les tracés alluviaux/sankey</span></span>
<span id="cb1236-12"><a href="survey_analysis.html#cb1236-12" aria-hidden="true" tabindex="-1"></a>               ) </span>
<span id="cb1236-13"><a href="survey_analysis.html#cb1236-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1236-14"><a href="survey_analysis.html#cb1236-14" aria-hidden="true" tabindex="-1"></a><span class="do">## charger les paquets de github pour le temps d&#39;observation / fonctions de pondération</span></span>
<span id="cb1236-15"><a href="survey_analysis.html#cb1236-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(sitrep)){</span>
<span id="cb1236-16"><a href="survey_analysis.html#cb1236-16" aria-hidden="true" tabindex="-1"></a>   remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;r4epi/sitrep&quot;</span>)</span>
<span id="cb1236-17"><a href="survey_analysis.html#cb1236-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">library</span>(sitrep)</span>
<span id="cb1236-18"><a href="survey_analysis.html#cb1236-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="charger-les-données" class="section level3 unnumbered">
<h3>Charger les données</h3>
<p>L’ensemble de données d’exemple utilisé dans cette section :</p>
<ul>
<li>des données fictives d’enquête de mortalité.</li>
<li>comptes de population fictifs pour la zone d’enquête.</li>
<li>Dictionnaire de données pour les données fictives de l’enquête sur la mortalité.</li>
</ul>
<p>Ceci est basé sur l’enquête pré-approuvée par le comité d’examen éthique de MSF OCA. Le site données fictives ont été produites dans le cadre du projet <a href="https://r4epis.netlify.app/">“R4Epis”</a>.
Tout ceci est basé sur les données collectées à l’aide de <a href="https://www.kobotoolbox.org/">KoboToolbox</a>, qui est un logiciel de collecte de données basé sur <a href="https://opendatakit.org/">Open Data Kit</a>.</p>
<p>Kobo vous permet d’exporter à la fois les données collectées et le dictionnaire de données pour cet ensemble de données. Nous vous recommandons vivement de le faire, car cela simplifie le nettoyage des données et est utile pour rechercher des variables/questions.</p>
<p><span style="color : darkgreen ;"><strong><em>TIP:</em></strong> Le dictionnaire de données de Kobo comporte des noms de variables dans la colonne “nom” de la feuille d’enquête. Les valeurs possibles pour chaque variable sont spécifiées dans la feuille de choix. Dans la feuille de choix, “name” a la valeur abrégée et les colonnes “label::english” et “label::french” ont les versions longues appropriées. L’utilisation de la fonction <code>msf_dict_survey()</code> du paquet <strong>epidict</strong> pour importer un fichier Excel du dictionnaire Kobo sera reformaté pour vous afin de pouvoir l’utiliser facilement pour le recodage. </span></p>
<p><span style="color : orange ;"><strong><em>CAUTION:</em></strong> Le jeu de données d’exemple n’est pas le même comme un export (comme dans Kobo vous exportez différents niveaux de questionnaire individuellement).
- voir la section sur les données d’enquête ci-dessous pour fusionner les différents niveaux.</span></p>
<p>Le jeu de données est importé à l’aide de la fonction <code>import()</code> du paquet <strong>rio</strong>. Consultez la page <a href="import_export.html#import_export">Importation et exportation</a> pour connaître les différentes façons d’importer des données.</p>
<div class="sourceCode" id="cb1237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1237-1"><a href="survey_analysis.html#cb1237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importez les données d&#39;enquête</span></span>
<span id="cb1237-2"><a href="survey_analysis.html#cb1237-2" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">&quot;survey_data.xlsx&quot;</span>)</span>
<span id="cb1237-3"><a href="survey_analysis.html#cb1237-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1237-4"><a href="survey_analysis.html#cb1237-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Importez le dictionnaire dans R</span></span>
<span id="cb1237-5"><a href="survey_analysis.html#cb1237-5" aria-hidden="true" tabindex="-1"></a>survey_dict <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">&quot;survey_dict.xlsx&quot;</span>) </span></code></pre></div>
<p>Les 10 premières lignes de l’enquête sont affichées ci-dessous.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-df0e9bd711de407e6eac" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-df0e9bd711de407e6eac">{"x":{"filter":"none","vertical":false,"data":[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["2018-04-15T00:00:00Z","2018-03-04T00:00:00Z","2018-04-16T00:00:00Z","2018-01-23T00:00:00Z","2018-01-09T00:00:00Z","2018-03-07T00:00:00Z","2018-02-18T00:00:00Z","2018-04-12T00:00:00Z","2018-04-17T00:00:00Z","2018-01-05T00:00:00Z"],[null,null,null,null,null,null,null,null,null,null],["village_1","village_1","village_10","village_5","village_3","village_8","other","village_7","village_4","village_2"],[null,null,null,null,null,null,null,null,null,null],[1,1,10,5,3,8,11,7,4,2],[9,1,15,6,18,14,17,16,13,14],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["yes","no","no","yes","no","yes","no","yes","yes","yes"],[null,"no_benefit","neg_experience",null,"other",null,"no_benefit",null,null,null],[null,null,null,null,null,null,null,null,null,null],[6,null,null,8,null,5,null,6,5,5],["female",null,null,"female",null,"male",null,"male","male","female"],[26,null,null,3,null,22,null,33,96,18],[null,null,null,36,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["no",null,null,"no",null,"yes",null,"yes","yes","yes"],["yes",null,null,null,null,"yes",null,"no","no","no"],["secondary",null,null,null,null,"secondary",null,null,null,null],["no",null,null,"no",null,"yes",null,"no","yes","yes"],[null,null,null,null,null,"yes",null,null,"no","no"],["yes",null,null,null,null,null,null,null,null,"yes"],["no",null,null,"no",null,"yes",null,"yes","no","yes"],["yes",null,null,"no",null,"no",null,"no","yes","yes"],["no",null,null,null,null,null,null,null,"no","no"],[null,null,null,null,null,null,null,null,null,null],["yes",null,null,"no",null,"no",null,"yes","no","no"],["no",null,null,null,null,null,null,"no",null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["no","no","no","no","no","no","no","no","yes","no"],[null,null,null,null,null,null,null,null,"no",null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,"dont_know",null],[null,null,null,null,null,null,null,null,null,null],["yes",null,null,"yes",null,"no",null,"yes","no","no"],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["sexual",null,null,"sexual",null,null,null,"shot",null,null],["0",null,null,"0",null,null,null,"0",null,null],["1",null,null,"1",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"1",null,null],["0",null,null,"0",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"0",null,null],[9,1,183,83,58,146,205,130,72,33],[1,1,1,1,1,1,1,1,1,1],["9_1","1_1","183_1","83_1","58_1","146_1","205_1","130_1","72_1","33_1"]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>start<\/th>\n      <th>end<\/th>\n      <th>today<\/th>\n      <th>deviceid<\/th>\n      <th>date<\/th>\n      <th>team_number<\/th>\n      <th>village_name<\/th>\n      <th>village_other<\/th>\n      <th>cluster_number<\/th>\n      <th>household_number<\/th>\n      <th>households_building<\/th>\n      <th>random_hh<\/th>\n      <th>random_hh_note<\/th>\n      <th>consent<\/th>\n      <th>no_consent_reason<\/th>\n      <th>no_consent_other<\/th>\n      <th>member_number<\/th>\n      <th>sex<\/th>\n      <th>age_years<\/th>\n      <th>age_months_calc<\/th>\n      <th>age_months<\/th>\n      <th>bednet<\/th>\n      <th>read_write<\/th>\n      <th>education_level<\/th>\n      <th>measles_vaccination<\/th>\n      <th>vaccination_card<\/th>\n      <th>pregnant<\/th>\n      <th>malaria_treatment<\/th>\n      <th>arrived<\/th>\n      <th>remember_arrival<\/th>\n      <th>arrived_date<\/th>\n      <th>left<\/th>\n      <th>remember_departure<\/th>\n      <th>left_date<\/th>\n      <th>born<\/th>\n      <th>remember_dob<\/th>\n      <th>birthday_date<\/th>\n      <th>died<\/th>\n      <th>remember_death<\/th>\n      <th>death_date<\/th>\n      <th>cause<\/th>\n      <th>cause_other<\/th>\n      <th>violent_episode<\/th>\n      <th>violent_episodes_number<\/th>\n      <th>violence_nature_other<\/th>\n      <th>violence_nature<\/th>\n      <th>violence_nature/beaten<\/th>\n      <th>violence_nature/sexual<\/th>\n      <th>violence_nature/shot<\/th>\n      <th>violence_nature/detained_kidnapped<\/th>\n      <th>violence_nature/other<\/th>\n      <th>violence_nature/no_response<\/th>\n      <th>index<\/th>\n      <th>index_y<\/th>\n      <th>uid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[8,9,16,18,19,20,52,53]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Nous voulons également importer les données sur la population d’échantillonnage afin de pouvoir produire des pondérations appropriées. Ces données peuvent se présenter sous différents formats. Cependant, nous vous suggérons de les présenter comme suit (vous pouvez simplement les saisir dans un excel).</p>
<div class="sourceCode" id="cb1238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1238-1"><a href="survey_analysis.html#cb1238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importez les données de la population</span></span>
<span id="cb1238-2"><a href="survey_analysis.html#cb1238-2" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">&quot;population.xlsx&quot;</span>)</span></code></pre></div>
<p>Les 10 premières lignes de l’enquête sont affichées ci-dessous.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3ab610eab74d7d543104" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3ab610eab74d7d543104">{"x":{"filter":"none","vertical":false,"data":[["0-2","3-14","15-29","30-44","45+","0-2","3-14","15-29","30-44","45+"],["male","male","male","male","male","female","female","female","female","female"],[0.034,0.1811,0.138,0.0808,0.0661,0.034,0.1811,0.138,0.0808,0.0661],[340,1811,1380,808,661,340,1811,1380,808,661],["district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a"]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>age_group<\/th>\n      <th>sex<\/th>\n      <th>proportions<\/th>\n      <th>population<\/th>\n      <th>health_district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Pour les enquêtes en grappes, vous pouvez souhaiter ajouter des poids d’enquête au niveau de la grappe. Vous pouvez lire ces données comme ci-dessus.
Alternativement, s’il n’y a que quelques comptages, ils peuvent être entrés comme suit dans un tibble. Dans tous les cas, vous aurez besoin d’avoir une colonne avec un identifiant de grappe qui correspondant à vos données d’enquête, et une autre colonne avec le nombre de ménages dans chaque grappe.</p>
<div class="sourceCode" id="cb1239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1239-1"><a href="survey_analysis.html#cb1239-1" aria-hidden="true" tabindex="-1"></a><span class="do">## définir le nombre de ménages dans chaque cluster</span></span>
<span id="cb1239-2"><a href="survey_analysis.html#cb1239-2" aria-hidden="true" tabindex="-1"></a>cluster_counts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">&quot;village_1&quot;</span>, <span class="st">&quot;village_2&quot;</span>, <span class="st">&quot;village_3&quot;</span>, <span class="st">&quot;village_4&quot;</span>, </span>
<span id="cb1239-3"><a href="survey_analysis.html#cb1239-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;village_5&quot;</span>, <span class="st">&quot;village_6&quot;</span>, <span class="st">&quot;village_7&quot;</span>, <span class="st">&quot;village_8&quot;</span>,</span>
<span id="cb1239-4"><a href="survey_analysis.html#cb1239-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;village_9&quot;</span>, <span class="st">&quot;village_10&quot;</span>), </span>
<span id="cb1239-5"><a href="survey_analysis.html#cb1239-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">households =</span> <span class="fu">c</span>(<span class="dv">700</span>, <span class="dv">400</span>, <span class="dv">600</span>, <span class="dv">500</span>, <span class="dv">300</span>, </span>
<span id="cb1239-6"><a href="survey_analysis.html#cb1239-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="dv">800</span>, <span class="dv">700</span>, <span class="dv">400</span>, <span class="dv">500</span>, <span class="dv">500</span>))</span></code></pre></div>
</div>
<div id="nettoyer-les-données-2" class="section level3 unnumbered">
<h3>Nettoyer les données</h3>
<p>L’exemple ci-dessous permet de s’assurer que la colonne date est au bon format. Il existe plusieurs autres façons de procéder (voir la page <a href="working_dates.html#working_dates">Travailler avec des dates</a> pour plus de détails), mais l’utilisation du dictionnaire pour définir les dates est rapide et facile.</p>
<p>Nous créons également une variable de groupe d’âge en utilisant la fonction <code>age_categories()</code> de <strong>epikit</strong> - voir la section <a href="cleaning_data.html#cleaning_data">Nettoyage de données et fonctions essentielles</a> pour plus de détails. De plus, nous créons une variable de caractère définissant dans quel district se trouvent les différents clusters.</p>
<p>Enfin, nous recodons toutes les variables oui/non en variables VRAI/FAUX, sinon elles ne peuvent pas être utilisées par les fonctions de proportion <strong>survey</strong>.</p>
<div class="sourceCode" id="cb1240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1240-1"><a href="survey_analysis.html#cb1240-1" aria-hidden="true" tabindex="-1"></a><span class="do">## sélectionne les noms de variables de date dans le dictionnaire </span></span>
<span id="cb1240-2"><a href="survey_analysis.html#cb1240-2" aria-hidden="true" tabindex="-1"></a>DATEVARS <span class="ot">&lt;-</span> survey_dict <span class="sc">%&gt;%</span> </span>
<span id="cb1240-3"><a href="survey_analysis.html#cb1240-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;date&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1240-4"><a href="survey_analysis.html#cb1240-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">names</span>(survey_data)) <span class="sc">%&gt;%</span> </span>
<span id="cb1240-5"><a href="survey_analysis.html#cb1240-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## filtre pour correspondre aux noms des colonnes de vos données</span></span>
<span id="cb1240-6"><a href="survey_analysis.html#cb1240-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(name) <span class="co"># sélectionne les variables de date</span></span>
<span id="cb1240-7"><a href="survey_analysis.html#cb1240-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1240-8"><a href="survey_analysis.html#cb1240-8" aria-hidden="true" tabindex="-1"></a><span class="do">## changer en dates </span></span>
<span id="cb1240-9"><a href="survey_analysis.html#cb1240-9" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1240-10"><a href="survey_analysis.html#cb1240-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(DATEVARS), as.Date))</span>
<span id="cb1240-11"><a href="survey_analysis.html#cb1240-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1240-12"><a href="survey_analysis.html#cb1240-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1240-13"><a href="survey_analysis.html#cb1240-13" aria-hidden="true" tabindex="-1"></a><span class="do">## ajouter ceux dont l&#39;âge est uniquement en mois à la variable année (diviser par douze).</span></span>
<span id="cb1240-14"><a href="survey_analysis.html#cb1240-14" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1240-15"><a href="survey_analysis.html#cb1240-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(age_years), </span>
<span id="cb1240-16"><a href="survey_analysis.html#cb1240-16" aria-hidden="true" tabindex="-1"></a>                             age_months <span class="sc">/</span> <span class="dv">12</span>, </span>
<span id="cb1240-17"><a href="survey_analysis.html#cb1240-17" aria-hidden="true" tabindex="-1"></a>                             age_years))</span>
<span id="cb1240-18"><a href="survey_analysis.html#cb1240-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1240-19"><a href="survey_analysis.html#cb1240-19" aria-hidden="true" tabindex="-1"></a><span class="do">## définir la variable groupe d&#39;âge</span></span>
<span id="cb1240-20"><a href="survey_analysis.html#cb1240-20" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1240-21"><a href="survey_analysis.html#cb1240-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">age_categories</span>(age_years, </span>
<span id="cb1240-22"><a href="survey_analysis.html#cb1240-22" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">15</span>, <span class="dv">30</span>, <span class="dv">45</span>)</span>
<span id="cb1240-23"><a href="survey_analysis.html#cb1240-23" aria-hidden="true" tabindex="-1"></a>                                    ))</span>
<span id="cb1240-24"><a href="survey_analysis.html#cb1240-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1240-25"><a href="survey_analysis.html#cb1240-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1240-26"><a href="survey_analysis.html#cb1240-26" aria-hidden="true" tabindex="-1"></a><span class="do">## créer une variable caractère basée sur les groupes d&#39;une autre variable </span></span>
<span id="cb1240-27"><a href="survey_analysis.html#cb1240-27" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1240-28"><a href="survey_analysis.html#cb1240-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">health_district =</span> <span class="fu">case_when</span>(</span>
<span id="cb1240-29"><a href="survey_analysis.html#cb1240-29" aria-hidden="true" tabindex="-1"></a>    cluster_number <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">~</span> <span class="st">&quot;district_a&quot;</span>, </span>
<span id="cb1240-30"><a href="survey_analysis.html#cb1240-30" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;district_b&quot;</span></span>
<span id="cb1240-31"><a href="survey_analysis.html#cb1240-31" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb1240-32"><a href="survey_analysis.html#cb1240-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1240-33"><a href="survey_analysis.html#cb1240-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1240-34"><a href="survey_analysis.html#cb1240-34" aria-hidden="true" tabindex="-1"></a><span class="do">## sélectionner les noms de variables oui/non dans le dictionnaire </span></span>
<span id="cb1240-35"><a href="survey_analysis.html#cb1240-35" aria-hidden="true" tabindex="-1"></a>YNVARS <span class="ot">&lt;-</span> survey_dict <span class="sc">%&gt;%</span> </span>
<span id="cb1240-36"><a href="survey_analysis.html#cb1240-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;yn&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1240-37"><a href="survey_analysis.html#cb1240-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">names</span>(survey_data)) <span class="sc">%&gt;%</span> </span>
<span id="cb1240-38"><a href="survey_analysis.html#cb1240-38" aria-hidden="true" tabindex="-1"></a>  <span class="do">## filtre pour correspondre aux noms des colonnes de vos données</span></span>
<span id="cb1240-39"><a href="survey_analysis.html#cb1240-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(name) <span class="co"># select yn vars</span></span>
<span id="cb1240-40"><a href="survey_analysis.html#cb1240-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1240-41"><a href="survey_analysis.html#cb1240-41" aria-hidden="true" tabindex="-1"></a><span class="do">## changer en dates </span></span>
<span id="cb1240-42"><a href="survey_analysis.html#cb1240-42" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1240-43"><a href="survey_analysis.html#cb1240-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(YNVARS), </span>
<span id="cb1240-44"><a href="survey_analysis.html#cb1240-44" aria-hidden="true" tabindex="-1"></a>                str_detect, </span>
<span id="cb1240-45"><a href="survey_analysis.html#cb1240-45" aria-hidden="true" tabindex="-1"></a>                <span class="at">pattern =</span> <span class="st">&quot;yes&quot;</span>))</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="données-denquête" class="section level2" number="25.3">
<h2><span class="header-section-number">25.3</span> Données d’enquête</h2>
<p>Il existe de nombreux plans d’échantillonnage différents qui peuvent être utilisés pour les enquêtes. Ici, nous allons démontrer le code pour :
- Stratifié
- en grappes
- Stratifié et grappe</p>
<p>Comme décrit ci-dessus (en fonction de la façon dont vous concevez votre questionnaire), les données de chaque niveau seront exportées comme un ensemble de données séparé de Kobo. Dans notre exemple, il y a
un niveau pour les ménages et un niveau pour les individus au sein de ces ménages.</p>
<p>Ces deux niveaux sont liés par un identifiant unique. Pour un ensemble de données Kobo, cette variable est “_index” au niveau du ménage, qui correspond à “_parent_index” au niveau de l’individu.
Cela créera de nouvelles lignes pour le ménage avec chaque individu correspondant, voir la section du manuel sur <a href="joining_matching.html#joining_matching">Joindre des données</a> pour plus de détails.</p>
<div class="sourceCode" id="cb1241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1241-1"><a href="survey_analysis.html#cb1241-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Joignez les données des individus et des ménages pour former un ensemble de données complet.</span></span>
<span id="cb1241-2"><a href="survey_analysis.html#cb1241-2" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(survey_data_hh, </span>
<span id="cb1241-3"><a href="survey_analysis.html#cb1241-3" aria-hidden="true" tabindex="-1"></a>                         survey_data_indiv,</span>
<span id="cb1241-4"><a href="survey_analysis.html#cb1241-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;_index&quot;</span> <span class="ot">=</span> <span class="st">&quot;_parent_index&quot;</span>))</span>
<span id="cb1241-5"><a href="survey_analysis.html#cb1241-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1241-6"><a href="survey_analysis.html#cb1241-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1241-7"><a href="survey_analysis.html#cb1241-7" aria-hidden="true" tabindex="-1"></a><span class="do">## créer un identifiant unique en combinant les index des deux niveaux </span></span>
<span id="cb1241-8"><a href="survey_analysis.html#cb1241-8" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1241-9"><a href="survey_analysis.html#cb1241-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">uid =</span> <span class="fu">str_glue</span>(<span class="st">&quot;{index}_{index_y}&quot;</span>))</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="temps-dobservation" class="section level2" number="25.4">
<h2><span class="header-section-number">25.4</span> Temps d’observation</h2>
<p>Pour les enquêtes de mortalité, nous voulons maintenant savoir combien de temps chaque individu a été présent dans l’emplacement afin de pouvoir calculer un taux de mortalité approprié pour notre période d’intérêt. Ceci n’est pas pertinent pour toutes les enquêtes, mais particulièrement pour les enquêtes de mortalité, car elles sont fréquemment menées auprès de populations mobiles ou déplacées.</p>
<p>Pour ce faire, nous définissons d’abord notre période d’intérêt, également connue sous le nom de période de rappel (c’est-à-dire le moment où l’enquête est menée). Nous pouvons ensuite utiliser cette période pour définir des dates inappropriées comme manquantes, c’est-à-dire que si des décès sont signalés en dehors de la période d’intérêt.</p>
<div class="sourceCode" id="cb1242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1242-1"><a href="survey_analysis.html#cb1242-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Définit le début/la fin de la période de rappel.</span></span>
<span id="cb1242-2"><a href="survey_analysis.html#cb1242-2" aria-hidden="true" tabindex="-1"></a><span class="do">## peut être changé en variables de date provenant de l&#39;ensemble de données </span></span>
<span id="cb1242-3"><a href="survey_analysis.html#cb1242-3" aria-hidden="true" tabindex="-1"></a><span class="do">## (par exemple, date d&#39;arrivée et date du questionnaire)</span></span>
<span id="cb1242-4"><a href="survey_analysis.html#cb1242-4" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1242-5"><a href="survey_analysis.html#cb1242-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">recall_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2018-01-01&quot;</span>), </span>
<span id="cb1242-6"><a href="survey_analysis.html#cb1242-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">recall_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2018-05-01&quot;</span>)</span>
<span id="cb1242-7"><a href="survey_analysis.html#cb1242-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1242-8"><a href="survey_analysis.html#cb1242-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1242-9"><a href="survey_analysis.html#cb1242-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1242-10"><a href="survey_analysis.html#cb1242-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir les dates inappropriées à NA sur la base de règles </span></span>
<span id="cb1242-11"><a href="survey_analysis.html#cb1242-11" aria-hidden="true" tabindex="-1"></a><span class="do">## par exemple, arrivées avant le début, départs après la fin.</span></span>
<span id="cb1242-12"><a href="survey_analysis.html#cb1242-12" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1242-13"><a href="survey_analysis.html#cb1242-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb1242-14"><a href="survey_analysis.html#cb1242-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrived_date =</span> <span class="fu">if_else</span>(arrived_date <span class="sc">&lt;</span> recall_start, </span>
<span id="cb1242-15"><a href="survey_analysis.html#cb1242-15" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">as.Date</span>(<span class="cn">NA</span>),</span>
<span id="cb1242-16"><a href="survey_analysis.html#cb1242-16" aria-hidden="true" tabindex="-1"></a>                                  arrived_date),</span>
<span id="cb1242-17"><a href="survey_analysis.html#cb1242-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">birthday_date =</span> <span class="fu">if_else</span>(birthday_date <span class="sc">&lt;</span> recall_start,</span>
<span id="cb1242-18"><a href="survey_analysis.html#cb1242-18" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">as.Date</span>(<span class="cn">NA</span>),</span>
<span id="cb1242-19"><a href="survey_analysis.html#cb1242-19" aria-hidden="true" tabindex="-1"></a>                                  birthday_date),</span>
<span id="cb1242-20"><a href="survey_analysis.html#cb1242-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">left_date =</span> <span class="fu">if_else</span>(left_date <span class="sc">&gt;</span> recall_end,</span>
<span id="cb1242-21"><a href="survey_analysis.html#cb1242-21" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">as.Date</span>(<span class="cn">NA</span>),</span>
<span id="cb1242-22"><a href="survey_analysis.html#cb1242-22" aria-hidden="true" tabindex="-1"></a>                               left_date),</span>
<span id="cb1242-23"><a href="survey_analysis.html#cb1242-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">death_date =</span> <span class="fu">if_else</span>(death_date <span class="sc">&gt;</span> recall_end,</span>
<span id="cb1242-24"><a href="survey_analysis.html#cb1242-24" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">as.Date</span>(<span class="cn">NA</span>),</span>
<span id="cb1242-25"><a href="survey_analysis.html#cb1242-25" aria-hidden="true" tabindex="-1"></a>                               death_date)</span>
<span id="cb1242-26"><a href="survey_analysis.html#cb1242-26" aria-hidden="true" tabindex="-1"></a>           )</span></code></pre></div>
<p>Nous pouvons ensuite utiliser nos variables de date pour définir les dates de début et de fin pour chaque individu. Nous pouvons utiliser la fonction <code>find_start_date()</code> de <strong>sitrep</strong> pour affiner les causes des les dates et ensuite utiliser cela pour calculer la différence entre les jours (personne-temps).</p>
<p>Date de début :
L’événement d’arrivée approprié le plus tôt dans votre période de rappel. Soit le début de votre période de rappel (que vous définissez à l’avance), soit une date après le début de la période de rappel, le cas échéant (par exemple, les arrivées ou les naissances).</p>
<p>Date de fin :
Soit la fin de votre période de rappel, soit une date antérieure à la fin du rappel.</p>
<div class="sourceCode" id="cb1243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1243-1"><a href="survey_analysis.html#cb1243-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Créer de nouvelles variables pour les dates/causes de début et de fin.</span></span>
<span id="cb1243-2"><a href="survey_analysis.html#cb1243-2" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1243-3"><a href="survey_analysis.html#cb1243-3" aria-hidden="true" tabindex="-1"></a>     <span class="do">## choisir la date la plus ancienne saisie dans l&#39;enquête.</span></span>
<span id="cb1243-4"><a href="survey_analysis.html#cb1243-4" aria-hidden="true" tabindex="-1"></a>     <span class="do">## à partir des naissances, des arrivées dans les ménages et des arrivées dans les camps. </span></span>
<span id="cb1243-5"><a href="survey_analysis.html#cb1243-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">find_start_date</span>(<span class="st">&quot;birthday_date&quot;</span>,</span>
<span id="cb1243-6"><a href="survey_analysis.html#cb1243-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;arrived_date&quot;</span>,</span>
<span id="cb1243-7"><a href="survey_analysis.html#cb1243-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">period_start =</span> <span class="st">&quot;recall_start&quot;</span>,</span>
<span id="cb1243-8"><a href="survey_analysis.html#cb1243-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">period_end =</span> <span class="st">&quot;recall_end&quot;</span>,</span>
<span id="cb1243-9"><a href="survey_analysis.html#cb1243-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">datecol =</span> <span class="st">&quot;startdate&quot;</span>,</span>
<span id="cb1243-10"><a href="survey_analysis.html#cb1243-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">datereason =</span> <span class="st">&quot;startcause&quot;</span></span>
<span id="cb1243-11"><a href="survey_analysis.html#cb1243-11" aria-hidden="true" tabindex="-1"></a>                 ) <span class="sc">%&gt;%</span></span>
<span id="cb1243-12"><a href="survey_analysis.html#cb1243-12" aria-hidden="true" tabindex="-1"></a>     <span class="do">## choisir la date la plus ancienne saisie dans l&#39;enquête</span></span>
<span id="cb1243-13"><a href="survey_analysis.html#cb1243-13" aria-hidden="true" tabindex="-1"></a>     <span class="do">## à partir des départs du camp, des décès et de la fin de l&#39;étude</span></span>
<span id="cb1243-14"><a href="survey_analysis.html#cb1243-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">find_end_date</span>(<span class="st">&quot;left_date&quot;</span>,</span>
<span id="cb1243-15"><a href="survey_analysis.html#cb1243-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;death_date&quot;</span>,</span>
<span id="cb1243-16"><a href="survey_analysis.html#cb1243-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">period_start =</span> <span class="st">&quot;recall_start&quot;</span>,</span>
<span id="cb1243-17"><a href="survey_analysis.html#cb1243-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">period_end =</span> <span class="st">&quot;recall_end&quot;</span>,</span>
<span id="cb1243-18"><a href="survey_analysis.html#cb1243-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">datecol =</span> <span class="st">&quot;enddate&quot;</span>,</span>
<span id="cb1243-19"><a href="survey_analysis.html#cb1243-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">datereason =</span> <span class="st">&quot;endcause&quot;</span> </span>
<span id="cb1243-20"><a href="survey_analysis.html#cb1243-20" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb1243-21"><a href="survey_analysis.html#cb1243-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1243-22"><a href="survey_analysis.html#cb1243-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1243-23"><a href="survey_analysis.html#cb1243-23" aria-hidden="true" tabindex="-1"></a><span class="do">## étiqueter ceux qui étaient présents au début/à la fin (sauf les naissances/décès)</span></span>
<span id="cb1243-24"><a href="survey_analysis.html#cb1243-24" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1243-25"><a href="survey_analysis.html#cb1243-25" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb1243-26"><a href="survey_analysis.html#cb1243-26" aria-hidden="true" tabindex="-1"></a>       <span class="do">## remplir la date de début pour qu&#39;elle corresponde au début de la période de rappel (pour ceux qui sont vides) </span></span>
<span id="cb1243-27"><a href="survey_analysis.html#cb1243-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">startdate =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(startdate), recall_start, startdate), </span>
<span id="cb1243-28"><a href="survey_analysis.html#cb1243-28" aria-hidden="true" tabindex="-1"></a>       <span class="do">## définir la cause de début comme présente au début si elle est égale à la période de rappel </span></span>
<span id="cb1243-29"><a href="survey_analysis.html#cb1243-29" aria-hidden="true" tabindex="-1"></a>       <span class="do">## sauf si elle est égale à la date de naissance </span></span>
<span id="cb1243-30"><a href="survey_analysis.html#cb1243-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">startcause =</span> <span class="fu">if_else</span>(startdate <span class="sc">==</span> recall_start <span class="sc">&amp;</span> startcause <span class="sc">!=</span> <span class="st">&quot;birthday_date&quot;</span>,</span>
<span id="cb1243-31"><a href="survey_analysis.html#cb1243-31" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;Present at start&quot;</span>, startcause), </span>
<span id="cb1243-32"><a href="survey_analysis.html#cb1243-32" aria-hidden="true" tabindex="-1"></a>       <span class="do">## remplir la date de fin pour qu&#39;elle corresponde à la fin de la période de rappel (pour ceux qui sont vides) </span></span>
<span id="cb1243-33"><a href="survey_analysis.html#cb1243-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">enddate =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(enddate), recall_end, enddate), </span>
<span id="cb1243-34"><a href="survey_analysis.html#cb1243-34" aria-hidden="true" tabindex="-1"></a>       <span class="do">## définir la cause de fin comme étant présente à la fin si égale à la fin de rappel </span></span>
<span id="cb1243-35"><a href="survey_analysis.html#cb1243-35" aria-hidden="true" tabindex="-1"></a>       <span class="do">## sauf si elle est égale à la date de décès</span></span>
<span id="cb1243-36"><a href="survey_analysis.html#cb1243-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">endcause =</span> <span class="fu">if_else</span>(enddate <span class="sc">==</span> recall_end <span class="sc">&amp;</span> endcause <span class="sc">!=</span> <span class="st">&quot;death_date&quot;</span>, </span>
<span id="cb1243-37"><a href="survey_analysis.html#cb1243-37" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Present at end&quot;</span>, endcause))</span>
<span id="cb1243-38"><a href="survey_analysis.html#cb1243-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1243-39"><a href="survey_analysis.html#cb1243-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1243-40"><a href="survey_analysis.html#cb1243-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Définir la durée d&#39;observation en jours</span></span>
<span id="cb1243-41"><a href="survey_analysis.html#cb1243-41" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1243-42"><a href="survey_analysis.html#cb1243-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">obstime =</span> <span class="fu">as.numeric</span>(enddate <span class="sc">-</span> startdate))</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="pondération" class="section level2" number="25.5">
<h2><span class="header-section-number">25.5</span> Pondération</h2>
<p>Il est important d’éliminer les observations erronées avant d’ajouter les poids de l’enquête. Par exemple, si vous avez des observations avec un temps d’observation négatif, vous devrez les vérifier (vous pouvez le faire avec la fonction <code>assert_positive_timespan()</code> de <strong>sitrep</strong>. Une autre chose est si vous voulez supprimer les lignes vides (par exemple avec <code>drop_na(uid)</code>) ou supprimer les doublons (voir la section du manuel sur la <a href="cleaning_data.html#deduplication">déduplication</a> pour plus de détails). Ceux qui n’ont pas de consentement doivent aussi être supprimés.</p>
<p>Dans cet exemple, nous filtrons les cas que nous voulons supprimer et les stockons dans un cadre de données séparé - de cette façon, nous pouvons décrire ceux qui ont été exclus de l’enquête. Nous utilisons ensuite la fonction <code>anti_join()</code> de <strong>dplyr</strong> pour supprimer ces cas exclus de nos données d’enquête.</p>
<p><span style="color : red ;"><strong><em>DANGER:</em></strong> Vous ne pouvez pas avoir de valeurs manquantes dans votre variable de poids, ni dans aucune des variables pertinentes pour le plan de sondage (par exemple, les variables d’âge, de sexe, de strates ou de grappes).</span></p>
<div class="sourceCode" id="cb1244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1244-1"><a href="survey_analysis.html#cb1244-1" aria-hidden="true" tabindex="-1"></a><span class="do">## stockez les cas que vous abandonnez afin de pouvoir les décrire (par exemple, non-consentant. </span></span>
<span id="cb1244-2"><a href="survey_analysis.html#cb1244-2" aria-hidden="true" tabindex="-1"></a><span class="do">## ou mauvais village/cluster)</span></span>
<span id="cb1244-3"><a href="survey_analysis.html#cb1244-3" aria-hidden="true" tabindex="-1"></a>dropped <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1244-4"><a href="survey_analysis.html#cb1244-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>consent <span class="sc">|</span> <span class="fu">is.na</span>(startdate) <span class="sc">|</span> <span class="fu">is.na</span>(enddate) <span class="sc">|</span> village_name <span class="sc">==</span> <span class="st">&quot;other&quot;</span>)</span>
<span id="cb1244-5"><a href="survey_analysis.html#cb1244-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1244-6"><a href="survey_analysis.html#cb1244-6" aria-hidden="true" tabindex="-1"></a><span class="do">## utiliser les cas abandonnés pour supprimer les lignes inutilisées de l&#39;ensemble des données de l&#39;enquête.  </span></span>
<span id="cb1244-7"><a href="survey_analysis.html#cb1244-7" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(survey_data, dropped, <span class="at">by =</span> <span class="fu">names</span>(dropped))</span></code></pre></div>
<p>Comme mentionné ci-dessus, nous montrons comment ajouter des poids pour trois plans d’étude différents (stratifié, en grappe et en grappe stratifié). Ceux-ci nécessitent des informations sur la population source et/ou les grappes enquêtées. Nous utiliserons le code de la grappe stratifiée pour cet exemple, mais utilisez celui qui est le plus approprié à votre plan d’étude.</p>
<div class="sourceCode" id="cb1245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1245-1"><a href="survey_analysis.html#cb1245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stratified ------------------------------------------------------------------</span></span>
<span id="cb1245-2"><a href="survey_analysis.html#cb1245-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Créez une variable appelée &quot;surv_weight_strata&quot;.</span></span>
<span id="cb1245-3"><a href="survey_analysis.html#cb1245-3" aria-hidden="true" tabindex="-1"></a><span class="co"># contient les poids pour chaque individu - par groupe d&#39;âge, sexe et district sanitaire.</span></span>
<span id="cb1245-4"><a href="survey_analysis.html#cb1245-4" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> <span class="fu">add_weights_strata</span>(<span class="at">x =</span> survey_data,</span>
<span id="cb1245-5"><a href="survey_analysis.html#cb1245-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">p =</span> population,</span>
<span id="cb1245-6"><a href="survey_analysis.html#cb1245-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">surv_weight =</span> <span class="st">&quot;surv_weight_strata&quot;</span>,</span>
<span id="cb1245-7"><a href="survey_analysis.html#cb1245-7" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">surv_weight_ID =</span> <span class="st">&quot;surv_weight_ID_strata&quot;</span>,</span>
<span id="cb1245-8"><a href="survey_analysis.html#cb1245-8" aria-hidden="true" tabindex="-1"></a>                                         age_group, sex, health_district)</span>
<span id="cb1245-9"><a href="survey_analysis.html#cb1245-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1245-10"><a href="survey_analysis.html#cb1245-10" aria-hidden="true" tabindex="-1"></a><span class="do">## cluster ---------------------------------------------------------------------</span></span>
<span id="cb1245-11"><a href="survey_analysis.html#cb1245-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1245-12"><a href="survey_analysis.html#cb1245-12" aria-hidden="true" tabindex="-1"></a><span class="co"># obtient le nombre de personnes d&#39;individus interrogés par ménage</span></span>
<span id="cb1245-13"><a href="survey_analysis.html#cb1245-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ajoute une variable avec les comptes de la variable index du ménage (parent)</span></span>
<span id="cb1245-14"><a href="survey_analysis.html#cb1245-14" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1245-15"><a href="survey_analysis.html#cb1245-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(index, <span class="at">name =</span> <span class="st">&quot;interviewed&quot;</span>)</span>
<span id="cb1245-16"><a href="survey_analysis.html#cb1245-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1245-17"><a href="survey_analysis.html#cb1245-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1245-18"><a href="survey_analysis.html#cb1245-18" aria-hidden="true" tabindex="-1"></a><span class="do">## crée des poids de cluster</span></span>
<span id="cb1245-19"><a href="survey_analysis.html#cb1245-19" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> <span class="fu">add_weights_cluster</span>(<span class="at">x =</span> survey_data,</span>
<span id="cb1245-20"><a href="survey_analysis.html#cb1245-20" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">cl =</span> cluster_counts,</span>
<span id="cb1245-21"><a href="survey_analysis.html#cb1245-21" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">eligible =</span> member_number,</span>
<span id="cb1245-22"><a href="survey_analysis.html#cb1245-22" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">interviewed =</span> interviewed,</span>
<span id="cb1245-23"><a href="survey_analysis.html#cb1245-23" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">cluster_x =</span> village_name,</span>
<span id="cb1245-24"><a href="survey_analysis.html#cb1245-24" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">cluster_cl =</span> cluster,</span>
<span id="cb1245-25"><a href="survey_analysis.html#cb1245-25" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">household_x =</span> index,</span>
<span id="cb1245-26"><a href="survey_analysis.html#cb1245-26" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">household_cl =</span> households,</span>
<span id="cb1245-27"><a href="survey_analysis.html#cb1245-27" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">surv_weight =</span> <span class="st">&quot;surv_weight_cluster&quot;</span>,</span>
<span id="cb1245-28"><a href="survey_analysis.html#cb1245-28" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">surv_weight_ID =</span> <span class="st">&quot;surv_weight_ID_cluster&quot;</span>,</span>
<span id="cb1245-29"><a href="survey_analysis.html#cb1245-29" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">ignore_cluster =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1245-30"><a href="survey_analysis.html#cb1245-30" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">ignore_household =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1245-31"><a href="survey_analysis.html#cb1245-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1245-32"><a href="survey_analysis.html#cb1245-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1245-33"><a href="survey_analysis.html#cb1245-33" aria-hidden="true" tabindex="-1"></a><span class="co"># stratifié et cluster ------------------------------------------------------</span></span>
<span id="cb1245-34"><a href="survey_analysis.html#cb1245-34" aria-hidden="true" tabindex="-1"></a><span class="co"># créer un poids d&#39;enquête pour la grappe et les strates</span></span>
<span id="cb1245-35"><a href="survey_analysis.html#cb1245-35" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1245-36"><a href="survey_analysis.html#cb1245-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">surv_weight_cluster_strata =</span> surv_weight_strata <span class="sc">*</span> surv_weight_cluster)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="objets-de-conception-denquête" class="section level2" number="25.6">
<h2><span class="header-section-number">25.6</span> Objets de conception d’enquête</h2>
<p>Créez un objet d’enquête en fonction de la conception de votre étude. Utilisé de la même manière que les cadres de données pour calculer les proportions de poids, etc. Assurez-vous que toutes les variables nécessaires sont créées avant cela.</p>
<p>Il y a quatre options, commentez celles que vous n’utilisez pas :
- aléatoire simple
- Stratifié
- en grappe
- Grappe stratifiée</p>
<p>Pour ce modèle, nous supposerons que nous regroupons les enquêtes dans deux strates distinctes (districts sanitaires A et B). Pour obtenir des estimations globales, nous devons donc combiner les poids des grappes et des strates.</p>
<p>Comme nous l’avons mentionné précédemment, il existe deux paquets disponibles pour ce faire. Le classique est <strong>survey</strong> et il existe un paquetage appelé <strong>srvyr</strong> qui crée des objets et des fonctions adaptés à tidyverse. Nous ferons la démonstration des deux, mais notez que la plupart du code de ce chapitre utilisera des objets basés sur <strong>srvyr</strong>. La seule exception est que le paquet <strong>gtsummary</strong> n’accepte que les objets <strong>survey</strong>.</p>
<div id="paquet-survey" class="section level3" number="25.6.1">
<h3><span class="header-section-number">25.6.1</span> Paquet **Survey</h3>
<p>Le paquet <strong>survey</strong> utilise effectivement le codage <strong>base</strong> <em>R</em>, et il n’est donc pas possible d’utiliser les pipes (<code>%&gt;%</code>) ou d’autres syntaxes <strong>dplyr</strong>. Avec le paquetage <strong>survey</strong>, nous utilisons la fonction <code>svydesign()</code> pour définir un objet d’enquête avec les clusters, les poids et les strates appropriés.</p>
<p><span style="color : black ;"><strong><em>NOTE:</em></strong> nous devons utiliser le tilde (<code>~</code>) devant les variables, ceci parce que le package utilise la syntaxe <strong>base</strong> <em>R</em> d’affectation des variables basée sur des formules. </span></p>
<div class="sourceCode" id="cb1246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1246-1"><a href="survey_analysis.html#cb1246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aléatoire simple ---------------------------------------------------------------</span></span>
<span id="cb1246-2"><a href="survey_analysis.html#cb1246-2" aria-hidden="true" tabindex="-1"></a>base_survey_design_simple <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="co"># 1 pour aucun id de grappe</span></span>
<span id="cb1246-3"><a href="survey_analysis.html#cb1246-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="cn">NULL</span>, <span class="co"># aucun poids ajouté</span></span>
<span id="cb1246-4"><a href="survey_analysis.html#cb1246-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="cn">NULL</span>, <span class="co"># l&#39;échantillonnage est simple (pas de strates)</span></span>
<span id="cb1246-5"><a href="survey_analysis.html#cb1246-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> survey_data <span class="co"># doit spécifier l&#39;ensemble de données</span></span>
<span id="cb1246-6"><a href="survey_analysis.html#cb1246-6" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb1246-7"><a href="survey_analysis.html#cb1246-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1246-8"><a href="survey_analysis.html#cb1246-8" aria-hidden="true" tabindex="-1"></a><span class="do">## stratified ------------------------------------------------------------------</span></span>
<span id="cb1246-9"><a href="survey_analysis.html#cb1246-9" aria-hidden="true" tabindex="-1"></a>base_survey_design_strata <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="co"># 1 pour aucun id de cluster</span></span>
<span id="cb1246-10"><a href="survey_analysis.html#cb1246-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="sc">~</span>surv_weight_strata, <span class="co"># variable de poids créée ci-dessus</span></span>
<span id="cb1246-11"><a href="survey_analysis.html#cb1246-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="sc">~</span>health_district, <span class="co"># l&#39;échantillonnage a été stratifié par district</span></span>
<span id="cb1246-12"><a href="survey_analysis.html#cb1246-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> survey_data <span class="co"># il faut spécifier l&#39;ensemble de données</span></span>
<span id="cb1246-13"><a href="survey_analysis.html#cb1246-13" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb1246-14"><a href="survey_analysis.html#cb1246-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1246-15"><a href="survey_analysis.html#cb1246-15" aria-hidden="true" tabindex="-1"></a><span class="co"># cluster ---------------------------------------------------------------------</span></span>
<span id="cb1246-16"><a href="survey_analysis.html#cb1246-16" aria-hidden="true" tabindex="-1"></a>base_survey_design_cluster <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span>village_name, <span class="co"># ids de cluster</span></span>
<span id="cb1246-17"><a href="survey_analysis.html#cb1246-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="sc">~</span>surv_weight_cluster, <span class="co"># variable de poids créée ci-dessus</span></span>
<span id="cb1246-18"><a href="survey_analysis.html#cb1246-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="cn">NULL</span>, <span class="co"># l&#39;échantillonnage était simple (pas de strates)</span></span>
<span id="cb1246-19"><a href="survey_analysis.html#cb1246-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> survey_data <span class="co"># il faut spécifier l&#39;ensemble de données</span></span>
<span id="cb1246-20"><a href="survey_analysis.html#cb1246-20" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb1246-21"><a href="survey_analysis.html#cb1246-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1246-22"><a href="survey_analysis.html#cb1246-22" aria-hidden="true" tabindex="-1"></a><span class="co"># cluster stratifié ----------------------------------------------------------</span></span>
<span id="cb1246-23"><a href="survey_analysis.html#cb1246-23" aria-hidden="true" tabindex="-1"></a>base_survey_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span>village_name, <span class="co"># ids de cluster</span></span>
<span id="cb1246-24"><a href="survey_analysis.html#cb1246-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="sc">~</span>surv_weight_cluster_strata, <span class="co"># variable de poids créée ci-dessus</span></span>
<span id="cb1246-25"><a href="survey_analysis.html#cb1246-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="sc">~</span>health_district, <span class="co"># l&#39;échantillonnage a été stratifié par district</span></span>
<span id="cb1246-26"><a href="survey_analysis.html#cb1246-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> survey_data <span class="co"># doit spécifier l&#39;ensemble de données</span></span>
<span id="cb1246-27"><a href="survey_analysis.html#cb1246-27" aria-hidden="true" tabindex="-1"></a>                  )</span></code></pre></div>
</div>
<div id="paquet-srvyr" class="section level3" number="25.6.2">
<h3><span class="header-section-number">25.6.2</span> Paquet **Srvyr</h3>
<p>Avec le paquet <strong>srvyr</strong>, nous pouvons utiliser la fonction <code>as_survey_design()</code>, qui a les mêmes arguments que ci-dessus, mais autorise les tubes (<code>%&gt;%</code>), et nous n’avons donc pas besoin d’utiliser le tilde (<code>%&gt;%</code>).</p>
<div class="sourceCode" id="cb1247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1247-1"><a href="survey_analysis.html#cb1247-1" aria-hidden="true" tabindex="-1"></a><span class="do">## aléatoire simple ---------------------------------------------------------------</span></span>
<span id="cb1247-2"><a href="survey_analysis.html#cb1247-2" aria-hidden="true" tabindex="-1"></a>survey_design_simple <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1247-3"><a href="survey_analysis.html#cb1247-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> <span class="dv">1</span>, <span class="co"># 1 pour aucun id de grappe </span></span>
<span id="cb1247-4"><a href="survey_analysis.html#cb1247-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="cn">NULL</span>, <span class="co"># Aucun poids ajouté</span></span>
<span id="cb1247-5"><a href="survey_analysis.html#cb1247-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="cn">NULL</span> <span class="co"># l&#39;échantillonnage était simple (pas de strates)</span></span>
<span id="cb1247-6"><a href="survey_analysis.html#cb1247-6" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb1247-7"><a href="survey_analysis.html#cb1247-7" aria-hidden="true" tabindex="-1"></a><span class="do">## stratified ------------------------------------------------------------------</span></span>
<span id="cb1247-8"><a href="survey_analysis.html#cb1247-8" aria-hidden="true" tabindex="-1"></a>survey_design_strata <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1247-9"><a href="survey_analysis.html#cb1247-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> <span class="dv">1</span>, <span class="co"># 1 pour aucun id de cluster</span></span>
<span id="cb1247-10"><a href="survey_analysis.html#cb1247-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> surv_weight_strata, <span class="co"># variable de poids créée ci-dessus</span></span>
<span id="cb1247-11"><a href="survey_analysis.html#cb1247-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> health_district <span class="co"># l&#39;échantillonnage a été stratifié par district</span></span>
<span id="cb1247-12"><a href="survey_analysis.html#cb1247-12" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb1247-13"><a href="survey_analysis.html#cb1247-13" aria-hidden="true" tabindex="-1"></a><span class="do">## cluster ---------------------------------------------------------------------</span></span>
<span id="cb1247-14"><a href="survey_analysis.html#cb1247-14" aria-hidden="true" tabindex="-1"></a>survey_design_cluster <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1247-15"><a href="survey_analysis.html#cb1247-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> village_name, <span class="co"># ids de la grappe</span></span>
<span id="cb1247-16"><a href="survey_analysis.html#cb1247-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> surv_weight_cluster, <span class="co"># variable de poids créée ci-dessus</span></span>
<span id="cb1247-17"><a href="survey_analysis.html#cb1247-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="cn">NULL</span> <span class="co"># l&#39;échantillonnage était simple (pas de strates)</span></span>
<span id="cb1247-18"><a href="survey_analysis.html#cb1247-18" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb1247-19"><a href="survey_analysis.html#cb1247-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1247-20"><a href="survey_analysis.html#cb1247-20" aria-hidden="true" tabindex="-1"></a><span class="do">## cluster stratifié ----------------------------------------------------------</span></span>
<span id="cb1247-21"><a href="survey_analysis.html#cb1247-21" aria-hidden="true" tabindex="-1"></a>survey_design <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1247-22"><a href="survey_analysis.html#cb1247-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> village_name, <span class="co"># ids de la grappe</span></span>
<span id="cb1247-23"><a href="survey_analysis.html#cb1247-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> surv_weight_cluster_strata, <span class="co"># variable de poids créée ci-dessus</span></span>
<span id="cb1247-24"><a href="survey_analysis.html#cb1247-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> health_district <span class="co"># l&#39;échantillonnage a été stratifié par district</span></span>
<span id="cb1247-25"><a href="survey_analysis.html#cb1247-25" aria-hidden="true" tabindex="-1"></a>                  )</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="analyse-descriptive-1" class="section level2" number="25.7">
<h2><span class="header-section-number">25.7</span> Analyse descriptive</h2>
<p>L’analyse descriptive et la visualisation de base sont traitées en détail dans d’autres chapitres du manuel, nous ne nous y attarderons donc pas ici. Pour plus de détails, voir les chapitres sur les <a href="descriptive_tables.html#descriptive_tables">tableaux descriptifs</a>, <a href="stats_test.html#stats_test">les tests statistiques</a>, <a href="tables_presentation.html#tables_presentation">les tableaux de présentation</a>, [les bases du ggplot] (#ggplot_basics) et <a href="rmarkdown.html#rmarkdown">rapports R markdown</a>.</p>
<p>Dans cette section, nous allons nous concentrer sur la manière d’étudier le biais dans votre échantillon et de le visualiser. Nous nous pencherons également sur la visualisation du flux de population dans le cadre d’une enquête à l’aide de diagrammes alluviaux/sankey.</p>
<p>En général, vous devriez envisager d’inclure les analyses descriptives suivantes :</p>
<ul>
<li>Le nombre final de grappes, de ménages et d’individus inclus.<br />
</li>
<li>Nombre d’individus exclus et les raisons de cette exclusion</li>
<li>Nombre médian (fourchette) de ménages par grappe et d’individus par ménage.</li>
</ul>
<div id="biais-déchantillonnage" class="section level3" number="25.7.1">
<h3><span class="header-section-number">25.7.1</span> Biais d’échantillonnage</h3>
<p>Comparez les proportions dans chaque groupe d’âge entre votre échantillon et la population source. Ceci est important pour pouvoir mettre en évidence un éventuel biais d’échantillonnage. Vous pouvez également répéter cette opération en examinant les distributions par sexe.</p>
<p>Notez que ces p-values ne sont qu’indicatives, et qu’une discussion descriptive (ou une visualisation avec les pyramides d’âge ci-dessous) des distributions dans votre échantillon d’étude par rapport à la population source est plus importante que le test binomial lui-même. Cela est dû au fait que l’augmentation de la taille de l’échantillon conduira le plus souvent à des différences qui peuvent ne pas être pertinentes après la pondération de vos données.</p>
<div class="sourceCode" id="cb1248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1248-1"><a href="survey_analysis.html#cb1248-1" aria-hidden="true" tabindex="-1"></a><span class="do">## dénombrements et saillies de la population étudiée.</span></span>
<span id="cb1248-2"><a href="survey_analysis.html#cb1248-2" aria-hidden="true" tabindex="-1"></a>ag <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1248-3"><a href="survey_analysis.html#cb1248-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb1248-4"><a href="survey_analysis.html#cb1248-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb1248-5"><a href="survey_analysis.html#cb1248-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1248-6"><a href="survey_analysis.html#cb1248-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n), </span>
<span id="cb1248-7"><a href="survey_analysis.html#cb1248-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_total =</span> <span class="fu">sum</span>(n))</span>
<span id="cb1248-8"><a href="survey_analysis.html#cb1248-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1248-9"><a href="survey_analysis.html#cb1248-9" aria-hidden="true" tabindex="-1"></a><span class="do">## comptes et props de la population source</span></span>
<span id="cb1248-10"><a href="survey_analysis.html#cb1248-10" aria-hidden="true" tabindex="-1"></a>propcount <span class="ot">&lt;-</span> population <span class="sc">%&gt;%</span> </span>
<span id="cb1248-11"><a href="survey_analysis.html#cb1248-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb1248-12"><a href="survey_analysis.html#cb1248-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tally</span>(population) <span class="sc">%&gt;%</span></span>
<span id="cb1248-13"><a href="survey_analysis.html#cb1248-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb1248-14"><a href="survey_analysis.html#cb1248-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1248-15"><a href="survey_analysis.html#cb1248-15" aria-hidden="true" tabindex="-1"></a><span class="do">## lier ensemble les colonnes de deux tables, regrouper par âge, et effectuer un </span></span>
<span id="cb1248-16"><a href="survey_analysis.html#cb1248-16" aria-hidden="true" tabindex="-1"></a><span class="do">## un test binomial pour voir si n/total est significativement différent de la population</span></span>
<span id="cb1248-17"><a href="survey_analysis.html#cb1248-17" aria-hidden="true" tabindex="-1"></a><span class="do">## proportion.</span></span>
<span id="cb1248-18"><a href="survey_analysis.html#cb1248-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Le suffixe ajoute ici du texte à la fin des colonnes dans chacun des deux ensembles de données.</span></span>
<span id="cb1248-19"><a href="survey_analysis.html#cb1248-19" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(ag, propcount, <span class="at">by =</span> <span class="st">&quot;age_group&quot;</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_pop&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1248-20"><a href="survey_analysis.html#cb1248-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb1248-21"><a href="survey_analysis.html#cb1248-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">## broom::tidy(binom.test()) crée une trame de données à partir du test binomial et ## ajoutera les variables p.p. à la trame de données.</span></span>
<span id="cb1248-22"><a href="survey_analysis.html#cb1248-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## ajoutera les variables p.value, parameter, conf.low, conf.high, method, and</span></span>
<span id="cb1248-23"><a href="survey_analysis.html#cb1248-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## alternative. Nous n&#39;utiliserons que p.value ici. Vous pouvez inclure d&#39;autres</span></span>
<span id="cb1248-24"><a href="survey_analysis.html#cb1248-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## d&#39;autres colonnes si vous souhaitez faire état des intervalles de confiance.</span></span>
<span id="cb1248-25"><a href="survey_analysis.html#cb1248-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">binom =</span> <span class="fu">list</span>(broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="fu">binom.test</span>(n, n_total, proportion_pop)))) <span class="sc">%&gt;%</span></span>
<span id="cb1248-26"><a href="survey_analysis.html#cb1248-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(binom)) <span class="sc">%&gt;%</span> <span class="co"># important pour l&#39;expansion du cadre de données binom.test</span></span>
<span id="cb1248-27"><a href="survey_analysis.html#cb1248-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion_pop =</span> proportion_pop <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1248-28"><a href="survey_analysis.html#cb1248-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Ajustement des valeurs de p pour corriger les faux positifs. </span></span>
<span id="cb1248-29"><a href="survey_analysis.html#cb1248-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (parce que l&#39;on teste plusieurs groupes d&#39;âge). Cela ne fera une </span></span>
<span id="cb1248-30"><a href="survey_analysis.html#cb1248-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## une différence que si vous avez plusieurs catégories d&#39;âge</span></span>
<span id="cb1248-31"><a href="survey_analysis.html#cb1248-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p.value =</span> <span class="fu">p.adjust</span>(p.value, <span class="at">method =</span> <span class="st">&quot;holm&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1248-32"><a href="survey_analysis.html#cb1248-32" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb1248-33"><a href="survey_analysis.html#cb1248-33" aria-hidden="true" tabindex="-1"></a>  <span class="do">## N&#39;affichez que les valeurs de p supérieures à 0,001 (celles qui sont inférieures sont signalées comme &lt;0,001)</span></span>
<span id="cb1248-34"><a href="survey_analysis.html#cb1248-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p.value =</span> <span class="fu">ifelse</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.001</span>, </span>
<span id="cb1248-35"><a href="survey_analysis.html#cb1248-35" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;&lt;0.001&quot;</span>, </span>
<span id="cb1248-36"><a href="survey_analysis.html#cb1248-36" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">as.character</span>(<span class="fu">round</span>(p.value, <span class="dv">3</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1248-37"><a href="survey_analysis.html#cb1248-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1248-38"><a href="survey_analysis.html#cb1248-38" aria-hidden="true" tabindex="-1"></a>  <span class="do">## renommez les colonnes de manière appropriée</span></span>
<span id="cb1248-39"><a href="survey_analysis.html#cb1248-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb1248-40"><a href="survey_analysis.html#cb1248-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Groupe d&#39;âge&quot;</span> <span class="ot">=</span> age_group,</span>
<span id="cb1248-41"><a href="survey_analysis.html#cb1248-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Population étudiée (n)&quot;</span> <span class="ot">=</span> n,</span>
<span id="cb1248-42"><a href="survey_analysis.html#cb1248-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Population étudiée (%)&quot;</span> <span class="ot">=</span> proportion,</span>
<span id="cb1248-43"><a href="survey_analysis.html#cb1248-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Population source (n)&quot;</span> <span class="ot">=</span> n_pop,</span>
<span id="cb1248-44"><a href="survey_analysis.html#cb1248-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Population source (%)&quot;</span> <span class="ot">=</span> proportion_pop,</span>
<span id="cb1248-45"><a href="survey_analysis.html#cb1248-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;P-value&quot;</span> <span class="ot">=</span> p.value</span>
<span id="cb1248-46"><a href="survey_analysis.html#cb1248-46" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
## # Groups:   Groupe d&#39;âge [5]
##   `Groupe d&#39;âge` `Population étudiée (n)` `Population étudiée (%)` `Population source (n)` `Population source (%)` `P-value`
##   &lt;chr&gt;                             &lt;int&gt;                    &lt;dbl&gt;                   &lt;dbl&gt;                   &lt;dbl&gt; &lt;chr&gt;    
## 1 0-2                                  12                   0.0256                    1360                     6.8 &lt;0.001   
## 2 3-14                                 42                   0.0896                    7244                    36.2 &lt;0.001   
## 3 15-29                                64                   0.136                     5520                    27.6 &lt;0.001   
## 4 30-44                                52                   0.111                     3232                    16.2 0.002    
## 5 45+                                 299                   0.638                     2644                    13.2 &lt;0.001</code></pre>
</div>
<div id="pyramides-démographiques" class="section level3" number="25.7.2">
<h3><span class="header-section-number">25.7.2</span> Pyramides démographiques</h3>
<p>Les pyramides démographiques (ou âge-sexe) sont un moyen facile de visualiser la distribution dans la population de votre enquête. Il est également intéressant de créer des <a href="descriptive_tables.html#descriptive_tables">tableaux descriptifs</a> et le sexe par strates d’enquête. Nous allons démontrer l’utilisation du paquet <strong>apyramide</strong> car il permet de pondérées en utilisant notre objet de conception d’enquête créé ci-dessus. Autres options pour créer <a href="age_pyramid.html#age_pyramid">pyramides démographiques</a> sont traitées en détail dans ce chapitre du manuel. Nous utiliserons également une fonction wrapper de <strong>apyramid</strong> appelée <code>age_pyramid()</code> qui permet de gagner quelque lignes de code pour produire un graphique avec des proportions.</p>
<p>Comme pour le test binomial formel de différence, vu plus haut dans la section sur le biais d’échantillonnage, nous sommes intéressés ici à visualiser si notre population échantillonnée est sensiblement différente de la population source et si la pondération corrige cette différence. Pour ce faire, nous allons utiliser le paquet <strong>patchwork</strong> pour montrer nos visualisations <strong>ggplot</strong> côte à côte ; pour plus de détails, voir la section sur la combinaison de tracés dans le chapitre du manuel <a href="ggplot_tips.html#ggplot_tips">Astuces de ggplot</a> du manuel. Nous allons visualiser notre population source, notre population d’enquête non pondérée et notre population d’enquête pondérée. Vous pouvez également envisager de visualiser chaque strate de votre enquête, pars exemple ici, en utilisant l’argument <code>stack_by = "health_district"</code> (voir <code>?plot_age_pyramid</code> pour plus de détails).</p>
<p><span style="color : black ;"><strong><em>NOTE:</em></strong> Les axes x et y sont inversés dans les pyramides </span>.</p>
<div class="sourceCode" id="cb1250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1250-1"><a href="survey_analysis.html#cb1250-1" aria-hidden="true" tabindex="-1"></a><span class="do">## définir les limites et les étiquettes de l&#39;axe des x ---------------------------------------------</span></span>
<span id="cb1250-2"><a href="survey_analysis.html#cb1250-2" aria-hidden="true" tabindex="-1"></a><span class="do">## (mettez à jour ces chiffres pour qu&#39;ils correspondent aux valeurs de votre graphique)</span></span>
<span id="cb1250-3"><a href="survey_analysis.html#cb1250-3" aria-hidden="true" tabindex="-1"></a>max_prop <span class="ot">&lt;-</span> <span class="dv">35</span> <span class="do">## choisissez la plus haute proportion que vous voulez montrer </span></span>
<span id="cb1250-4"><a href="survey_analysis.html#cb1250-4" aria-hidden="true" tabindex="-1"></a>step <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="co"># choisissez l&#39;espace que vous voulez entre les étiquettes. </span></span>
<span id="cb1250-5"><a href="survey_analysis.html#cb1250-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1250-6"><a href="survey_analysis.html#cb1250-6" aria-hidden="true" tabindex="-1"></a><span class="do">## cette partie définit le vecteur en utilisant les nombres ci-dessus avec des ruptures d&#39;axe.</span></span>
<span id="cb1250-7"><a href="survey_analysis.html#cb1250-7" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1250-8"><a href="survey_analysis.html#cb1250-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(max_prop<span class="sc">/</span><span class="dv">100</span> <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span> <span class="sc">-</span> step<span class="sc">/</span><span class="dv">100</span>, step<span class="sc">/</span><span class="dv">100</span>), </span>
<span id="cb1250-9"><a href="survey_analysis.html#cb1250-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, </span>
<span id="cb1250-10"><a href="survey_analysis.html#cb1250-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="dv">0</span> <span class="sc">+</span> step <span class="sc">/</span> <span class="dv">100</span>, max_prop<span class="sc">/</span><span class="dv">100</span>, step<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb1250-11"><a href="survey_analysis.html#cb1250-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1250-12"><a href="survey_analysis.html#cb1250-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1250-13"><a href="survey_analysis.html#cb1250-13" aria-hidden="true" tabindex="-1"></a><span class="do">## cette partie définit le vecteur en utilisant les nombres ci-dessus avec les limites de l&#39;axe</span></span>
<span id="cb1250-14"><a href="survey_analysis.html#cb1250-14" aria-hidden="true" tabindex="-1"></a>limits <span class="ot">&lt;-</span> <span class="fu">c</span>(max_prop<span class="sc">/</span><span class="dv">100</span> <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span>, max_prop<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb1250-15"><a href="survey_analysis.html#cb1250-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1250-16"><a href="survey_analysis.html#cb1250-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Cette partie définit le vecteur en utilisant les nombres ci-dessus avec les étiquettes d&#39;axe.</span></span>
<span id="cb1250-17"><a href="survey_analysis.html#cb1250-17" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1250-18"><a href="survey_analysis.html#cb1250-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">seq</span>(max_prop, step, <span class="sc">-</span>step), </span>
<span id="cb1250-19"><a href="survey_analysis.html#cb1250-19" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span>, </span>
<span id="cb1250-20"><a href="survey_analysis.html#cb1250-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">seq</span>(step, max_prop, step)</span>
<span id="cb1250-21"><a href="survey_analysis.html#cb1250-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1250-22"><a href="survey_analysis.html#cb1250-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1250-23"><a href="survey_analysis.html#cb1250-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1250-24"><a href="survey_analysis.html#cb1250-24" aria-hidden="true" tabindex="-1"></a><span class="do">## créer des graphiques individuellement --------------------------------------------------</span></span>
<span id="cb1250-25"><a href="survey_analysis.html#cb1250-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1250-26"><a href="survey_analysis.html#cb1250-26" aria-hidden="true" tabindex="-1"></a><span class="do">## tracer la population source </span></span>
<span id="cb1250-27"><a href="survey_analysis.html#cb1250-27" aria-hidden="true" tabindex="-1"></a><span class="do">## nb : cette population doit être réduite à la population globale (c&#39;est-à-dire en enlevant les districts de santé).</span></span>
<span id="cb1250-28"><a href="survey_analysis.html#cb1250-28" aria-hidden="true" tabindex="-1"></a>source_population <span class="ot">&lt;-</span> population <span class="sc">%&gt;%</span></span>
<span id="cb1250-29"><a href="survey_analysis.html#cb1250-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## s&#39;assurer que l&#39;âge et le sexe sont des facteurs</span></span>
<span id="cb1250-30"><a href="survey_analysis.html#cb1250-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">factor</span>(age_group, </span>
<span id="cb1250-31"><a href="survey_analysis.html#cb1250-31" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;0-2&quot;</span>, </span>
<span id="cb1250-32"><a href="survey_analysis.html#cb1250-32" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">&quot;3-14&quot;</span>, </span>
<span id="cb1250-33"><a href="survey_analysis.html#cb1250-33" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">&quot;15-29&quot;</span>,</span>
<span id="cb1250-34"><a href="survey_analysis.html#cb1250-34" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">&quot;30-44&quot;</span>, </span>
<span id="cb1250-35"><a href="survey_analysis.html#cb1250-35" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">&quot;45+&quot;</span>)), </span>
<span id="cb1250-36"><a href="survey_analysis.html#cb1250-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="fu">factor</span>(sex)) <span class="sc">%&gt;%</span> </span>
<span id="cb1250-37"><a href="survey_analysis.html#cb1250-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb1250-38"><a href="survey_analysis.html#cb1250-38" aria-hidden="true" tabindex="-1"></a>  <span class="do">## additionner les comptes pour chaque district de santé </span></span>
<span id="cb1250-39"><a href="survey_analysis.html#cb1250-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">population =</span> <span class="fu">sum</span>(population)) <span class="sc">%&gt;%</span> </span>
<span id="cb1250-40"><a href="survey_analysis.html#cb1250-40" aria-hidden="true" tabindex="-1"></a>  <span class="do">## supprimer le regroupement pour pouvoir calculer la proportion globale</span></span>
<span id="cb1250-41"><a href="survey_analysis.html#cb1250-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1250-42"><a href="survey_analysis.html#cb1250-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> population <span class="sc">/</span> <span class="fu">sum</span>(population)) <span class="sc">%&gt;%</span> </span>
<span id="cb1250-43"><a href="survey_analysis.html#cb1250-43" aria-hidden="true" tabindex="-1"></a>  <span class="do">## tracer la pyramide </span></span>
<span id="cb1250-44"><a href="survey_analysis.html#cb1250-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">age_pyramid</span>(</span>
<span id="cb1250-45"><a href="survey_analysis.html#cb1250-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">age_group =</span> age_group, </span>
<span id="cb1250-46"><a href="survey_analysis.html#cb1250-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">split_by =</span> sex, </span>
<span id="cb1250-47"><a href="survey_analysis.html#cb1250-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">count =</span> proportion, </span>
<span id="cb1250-48"><a href="survey_analysis.html#cb1250-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">proportional =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb1250-49"><a href="survey_analysis.html#cb1250-49" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Afficher uniquement le libellé de l&#39;axe des y (sinon répété dans les trois graphiques)</span></span>
<span id="cb1250-50"><a href="survey_analysis.html#cb1250-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Population source&quot;</span>, </span>
<span id="cb1250-51"><a href="survey_analysis.html#cb1250-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb1250-52"><a href="survey_analysis.html#cb1250-52" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Groupe d&#39;âge (années)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1250-53"><a href="survey_analysis.html#cb1250-53" aria-hidden="true" tabindex="-1"></a>  <span class="do">## rendre l&#39;axe des x identique pour tous les graphiques </span></span>
<span id="cb1250-54"><a href="survey_analysis.html#cb1250-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> breaks, </span>
<span id="cb1250-55"><a href="survey_analysis.html#cb1250-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> limits, </span>
<span id="cb1250-56"><a href="survey_analysis.html#cb1250-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> labels)</span>
<span id="cb1250-57"><a href="survey_analysis.html#cb1250-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1250-58"><a href="survey_analysis.html#cb1250-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1250-59"><a href="survey_analysis.html#cb1250-59" aria-hidden="true" tabindex="-1"></a><span class="do">## Tracez l&#39;échantillon de population non pondéré </span></span>
<span id="cb1250-60"><a href="survey_analysis.html#cb1250-60" aria-hidden="true" tabindex="-1"></a>sample_population <span class="ot">&lt;-</span> <span class="fu">age_pyramid</span>(survey_data, </span>
<span id="cb1250-61"><a href="survey_analysis.html#cb1250-61" aria-hidden="true" tabindex="-1"></a>                 <span class="at">age_group =</span> <span class="st">&quot;age_group&quot;</span>, </span>
<span id="cb1250-62"><a href="survey_analysis.html#cb1250-62" aria-hidden="true" tabindex="-1"></a>                 <span class="at">split_by =</span> <span class="st">&quot;sex&quot;</span>,</span>
<span id="cb1250-63"><a href="survey_analysis.html#cb1250-63" aria-hidden="true" tabindex="-1"></a>                 <span class="at">proportion =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb1250-64"><a href="survey_analysis.html#cb1250-64" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Afficher uniquement le libellé de l&#39;axe des x (sinon répété dans les trois graphiques)</span></span>
<span id="cb1250-65"><a href="survey_analysis.html#cb1250-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Population échantillon non pondérée&quot;</span>, </span>
<span id="cb1250-66"><a href="survey_analysis.html#cb1250-66" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Proportion (%)&quot;</span>, </span>
<span id="cb1250-67"><a href="survey_analysis.html#cb1250-67" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1250-68"><a href="survey_analysis.html#cb1250-68" aria-hidden="true" tabindex="-1"></a>  <span class="do">## rendre l&#39;axe des x identique pour tous les graphiques </span></span>
<span id="cb1250-69"><a href="survey_analysis.html#cb1250-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> breaks, </span>
<span id="cb1250-70"><a href="survey_analysis.html#cb1250-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> limits, </span>
<span id="cb1250-71"><a href="survey_analysis.html#cb1250-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> labels)</span>
<span id="cb1250-72"><a href="survey_analysis.html#cb1250-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1250-73"><a href="survey_analysis.html#cb1250-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1250-74"><a href="survey_analysis.html#cb1250-74" aria-hidden="true" tabindex="-1"></a><span class="do">## tracer la population de l&#39;échantillon pondéré </span></span>
<span id="cb1250-75"><a href="survey_analysis.html#cb1250-75" aria-hidden="true" tabindex="-1"></a>weighted_population <span class="ot">&lt;-</span> survey_design <span class="sc">%&gt;%</span> </span>
<span id="cb1250-76"><a href="survey_analysis.html#cb1250-76" aria-hidden="true" tabindex="-1"></a>  <span class="do">## S&#39;assurer que les variables sont des facteurs</span></span>
<span id="cb1250-77"><a href="survey_analysis.html#cb1250-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">factor</span>(age_group), </span>
<span id="cb1250-78"><a href="survey_analysis.html#cb1250-78" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="fu">factor</span>(sex)) <span class="sc">%&gt;%</span></span>
<span id="cb1250-79"><a href="survey_analysis.html#cb1250-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">age_pyramid</span>(</span>
<span id="cb1250-80"><a href="survey_analysis.html#cb1250-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="st">&quot;age_group&quot;</span>,</span>
<span id="cb1250-81"><a href="survey_analysis.html#cb1250-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">split_by =</span> <span class="st">&quot;sex&quot;</span>, </span>
<span id="cb1250-82"><a href="survey_analysis.html#cb1250-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">proportion =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb1250-83"><a href="survey_analysis.html#cb1250-83" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Afficher uniquement le libellé de l&#39;axe des x (sinon répété dans les trois graphiques)</span></span>
<span id="cb1250-84"><a href="survey_analysis.html#cb1250-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Echantillon de population pondéré&quot;</span>, </span>
<span id="cb1250-85"><a href="survey_analysis.html#cb1250-85" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb1250-86"><a href="survey_analysis.html#cb1250-86" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1250-87"><a href="survey_analysis.html#cb1250-87" aria-hidden="true" tabindex="-1"></a>  <span class="do">## rendre l&#39;axe des x identique pour tous les graphiques </span></span>
<span id="cb1250-88"><a href="survey_analysis.html#cb1250-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> breaks, </span>
<span id="cb1250-89"><a href="survey_analysis.html#cb1250-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> limits, </span>
<span id="cb1250-90"><a href="survey_analysis.html#cb1250-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> labels)</span>
<span id="cb1250-91"><a href="survey_analysis.html#cb1250-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1250-92"><a href="survey_analysis.html#cb1250-92" aria-hidden="true" tabindex="-1"></a><span class="do">## combine les trois tracés ----------------------------------------------------</span></span>
<span id="cb1250-93"><a href="survey_analysis.html#cb1250-93" aria-hidden="true" tabindex="-1"></a><span class="do">## Combinez trois tracés côte à côte en utilisant + </span></span>
<span id="cb1250-94"><a href="survey_analysis.html#cb1250-94" aria-hidden="true" tabindex="-1"></a>source_population <span class="sc">+</span> sample_population <span class="sc">+</span> weighted_population <span class="sc">+</span> </span>
<span id="cb1250-95"><a href="survey_analysis.html#cb1250-95" aria-hidden="true" tabindex="-1"></a>  <span class="do">## ne montrer qu&#39;une seule légende et définir le thème </span></span>
<span id="cb1250-96"><a href="survey_analysis.html#cb1250-96" aria-hidden="true" tabindex="-1"></a>  <span class="do">## notez l&#39;utilisation de &amp; pour combiner le thème avec plot_layout()</span></span>
<span id="cb1250-97"><a href="survey_analysis.html#cb1250-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span> </span>
<span id="cb1250-98"><a href="survey_analysis.html#cb1250-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="co"># déplace la légende vers le bas</span></span>
<span id="cb1250-99"><a href="survey_analysis.html#cb1250-99" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(), <span class="co"># supprimer le titre</span></span>
<span id="cb1250-100"><a href="survey_analysis.html#cb1250-100" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>), <span class="co"># change la taille du texte</span></span>
<span id="cb1250-101"><a href="survey_analysis.html#cb1250-101" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>) <span class="co"># tourner le texte de l&#39;axe x</span></span>
<span id="cb1250-102"><a href="survey_analysis.html#cb1250-102" aria-hidden="true" tabindex="-1"></a>       )</span></code></pre></div>
<p><img src="_main_files/figure-html/weighted_age_pyramid-1.png" width="1440" /></p>
</div>
<div id="diagramme-alluvialsankey" class="section level3" number="25.7.3">
<h3><span class="header-section-number">25.7.3</span> Diagramme alluvial/sankey</h3>
<p>La visualisation des points de départ et des résultats pour les individus peut être très utile pour obtenir une vue d’ensemble. L’application est évidente pour les populations mobiles, mais il existe de nombreuses autres applications telles que les cohortes ou toute autre situation
où il y a des transitions d’états pour les individus. Ces diagrammes ont plusieurs noms différents, y compris alluvial, sankey et ensembles parallèles - les détails sont dans le chapitre du manuel consacré aux <a href="diagrams.html#diagrams">diagrammes et graphiques</a>.</p>
<div class="sourceCode" id="cb1251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1251-1"><a href="survey_analysis.html#cb1251-1" aria-hidden="true" tabindex="-1"></a><span class="do">## résumer les données</span></span>
<span id="cb1251-2"><a href="survey_analysis.html#cb1251-2" aria-hidden="true" tabindex="-1"></a>flow_table <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1251-3"><a href="survey_analysis.html#cb1251-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(startcause, endcause, sex) <span class="sc">%&gt;%</span> <span class="co"># obtenir des comptages </span></span>
<span id="cb1251-4"><a href="survey_analysis.html#cb1251-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather_set_data</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;startcause&quot;</span>, <span class="st">&quot;endcause&quot;</span>)) <span class="co"># changer de format pour le tracé</span></span>
<span id="cb1251-5"><a href="survey_analysis.html#cb1251-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1251-6"><a href="survey_analysis.html#cb1251-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1251-7"><a href="survey_analysis.html#cb1251-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1251-8"><a href="survey_analysis.html#cb1251-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Tracez votre ensemble de données </span></span>
<span id="cb1251-9"><a href="survey_analysis.html#cb1251-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## sur l&#39;axe des x, les causes de début et de fin.</span></span>
<span id="cb1251-10"><a href="survey_analysis.html#cb1251-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## gather_set_data génère un ID pour chaque combinaison possible.</span></span>
<span id="cb1251-11"><a href="survey_analysis.html#cb1251-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## La division par y donne les combinaisons possibles de début et de fin.</span></span>
<span id="cb1251-12"><a href="survey_analysis.html#cb1251-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## la valeur n donne les comptes (peut aussi être changée en proportion).</span></span>
<span id="cb1251-13"><a href="survey_analysis.html#cb1251-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flow_table, <span class="fu">aes</span>(x, <span class="at">id =</span> id, <span class="at">split =</span> y, <span class="at">value =</span> n)) <span class="sc">+</span></span>
<span id="cb1251-14"><a href="survey_analysis.html#cb1251-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## colorer les lignes par sexe </span></span>
<span id="cb1251-15"><a href="survey_analysis.html#cb1251-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_parallel_sets</span>(<span class="fu">aes</span>(<span class="at">fill =</span> sex), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">axis.width =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="do">### remplir les cases d&#39;étiquettes en gris.</span></span>
<span id="cb1251-16"><a href="survey_analysis.html#cb1251-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## remplir les cases d&#39;étiquettes en gris</span></span>
<span id="cb1251-17"><a href="survey_analysis.html#cb1251-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_parallel_sets_axes</span>(<span class="at">axis.width =</span> <span class="fl">0.15</span>, <span class="at">fill =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>) <span class="sc">+</span> <span class="do">## changer la couleur du texte et l&#39;angle de l&#39;étiquette.</span></span>
<span id="cb1251-18"><a href="survey_analysis.html#cb1251-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## changer la couleur et l&#39;angle du texte (doit être ajusté)</span></span>
<span id="cb1251-19"><a href="survey_analysis.html#cb1251-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_parallel_sets_labels</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="do">## ajuster la couleur et l&#39;angle du texte (doit être ajusté)</span></span>
<span id="cb1251-20"><a href="survey_analysis.html#cb1251-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## suppression des étiquettes d&#39;axe</span></span>
<span id="cb1251-21"><a href="survey_analysis.html#cb1251-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb1251-22"><a href="survey_analysis.html#cb1251-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/visualise_population_flow-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
</div>
<div id="proportions-pondérées" class="section level2" number="25.8">
<h2><span class="header-section-number">25.8</span> Proportions pondérées</h2>
<p>Cette section détaillera comment produire des tableaux pour les effectifs et les proportions pondérés, avec les intervalles de confiance associés et l’effet de plan. Il existe quatre options différentes utilisant les fonctions des paquets suivants : <strong>survey</strong>, <strong>srvyr</strong>, <strong>sitrep</strong> et <strong>gtsummary</strong>. Pour un codage minimal permettant de produire un tableau standard de style épidémiologique, nous recommandons la fonction <strong>sitrep</strong> - qui est un wrapper pour le code <strong>srvyr</strong> ; notez cependant que ce n’est pas encore sur CRAN et que cela peut changer dans le futur. Autrement, le code <strong>survey</strong> est susceptible d’être le plus stable à long terme, alors que <strong>srvyr</strong> s’intégrera le mieux dans les flux de travail de tidyverse. Bien que les fonctions <strong>gtsummary</strong> ont beaucoup de potentiel, elles semblent expérimentales et incomplètes au moment de la rédaction.</p>
<div id="paquet-survey-1" class="section level3" number="25.8.1">
<h3><span class="header-section-number">25.8.1</span> Paquet **Survey</h3>
<p>Nous pouvons utiliser la fonction <code>svyciprop()</code> de <strong>survey</strong> pour obtenir des proportions pondérées et les intervalles de confiance à 95% qui les accompagnent. Il est intéressant de noter que <code>svyprop()</code> ne semble accepter que les variables comprises entre 0 et 1 (ou VRAI/FAUX), donc les variables catégorielles ne fonctionneront pas.</p>
<p><span style="color : black ;"><strong><em>NOTE:</em></strong> Les fonctions de <strong>survey</strong> acceptent également les objets de conception <strong>srvyr</strong>, mais ici nous avons utilisé l’objet de conception <strong>survey</strong> juste pour la cohérence </span>.</p>
<div class="sourceCode" id="cb1252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1252-1"><a href="survey_analysis.html#cb1252-1" aria-hidden="true" tabindex="-1"></a><span class="do">## produire des comptes pondérés </span></span>
<span id="cb1252-2"><a href="survey_analysis.html#cb1252-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svytable</span>(<span class="sc">~</span>died, base_survey_design)</span></code></pre></div>
<pre><code>## died
##      FALSE       TRUE 
## 1406244.43   76213.01</code></pre>
<div class="sourceCode" id="cb1254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1254-1"><a href="survey_analysis.html#cb1254-1" aria-hidden="true" tabindex="-1"></a><span class="do">## produit des proportions pondérées</span></span>
<span id="cb1254-2"><a href="survey_analysis.html#cb1254-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svyciprop</span>(<span class="sc">~</span>died, base_survey_design, <span class="at">na.rm =</span> T)</span></code></pre></div>
<pre><code>##               2.5% 97.5%
## died 0.0514 0.0208  0.12</code></pre>
<div class="sourceCode" id="cb1256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1256-1"><a href="survey_analysis.html#cb1256-1" aria-hidden="true" tabindex="-1"></a><span class="do">## obtenir l&#39;effet du plan de sondage </span></span>
<span id="cb1256-2"><a href="survey_analysis.html#cb1256-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>died, base_survey_design, <span class="at">na.rm =</span> T, <span class="at">deff =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb1256-3"><a href="survey_analysis.html#cb1256-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">deff</span>()</span></code></pre></div>
<pre><code>## diedFALSE  diedTRUE 
##  3.755508  3.755508</code></pre>
<p>Nous pouvons combiner les fonctions de <strong>survey</strong> présentées ci-dessus en une fonction que nous définissons nous-mêmes ci-dessous, appelée <code>svy_prop</code> ; et nous pouvons alors utiliser cette fonction avec <code>map()</code> du paquetage purrr pour itérer sur plusieurs variables et créer un tableau. Voir le chapitre du manuel <a href="iteration.html#iteration">itération</a> pour plus de détails sur <strong>purrr</strong>.</p>
<div class="sourceCode" id="cb1258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1258-1"><a href="survey_analysis.html#cb1258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Définissez la fonction permettant de calculer les effectifs pondérés, les proportions, l&#39;IC et l&#39;effet de plan.</span></span>
<span id="cb1258-2"><a href="survey_analysis.html#cb1258-2" aria-hidden="true" tabindex="-1"></a><span class="co"># x est la variable entre guillemets </span></span>
<span id="cb1258-3"><a href="survey_analysis.html#cb1258-3" aria-hidden="true" tabindex="-1"></a><span class="co"># design est votre objet de conception d&#39;enquête</span></span>
<span id="cb1258-4"><a href="survey_analysis.html#cb1258-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1258-5"><a href="survey_analysis.html#cb1258-5" aria-hidden="true" tabindex="-1"></a>svy_prop <span class="ot">&lt;-</span> <span class="cf">function</span>(design, x) {</span>
<span id="cb1258-6"><a href="survey_analysis.html#cb1258-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1258-7"><a href="survey_analysis.html#cb1258-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## mettre la variable d&#39;intérêt dans une formule </span></span>
<span id="cb1258-8"><a href="survey_analysis.html#cb1258-8" aria-hidden="true" tabindex="-1"></a>  form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>( <span class="st">&quot;~&quot;</span> , x))</span>
<span id="cb1258-9"><a href="survey_analysis.html#cb1258-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## garder seulement la colonne VRAIE des comptes de svytable</span></span>
<span id="cb1258-10"><a href="survey_analysis.html#cb1258-10" aria-hidden="true" tabindex="-1"></a>  weighted_counts <span class="ot">&lt;-</span> <span class="fu">svytable</span>(form, design)[[<span class="dv">2</span>]]</span>
<span id="cb1258-11"><a href="survey_analysis.html#cb1258-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## calculer les proportions (multiplier par 100 pour obtenir des pourcentages).</span></span>
<span id="cb1258-12"><a href="survey_analysis.html#cb1258-12" aria-hidden="true" tabindex="-1"></a>  weighted_props <span class="ot">&lt;-</span> <span class="fu">svyciprop</span>(form, design, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb1258-13"><a href="survey_analysis.html#cb1258-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## extraire les intervalles de confiance et les multiplier pour obtenir des pourcentages.</span></span>
<span id="cb1258-14"><a href="survey_analysis.html#cb1258-14" aria-hidden="true" tabindex="-1"></a>  weighted_confint <span class="ot">&lt;-</span> <span class="fu">confint</span>(weighted_props) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb1258-15"><a href="survey_analysis.html#cb1258-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## utiliser svymean pour calculer l&#39;effet de plan et ne garder que la colonne TRUE.</span></span>
<span id="cb1258-16"><a href="survey_analysis.html#cb1258-16" aria-hidden="true" tabindex="-1"></a>  design_eff <span class="ot">&lt;-</span> <span class="fu">deff</span>(<span class="fu">svymean</span>(form, design, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">deff =</span> <span class="cn">TRUE</span>))[[<span class="cn">TRUE</span>]]</span>
<span id="cb1258-17"><a href="survey_analysis.html#cb1258-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1258-18"><a href="survey_analysis.html#cb1258-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## combiner en un seul cadre de données</span></span>
<span id="cb1258-19"><a href="survey_analysis.html#cb1258-19" aria-hidden="true" tabindex="-1"></a>  full_table <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb1258-20"><a href="survey_analysis.html#cb1258-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Variable&quot;</span> <span class="ot">=</span> x,</span>
<span id="cb1258-21"><a href="survey_analysis.html#cb1258-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Count&quot;</span> <span class="ot">=</span> weighted_counts,</span>
<span id="cb1258-22"><a href="survey_analysis.html#cb1258-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Proportion&quot;</span> <span class="ot">=</span> weighted_props,</span>
<span id="cb1258-23"><a href="survey_analysis.html#cb1258-23" aria-hidden="true" tabindex="-1"></a>    weighted_confint, </span>
<span id="cb1258-24"><a href="survey_analysis.html#cb1258-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Design effect&quot;</span> <span class="ot">=</span> design_eff</span>
<span id="cb1258-25"><a href="survey_analysis.html#cb1258-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1258-26"><a href="survey_analysis.html#cb1258-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1258-27"><a href="survey_analysis.html#cb1258-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Retourner le tableau sous forme de cadre de données</span></span>
<span id="cb1258-28"><a href="survey_analysis.html#cb1258-28" aria-hidden="true" tabindex="-1"></a>  full_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(full_table, </span>
<span id="cb1258-29"><a href="survey_analysis.html#cb1258-29" aria-hidden="true" tabindex="-1"></a>             <span class="do">## supprimer les noms de variables des lignes (c&#39;est une colonne séparée maintenant)</span></span>
<span id="cb1258-30"><a href="survey_analysis.html#cb1258-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb1258-31"><a href="survey_analysis.html#cb1258-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1258-32"><a href="survey_analysis.html#cb1258-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Remplacer les valeurs numériques par des valeurs numériques</span></span>
<span id="cb1258-33"><a href="survey_analysis.html#cb1258-33" aria-hidden="true" tabindex="-1"></a>  full_table[ , <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(full_table[ , <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb1258-34"><a href="survey_analysis.html#cb1258-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1258-35"><a href="survey_analysis.html#cb1258-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Retourner le cadre de données</span></span>
<span id="cb1258-36"><a href="survey_analysis.html#cb1258-36" aria-hidden="true" tabindex="-1"></a>  full_table</span>
<span id="cb1258-37"><a href="survey_analysis.html#cb1258-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1258-38"><a href="survey_analysis.html#cb1258-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1258-39"><a href="survey_analysis.html#cb1258-39" aria-hidden="true" tabindex="-1"></a><span class="do">## itérer sur plusieurs variables pour créer un tableau </span></span>
<span id="cb1258-40"><a href="survey_analysis.html#cb1258-40" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb1258-41"><a href="survey_analysis.html#cb1258-41" aria-hidden="true" tabindex="-1"></a>  <span class="do">## définir les variables d&#39;intérêt</span></span>
<span id="cb1258-42"><a href="survey_analysis.html#cb1258-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;died&quot;</span>, <span class="st">&quot;arrived&quot;</span>), </span>
<span id="cb1258-43"><a href="survey_analysis.html#cb1258-43" aria-hidden="true" tabindex="-1"></a>  <span class="do">## déclarer la fonction utilisée et les arguments pour cette fonction (design)</span></span>
<span id="cb1258-44"><a href="survey_analysis.html#cb1258-44" aria-hidden="true" tabindex="-1"></a>  svy_prop, <span class="at">design =</span> base_survey_design) <span class="sc">%&gt;%</span> </span>
<span id="cb1258-45"><a href="survey_analysis.html#cb1258-45" aria-hidden="true" tabindex="-1"></a>  <span class="do">## réduire la liste à un seul cadre de données</span></span>
<span id="cb1258-46"><a href="survey_analysis.html#cb1258-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1258-47"><a href="survey_analysis.html#cb1258-47" aria-hidden="true" tabindex="-1"></a>  <span class="do">## round </span></span>
<span id="cb1258-48"><a href="survey_analysis.html#cb1258-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="at">digits =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>##   Variable    Count Proportion X2.5. X97.5. Design.effect
## 1     left 701199.1       47.3  39.2   55.5           2.4
## 2     died  76213.0        5.1   2.1   12.1           3.8
## 3  arrived 761799.0       51.4  40.9   61.7           3.9</code></pre>
</div>
<div id="paquet-srvyr-1" class="section level3" number="25.8.2">
<h3><span class="header-section-number">25.8.2</span> Paquet **Srvyr</h3>
<p>Avec <strong>srvyr</strong>, nous pouvons utiliser la syntaxe <strong>dplyr</strong> pour créer une table. Notez que la méthode fonction <code>survey_mean()</code> est utilisée et que l’argument de proportion est spécifié, ainsi que également que la même fonction est utilisée pour calculer l’effet de plan. Ceci est dû au fait que <strong>srvyr</strong> englobe les deux fonctions du paquetage <strong>survey</strong>, <code>svyciprop()</code> et <code>svymean()</code>, qui sont utilisées dans la section ci-dessus.</p>
<p><span style="color : black ;"><strong><em>NOTE:</em></strong> Il ne semble pas non plus possible d’obtenir des proportions à partir de variables catégorielles en utilisant <strong>srvyr</strong>, si vous en avez besoin, consultez la section ci-dessous utilisant <strong>sitrep</strong> </span>.</p>
<div class="sourceCode" id="cb1260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1260-1"><a href="survey_analysis.html#cb1260-1" aria-hidden="true" tabindex="-1"></a><span class="do">## utiliser l&#39;objet de conception srvyr</span></span>
<span id="cb1260-2"><a href="survey_analysis.html#cb1260-2" aria-hidden="true" tabindex="-1"></a>survey_design <span class="sc">%&gt;%</span> </span>
<span id="cb1260-3"><a href="survey_analysis.html#cb1260-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1260-4"><a href="survey_analysis.html#cb1260-4" aria-hidden="true" tabindex="-1"></a>    <span class="do">## produire les comptes pondérés </span></span>
<span id="cb1260-5"><a href="survey_analysis.html#cb1260-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">counts =</span> <span class="fu">survey_total</span>(died), </span>
<span id="cb1260-6"><a href="survey_analysis.html#cb1260-6" aria-hidden="true" tabindex="-1"></a>    <span class="do">## produire les proportions pondérées et les intervalles de confiance </span></span>
<span id="cb1260-7"><a href="survey_analysis.html#cb1260-7" aria-hidden="true" tabindex="-1"></a>    <span class="do">## multiplier par 100 pour obtenir un pourcentage </span></span>
<span id="cb1260-8"><a href="survey_analysis.html#cb1260-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">props =</span> <span class="fu">survey_mean</span>(died, </span>
<span id="cb1260-9"><a href="survey_analysis.html#cb1260-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">proportion =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1260-10"><a href="survey_analysis.html#cb1260-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>) <span class="sc">*</span> <span class="dv">100</span>, </span>
<span id="cb1260-11"><a href="survey_analysis.html#cb1260-11" aria-hidden="true" tabindex="-1"></a>    <span class="do">## produire l&#39;effet de plan </span></span>
<span id="cb1260-12"><a href="survey_analysis.html#cb1260-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">deff =</span> <span class="fu">survey_mean</span>(died, <span class="at">deff =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1260-13"><a href="survey_analysis.html#cb1260-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## conserver uniquement les lignes d&#39;intérêt</span></span>
<span id="cb1260-14"><a href="survey_analysis.html#cb1260-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (supprimez les erreurs standard et répétez le calcul des proportions)</span></span>
<span id="cb1260-15"><a href="survey_analysis.html#cb1260-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(counts, props, props_low, props_upp, deff_deff)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   counts props props_low props_upp deff_deff
##    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 76213.  5.14      2.08      12.1      3.76</code></pre>
<p>Là encore, nous pourrions écrire une fonction pour itérer sur plusieurs variables en utilisant le paquet <strong>purrr</strong>. Voir le chapitre du manuel <a href="iteration.html#iteration">itération</a> pour plus de détails sur <strong>purrr</strong>.</p>
<div class="sourceCode" id="cb1262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1262-1"><a href="survey_analysis.html#cb1262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Définit la fonction permettant de calculer les effectifs pondérés, les proportions, l&#39;IC et l&#39;effet du plan de sondage.</span></span>
<span id="cb1262-2"><a href="survey_analysis.html#cb1262-2" aria-hidden="true" tabindex="-1"></a><span class="co"># design est l&#39;objet de votre plan de sondage</span></span>
<span id="cb1262-3"><a href="survey_analysis.html#cb1262-3" aria-hidden="true" tabindex="-1"></a><span class="co"># x est la variable entre guillemets </span></span>
<span id="cb1262-4"><a href="survey_analysis.html#cb1262-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1262-5"><a href="survey_analysis.html#cb1262-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1262-6"><a href="survey_analysis.html#cb1262-6" aria-hidden="true" tabindex="-1"></a>srvyr_prop <span class="ot">&lt;-</span> <span class="cf">function</span>(design, x) {</span>
<span id="cb1262-7"><a href="survey_analysis.html#cb1262-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1262-8"><a href="survey_analysis.html#cb1262-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1262-9"><a href="survey_analysis.html#cb1262-9" aria-hidden="true" tabindex="-1"></a>    <span class="do">## utiliser l&#39;objet du plan de sondage</span></span>
<span id="cb1262-10"><a href="survey_analysis.html#cb1262-10" aria-hidden="true" tabindex="-1"></a>    design, </span>
<span id="cb1262-11"><a href="survey_analysis.html#cb1262-11" aria-hidden="true" tabindex="-1"></a>    <span class="do">## produire les comptes pondérés </span></span>
<span id="cb1262-12"><a href="survey_analysis.html#cb1262-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">counts =</span> <span class="fu">survey_total</span>(.data[[x]]), </span>
<span id="cb1262-13"><a href="survey_analysis.html#cb1262-13" aria-hidden="true" tabindex="-1"></a>    <span class="do">## produire les proportions pondérées et les intervalles de confiance </span></span>
<span id="cb1262-14"><a href="survey_analysis.html#cb1262-14" aria-hidden="true" tabindex="-1"></a>    <span class="do">## multiplier par 100 pour obtenir un pourcentage </span></span>
<span id="cb1262-15"><a href="survey_analysis.html#cb1262-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">props =</span> <span class="fu">survey_mean</span>(.data[[x]], </span>
<span id="cb1262-16"><a href="survey_analysis.html#cb1262-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">proportion =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1262-17"><a href="survey_analysis.html#cb1262-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>) <span class="sc">*</span> <span class="dv">100</span>, </span>
<span id="cb1262-18"><a href="survey_analysis.html#cb1262-18" aria-hidden="true" tabindex="-1"></a>    <span class="do">## produire l&#39;effet de plan </span></span>
<span id="cb1262-19"><a href="survey_analysis.html#cb1262-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">deff =</span> <span class="fu">survey_mean</span>(.data[[x]], <span class="at">deff =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1262-20"><a href="survey_analysis.html#cb1262-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## ajouter le nom de la variable</span></span>
<span id="cb1262-21"><a href="survey_analysis.html#cb1262-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb1262-22"><a href="survey_analysis.html#cb1262-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## ne conserve que les lignes d&#39;intérêt</span></span>
<span id="cb1262-23"><a href="survey_analysis.html#cb1262-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (supprimez les erreurs standard et répétez le calcul des proportions)</span></span>
<span id="cb1262-24"><a href="survey_analysis.html#cb1262-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(variable, counts, props, props_low, props_upp, deff_deff)</span>
<span id="cb1262-25"><a href="survey_analysis.html#cb1262-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1262-26"><a href="survey_analysis.html#cb1262-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1262-27"><a href="survey_analysis.html#cb1262-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1262-28"><a href="survey_analysis.html#cb1262-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1262-29"><a href="survey_analysis.html#cb1262-29" aria-hidden="true" tabindex="-1"></a><span class="do">## itérer sur plusieurs variables pour créer un tableau </span></span>
<span id="cb1262-30"><a href="survey_analysis.html#cb1262-30" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb1262-31"><a href="survey_analysis.html#cb1262-31" aria-hidden="true" tabindex="-1"></a>  <span class="do">## définir les variables d&#39;intérêt</span></span>
<span id="cb1262-32"><a href="survey_analysis.html#cb1262-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;died&quot;</span>, <span class="st">&quot;arrived&quot;</span>), </span>
<span id="cb1262-33"><a href="survey_analysis.html#cb1262-33" aria-hidden="true" tabindex="-1"></a>  <span class="do">## déclarer la fonction utilisée et les arguments pour cette fonction (design)</span></span>
<span id="cb1262-34"><a href="survey_analysis.html#cb1262-34" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span><span class="fu">srvyr_prop</span>(.x, <span class="at">design =</span> survey_design)) <span class="sc">%&gt;%</span> </span>
<span id="cb1262-35"><a href="survey_analysis.html#cb1262-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">## réduire la liste à un seul cadre de données</span></span>
<span id="cb1262-36"><a href="survey_analysis.html#cb1262-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   variable  counts props props_low props_upp deff_deff
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 left     701199. 47.3      39.2       55.5      2.38
## 2 died      76213.  5.14      2.08      12.1      3.76
## 3 arrived  761799. 51.4      40.9       61.7      3.93</code></pre>
</div>
<div id="paquet-sitrep" class="section level3" number="25.8.3">
<h3><span class="header-section-number">25.8.3</span> Paquet **Sitrep</h3>
<p>La fonction <code>tab_survey()</code> de <strong>sitrep</strong> est une enveloppe pour <strong>srvyr</strong>, vous permettant de créer des tableaux pondérés avec un codage minimal. Elle vous permet également de calculer proportions pondérées pour les variables catégorielles.</p>
<div class="sourceCode" id="cb1264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1264-1"><a href="survey_analysis.html#cb1264-1" aria-hidden="true" tabindex="-1"></a><span class="do">## utilisation de l&#39;objet survey design</span></span>
<span id="cb1264-2"><a href="survey_analysis.html#cb1264-2" aria-hidden="true" tabindex="-1"></a>survey_design <span class="sc">%&gt;%</span> </span>
<span id="cb1264-3"><a href="survey_analysis.html#cb1264-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## passe les noms des variables d&#39;intérêt sans les citer</span></span>
<span id="cb1264-4"><a href="survey_analysis.html#cb1264-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_survey</span>(arrived, left, died, education_level,</span>
<span id="cb1264-5"><a href="survey_analysis.html#cb1264-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">deff =</span> <span class="cn">TRUE</span>, <span class="co"># calculer l&#39;effet du plan de sondage</span></span>
<span id="cb1264-6"><a href="survey_analysis.html#cb1264-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">pretty =</span> <span class="cn">TRUE</span> <span class="co"># fusionner la proportion et le 95%CI</span></span>
<span id="cb1264-7"><a href="survey_analysis.html#cb1264-7" aria-hidden="true" tabindex="-1"></a>             )</span></code></pre></div>
<pre><code>## Warning: removing 257 missing value(s) from `education_level`</code></pre>
<pre><code>## # A tibble: 9 × 5
##   variable        value            n  deff ci               
##   &lt;chr&gt;           &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;            
## 1 arrived         TRUE       761799.  3.93 51.4% (40.9-61.7)
## 2 arrived         FALSE      720658.  3.93 48.6% (38.3-59.1)
## 3 left            TRUE       701199.  2.38 47.3% (39.2-55.5)
## 4 left            FALSE      781258.  2.38 52.7% (44.5-60.8)
## 5 died            TRUE        76213.  3.76 5.1% (2.1-12.1)  
## 6 died            FALSE     1406244.  3.76 94.9% (87.9-97.9)
## 7 education_level higher     171644.  4.70 42.4% (26.9-59.7)
## 8 education_level primary    102609.  2.37 25.4% (16.2-37.3)
## 9 education_level secondary  130201.  6.68 32.2% (16.5-53.3)</code></pre>
</div>
<div id="paquet-gtsummary" class="section level3" number="25.8.4">
<h3><span class="header-section-number">25.8.4</span> Paquet **Gtsummary</h3>
<p>Avec <strong>gtsummary</strong>, il ne semble pas y avoir de fonctions intégrées pour ajouter des intervalles de confiance ou l’effet de plan. Ici nous montrons comment définir une fonction pour ajouter des intervalles de confiance et ensuite ajouter des intervalles de confiance à une table <strong>gtsummary</strong> créée en utilisant la fonction <code>tbl_svysummary()</code>.</p>
<div class="sourceCode" id="cb1267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1267-1"><a href="survey_analysis.html#cb1267-1" aria-hidden="true" tabindex="-1"></a>confidence_intervals <span class="ot">&lt;-</span> <span class="cf">function</span>(data, variable, by, ...) {</span>
<span id="cb1267-2"><a href="survey_analysis.html#cb1267-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1267-3"><a href="survey_analysis.html#cb1267-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## extraire les intervalles de confiance et les multiplier pour obtenir des pourcentages.</span></span>
<span id="cb1267-4"><a href="survey_analysis.html#cb1267-4" aria-hidden="true" tabindex="-1"></a>  props <span class="ot">&lt;-</span> <span class="fu">svyciprop</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>( <span class="st">&quot;~&quot;</span> , variable)),</span>
<span id="cb1267-5"><a href="survey_analysis.html#cb1267-5" aria-hidden="true" tabindex="-1"></a>              data, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1267-6"><a href="survey_analysis.html#cb1267-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1267-7"><a href="survey_analysis.html#cb1267-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Extraire les intervalles de confiance </span></span>
<span id="cb1267-8"><a href="survey_analysis.html#cb1267-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fu">confint</span>(props) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="do">### rendre numérique et multiplier pour le pourcentage</span></span>
<span id="cb1267-9"><a href="survey_analysis.html#cb1267-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(., <span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="do">## arrondir à un chiffre</span></span>
<span id="cb1267-10"><a href="survey_analysis.html#cb1267-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(.) <span class="sc">%&gt;%</span> <span class="do">## extraire les chiffres de la matrice</span></span>
<span id="cb1267-11"><a href="survey_analysis.html#cb1267-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(., <span class="at">collapse =</span> <span class="st">&quot;-&quot;</span>) <span class="do">## combine en un seul caractère</span></span>
<span id="cb1267-12"><a href="survey_analysis.html#cb1267-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1267-13"><a href="survey_analysis.html#cb1267-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1267-14"><a href="survey_analysis.html#cb1267-14" aria-hidden="true" tabindex="-1"></a><span class="do">## utiliser l&#39;objet de conception du paquet d&#39;enquêtes</span></span>
<span id="cb1267-15"><a href="survey_analysis.html#cb1267-15" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_svysummary</span>(base_survey_design, </span>
<span id="cb1267-16"><a href="survey_analysis.html#cb1267-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">include =</span> <span class="fu">c</span>(arrived, left, died), <span class="do">## définir les variables à inclure</span></span>
<span id="cb1267-17"><a href="survey_analysis.html#cb1267-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">statistic =</span> <span class="fu">list</span>(<span class="fu">everything</span>() <span class="sc">~</span> <span class="fu">c</span>(<span class="st">&quot;{n} ({p}%)&quot;</span>))) <span class="sc">%&gt;%</span> <span class="do">## définir les statistiques d&#39;intérêt</span></span>
<span id="cb1267-18"><a href="survey_analysis.html#cb1267-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_n</span>() <span class="sc">%&gt;%</span> <span class="do">## ajoute le total pondéré </span></span>
<span id="cb1267-19"><a href="survey_analysis.html#cb1267-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_stat</span>(<span class="at">fns =</span> <span class="fu">everything</span>() <span class="sc">~</span> confidence_intervals) <span class="sc">%&gt;%</span> <span class="do">## ajouter les ICs</span></span>
<span id="cb1267-20"><a href="survey_analysis.html#cb1267-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## modifier les en-têtes de colonnes</span></span>
<span id="cb1267-21"><a href="survey_analysis.html#cb1267-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_header</span>(</span>
<span id="cb1267-22"><a href="survey_analysis.html#cb1267-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb1267-23"><a href="survey_analysis.html#cb1267-23" aria-hidden="true" tabindex="-1"></a>      n <span class="sc">~</span> <span class="st">&quot;**Total pondéré (N)**&quot;</span>,</span>
<span id="cb1267-24"><a href="survey_analysis.html#cb1267-24" aria-hidden="true" tabindex="-1"></a>      stat_0 <span class="sc">~</span> <span class="st">&quot;**Compte pondéré**&quot;</span>,</span>
<span id="cb1267-25"><a href="survey_analysis.html#cb1267-25" aria-hidden="true" tabindex="-1"></a>      add_stat_1 <span class="sc">~</span> <span class="st">&quot;**95%CI**&quot;</span></span>
<span id="cb1267-26"><a href="survey_analysis.html#cb1267-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1267-27"><a href="survey_analysis.html#cb1267-27" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<div id="snzgiunydk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#snzgiunydk table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#snzgiunydk thead, #snzgiunydk tbody, #snzgiunydk tfoot, #snzgiunydk tr, #snzgiunydk td, #snzgiunydk th {
  border-style: none;
}

#snzgiunydk p {
  margin: 0;
  padding: 0;
}

#snzgiunydk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#snzgiunydk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#snzgiunydk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#snzgiunydk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#snzgiunydk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#snzgiunydk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#snzgiunydk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#snzgiunydk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#snzgiunydk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#snzgiunydk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#snzgiunydk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#snzgiunydk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#snzgiunydk .gt_spanner_row {
  border-bottom-style: hidden;
}

#snzgiunydk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#snzgiunydk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#snzgiunydk .gt_from_md > :first-child {
  margin-top: 0;
}

#snzgiunydk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#snzgiunydk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#snzgiunydk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#snzgiunydk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#snzgiunydk .gt_row_group_first td {
  border-top-width: 2px;
}

#snzgiunydk .gt_row_group_first th {
  border-top-width: 2px;
}

#snzgiunydk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#snzgiunydk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#snzgiunydk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#snzgiunydk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#snzgiunydk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#snzgiunydk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#snzgiunydk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#snzgiunydk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#snzgiunydk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#snzgiunydk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#snzgiunydk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#snzgiunydk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#snzgiunydk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#snzgiunydk .gt_left {
  text-align: left;
}

#snzgiunydk .gt_center {
  text-align: center;
}

#snzgiunydk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#snzgiunydk .gt_font_normal {
  font-weight: normal;
}

#snzgiunydk .gt_font_bold {
  font-weight: bold;
}

#snzgiunydk .gt_font_italic {
  font-style: italic;
}

#snzgiunydk .gt_super {
  font-size: 65%;
}

#snzgiunydk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#snzgiunydk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#snzgiunydk .gt_indent_1 {
  text-indent: 5px;
}

#snzgiunydk .gt_indent_2 {
  text-indent: 10px;
}

#snzgiunydk .gt_indent_3 {
  text-indent: 15px;
}

#snzgiunydk .gt_indent_4 {
  text-indent: 20px;
}

#snzgiunydk .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Total pondéré (N)&lt;/strong&gt;"><strong>Total pondéré (N)</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Compte pondéré&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>Compte pondéré</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;95%CI&lt;/strong&gt;"><strong>95%CI</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">arrived</td>
<td headers="n" class="gt_row gt_center">1,482,457</td>
<td headers="stat_0" class="gt_row gt_center">761,799 (51%)</td>
<td headers="add_stat_1" class="gt_row gt_center">40.9-61.7</td></tr>
    <tr><td headers="label" class="gt_row gt_left">left</td>
<td headers="n" class="gt_row gt_center">1,482,457</td>
<td headers="stat_0" class="gt_row gt_center">701,199 (47%)</td>
<td headers="add_stat_1" class="gt_row gt_center">39.2-55.5</td></tr>
    <tr><td headers="label" class="gt_row gt_left">died</td>
<td headers="n" class="gt_row gt_center">1,482,457</td>
<td headers="stat_0" class="gt_row gt_center">76,213 (5.1%)</td>
<td headers="add_stat_1" class="gt_row gt_center">2.1-12.1</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> n (%)</td>
    </tr>
  </tfoot>
</table>
</div>
<!-- ======================================================= -->
</div>
</div>
<div id="ratios-pondérés" class="section level2" number="25.9">
<h2><span class="header-section-number">25.9</span> Ratios pondérés</h2>
<p>De même, pour les ratios pondérés (comme pour les ratios de mortalité), vous pouvez utiliser le paquetage <strong>survey</strong> ou le paquet <strong>srvyr</strong>. Vous pouvez également écrire des fonctions (similaires à celles ci-dessus) pour itérer sur plusieurs variables. Vous pourriez également créer une fonction pour <strong>gtsummary</strong> comme ci-dessus mais actuellement, elle n’a pas de fonctionnalité intégrée.</p>
<div id="paquet-survey-2" class="section level3" number="25.9.1">
<h3><span class="header-section-number">25.9.1</span> Paquet **Survey</h3>
<div class="sourceCode" id="cb1268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1268-1"><a href="survey_analysis.html#cb1268-1" aria-hidden="true" tabindex="-1"></a>ratio <span class="ot">&lt;-</span> <span class="fu">svyratio</span>(<span class="sc">~</span>died, </span>
<span id="cb1268-2"><a href="survey_analysis.html#cb1268-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">denominator =</span> <span class="sc">~</span>obstime, </span>
<span id="cb1268-3"><a href="survey_analysis.html#cb1268-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">design =</span> base_survey_design)</span>
<span id="cb1268-4"><a href="survey_analysis.html#cb1268-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1268-5"><a href="survey_analysis.html#cb1268-5" aria-hidden="true" tabindex="-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">confint</span>(ratio)</span>
<span id="cb1268-6"><a href="survey_analysis.html#cb1268-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1268-7"><a href="survey_analysis.html#cb1268-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(</span>
<span id="cb1268-8"><a href="survey_analysis.html#cb1268-8" aria-hidden="true" tabindex="-1"></a>  ratio<span class="sc">$</span>ratio <span class="sc">*</span> <span class="dv">10000</span>, </span>
<span id="cb1268-9"><a href="survey_analysis.html#cb1268-9" aria-hidden="true" tabindex="-1"></a>  ci <span class="sc">*</span> <span class="dv">10000</span></span>
<span id="cb1268-10"><a href="survey_analysis.html#cb1268-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##       obstime    2.5 %   97.5 %
## died 5.981922 1.194294 10.76955</code></pre>
</div>
<div id="paquet-srvyr-paquet" class="section level3" number="25.9.2">
<h3><span class="header-section-number">25.9.2</span> <strong>Paquet SRVYR</strong> (paquet)</h3>
<div class="sourceCode" id="cb1270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1270-1"><a href="survey_analysis.html#cb1270-1" aria-hidden="true" tabindex="-1"></a>survey_design <span class="sc">%&gt;%</span> </span>
<span id="cb1270-2"><a href="survey_analysis.html#cb1270-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">### ratio d&#39;enquête utilisé pour tenir compte du temps d&#39;observation </span></span>
<span id="cb1270-3"><a href="survey_analysis.html#cb1270-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1270-4"><a href="survey_analysis.html#cb1270-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortality =</span> <span class="fu">survey_ratio</span>(</span>
<span id="cb1270-5"><a href="survey_analysis.html#cb1270-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(died) <span class="sc">*</span> <span class="dv">10000</span>, </span>
<span id="cb1270-6"><a href="survey_analysis.html#cb1270-6" aria-hidden="true" tabindex="-1"></a>      obstime, </span>
<span id="cb1270-7"><a href="survey_analysis.html#cb1270-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>)</span>
<span id="cb1270-8"><a href="survey_analysis.html#cb1270-8" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   mortality mortality_low mortality_upp
##       &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
## 1      5.98         0.349          11.6</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="ressources-12" class="section level2" number="25.10">
<h2><span class="header-section-number">25.10</span> Ressources</h2>
<p><a href="https://stats.idre.ucla.edu/r/seminars/survey-data-analysis-with-r/">Page des statistiques de l’UCLA</a></p>
<p><a href="http://asdfree.com/">Analyse des données d’enquête gratuite</a></p>
<p><a href="http://gdfe.co/srvyr/">paquet srvyr</a></p>
<p><a href="http://www.danieldsjoberg.com/gtsummary/reference/index.html">paquet gtsummary</a></p>
<p><a href="https://github.com/EPIET/RapidAssessmentSurveys">Études de cas de l’enquête EPIET</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
