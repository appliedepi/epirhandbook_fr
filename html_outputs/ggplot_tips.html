<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>31 Trucs et Astuces avec ggplot | Le Epi R Handbook</title>
<meta name="author" content="the handbook team">
<meta name="description" content="Dans cette page, nous couvrirons les trucs et astuces pour rendre vos ggplots nets et esthétiques. Voir la page sur les bases de ggplot pour les principes de base. Il existe plusieurs tutoriels...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="31 Trucs et Astuces avec ggplot | Le Epi R Handbook">
<meta property="og:type" content="book">
<meta property="og:description" content="Dans cette page, nous couvrirons les trucs et astuces pour rendre vos ggplots nets et esthétiques. Voir la page sur les bases de ggplot pour les principes de base. Il existe plusieurs tutoriels...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="31 Trucs et Astuces avec ggplot | Le Epi R Handbook">
<meta name="twitter:description" content="Dans cette page, nous couvrirons les trucs et astuces pour rendre vos ggplots nets et esthétiques. Voir la page sur les bases de ggplot pour les principes de base. Il existe plusieurs tutoriels...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.28/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.10/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Le Epi R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">About this book</li>
<li><a class="" href="editorial_notes.html"><span class="header-section-number">1</span> Notes techniques et choix éditoriaux</a></li>
<li><a class="" href="download_book_data.html"><span class="header-section-number">2</span> Télécharger le manuel et les données</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="transition_to_r.html"><span class="header-section-number">3</span> Transition vers R</a></li>
<li><a class="" href="suggested_packages.html"><span class="header-section-number">4</span> Paquets conseillés</a></li>
<li><a class="" href="r_projects.html"><span class="header-section-number">5</span> Projets R</a></li>
<li><a class="" href="import_export.html"><span class="header-section-number">6</span> Importer et exporter des données</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning_data.html"><span class="header-section-number">7</span> Nettoyage de données et fonctions essentielles</a></li>
<li><a class="" href="working_dates.html"><span class="header-section-number">8</span> Manipuler les dates</a></li>
<li><a class="" href="character_strings.html"><span class="header-section-number">9</span> Caractères et chaînes de caractères</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">10</span> Facteurs</a></li>
<li><a class="" href="pivoting_data.html"><span class="header-section-number">11</span> Restructurer les données</a></li>
<li><a class="" href="grouping_data.html"><span class="header-section-number">12</span> Travailler sur des données groupées</a></li>
<li><a class="" href="joining_matching.html"><span class="header-section-number">13</span> Joindre des données</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">14</span> De-duplication</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">15</span> Itération, boucles et listes</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive_tables.html"><span class="header-section-number">16</span> Tableaux descriptifs</a></li>
<li><a class="" href="stats_test.html"><span class="header-section-number">17</span> Tests statistiques simples</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">18</span> Régression univariée et multivariable</a></li>
<li><a class="" href="missing_data.html"><span class="header-section-number">19</span> Données manquantes</a></li>
<li><a class="" href="standardisation.html"><span class="header-section-number">20</span> Taux standardisés</a></li>
<li><a class="" href="moving_average.html"><span class="header-section-number">21</span> Moyennes mobiles</a></li>
<li><a class="" href="time_series.html"><span class="header-section-number">22</span> Série temporelle et détection des épidémies</a></li>
<li><a class="" href="contact_tracing.html"><span class="header-section-number">23</span> Suivi des contacts</a></li>
<li><a class="" href="survey_analysis.html"><span class="header-section-number">24</span> Analyse d’enquête</a></li>
<li><a class="" href="survival_analysis.html"><span class="header-section-number">25</span> Analyse de survie</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">26</span> GIS basics</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="tables_presentation.html"><span class="header-section-number">27</span> Présenter avec des tables</a></li>
<li><a class="" href="ggplot_basics.html"><span class="header-section-number">28</span> Les bases de ggplot</a></li>
<li><a class="" href="plot_continuous.html"><span class="header-section-number">29</span> Traçage de données continues</a></li>
<li><a class="" href="tracer-des-donn%C3%A9es-cat%C3%A9gorielles.html"><span class="header-section-number">30</span> Tracer des données catégorielles</a></li>
<li><a class="active" href="ggplot_tips.html"><span class="header-section-number">31</span> Trucs et Astuces avec ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> Courbes épidémiques</a></li>
<li><a class="" href="age_pyramid.html"><span class="header-section-number">33</span> Pyramides démographiques et échelles de Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> Graphiques thermiques</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> Diagrammes et schémas</a></li>
<li><a class="" href="combination_analysis.html"><span class="header-section-number">36</span> Analyse des combinaisons</a></li>
<li><a class="" href="transmission_chains.html"><span class="header-section-number">37</span> Chaînes de transmission</a></li>
<li><a class="" href="phylogenetic_trees.html"><span class="header-section-number">38</span> Les arbres phylogénétiques</a></li>
<li><a class="" href="interactive_plots.html"><span class="header-section-number">39</span> Graphiques interactifs</a></li>
<li class="book-part">Reports and dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> Production de rapports avec R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> Organisation des rapports de routine</a></li>
<li><a class="" href="dashboards.html"><span class="header-section-number">42</span> Tableaux de bord avec R Markdown</a></li>
<li><a class="" href="shiny.html"><span class="header-section-number">43</span> Tableaux de bord avec Shiny</a></li>
<li class="book-part">Miscellaneous</li>
<li><a class="" href="writing_functions.html"><span class="header-section-number">44</span> Fonctions d’écriture</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> Interactions avec les répertoires</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Contrôle de version et collaboration avec Git et Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> Erreurs fréquentes</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> Obtenir de l’aide</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">49</span> Relational databases</a></li>
<li><a class="" href="network_drives.html"><span class="header-section-number">50</span> R sur les lecteurs réseau</a></li>
<li><a class="" href="data_table.html"><span class="header-section-number">51</span> Tableau de données</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">52</span> Advanced RStudio</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ggplot_tips" class="section level1" number="31">
<h1>
<span class="header-section-number">31</span> Trucs et Astuces avec ggplot<a class="anchor" aria-label="anchor" href="#ggplot_tips"><i class="fas fa-link"></i></a>
</h1>
<p>Dans cette page, nous couvrirons les trucs et astuces pour rendre vos ggplots nets et esthétiques. Voir la page sur les <a href="ggplot_basics.html#ggplot_basics">bases de ggplot</a> pour les principes de base.</p>
<p>Il existe plusieurs <a href="https://ggplot2.tidyverse.org/">tutoriels <strong>ggplot2</strong></a> dont certains listés à la section Ressources. Vous pouvez également télécharger cette <a href="https://rstudio.com/resources/cheatsheets/">fiche technique sur la visualisation de données avec ggplot</a> sur le site Web de RStudio. Nous vous recommandons vivement aussi de vous inspirer de la <a href="https://www.r-graph-gallery.com/">R graph gallery</a> et de <a href="https://www.data-to-viz.com/caveats.html">Data-to-viz</a>.</p>
<!-- ======================================================= -->
<div id="préparation-16" class="section level2" number="31.1">
<h2>
<span class="header-section-number">31.1</span> Préparation<a class="anchor" aria-label="anchor" href="#pr%C3%A9paration-16"><i class="fas fa-link"></i></a>
</h2>
<div id="charger-les-extensions-packages-1" class="section level3 unnumbered">
<h3>Charger les extensions (“packages”)<a class="anchor" aria-label="anchor" href="#charger-les-extensions-packages-1"><i class="fas fa-link"></i></a>
</h3>
<p>Ce bout de code montre le chargement des “packages” nécessaires aux analyses. Dans ce manuel, nous mettons l’accent sur la fonction <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> du “package” <strong>pacman</strong>, qui installe le (ou une liste de) “package (s)” que si nécessaire (uniquement si le package n’est pas déjà installé) <em>et</em> le charge pour l’utiliser . On peut également charger des “packages” avec <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> à partir de <code>R</code> <strong>base</strong>. Voir la page sur <a href="#rbasics">Bases de R</a> pour plus d’informations sur les “packages” <code>R</code>.</p>
<div class="sourceCode" id="cb1382"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">tidyverse</span>,      <span class="co"># inclut ggplot2 et d'autres extensions de  data management</span></span>
<span>  <span class="va">rio</span>,            <span class="co"># importer/exporter</span></span>
<span>  <span class="va">here</span>,           <span class="co"># localiser des fichiers</span></span>
<span>  <span class="va">stringr</span>,        <span class="co">#  travailler avec des caracteres     </span></span>
<span>  <span class="va">scales</span>,         <span class="co"># transformer des valeurs numeriques</span></span>
<span>  <span class="va">ggrepel</span>,        <span class="co"># bien placer des  étiquettes </span></span>
<span>  <span class="va">gghighlight</span>,    <span class="co"># mettre en évidence une partie de l'intrigue</span></span>
<span>  <span class="va">RColorBrewer</span>    <span class="co"># gammes de couleurs</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="importer-des-données-6" class="section level3 unnumbered">
<h3>Importer des données<a class="anchor" aria-label="anchor" href="#importer-des-donn%C3%A9es-6"><i class="fas fa-link"></i></a>
</h3>
<p>Pour commencer, nous importons le jeu de données des cas d’une épidémie d’Ebola simulée. Si vous voulez suivre en travaillant sur la base, <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">cliquez pour télécharger la version “clean” </a> (en fichier .rds). Importez les données avec la fonction <code>import()</code> du “package” <strong>rio</strong> (elle gère de nombreux types de fichiers comme .xlsx, .csv, .rds - voir la page <a href="import_export.html#import_export">Importation et exportation</a> pour plus de détails).</p>
<div class="sourceCode" id="cb1383"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Les 50 premières lignes de la liste linéaire sont affichées ci-dessous.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-87831d6cd11cdd6ecb13" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-87831d6cd11cdd6ecb13">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="ggplot_tips_colors" class="section level2" number="31.2">
<h2>
<span class="header-section-number">31.2</span> Palettes de couleur, le remplissage, les axes, etc.<a class="anchor" aria-label="anchor" href="#ggplot_tips_colors"><i class="fas fa-link"></i></a>
</h2>
<p>Nous avons déjà parlé du “mappage” dans la page sur les <a href="ggplot_basics.html#ggplot_basics">Bases de ggplot</a>. Ainsi lorsque le mappage est établi, ie les attributs du graphique (par exemple, la taille, la couleur, la forme, le remplissage, l’axe du tracé) associés à des variables dans les données, on pourrait amener à vouloir modifier ce mappage pour que notre graphique reflète mieux le message que nous voulons délivrer. Ceci est possible avec les commandes <code>scales</code> qui vont permettre des ajustements de l’affichage exact du résultat de nos mappages . Par exemple la couleur reliée à une variable précise sera modifiée ou précisée selon nos besoins avec <code>scale_color</code>, la taille (<code>size</code>) pourrait être ajustée selon les valeurs minimales et maximales avec <code>scale_size</code> etc. Dans cette section, nous développerons l’utilisation de certains <code>scales</code> courants.</p>
<div id="palettes-de-couleurs" class="section level3" number="31.2.1">
<h3>
<span class="header-section-number">31.2.1</span> Palettes de couleurs<a class="anchor" aria-label="anchor" href="#palettes-de-couleurs"><i class="fas fa-link"></i></a>
</h3>
<p>Une chose qui peut être initialement difficile à comprendre avec <strong>ggplot2</strong> est le contrôle des palettes de couleurs. Notez que cette section traite de la couleur des <em>objets du graphe</em> (“geoms”/formes) tels que les points, les barres, les lignes, les tuiles, etc. Pour ajuster la couleur des textes accessoires (non reliés aux données) , des titres ou de la couleur de fond, consultez la section <a href="ggplot_basics.html#ggplot_basics_themes">Themes</a> de la page <a href="ggplot_basics.html#ggplot_basics">ggplot basics</a>.</p>
<p>Pour contrôler la “couleur” des <em>objets du graphe</em>, vous devrez ajuster soit l’attribut <code>color =</code> (la couleur <em>extérieure</em>), soit l’attribut <code>fill =</code> (la couleur <em>intérieure</em>). Une exception à cette configuration est <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>, où vous ne pouvez contrôler que <code>color =</code>, qui contrôle la couleur du point (intérieur et extérieur).</p>
<p>Lorsque vous définissez la couleur ou le remplissage, vous pouvez soit utiliser des noms de couleurs reconnus par R comme “red” (voir <a href="http://sape.inf.usi.ch/quick-reference/ggplot2/colour">complete list</a> ou entrer dans <code><a href="https://rdrr.io/r/grDevices/colors.html">?colors</a></code>), ou une couleur hexadécimale spécifique comme <code>"#ff0505"</code>.</p>
<div class="sourceCode" id="cb1384"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># histogramme - </span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>       <span class="co"># definir donnees et axes</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>              <span class="co"># afficher l'histogramme</span></span>
<span>    binwidth <span class="op">=</span> <span class="fl">7</span>,                <span class="co"># taille des bins</span></span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,               <span class="co"># couleur de ligne des bins</span></span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span>          <span class="co"># couleur interieure des bins (fill) </span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1047-1.png" width="672"></div>
<p>Comme expliqué dans la page <a href="ggplot_basics.html#ggplot_basics">ggplot basics</a> sur <a href="ggplot_basics.html#ggplot_basics_mapping">comment relier les données aux éléments graphiques</a>, les attributs graphiques tels que <code>fill =</code> et <code>color =</code> peuvent être définis soit <em>à l’extérieur</em> d’une instruction <code>mapping = aes()</code> soit <em>à l’intérieur</em> d’une telle instruction. Si vous êtes <em>en dehors</em> de <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, la valeur assignée doit être statique (par exemple, <code>color = "blue"</code>) et s’appliquera à <em>toutes</em> les données tracées par le “geom”. Si elle est <em>à l’intérieur</em>, l’attribut doit être mise en correspondance avec une variable, comme <code>color = hospital</code>, et l’expression variera en fonction de la valeur de cette ligne dans les données. Quelques exemples :</p>
<div class="sourceCode" id="cb1385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Couleur statique pour les points et pour la ligne</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">50</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Static color for points and line"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Couleur mappée sur une variable continue</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>         </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Color mapped to continuous column"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Couleur mappée sur une variable discrète</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>         </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Color mapped to discrete column"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># diagramme en barres, remplissage pour variable discrète, couleur pour la valeur statique</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     </span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"yellow"</span><span class="op">)</span><span class="op">+</span>         </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Fill mapped to discrete column, static color"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1048-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1048-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1048-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1048-4.png" width="50%"></p>
</div>
<div id="ggplot_tips_scales" class="section level3 unnumbered">
<h3>Scales<a class="anchor" aria-label="anchor" href="#ggplot_tips_scales"><i class="fas fa-link"></i></a>
</h3>
<p>Une fois que vous avez associé une variable à un attribut graphique (par exemple <code>x =</code>, <code>y =</code>, <code>fill =</code>, <code>color =</code>…) via un mappage, la manière de l’affichage de celui-ci pourra être modifié par les “scales” qui vont aussi définir la façon dont la légende correspondante va être affichée. On peut voir ci-dessus comment les “scales” peuvent être continues, discrètes, en format date, etc. en fonction du type/classe de variable assignée. Si vous avez plusieurs attributs affectés à des variables, votre graphique aura plusieurs “scales”.</p>
<p>Vous pouvez contrôler les “scqles” avec la fonction <code>scales_()</code> appropriée. Les fonctions “scales” de <strong>ggplot()</strong> ont 3 parties qui s’écrivent comme ceci : <code>scale_AESTHETIC_METHOD()</code>.</p>
<ol style="list-style-type: decimal">
<li>La première partie, <code>scale_()</code>, est fixe.</li>
<li>La deuxième partie (“AESTHETIC”), doit être l’attribut pour lequel vous voulez ajuster l’échelle (<code>_fill_</code>, <code>_shape_</code>, <code>_color_</code>, <code>_size_</code>, <code>_alpha_</code>…) - les options ici incluent également <code>_x_</code> et <code>_y_</code>.</li>
<li>La troisième partie (“METHOD”), sera soit <code>_discrete()</code>, <code>continuous()</code>, <code>_date()</code>, <code>_gradient()</code>, ou <code>_manual()</code> selon la classe de la variable et <em>comment</em> on veut la contrôler. Il en existe d’autres, mais ce sont les plus utilisées.</li>
</ol>
<p>Assurez-vous que vous utilisez la bonne fonction pour la “scale” ! Sinon, votre commande “scale” n’aura pas l’air de changer quoi que ce soit. Si vous avez plusieurs “scales”, vous pouvez utiliser plusieurs fonctions “scale” pour les ajuster ! Par exemple :</p>
</div>
<div id="arguments-des-scales" class="section level3 unnumbered">
<h3>Arguments des “Scales”<a class="anchor" aria-label="anchor" href="#arguments-des-scales"><i class="fas fa-link"></i></a>
</h3>
<p>Chaque type de “scale” a ses propres arguments, bien qu’il y ait quelques chevauchements. Interrogez la fonction comme <code><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">?scale_color_discrete</a></code> dans la console R pour voir la documentation des arguments de la fonction.</p>
<p>Pour les “scales” continues, utilisez <code>breaks =</code> pour fournir une séquence de valeurs avec <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> (prenez <code>to =</code>, <code>from =</code>, et <code>by =</code> comme indiqué dans l’exemple ci-dessous. Définissez <code>expand = c(0,0)</code> pour éliminer l’espace de remplissage autour des axes (ceci peut être utilisé sur toute “scale” <code>_x_</code> ou <code>_y_</code>.</p>
<p>Pour les “scales” discrètes, vous pouvez ajuster l’ordre d’apparition des modalités de la variable avec <code>breaks =</code>, et la façon dont les valeurs s’affichent avec l’argument <code>labels =</code>. Fournissez un vecteur caractère à chacun d’eux (voir l’exemple ci-dessous). Vous pouvez également écarter les valeurs manquantes <code>NA</code> facilement en définissant <code>na.translate = FALSE</code>.</p>
<p>Les nuances des “scales” au format date sont traitées plus en détail dans la page <a href="epicurves.html#epicurves">Courbes épidémiques</a>.</p>
</div>
<div id="réglages-manuels" class="section level3 unnumbered">
<h3>Réglages manuels<a class="anchor" aria-label="anchor" href="#r%C3%A9glages-manuels"><i class="fas fa-link"></i></a>
</h3>
<p>L’une des astuces les plus utiles consiste à utiliser des fonctions “scale” de façon “manuelle” pour assigner explicitement les couleurs comme vous le souhaitez. Ce sont des fonctions avec la syntaxe <code>scale_xxx_manual()</code> (par exemple <code><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual()</a></code> ou <code><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual()</a></code>). Chacun des arguments ci-dessous est démontré dans l’exemple de code ci-dessous.</p>
<ul>
<li>Attribuer des couleurs aux valeurs de données avec l’argument <code>values =</code> argument.<br>
</li>
<li>Spécifier une couleur pour les données manquantes <code>NA</code> avec l’argument <code>na.value =</code><br>
</li>
<li>Modifier la façon dont les valeurs sont <em>écrites</em> dans la légende avec l’argument <code>labels =</code><br>
</li>
<li>Modifier le titre de la légende avec l’argument <code>name =</code>
</li>
</ul>
<p>Ci-dessous, nous créons un graphique à barres et montrons comment il apparaît par défaut, puis avec trois “scales” ajustées - la “scale” continue de l’axe des y, la “scale” discrète de l’axe des x, et l’ajustement manuel du remplissage (couleur intérieure de la barre).</p>
<div class="sourceCode" id="cb1386"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># BASELINE - pas d'ajustement de la scale</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">outcome</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Baseline - no scale adjustments"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1049-1.png" width="672"></div>
<div class="sourceCode" id="cb1387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SCALES AJUSTEES</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">outcome</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># simplifier le background</span></span>
<span>  </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>                <span class="co"># scale continue pour l'axe des y (comptage)</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                 <span class="co"># eviter un graphe trop rembourré</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                 to <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>                 by <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">scale_x_discrete</span><span class="op">(</span>                   <span class="co"># scale discrete pour l'axe des x (gender)</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                  <span class="co"># eviter un graphe trop rembourré</span></span>
<span>    drop <span class="op">=</span> <span class="cn">FALSE</span>,                     <span class="co"># afficher toutes les modalités de la variable facteur (même si non utilisée dans la représentation)</span></span>
<span>    na.translate <span class="op">=</span> <span class="cn">FALSE</span>,             <span class="co"># retirer les valeurs NA </span></span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Died"</span>, <span class="st">"Recovered"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># Changer l'affichage des valeurs</span></span>
<span>    </span>
<span>  </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>                  <span class="co"># Spécifier Manuellement la couleur intérieure des barres</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m"</span> <span class="op">=</span> <span class="st">"violetred"</span>,     <span class="co"># préciser les couleurs que prennent chaque modalité</span></span>
<span>               <span class="st">"f"</span> <span class="op">=</span> <span class="st">"aquamarine"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m"</span> <span class="op">=</span> <span class="st">"Male"</span>,          <span class="co">#  ré-étiqueter la légende (utiliser l'affectation "=" pour éviter les erreurs)</span></span>
<span>              <span class="st">"f"</span> <span class="op">=</span> <span class="st">"Female"</span>,</span>
<span>              <span class="st">"Missing"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Gender"</span>,                  <span class="co"># titre de la legende</span></span>
<span>    na.value <span class="op">=</span> <span class="st">"grey"</span>                 <span class="co"># assigner une couleur aux valeurs manquantes</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Adjustment of scales"</span><span class="op">)</span> <span class="co"># Préciser le titre</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1049-2.png" width="672"></div>
</div>
<div id="scales-daxes-continus" class="section level3 unnumbered">
<h3>“Scales” d’axes continus<a class="anchor" aria-label="anchor" href="#scales-daxes-continus"><i class="fas fa-link"></i></a>
</h3>
<p>Lorsque les données sont mappées sur les axes du graphique, ceux-ci peuvent également être ajustés à l’aide de commandes “scales’. Un exemple courant est l’ajustement de l’affichage d’un axe (par exemple l’axe des y) qui est mappé à une variable avec des données continues.</p>
<p>Nous pouvons vouloir ajuster la continuité ou l’affichage des valeurs dans le ggplot en utilisant <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous()</a></code>. Comme indiqué ci-dessus, utilisez l’argument <code>breaks =</code> pour fournir une séquence de valeurs de graduation qui serviront de “ruptures” le long de la “scale”. A cet argument, vous pouvez fournir un vecteur <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> contenant le nombre de graduation souhaitées, ou vous pouvez fournir une séquence régulière de nombres en utilisant la fonction R <strong>base</strong> <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code>. Cette fonction <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> accepte <code>to =</code>, <code>from =</code>, et <code>by =</code>.</p>
<div class="sourceCode" id="cb1388"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># BASELINE - pas d'ajustement de la scale</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">outcome</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Baseline - no scale adjustments"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># </span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">outcome</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span></span>
<span>      from <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      to <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>      by <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Adjusted y-axis breaks"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1050-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1050-2.png" width="50%"></p>
<div id="afficher-les-pourcentages" class="section level4 unnumbered">
<h4>Afficher les pourcentages<a class="anchor" aria-label="anchor" href="#afficher-les-pourcentages"><i class="fas fa-link"></i></a>
</h4>
<p>Si les valeurs de vos données originales sont des proportions, vous pouvez facilement les afficher sous forme de pourcentages avec “%” en fournissant <code>labels = scales::percent</code> dans votre commande scales, comme montré ci-dessous.</p>
<p>Une alternative serait de convertir les valeurs en caractères et d’ajouter un caractère “%” à la fin, mais cette approche entraînera des complications car vos données ne seront plus des valeurs numériques continues.</p>
<div class="sourceCode" id="cb1389"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Axe des y originellement en proportions</span></span>
<span><span class="co">#############################</span></span>
<span><span class="va">linelist</span> <span class="op">%&gt;%</span>                                   <span class="co"># commencer avec les données d'intérêt: linelist</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span>                       <span class="co"># agréger les données selon les modalités de la variable hopital</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>                                   <span class="co"># créer un résumé par colonnes</span></span>
<span>    n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,                                     <span class="co"># compter le nombre total de lignes </span></span>
<span>    deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="co"># compter le nombre de décès par groupe</span></span>
<span>    prop_death <span class="op">=</span> <span class="va">deaths</span><span class="op">/</span><span class="va">n</span><span class="op">)</span> <span class="op">%&gt;%</span>                   <span class="co"># calculer la proportion de décès par groupe</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>                                      <span class="co"># tracer le graphique</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">hospital</span>,</span>
<span>      y <span class="op">=</span> <span class="va">prop_death</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Display y-axis original proportions"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Afficher les proportions de l'axe des y avec des pourcentages</span></span>
<span><span class="co">########################################</span></span>
<span><span class="va">linelist</span> <span class="op">%&gt;%</span>         </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    prop_death <span class="op">=</span> <span class="va">deaths</span><span class="op">/</span><span class="va">n</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">hospital</span>,</span>
<span>      y <span class="op">=</span> <span class="va">prop_death</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Display y-axis as percents (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span>                    <span class="co"># afficher les proportions comme des pourcentages</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1051-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1051-2.png" width="50%"></p>
</div>
<div id="échelle-logarithmique" class="section level4 unnumbered">
<h4>Échelle logarithmique<a class="anchor" aria-label="anchor" href="#%C3%A9chelle-logarithmique"><i class="fas fa-link"></i></a>
</h4>
<p>Pour transformer un axe continu en échelle logarithmique, ajouter <code>trans = "log2"</code> à la commande “scale”. Pour les besoins de l’exemple, nous créons un jeu de données des régions avec leurs valeurs respectives de <code>preparedness_index</code> et de cas cumulés.</p>
<div class="sourceCode" id="cb1390"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>, <span class="st">"G"</span>, <span class="st">"H"</span>, <span class="st">"I"</span><span class="op">)</span>,</span>
<span>  preparedness_index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8.8</span>, <span class="fl">7.5</span>, <span class="fl">3.4</span>, <span class="fl">3.6</span>, <span class="fl">2.1</span>, <span class="fl">7.9</span>, <span class="fl">7.0</span>, <span class="fl">5.6</span>, <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>  cases_cumulative <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">45</span>, <span class="fl">80</span>, <span class="fl">20</span>, <span class="fl">21</span>, <span class="fl">7</span>, <span class="fl">51</span>, <span class="fl">30</span>, <span class="fl">1442</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_data</span></span></code></pre></div>
<pre><code>##   region preparedness_index cases_cumulative
## 1      A                8.8               15
## 2      B                7.5               45
## 3      C                3.4               80
## 4      D                3.6               20
## 5      E                2.1               21
## 6      F                7.9                7
## 7      G                7.0               51
## 8      H                5.6               30
## 9      I                1.0             1442</code></pre>
<p>Les cas cumulés pour la région “I” sont nettement supérieurs à ceux de toutes les autres régions. Dans de telles circonstances, vous pouvez choisir d’afficher l’axe des y en utilisant une échelle logarithmique afin que le lecteur puisse voir les différences entre les régions ayant moins de cas cumulés.</p>
<div class="sourceCode" id="cb1392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Axe y original</span></span>
<span><span class="va">preparedness_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span>,  </span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>         x <span class="op">=</span> <span class="va">preparedness_index</span>,</span>
<span>         y <span class="op">=</span> <span class="va">cases_cumulative</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>            <span class="co"># points pour chaque region </span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">region</span><span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">+</span>                  <span class="co"># ajouter les etiquette</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preparedness_plot</span>                  <span class="co"># affichier le graphe originel</span></span>
<span></span>
<span></span>
<span><span class="co"># print with y-axis transformed</span></span>
<span><span class="va">preparedness_plot</span><span class="op">+</span>                   <span class="co"># appeler le graphe créé ci-dessus</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log2"</span><span class="op">)</span> <span class="co"># ajouter la transformation pour l'axe des y</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1053-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1053-2.png" width="50%"></p>
</div>
</div>
<div id="gradient-de-couleur" class="section level3 unnumbered">
<h3>Gradient de couleur<a class="anchor" aria-label="anchor" href="#gradient-de-couleur"><i class="fas fa-link"></i></a>
</h3>
<p>Les fonctions “scales” pour un remplissage en gradient de couleur (dégradé) peuvent impliquer des nuances supplémentaires. Les valeurs par défaut sont généralement très agréables, mais vous pouvez souhaiter ajuster les valeurs, les coupures, etc.</p>
<p>Pour illustrer comment ajuster une “scale” de couleur continue, nous utiliserons un ensemble de données de la page <a href="contact_tracing.html#contact_tracing">Suivi des contacts</a> qui contient les âges des cas et de leurs cas sources.</p>
<div class="sourceCode" id="cb1393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">case_source_relationships</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"godata"</span>, <span class="st">"relationships_clean.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">source_age</span>, <span class="va">target_age</span><span class="op">)</span> </span></code></pre></div>
<p>Ci-dessous, nous produisons un diagramme “raster” de la densité des tuiles thermiques. Nous ne détaillerons pas comment (voir le lien dans le paragraphe ci-dessus) mais nous nous concentrerons sur la façon dont nous pouvons ajuster la “scale” de couleurs. Pour en savoir plus sur la fonction <code><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density2d()</a></code> <strong>ggplot2</strong> <a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">ici</a>. Notez que la “scale” de remplissage est <em>continue</em>.</p>
<div class="sourceCode" id="cb1394"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans_matrix</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">case_source_relationships</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">source_age</span>, y <span class="op">=</span> <span class="va">target_age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">stat_density2d</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"raster"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    contour <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Nous allons maintenant montrer quelques variations de la “scale” de remplissage :</p>
<div class="sourceCode" id="cb1395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans_matrix</span></span>
<span><span class="va">trans_matrix</span> <span class="op">+</span> <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1056-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1056-2.png" width="50%"></p>
<p>Maintenant, nous allons montrer quelques exemples d’ajustement du nombre de graduations de l’échelle :</p>
<ul>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient()</a></code> accepte deux couleurs (haut/bas).</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn()</a></code> accepte un vecteur de n’importe quelle longueur de couleurs à <code>values =</code> (les valeurs intermédiaires seront interpolées)<br>
</li>
<li>Utiliser <a href="https://www.rdocumentation.org/packages/scales/versions/0.4.1/topics/rescale"><code>scales::rescale()</code></a> pour ajuster la façon dont les couleurs sont positionnées le long du gradient ; il redonne à votre vecteur de positions une valeur comprise entre 0 et 1.</li>
</ul>
<div class="sourceCode" id="cb1396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans_matrix</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_gradient</span><span class="op">(</span>     <span class="co"># gradient à deux côtés</span></span>
<span>    low <span class="op">=</span> <span class="st">"aquamarine"</span>,    <span class="co"># petites valeurs</span></span>
<span>    high <span class="op">=</span> <span class="st">"purple"</span>,       <span class="co"># grandes valeurs</span></span>
<span>    na.value <span class="op">=</span> <span class="st">"grey"</span>,     <span class="co"># valeur des NA</span></span>
<span>    name <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># Titre de la Legende</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Manually specify high/low colors"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3+ couleurs à mapper</span></span>
<span><span class="va">trans_matrix</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>    <span class="co"># gradient de 3 couleurs (low/mid/high)</span></span>
<span>    colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"yellow"</span>,<span class="st">"red"</span><span class="op">)</span> <span class="co"># fournir les couleurs dans un vecteur</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"3-color scale"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Utiliser rescale() pour ajuster le positionnement des couleurs</span></span>
<span><span class="va">trans_matrix</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>    <span class="co"># fournir autant de coleurs que l'on veut</span></span>
<span>    colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"yellow"</span>,<span class="st">"red"</span>, <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.07</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="co"># positions des couleurs sont redimensionnées entre 0 and 1</span></span>
<span>    <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Colors not evenly positioned"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># utilisation de limites pour découper les valeurs qui prennent une couleur de remplissage</span></span>
<span><span class="va">trans_matrix</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>    </span>
<span>    colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"yellow"</span>,<span class="st">"red"</span><span class="op">)</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.0002</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Restrict value limits, resulting in grey space"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1057-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1057-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1057-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1057-4.png" width="50%"></p>
</div>
<div id="palettes" class="section level3 unnumbered">
<h3>Palettes<a class="anchor" aria-label="anchor" href="#palettes"><i class="fas fa-link"></i></a>
</h3>
<div id="colorbrewer-et-viridis" class="section level4 unnumbered">
<h4>Colorbrewer et Viridis<a class="anchor" aria-label="anchor" href="#colorbrewer-et-viridis"><i class="fas fa-link"></i></a>
</h4>
<p>Plus généralement, si vous voulez des palettes prédéfinies, vous pouvez utiliser les fonctions <code>scale_xxx_brewer</code> ou <code>scale_xxx_viridis_y</code>.</p>
<p>Les fonctions ‘brewer’ peuvent fonctionner à partir des palettes <a href="colorbrewer.org">colorbrewer.org</a>.</p>
<p>Les fonctions ‘viridis’ s’inspirent des palettes viridis (adaptées aux daltoniens !), qui “fournissent des cartes de couleurs qui sont perceptiblement uniformes en couleur et en noir et blanc. Elles sont également conçues pour être perçues par des spectateurs souffrant de formes courantes de daltonisme.” (Pour en savoir plus, voir <a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">ici</a> et <a href="https://bids.github.io/colormap/">ici</a>). Préciser si la palette est discrète, continue ou binaire en le spécifiant à la fin de la fonction (par exemple, discrète est <code>scale_xxx_viridis_d</code>).</p>
<p>Il est conseillé de tester votre graphe dans ce <a href="https://www.color-blindness.com/coblis-color-blindness-simulator/">simulateur de daltonisme</a>. Si vous avez un schéma de couleurs rouge/vert, essayez plutôt un schéma “chaud-froid” (rouge-bleu) comme décrit <a href="https://www.visualisingdata.com/2019/08/five-ways-to-design-for-red-green-colour-blindness/#:~:text=The%20pink%2Dred%20through%20to,green%20hues%20used%20by%20default.">ici</a></p>
<p>Voici un exemple tiré de la page <a href="ggplot_basics.html#ggplot_basics">ggplot basics</a>, utilisant différents schémas de couleurs.</p>
<div class="sourceCode" id="cb1397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">symp_plot</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>                                         <span class="co"># commencer avec la linelist</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># selectionner les colonnes</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>                                                  <span class="co"># pivoter en format long</span></span>
<span>    cols <span class="op">=</span> <span class="op">-</span><span class="va">case_id</span>,                                  </span>
<span>    names_to <span class="op">=</span> <span class="st">"symptom_name"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"symptom_is_present"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>                                                        <span class="co"># remplacer les valeurs manquantes</span></span>
<span>    symptom_is_present <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">symptom_is_present</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>                                                        <span class="co"># commencer le ggplot!</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">symptom_name</span>, fill <span class="op">=</span> <span class="va">symptom_is_present</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>                    </span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Symptom"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Symptom status (proportion)"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">symp_plot</span>  <span class="co">#afficher le graphe avec les couleurs par defaut</span></span>
<span></span>
<span><span class="co">#################################</span></span>
<span><span class="co"># afficher le graphe avec les couleurs specifiées manuellement</span></span>
<span><span class="va">symp_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span> <span class="op">=</span> <span class="st">"black"</span>,         <span class="co"># definir explicitement les couleurs</span></span>
<span>               <span class="st">"no"</span> <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>               <span class="st">"unknown"</span> <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span>, <span class="st">"unknown"</span><span class="op">)</span>, <span class="co"># ordonner les facteurs correctement</span></span>
<span>    name <span class="op">=</span> <span class="st">""</span>                           <span class="co"># ne pas afficher de titre pour la légende</span></span>
<span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="co">#################################</span></span>
<span><span class="co"># afficher avec les couleurs discretes viridis</span></span>
<span><span class="va">symp_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span>, <span class="st">"unknown"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1058-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1058-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1058-3.png" width="50%"></p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="changement-de-lordre-des-variables-discrètes" class="section level2" number="31.3">
<h2>
<span class="header-section-number">31.3</span> Changement de l’ordre des variables discrètes<a class="anchor" aria-label="anchor" href="#changement-de-lordre-des-variables-discr%C3%A8tes"><i class="fas fa-link"></i></a>
</h2>
<p>Changer l’ordre dans lequel les variables discrètes apparaissent est souvent difficile à comprendre pour les personnes qui ne connaissent pas les graphiques <code>ggplot2</code>. Il est cependant facile de comprendre comment faire cela une fois que vous avez compris comment <code>ggplot2</code> gère les variables discrètes en intrinsèque. En général, si une variable discrète est utilisée, elle est automatiquement convertie en un type <code>factor</code> - qui ordonne les facteurs par ordre alphabétique par défaut. Pour gérer cela, vous devez simplement réorganiser les niveaux de facteurs (modalités) pour refléter l’ordre dans lequel vous souhaitez qu’ils apparaissent dans le graphique. Pour des informations plus détaillées sur la façon de réorganiser les objets <code>facteur</code>, voir la section <a href="factors.html#factors">Variables de type facteur</a> du guide.</p>
<p>Nous pouvons voir un exemple commun en utilisant les groupes d’âge - par défaut le groupe d’âge 5-9 sera placé au milieu des groupes d’âge (vu l’ordre alphanumérique), mais nous pouvons le déplacer derrière le groupe d’âge 0-4 du graphique en réordonnant les facteurs.</p>
<div class="sourceCode" id="cb1398"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">age_cat5</span><span class="op">)</span>,                         <span class="co"># supprimer les lignes où age_cat5 est manquant</span></span>
<span>  mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">age_cat5</span>, <span class="st">"5-9"</span>, after <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># reordonner la var facteur</span></span>
<span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age group"</span>, y <span class="op">=</span> <span class="st">"Number of hospitalisations"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Total hospitalisations by age group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1059-1.png" width="672"></div>
<div id="ggthemr" class="section level4 unnnumbered" number="31.3.0.1">
<h4>
<span class="header-section-number">31.3.0.1</span> <strong>ggthemr</strong><a class="anchor" aria-label="anchor" href="#ggthemr"><i class="fas fa-link"></i></a>
</h4>
<p>Pensez également à utiliser le “package” (extension) <strong>ggthemr</strong>. Vous pouvez télécharger ce “package” sur Github en suivant les instructions <a href="https://github.com/Mikata-Project/ggthemr">ici</a>. Il propose des palettes très agréables d’un point de vue esthétique, mais sachez que celles-ci ont généralement un nombre maximal de valeurs qui peut être limitatif si vous voulez plus de 7 ou 8 couleurs.</p>
</div>
</div>
<div id="courbes-de-niveau" class="section level2" number="31.4">
<h2>
<span class="header-section-number">31.4</span> Courbes de niveau<a class="anchor" aria-label="anchor" href="#courbes-de-niveau"><i class="fas fa-link"></i></a>
</h2>
<p>Les courbes de niveau sont utiles lorsque vous avez de nombreux points qui risquent de se superposer les uns les autres lors de la représentation (“surtraçage”). Elles permettent une différente visualisation de la répartition des points dans l’espace. Les données de cas utilisées ci-dessus sont à nouveau représentées, mais plus simplement en utilisant <code><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density2d()</a></code> et <code><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density2d_filled()</a></code> pour produire des niveaux de contour discrets - comme une carte topographique. Pour en savoir plus sur les statistiques, cliquez <a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">ici</a>.</p>
<div class="sourceCode" id="cb1399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">case_source_relationships</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">source_age</span>, y <span class="op">=</span> <span class="va">target_age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">stat_density2d</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"stat_density2d() + geom_point()"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">case_source_relationships</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">source_age</span>, y <span class="op">=</span> <span class="va">target_age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">stat_density2d_filled</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"stat_density2d_filled()"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1060-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1060-2.png" width="50%"></p>
</div>
<div id="distributions-marginales" class="section level2" number="31.5">
<h2>
<span class="header-section-number">31.5</span> Distributions marginales<a class="anchor" aria-label="anchor" href="#distributions-marginales"><i class="fas fa-link"></i></a>
</h2>
<p>Pour montrer les distributions sur les rebords d’un nuage de points <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>, vous pouvez utiliser le “package” <strong>ggExtra</strong> et sa fonction <code>ggMarginal()</code>. Sauvegardez votre ggplot original comme un objet, puis passez-le à <code>ggMarginal()</code> comme indiqué ci-dessous. Voici les arguments clés :</p>
<ul>
<li>Vous devez spécifier le <code>type =</code> comme étant soit un histogramme (“histogram”), une densité (“density”), un “boxplot”, un graphe en violon (“violin”), ou un “densigram”).<br>
</li>
<li>Par défaut, les graphiques marginaux apparaissent pour les deux axes. Vous pouvez définir <code>margins =</code> sur “x” ou “y” si vous n’en voulez qu’un seul.<br>
</li>
<li>Parmi les autres arguments facultatifs, citons <code>fill =</code> (couleur de la barre), <code>color =</code> (couleur de la ligne), <code>size =</code> (taille du tracé par rapport à la taille de la marge, donc plus le nombre est grand, plus le tracé marginal est petit).<br>
</li>
<li>Vous pouvez fournir d’autres arguments spécifiques aux axes à <code>xparams =</code> et <code>yparams =</code>. Par exemple, pour avoir des tailles de cases d’histogramme différentes, comme indiqué ci-dessous.</li>
</ul>
<p>Vous pouvez faire en sorte que les tracés marginaux reflètent les groupes (les variables qui ont été assignées à <code>color =</code> dans l’attribut de votre <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>). Si c’est le cas, définissez l’argument <code>ggMarginal()</code> <code>groupColour =</code> ou <code>groupFill =</code> à <code>TRUE</code>, comme indiqué ci-dessous.</p>
<p>Pour en savoir plus, consultez <a href="https://cran.r-project.org/web/packages/ggExtra/vignettes/ggExtra.html">cette vignette</a>, la <a href="https://www.r-graph-gallery.com/277-marginal-histogram-for-ggplot2.html">R Graph Gallery</a> ou la documentation de la fonction R <code>?ggMarginal</code>.</p>
<div class="sourceCode" id="cb1400"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Installer/charger ggExtra</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">ggExtra</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Diagramme de dispersion basique du poids et de l'âge</span></span>
<span><span class="va">scatter_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">wt_kg</span>, x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Scatter plot of weight and age"</span><span class="op">)</span></span></code></pre></div>
<p>Pour ajouter des histogrammes marginaux, utilisez <code>type = "histogram"</code>. Vous pouvez éventuellement définir <code>groupFill = TRUE</code> pour obtenir des histogrammes empilés.</p>
<div class="sourceCode" id="cb1401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># le graphe d'avant avec les histogrammes de chaque variable présentés sur les rebords</span></span>
<span><span class="fu">ggMarginal</span><span class="op">(</span></span>
<span>  <span class="va">scatter_plot</span>,                     <span class="co"># ajouter les histogrammes marginaux</span></span>
<span>  type <span class="op">=</span> <span class="st">"histogram"</span>,               <span class="co"># specifier qu'on veut un  histogramme</span></span>
<span>  fill <span class="op">=</span> <span class="st">"lightblue"</span>,               <span class="co"># couleur intérieure des barres de l'histogramme</span></span>
<span>  xparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,    <span class="co"># autres parametres pour l'axe des x</span></span>
<span>  yparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>     <span class="co"># autres parametres pour l'axe des y</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1062-1.png" width="672"></div>
<p>Graphique de densité marginale avec valeurs groupées/colorées :</p>
<div class="sourceCode" id="cb1402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scatter plot, coloriée selon la variable d'interet (le sexe)</span></span>
<span><span class="co"># la variable d'interet est assignee à l'argument "color" dans ggplot. groupFill dans ggMarginal est fixée à TRUE</span></span>
<span><span class="va">scatter_plot_color</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">wt_kg</span>, x <span class="op">=</span> <span class="va">age</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Scatter plot of weight and age"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggMarginal</span><span class="op">(</span><span class="va">scatter_plot_color</span>, type <span class="op">=</span> <span class="st">"density"</span>, groupFill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1063-1.png" width="672"></div>
<p>Définissez l’argument <code>size =</code> pour ajuster la taille relative du graphe marginal. Plus le nombre est petit, plus le graphe marginal est grand. Vous pouvez également définir <code>color =</code> au besoin.</p>
<p>Ci-dessous se trouve un boxplot marginal, avec une démonstration de l’utilisation de l’argument <code>margins =</code> pour avoir le graphique marginal que sur un seul axe :</p>
<div class="sourceCode" id="cb1403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># avec boxplot </span></span>
<span><span class="fu">ggMarginal</span><span class="op">(</span></span>
<span>  <span class="va">scatter_plot</span>,</span>
<span>  margins <span class="op">=</span> <span class="st">"x"</span>,      <span class="co"># afficher un graphe marginal uniquement sur l'axe x</span></span>
<span>  type <span class="op">=</span> <span class="st">"boxplot"</span><span class="op">)</span>   </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1064-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="étiquetage-pratiqueintelligent" class="section level2" number="31.6">
<h2>
<span class="header-section-number">31.6</span> Étiquetage pratique/intelligent<a class="anchor" aria-label="anchor" href="#%C3%A9tiquetage-pratiqueintelligent"><i class="fas fa-link"></i></a>
</h2>
<p>Dans <strong>ggplot2</strong>, il est également possible d’ajouter du texte aux graphiques. Cependant, cela s’accompagne d’une limitation notable : les étiquettes de texte entrent souvent en conflit avec les points de données dans un graphique, ce qui les rend désordonnées ou difficiles à lire. Il n’y a pas de moyen idéal de gérer ce problème dans le “package” de base, mais il existe un module complémentaire <strong>ggplot2</strong>, connu sous le nom de <strong>ggrepel</strong>, qui rend la gestion de ce problème très simple !</p>
<p>Le “package” <strong>ggrepel</strong> fournit deux nouvelles fonctions, <code>geom_label_repel()</code> et <code>geom_text_repel()</code>, qui remplacent <code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label()</a></code> et <code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text()</a></code>. Utilisez simplement ces fonctions à la place des fonctions de base pour produire des étiquettes soignées. Dans la fonction, mappez l’attribut graphique <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> comme toujours, mais incluez l’argument <code>label =</code> auquel vous fournissez un nom de variable contenant les valeurs que vous voulez afficher (par exemple l’id du patient, ou le nom, etc.). Vous pouvez créer des étiquettes plus complexes en combinant des variables et des retours à la ligne (<code>\n</code>) dans <code>str_glue()</code> comme indiqué ci-dessous.</p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Quelques conseils</span></p>
<ul>
<li><p>Utilisez <code>min.segment.length = 0</code> pour toujours dessiner des segments de ligne, ou <code>min.segment.length = Inf</code> pour ne jamais les dessiner.<br></p></li>
<li><p>Utilisez <code>size =</code> en dehors de <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> pour définir la taille du texte.<br></p></li>
<li><p>Utilisez <code>force =</code> pour modifier le degré de répulsion entre les étiquettes et leurs points respectifs (la valeur par défaut est 1).<br></p></li>
<li>
<p>Incluez <code>fill =</code> dans <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> pour que l’étiquette soit colorée par la valeur.</p>
<ul>
<li>Une lettre “a” peut apparaître dans la légende - ajoutez <code>guides(fill = guide_legend(override.aes = aes(color = NA)))</code> pour la supprimer</li>
</ul>
</li>
</ul>
<p>Pour en savoir plus, consultez ce <a href="https://ggrepel.slowkow.com/articles/examples.html">tutoriel très détaillé</a>.</p>
<div class="sourceCode" id="cb1404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">ggrepel</span><span class="op">)</span></span>
<span></span>
<span><span class="va">linelist</span> <span class="op">%&gt;%</span>                                               <span class="co"># commencer avec les données d'intérêt linelist</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span>                                   <span class="co"># agréger les données par les différentes modalités de la variable hopital</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>                                               <span class="co"># créer une nouvelles base avec les données résumées par hopital</span></span>
<span>    n_cases <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,                                           <span class="co"># nombre de cas pq hospital</span></span>
<span>    delay_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">days_onset_hosp</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,    <span class="co"># délai moyen par hopital</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_cases</span>, y <span class="op">=</span> <span class="va">delay_mean</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># envoyer la base modifiée dans la fonction ggplot</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>                                    <span class="co"># ajouter les points</span></span>
<span>  <span class="fu">geom_label_repel</span><span class="op">(</span>                                        <span class="co"># ajouter les étiquettes des points </span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      label <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span></span>
<span>        <span class="st">"{hospital}\n{n_cases} cases, {delay_mean} days"</span><span class="op">)</span>  <span class="co"># comment les étiquettes vont apparaître</span></span>
<span>      <span class="op">)</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,                                              <span class="co"># taille du texte pour les étiquettes</span></span>
<span>    min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span>                               <span class="co"># afficher  tous les segments de ligne              </span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>                                                    <span class="co"># ajouter des étiquettes aux axes </span></span>
<span>    title <span class="op">=</span> <span class="st">"Mean delay to admission, by hospital"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Number of cases"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Mean delay (days)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1065-1.png" width="672"></div>
<p>Vous pouvez étiqueter seulement un sous-ensemble de points de données - en utilisant la syntaxe standard <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> pour fournir différentes <code>data =</code> pour chaque couche <code>geom</code> du graphique. Ci-dessous, tous les cas sont représentés, mais seulement quelques-uns sont étiquetés.</p>
<div class="sourceCode" id="cb1405"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># Tous les points en gris</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">linelist</span>,                                   <span class="co"># la base complète fournie à ggplot</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">ht_cm</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span>                                              <span class="co"># gris et semi-transparent</span></span>
<span>  </span>
<span>  <span class="co"># Quelques points en noir</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">days_onset_hosp</span> <span class="op">&gt;</span> <span class="fl">15</span><span class="op">)</span>,  <span class="co"># filtrer les données à représenter</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">ht_cm</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>                                                <span class="co"># couleur par défaut (noir) et non transparente</span></span>
<span>  </span>
<span>  <span class="co"># point labels for few points</span></span>
<span>  <span class="fu">geom_label_repel</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">days_onset_hosp</span> <span class="op">&gt;</span> <span class="fl">15</span><span class="op">)</span>,  <span class="co"># filtrer les données pour les étiquettes à afficher</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">ht_cm</span>,</span>
<span>      y <span class="op">=</span> <span class="va">wt_kg</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">outcome</span>,                                          <span class="co"># couleurs des boites d'étiquettes selon outcome</span></span>
<span>      label <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Delay: {days_onset_hosp}d"</span><span class="op">)</span><span class="op">)</span>, <span class="co"># étiquette créée avec str_glue()</span></span>
<span>    min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>                                  <span class="co"># afficher  tous les segments de ligne </span></span>
<span>  </span>
<span>  <span class="co"># supprimer lettre "a" de l'intérieur des boites</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># étiquettes des axes</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Cases with long delay to admission"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"weight (kg)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"height(cm)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1066-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="axes-de-temps" class="section level2" number="31.7">
<h2>
<span class="header-section-number">31.7</span> Axes de temps<a class="anchor" aria-label="anchor" href="#axes-de-temps"><i class="fas fa-link"></i></a>
</h2>
<p>Travailler avec des axes temporels dans ggplot peut sembler intimidant, mais est très facile grâce à quelques fonctions clés. Rappelez-vous que lorsque vous travaillez avec le temps ou la date, vous devez vous assurer que les variables correctes sont formatées en tant que classe de date ou de “datetime” - voir la page <a href="#dates">Travailler avec les dates</a> pour plus d’informations à ce sujet, ou la page <a href="epicurves.html#epicurves">Courbes épidémiques</a> (section ggplot) pour des exemples.</p>
<p>L’ensemble de fonctions les plus utiles pour travailler avec des dates dans <code>ggplot2</code> sont les fonctions d’échelle (<code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></code>, <code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_datetime()</a></code>), et leurs fonctions d’axe des ordonnées. Ces fonctions vous permettent de définir la fréquence des étiquettes d’axe et le format des étiquettes d’axe. Pour savoir comment formater les dates, consultez à nouveau la section <a href="#dates"><em>travailler avec les dates</em></a> ! Vous pouvez utiliser les arguments <code>date_breaks</code> et <code>date_labels</code> pour spécifier l’apparence des dates :</p>
<ol style="list-style-type: decimal">
<li><p><code>date_breaks</code> vous permet de spécifier la fréquence des ruptures d’axe (le nombre de graduations) - vous pouvez passer une chaîne ici (par exemple <code>"3 months"</code>, ou “<code>2 days"</code>)</p></li>
<li><p><code>date_labels</code> vous permet de définir le format dans lequel les dates sont affichées. Vous pouvez passer une chaîne de format de date à ces arguments (par exemple, <code>"%b-%d-%Y"</code>) :</p></li>
</ol>
<div class="sourceCode" id="cb1406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># faire une courbe épi en fonction de la date d'apparition des symptômes, lorsque cela est disponible</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    <span class="co"># graduation par mois</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"1 months"</span>,</span>
<span>    <span class="co"># les étiquettes vont afficher le mois puis le jour</span></span>
<span>    date_labels <span class="op">=</span> <span class="st">"%b %d"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1067-1.png" width="672"></div>
<p>Une solution facile pour obtenir des étiquettes de date efficaces sur l’axe des x est d’assigner l’argument <code>labels =</code> dans <code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></code> à la fonction <code>label_date_short()</code> du “package” <strong>scales</strong>. Cette fonction construira automatiquement des étiquettes de date efficaces (pour en savoir plus, cliquez <a href="https://scales.r-lib.org/reference/label_date.html">ici</a>). Un avantage supplémentaire de cette fonction est que les étiquettes s’adapteront automatiquement à l’évolution de vos données dans le temps, des jours aux semaines, aux mois et aux années.</p>
<p>Vous trouverez un exemple complet dans la section de la page <a href="epicurves.html#epicurves">Courbes épidémiques</a> sur les étiquettes de date à plusieurs niveaux, mais un exemple rapide est présenté ci-dessous pour référence :</p>
<div class="sourceCode" id="cb1407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># étiquettes de date plus pratiques d'un coup</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1068-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="mise-en-évidence" class="section level2" number="31.8">
<h2>
<span class="header-section-number">31.8</span> Mise en évidence<a class="anchor" aria-label="anchor" href="#mise-en-%C3%A9vidence"><i class="fas fa-link"></i></a>
</h2>
<p>La mise en évidence d’éléments spécifiques dans un graphique est un moyen utile d’attirer l’attention sur une instance spécifique d’une variable tout en fournissant des informations sur la dispersion de l’ensemble des données. Bien que cela ne soit pas facile à faire dans la base <strong>ggplot2</strong>, il existe un “package” externe qui peut aider à le faire, connu sous le nom de <strong>gghighlight</strong>. Il est facile à utiliser dans la syntaxe ggplot.</p>
<p>Le “package” <strong>gghighlight</strong> utilise la fonction <code><a href="https://yutannihilation.github.io/gghighlight/reference/gghighlight.html">gghighlight()</a></code> pour obtenir cet effet. Pour utiliser cette fonction, fournissez une déclaration logique à la fonction - cela peut avoir des résultats assez flexibles, mais ici nous allons montrer un exemple de la distribution de l’âge des cas dans notre liste linéaire, en les mettant en évidence par résultat.</p>
<div class="sourceCode" id="cb1408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># charger gghighlight</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yutannihilation.github.io/gghighlight/">gghighlight</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remplacer les valeurs NA avec "unknown" dans la variable "outcome"</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>outcome <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">outcome</span>, <span class="st">"Unknown"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># produire un histogramme de tous les cas par age</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">linelist</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_years</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">gghighlight</span><span class="fu">::</span><span class="fu"><a href="https://yutannihilation.github.io/gghighlight/reference/gghighlight.html">gghighlight</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span><span class="op">)</span>     <span class="co"># mettre en évidence les cas ou le patient est décédé</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1069-1.png" width="672"></div>
<p>Cela fonctionne aussi très bien avec les fonctions de “facet” - cela permet à l’utilisateur de produire des graphiques répétitifs (selon les modalités la variable d’intérêt) mais cette fois au lieu que chaque sous-graphe concerne une modalité particulière de la variable sur laquelle le “faceting” est fait, tout sera représenté dans chaque sous-graphe mais avec les données de la modalité d’intérêt qui seront mises en évidence avec une couleur spécifique! Ci-dessous, nous comptons les cas par semaine et traçons les courbes épidémiques par hôpital (<code>color =</code> et <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> réglé sur la colonne <code>hospital</code>).</p>
<div class="sourceCode" id="cb1409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># produire un histogramme de tous les cas par age</span></span>
<span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span>week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_hospitalisation</span>, <span class="st">"week"</span><span class="op">)</span>,</span>
<span>        <span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">gghighlight</span><span class="fu">::</span><span class="fu"><a href="https://yutannihilation.github.io/gghighlight/reference/gghighlight.html">gghighlight</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                      <span class="co"># mettre en évidence les cas ou le patient est décédé</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">hospital</span><span class="op">)</span>                              <span class="co"># créer les "facets" par outcome</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1070-1.png" width="672"></div>
</div>
<div id="représenter-différentsmultiples-jeux-de-données" class="section level2" number="31.9">
<h2>
<span class="header-section-number">31.9</span> Représenter différents/multiples jeux de données<a class="anchor" aria-label="anchor" href="#repr%C3%A9senter-diff%C3%A9rentsmultiples-jeux-de-donn%C3%A9es"><i class="fas fa-link"></i></a>
</h2>
<p>Notez qu’il peut être difficile d’aligner correctement les axes pour tracer les données de plusieurs ensembles de données différents dans le même graphique. Considérez l’une des stratégies suivantes :</p>
<ul>
<li>Fusionnez les données avant de les représenter, et convertissez-les au format “long” avec une colonne reflétant l’ensemble de données.</li>
<li>Utilisez <strong>cowplot</strong> ou un logiciel similaire pour combiner deux graphiques (voir ci-dessous).</li>
</ul>
<!-- ======================================================= -->
</div>
<div id="combiner-des-graphiques" class="section level2" number="31.10">
<h2>
<span class="header-section-number">31.10</span> Combiner des graphiques<a class="anchor" aria-label="anchor" href="#combiner-des-graphiques"><i class="fas fa-link"></i></a>
</h2>
<p>Deux “packages” très utiles pour combiner des graphiques sont <strong>cowplot</strong> et <strong>patchwork</strong>. Dans cette page, nous nous concentrerons principalement sur <strong>cowplot</strong>, avec une utilisation occasionnelle de <strong>patchwork</strong>.</p>
<p>Voici l’<a href="https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html">introduction au cowplot</a> en ligne. Vous pouvez lire la documentation plus complète de chaque fonction <a href="https://www.rdocumentation.org/packages/cowplot/versions/1.1.1">ici</a>. Nous couvrirons ci-dessous quelques-uns des cas d’utilisation et des fonctions les plus courantes.</p>
<p>Le “package” <strong>cowplot</strong> fonctionne en tandem avec <strong>ggplot2</strong> - essentiellement, vous l’utilisez pour arranger et combiner les ggplots et leurs légendes en figures composées. Il peut également accepter les graphiques R <strong>base</strong>.</p>
<div class="sourceCode" id="cb1410"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span> <span class="co">#charger les packages dont on aura besoin</span></span>
<span>  <span class="va">tidyverse</span>,      <span class="co"># pour manipuler et visualiser des données</span></span>
<span>  <span class="va">cowplot</span>,        <span class="co"># pour combiner des graphes</span></span>
<span>  <span class="va">patchwork</span>       <span class="co"># pour combiner des graphes</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Bien que le “faceting” (décrit dans la page <a href="ggplot_basics.html#ggplot_basics">bases de ggplot</a>) soit une approche pratique de la représentation graphique, il est parfois impossible d’obtenir les résultats souhaités avec son approche relativement restrictive. Dans ce cas, vous pouvez choisir de combiner des graphiques en les collant ensemble dans un graphique plus grand. Il y a trois packages bien connus qui sont parfaits pour cela - <strong>cowplot</strong>, <strong>gridExtra</strong>, et <strong>patchwork</strong>. Cependant, ces package font largement les mêmes choses, donc nous nous concentrerons sur <strong>cowplot</strong> pour cette section.</p>
<div id="plot_grid" class="section level3 unnumbered">
<h3>
<code>plot_grid()</code><a class="anchor" aria-label="anchor" href="#plot_grid"><i class="fas fa-link"></i></a>
</h3>
<p>Le package <strong>cowplot</strong> a une gamme assez large de fonctions, mais l’utilisation la plus simple peut être réalisée par l’utilisation de <code>plot_grid()</code>. Il s’agit en fait d’un moyen d’arranger des graphiques prédéfinis dans une formation en grille. Nous pouvons travailler sur un autre exemple avec le jeu de données sur le paludisme - ici, nous pouvons représenter le nombre total de cas par district, et également montrer la courbe épidémique dans le temps.</p>
<div class="sourceCode" id="cb1411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"malaria_facility_count_data.rds"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># diagramme en barres du nombre total de cas par district</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">District</span>, y <span class="op">=</span> <span class="va">malaria_tot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"District"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Total number of cases"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Total malaria cases by district"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># courbe epidemique en fonction du temps</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">malaria_tot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Date of data submission"</span>,</span>
<span>    y <span class="op">=</span>  <span class="st">"number of cases"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>,</span>
<span>                  <span class="co"># 1 colonne et deux lignes - empilées l'une sur l'autre</span></span>
<span>                   ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                   nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                   <span class="co"># le graphe du haut fait 2/3 de la hauteur du second</span></span>
<span>                   rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1072-1.png" width="672"></div>
</div>
<div id="combiner-les-légendes" class="section level3 unnumbered">
<h3>Combiner les légendes<a class="anchor" aria-label="anchor" href="#combiner-les-l%C3%A9gendes"><i class="fas fa-link"></i></a>
</h3>
<p>Si vos graphiques ont la même légende, il est relativement simple de les combiner. Utilisez simplement l’approche <strong>cowplot</strong> ci-dessus pour combiner les graphiques, mais supprimez la légende de l’une d’entre elles (pour éviter la dé-duplication).</p>
<p>Si vos graphiques ont des légendes différentes, vous devez utiliser une autre approche :</p>
<ol style="list-style-type: decimal">
<li>Créez et enregistrez vos graphiques <em>sans légendes</em> en utilisant <code>theme(legend.position = "none")</code>.</li>
<li>Extrayez les légendes de chaque graphe en utilisant <code>get_legend()</code> comme indiqué ci-dessous - <em>mais extrayez les légendes des graphes modifiés pour afficher réellement la légende</em>.</li>
<li>Combinez les légendes dans un panneau de légendes.</li>
<li>Combinez les graphes et le panneau de légendes.</li>
</ol>
<p>Pour la démonstration, nous montrons les deux graphiques séparément, puis disposés dans une grille avec leurs propres légendes (utilisation laide et inefficace de l’espace) :</p>
<div class="sourceCode" id="cb1412"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Marks"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">4</span>, na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cases by outcome"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Marks"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">1</span>, na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cases by age"</span><span class="op">)</span></span></code></pre></div>
<p>Voici à quoi ressemblent les deux graphiques lorsqu’ils sont combinés en utilisant <code>plot_grid()</code> sans combiner leurs légendes :</p>
<div class="sourceCode" id="cb1413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1074-1.png" width="672"></div>
<p>Et maintenant, nous montrons comment combiner les légendes. Essentiellement, ce que nous faisons est de définir chaque graphique <em>sans</em> sa légende (<code>theme(legend.position = "none"</code>), et ensuite nous définissons la légende de chaque graphe <em>séparément</em>, en utilisant la fonction <code>get_legend()</code> de <strong>cowplot</strong>. Lorsque nous extrayons la légende du graphe sauvegardé, nous devons ajouter <code>+</code> la légende à nouveau, y compris en spécifiant le placement (<code>"right"</code>) et des ajustements plus petits pour l’alignement des légendes et de leurs titres. Ensuite, nous combinons les légendes ensemble verticalement, puis nous combinons les deux graphes avec les légendes nouvellement combinées. Voilà !</p>
<div class="sourceCode" id="cb1414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Définir graphe 1 sans legende</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Marks"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">4</span>, na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cases by outcome"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Définir graphe 2 sans legende</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Marks"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">1</span>, na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cases by age"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># extraire légende de p1 (de p1 + legend)</span></span>
<span><span class="va">leg_p1</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/get_legend.html">get_legend</a></span><span class="op">(</span><span class="va">p1</span> <span class="op">+</span></span>
<span>                                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>,        <span class="co"># extraire légende verticale</span></span>
<span>                                      legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># pour bien  aligner la légende</span></span>
<span>                                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Outcome"</span><span class="op">)</span><span class="op">)</span>                 <span class="co"># titre de la légende</span></span>
<span><span class="co"># extraire légende de p2 (de p2 + legend)</span></span>
<span><span class="va">leg_p2</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/get_legend.html">get_legend</a></span><span class="op">(</span><span class="va">p2</span> <span class="op">+</span> </span>
<span>                                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>,         <span class="co"># extraire légende verticale   </span></span>
<span>                                      legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># pour bien  aligner la légende</span></span>
<span>                                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Age Category"</span><span class="op">)</span><span class="op">)</span>             <span class="co"># titre de la légende</span></span>
<span></span>
<span><span class="co"># créer un tracé vierge pour l'alignement de la légende</span></span>
<span><span class="co">#blank_p &lt;- patchwork::plot_spacer() + theme_void()</span></span>
<span></span>
<span><span class="co"># créer un panneau de légendes, qui peut être superposé (ou utiliser l'espaceur commenté ci-dessus)</span></span>
<span><span class="va">legends</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">leg_p1</span>, <span class="va">leg_p2</span>, nrow <span class="op">=</span> <span class="fl">2</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="fl">.7</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combiner les deux graphiques et le panneau de légendes combiné</span></span>
<span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">legends</span>, ncol <span class="op">=</span> <span class="fl">3</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">.4</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined</span>  <span class="co"># afficher ce qui est enregistré sous "combined"</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1075-1.png" width="672"></div>
<p>Cette solution a été tirée de <a href="https://stackoverflow.com/questions/52060601/ggplot-multiple-legends-arrangement">cette pubication</a> avec une correction mineure pour aligner les légendes inspiré de <a href="https://github.com/wilkelab/cowplot/issues/33">cette pubication</a>.</p>
<p><span style="color : black;"><strong><em><em>NOTE:</em></em></strong> Note amusante - le “cow” dans <strong>cowplot</strong> vient du nom du créateur - Claus O. Wilke.</span></p>
</div>
<div id="encastrer-des-graphiques" class="section level3 unnumbered">
<h3>Encastrer des graphiques<a class="anchor" aria-label="anchor" href="#encastrer-des-graphiques"><i class="fas fa-link"></i></a>
</h3>
<p>Vous pouvez encastrer un graphique dans un autre en utilisant <strong>cowplot</strong>. Voici les points à prendre en compte :</p>
<ul>
<li>Définissez le graphique principal avec <code>theme_half_open()</code> de <strong>cowplot</strong> ; il peut être préférable d’avoir la légende en haut ou en bas.</li>
<li>Définissez le graphique à encastrer. Le mieux est d’avoir un graphe où vous n’avez pas besoin de légende. Vous pouvez supprimer les éléments du thème du graphe avec <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank()</a></code> comme indiqué ci-dessous.</li>
<li>Combinez-les en appliquant <code>ggdraw()</code> au graphe principal, puis en ajoutant <code>draw_plot()</code> au graphe à encastrer et en spécifiant les coordonnées (x et y du coin inférieur gauche), la hauteur et la largeur en tant que proportion par rapport au graphe principal.</li>
</ul>
<div class="sourceCode" id="cb1415"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Définir graphe principal</span></span>
<span><span class="va">main_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">1</span>, na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu">theme_half_open</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Epidemic curve and outcomes by hospital"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Définir graphe à encastrer</span></span>
<span><span class="va">inset_plot</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Marks"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">4</span>, na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>          axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cases by outcome"</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="co"># Combiner graphe principal avec celui à encastrer</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="va">main_plot</span><span class="op">)</span><span class="op">+</span></span>
<span>     <span class="fu">draw_plot</span><span class="op">(</span><span class="va">inset_plot</span>,</span>
<span>               x <span class="op">=</span> <span class="fl">.6</span>, y <span class="op">=</span> <span class="fl">.55</span>,    <span class="co">#x = .07, y = .65,</span></span>
<span>               width <span class="op">=</span> <span class="fl">.4</span>, height <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1076-1.png" width="100%"></div>
<p>Cette technique est expliquée plus en détail dans ces deux vignettes:</p>
<p><a href="https://wilkelab.org/cowplot/articles/drawing_with_on_plots.html">Wilke lab</a><br><a href="https://www.rdocumentation.org/packages/cowplot/versions/1.1.1/topics/draw_plot">Documentation draw_plot()</a></p>
<!-- ======================================================= -->
</div>
</div>
<div id="axes-doubles" class="section level2" number="31.11">
<h2>
<span class="header-section-number">31.11</span> Axes doubles<a class="anchor" aria-label="anchor" href="#axes-doubles"><i class="fas fa-link"></i></a>
</h2>
<p>Un axe y secondaire est souvent un ajout demandé à un graphique <code>ggplot2</code>. Bien que la validité de tels graphiques fasse l’objet d’un débat animé au sein de la communauté de la visualisation de données, et qu’ils ne sont souvent pas recommandés, il se peut que vous devriez y avoir recours. Nous présentons ci-dessous une méthode pour y parvenir : l’utilisation du package <strong>cowplot</strong> pour combiner deux graphiques séparés.</p>
<p>Cette approche implique la création de deux graphiques distincts - l’un avec un axe y sur la gauche, et l’autre avec un axe y sur la droite. Tous deux utiliseront un <code>theme_cowplot()</code> spécifique et doivent avoir le même axe des x. Ensuite, dans une troisième commande, les deux graphiques sont alignés et superposés l’un sur l’autre. Les fonctionnalités de <strong>cowplot</strong>, dont celle-ci n’est qu’une partie, sont décrites en profondeur sur ce <a href="https://wilkelab.org/cowplot/articles/aligning_plots.html">site</a>.</p>
<p>Pour démontrer cette technique, nous allons superposer la courbe épidémique avec une ligne représentant le pourcentage hebdomadaire de patients décédés. Nous utilisons cet exemple parce que l’alignement des dates sur l’axe des x est plus complexe que, par exemple, l’alignement d’un graphique à barres avec un autre graphique. Quelques points à noter :</p>
<ul>
<li>L’épicurve et la ligne sont agrégées en semaines avant d’être tracées <em>et</em> les <code>date_breaks</code> et les <code>date_labels</code> sont identiques - nous faisons cela pour que les axes x des deux graphiques soient les mêmes lorsqu’ils sont superposés.</li>
<li>L’axe des y est déplacé vers la droite pour le graphique 2 avec l’argument <code>position =</code> de <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous()</a></code>.</li>
<li>Les deux graphiques utilisent <code>theme_cowplot()</code>.</li>
</ul>
<p>Notez qu’il existe un autre exemple de cette technique sur la page <a href="epicurves.html#epicurves">Courbes épidémiques</a> - superposition de l’incidence cumulée sur l’épicurve.</p>
<p><strong>Tracer le graphique 1</strong><br>
Ceci reste essentiellement une épicurve. Nous utilisons <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area()</a></code> juste pour démontrer son utilisation (aire sous une ligne, par défaut).</p>
<div class="sourceCode" id="cb1416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span>            <span class="co"># charger/installer cowplot au besoin</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>                 <span class="co"># sauvegarder le graphe comme un objet nommé p1</span></span>
<span>     <span class="fu">count</span><span class="op">(</span></span>
<span>       epiweek <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>               date_breaks <span class="op">=</span> <span class="st">"month"</span>,</span>
<span>               date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span><span class="op">+</span></span>
<span>     <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>       y <span class="op">=</span> <span class="st">"Weekly cases"</span></span>
<span>     <span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span>                                      <span class="co"># afficher p1</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1077-1.png" width="672"></div>
<p><strong>Tracer le graphique 2</strong><br>
Créez le deuxième graphique qui montre une ligne du pourcentage hebdomadaire de décès.</p>
<div class="sourceCode" id="cb1417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>         <span class="co"># sauvegarder le graphe comme un objet nommé p2</span></span>
<span>     <span class="fu">group_by</span><span class="op">(</span></span>
<span>       epiweek <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>     <span class="fu">summarise</span><span class="op">(</span></span>
<span>       n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>       pct_death <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek</span>, y <span class="op">=</span> <span class="va">pct_death</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>               date_breaks <span class="op">=</span> <span class="st">"month"</span>,</span>
<span>               date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>               position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>            x <span class="op">=</span> <span class="st">"Epiweek of symptom onset"</span>,</span>
<span>            y <span class="op">=</span> <span class="st">"Weekly percent of deaths"</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"Weekly case incidence and percent deaths"</span></span>
<span>          <span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span>     <span class="co"># afficher p2</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1078-1.png" width="672"></div>
<p>Maintenant, nous alignons le graphique en utilisant la fonction <code>align_plots()</code>, en spécifiant l’alignement horizontal et vertical (“hv”, qui peut aussi être “h”, “v”, “none”). Nous spécifions également l’alignement de tous les axes (haut, bas, gauche et droite) avec “tblr”. Il en résulte un objet de classe liste (avec 2 éléments).</p>
<p>Ensuite, nous dessinons les deux graphiques ensemble en utilisant <code>ggdraw()</code> (de <strong>cowplot</strong>) et en référençant les deux parties de l’objet <code>aligned_plots</code>.</p>
<div class="sourceCode" id="cb1418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aligned_plots</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/align_plots.html">align_plots</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, align<span class="op">=</span><span class="st">"hv"</span>, axis<span class="op">=</span><span class="st">"tblr"</span><span class="op">)</span>         <span class="co"># aligner les deux graphes et les sauvegarder en tant que liste</span></span>
<span><span class="va">aligned_plotted</span> <span class="op">&lt;-</span> <span class="fu">ggdraw</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">draw_plot</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>  <span class="co"># les superposer et sauvegarder le  visuel résultant</span></span>
<span><span class="va">aligned_plotted</span>                                                                <span class="co"># afficher les graphiques superposés</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1079-1.png" width="672"></div>
<!-- ### Statistical transformation {.unnumbered}   -->
<!-- Another way to do this to have the second axis be a direct transformation of the secondary axis.  -->
<!-- Differences in axis values will be purely cosmetic - if you want to show two different variables on one graph, with different y-axis scales for each variable, this will not work without some work behind the scenes. To obtain this effect, you will have to transform one of your variables in the data, and apply the same transformation *in reverse* when specifying the axis labels. Based on this, you can either specify the transformation explicitly (e.g. variable a is around 10x as large as variable b) or calculate it in the code (e.g. what is the ratio between the maximum values of each dataset). -->
<!-- The syntax for adding a secondary axis is very straightforward! When calling a `scale_xxx_xxx()` function (e.g. `scale_y_continuous()`), use the `sec.axis` argument to call the `sec_axis()` function. The `trans` argument in this function allows you to specify the label transformation for the axis - provide this in standard tidyverse syntax.  -->
<!-- For example, if we want to show the number of positive RDTs in the malaria dataset for facility 1, showing 0-4 year olds and all cases on chart: -->
<!-- ```{r, , warning=F, message=F} -->
<!-- # take malaria data from facility 1 -->
<!-- malaria_facility_1 <- malaria_data %>% -->
<!--   filter(location_name == "Facility 1") -->
<!-- # calculate the ratio between malaria_rdt_0-4 and malaria_tot  -->
<!-- tf_ratio <- max(malaria_facility_1$malaria_tot, na.rm = T) / max(malaria_facility_1$`malaria_rdt_0-4`, na.rm = T) -->
<!-- # transform the values in the dataset -->
<!-- malaria_facility_1 <- malaria_facility_1 %>% -->
<!--   mutate(malaria_rdt_0_4_tf = `malaria_rdt_0-4` * tf_ratio) -->
<!-- # plot the graph with dual axes -->
<!-- ggplot(malaria_facility_1, aes(x = data_date)) + -->
<!--   geom_line(aes(y = malaria_tot, col = "Total cases")) + -->
<!--   geom_line(aes(y = malaria_rdt_0_4_tf, col = "Cases: 0-4 years old")) + -->
<!--   scale_y_continuous( -->
<!--     name = "Total cases", -->
<!--     sec.axis = sec_axis(trans = ~ . / tf_ratio, name = "Cases: 0-4 years old") -->
<!--   ) + -->
<!--   labs(x = "date of data collection") + -->
<!--   theme_minimal() + -->
<!--   theme(legend.title = element_blank()) -->
<!-- ``` -->
<!-- ## Sparklines   -->
<!-- UNDER CONSTRUCTION   -->
<!-- (perhaps move to Tables for presentation page) -->
</div>
<div id="packages-pour-vous-aider" class="section level2" number="31.12">
<h2>
<span class="header-section-number">31.12</span> Packages pour vous aider<a class="anchor" aria-label="anchor" href="#packages-pour-vous-aider"><i class="fas fa-link"></i></a>
</h2>
<p>Il existe quelques packages R très intéressants, spécialement conçus pour vous aider à naviguer dans <strong>ggplot2</strong> :</p>
<div id="faire-du-ggplot2-via-clique-boutton-avec-equisse" class="section level3 unnumbered">
<h3>Faire du <strong>ggplot2</strong> via clique-boutton avec <strong>equisse</strong><a class="anchor" aria-label="anchor" href="#faire-du-ggplot2-via-clique-boutton-avec-equisse"><i class="fas fa-link"></i></a>
</h3>
<p><strong>equisse</strong> fournit une interface graphique pour la construction de graphiques avec <strong>ggplot2</strong>. “Cet addin vous permet d’explorer interactivement vos données en les visualisant avec le package ggplot2. Il vous permet de dessiner des diagrammes en barres, des courbes, des diagrammes de dispersion, des histogrammes, des boxplot et des objets sf, puis d’exporter le graphique ou de récupérer le code pour reproduire le graphique.”</p>
<p>Installez puis lancez l’addin via le menu RStudio ou avec <code>esquisse::esquisser()</code>.</p>
<p>Voir la <a href="https://github.com/dreamRs/esquisse">page Github</a></p>
<p><a href="https://dreamrs.github.io/esquisse/index.html">Documentation</a></p>
</div>
</div>
<div id="divers" class="section level2" number="31.13">
<h2>
<span class="header-section-number">31.13</span> Divers<a class="anchor" aria-label="anchor" href="#divers"><i class="fas fa-link"></i></a>
</h2>
<div id="affichage-numérique" class="section level3 unnumbered">
<h3>Affichage numérique<a class="anchor" aria-label="anchor" href="#affichage-num%C3%A9rique"><i class="fas fa-link"></i></a>
</h3>
<p>Vous pouvez désactiver la notation scientifique en exécutant cette commande avant le graphique.</p>
<div class="sourceCode" id="cb1419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>scipen<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></code></pre></div>
<p>Ou appliquez <code>number_format()</code> du package <strong>scales</strong> à une valeur ou une colonne spécifique, comme indiqué ci-dessous.</p>
<p>Utilisez les fonctions du package <strong>scales</strong> pour ajuster facilement l’affichage des nombres. Ces fonctions peuvent être appliquées aux variables de votre jeu de données, mais sont présentées sur des nombres individuels pour les besoins de l’exemple.</p>
<div class="sourceCode" id="cb1420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html">number</a></span><span class="op">(</span><span class="fl">6.2e5</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "620 000"</code></pre>
<div class="sourceCode" id="cb1422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html">number</a></span><span class="op">(</span><span class="fl">1506800.62</span>,  accuracy <span class="op">=</span> <span class="fl">0.1</span>,<span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "1 506 800.6"</code></pre>
<div class="sourceCode" id="cb1424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">(</span><span class="fl">1506800.62</span>, accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "1,506,800.62"</code></pre>
<div class="sourceCode" id="cb1426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">(</span><span class="fl">1506800.62</span>, accuracy <span class="op">=</span> <span class="fl">0.01</span>,  big.mark <span class="op">=</span> <span class="st">"."</span> , decimal.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "1.506.800,62"</code></pre>
<div class="sourceCode" id="cb1428"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "10%"</code></pre>
<div class="sourceCode" id="cb1430"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/dollar_format.html">dollar</a></span><span class="op">(</span><span class="fl">56</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "$56"</code></pre>
<div class="sourceCode" id="cb1432"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/scientific_format.html">scientific</a></span><span class="op">(</span><span class="fl">100000</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "1e+05"</code></pre>
</div>
</div>
<div id="ressources-18" class="section level2" number="31.14">
<h2>
<span class="header-section-number">31.14</span> Ressources<a class="anchor" aria-label="anchor" href="#ressources-18"><i class="fas fa-link"></i></a>
</h2>
<p>Inspiration <a href="https://www.tidyverse.org/blog/2018/07/ggplot2-3-0-0/">ggplot graph gallery</a></p>
<p><a href="https://ecdc.europa.eu/sites/portal/files/documents/Guidelines%20for%20presentation%20of%20surveillance%20data-final-with-cover-for-we....pdf">Guide pour la présentation des données de surveillance</a></p>
<p><a href="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/#modifying-facet-label-text">Facets et étiquettes</a> <a href="https://ggplot2.tidyverse.org/reference/labellers.html">Fonction d’étiquetage</a></p>
<p>Ajuster l’ordre des modalités des variables de type facteur <a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a><br><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a><br><a href="https://cmdlinetips.com/2019/02/how-to-reorder-a-boxplot-in-r/">Ré-arranger un boxplot</a><br><a href="https://www.r-graph-gallery.com/267-reorder-a-variable-in-ggplot2.html">Ré-ordonner une variable dans ggplot2</a><br><a href="https://r4ds.had.co.nz/factors.html">R for Data Science - Factors</a></p>
<p>Légendes<br><a href="https://stackoverflow.com/questions/38425908/reverse-stacking-order-without-affecting-legend-order-in-ggplot2-bar-charts">Ajuster l’ordre d’une légende</a></p>
<p>Notes de bas de graphique: <a href="https://stackoverflow.com/questions/64701500/left-align-ggplot-caption">Alignement des notes du graphique</a></p>
<p>Etiquettes<br><a href="https://ggrepel.slowkow.com/articles/examples.html">ggrepel</a></p>
<p>Anti-sèches<br><a href="http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/">Beautiful plotting with ggplot2</a></p>
<!-- TO DO - Under construction -->
<!-- * Straight horizontal, vertical, or other line -->
<!-- You can also add straight lines to your plot with `geom_hline()` (horizontal), `geom_vline()` (vertical) or `geom_abline()` (with a specified y intercept and slope) -->
<!-- Using option `label_wrap_gen` in facet_wrap to have multiple strip lines -->
<!-- labels and colors of strips -->
<!-- Axis text vertical adjustment -->
<!-- rotation -->
<!-- Labellers -->
<!-- limit range with limit() and coord_cartesian(), ylim(), or scale_x_continuous() -->
<!-- theme_classic() -->
<!-- expand = c(0,0) -->
<!-- coord_flip() -->
<!-- tick marks -->
<!-- ggrepel -->
<!-- animations -->
<!-- remove -->
<!-- remove title -->
<!-- using fill = or color = in labs() -->
<!-- flip order / don't flip order -->
<!-- move location -->
<!-- color?    theme(legend.title = element_text(colour="chocolate", size=16, face="bold"))+ scale_color_discrete(name="This color is\ncalled chocolate!?") -->
<!-- Color of boxes behind points in legend  -->
<!--      theme(legend.key=element_rect(fill='pink'))   or use fill = NA to remove them. http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/  -->
<!-- Change size of symbols in legend only guides(colour = guide_legend(override.aes = list(size=4))) -->
<!-- Turn off a layer in the legend -->
<!-- geom_text(data=nmmaps, aes(date, temp, label=round(temp)), size=4) -->
<!-- geom_text(data=nmmaps, aes(date, temp, label=round(temp), size=4), show_guide=FALSE) -->
<!-- Force a legend even if there is no aes().  -->
<!-- ggplot(nmmaps, aes(x=date, y=o3))+ -->
<!--      geom_line(aes(color="Important line"))+ -->
<!--      geom_point(aes(color="My points")) -->
<!-- Control the shape in the legend with guides - a list with linetype and shape -->
<!-- ggplot(nmmaps, aes(x=date, y=o3))+geom_line(aes(color="Important line"))+ -->
<!--    geom_point(aes(color="Point values"))+ -->
<!--   scale_colour_manual(name='', values=c('Important line'='grey', 'Point values'='red'), guide='legend') + -->
<!--   guides(colour = guide_legend(override.aes = list(linetype=c(1,0) -->
<!--                                                       , shape=c(NA, 16)))) -->

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="tracer-des-donn%C3%A9es-cat%C3%A9gorielles.html"><span class="header-section-number">30</span> Tracer des données catégorielles</a></div>
<div class="next"><a href="epicurves.html"><span class="header-section-number">32</span> Courbes épidémiques</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ggplot_tips"><span class="header-section-number">31</span> Trucs et Astuces avec ggplot</a></li>
<li>
<a class="nav-link" href="#pr%C3%A9paration-16"><span class="header-section-number">31.1</span> Préparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#charger-les-extensions-packages-1">Charger les extensions (“packages”)</a></li>
<li><a class="nav-link" href="#importer-des-donn%C3%A9es-6">Importer des données</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#ggplot_tips_colors"><span class="header-section-number">31.2</span> Palettes de couleur, le remplissage, les axes, etc.</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#palettes-de-couleurs"><span class="header-section-number">31.2.1</span> Palettes de couleurs</a></li>
<li><a class="nav-link" href="#ggplot_tips_scales">Scales</a></li>
<li><a class="nav-link" href="#arguments-des-scales">Arguments des “Scales”</a></li>
<li><a class="nav-link" href="#r%C3%A9glages-manuels">Réglages manuels</a></li>
<li><a class="nav-link" href="#scales-daxes-continus">“Scales” d’axes continus</a></li>
<li><a class="nav-link" href="#gradient-de-couleur">Gradient de couleur</a></li>
<li><a class="nav-link" href="#palettes">Palettes</a></li>
</ul>
</li>
<li><a class="nav-link" href="#changement-de-lordre-des-variables-discr%C3%A8tes"><span class="header-section-number">31.3</span> Changement de l’ordre des variables discrètes</a></li>
<li><a class="nav-link" href="#courbes-de-niveau"><span class="header-section-number">31.4</span> Courbes de niveau</a></li>
<li><a class="nav-link" href="#distributions-marginales"><span class="header-section-number">31.5</span> Distributions marginales</a></li>
<li><a class="nav-link" href="#%C3%A9tiquetage-pratiqueintelligent"><span class="header-section-number">31.6</span> Étiquetage pratique/intelligent</a></li>
<li><a class="nav-link" href="#axes-de-temps"><span class="header-section-number">31.7</span> Axes de temps</a></li>
<li><a class="nav-link" href="#mise-en-%C3%A9vidence"><span class="header-section-number">31.8</span> Mise en évidence</a></li>
<li><a class="nav-link" href="#repr%C3%A9senter-diff%C3%A9rentsmultiples-jeux-de-donn%C3%A9es"><span class="header-section-number">31.9</span> Représenter différents/multiples jeux de données</a></li>
<li>
<a class="nav-link" href="#combiner-des-graphiques"><span class="header-section-number">31.10</span> Combiner des graphiques</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#plot_grid">plot_grid()</a></li>
<li><a class="nav-link" href="#combiner-les-l%C3%A9gendes">Combiner les légendes</a></li>
<li><a class="nav-link" href="#encastrer-des-graphiques">Encastrer des graphiques</a></li>
</ul>
</li>
<li><a class="nav-link" href="#axes-doubles"><span class="header-section-number">31.11</span> Axes doubles</a></li>
<li>
<a class="nav-link" href="#packages-pour-vous-aider"><span class="header-section-number">31.12</span> Packages pour vous aider</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#faire-du-ggplot2-via-clique-boutton-avec-equisse">Faire du ggplot2 via clique-boutton avec equisse</a></li></ul>
</li>
<li>
<a class="nav-link" href="#divers"><span class="header-section-number">31.13</span> Divers</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#affichage-num%C3%A9rique">Affichage numérique</a></li></ul>
</li>
<li><a class="nav-link" href="#ressources-18"><span class="header-section-number">31.14</span> Ressources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Le Epi R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-21.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
