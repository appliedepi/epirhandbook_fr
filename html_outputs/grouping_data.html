<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>12 Travailler sur des données groupées | Le Epi R Handbook</title>
<meta name="author" content="the handbook team">
<meta name="description" content="Ce chapitre explique comment grouper et agréger des données lors une analyse descriptive. Il utilise les fonctions du méta-paquet tidyverse pour des fonctions communes et faciles à utiliser....">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="12 Travailler sur des données groupées | Le Epi R Handbook">
<meta property="og:type" content="book">
<meta property="og:description" content="Ce chapitre explique comment grouper et agréger des données lors une analyse descriptive. Il utilise les fonctions du méta-paquet tidyverse pour des fonctions communes et faciles à utiliser....">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="12 Travailler sur des données groupées | Le Epi R Handbook">
<meta name="twitter:description" content="Ce chapitre explique comment grouper et agréger des données lors une analyse descriptive. Il utilise les fonctions du méta-paquet tidyverse pour des fonctions communes et faciles à utiliser....">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.28/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.10/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Le Epi R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">About this book</li>
<li><a class="" href="editorial_notes.html"><span class="header-section-number">1</span> Notes techniques et choix éditoriaux</a></li>
<li><a class="" href="download_book_data.html"><span class="header-section-number">2</span> Télécharger le manuel et les données</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="transition_to_r.html"><span class="header-section-number">3</span> Transition vers R</a></li>
<li><a class="" href="suggested_packages.html"><span class="header-section-number">4</span> Paquets conseillés</a></li>
<li><a class="" href="r_projects.html"><span class="header-section-number">5</span> Projets R</a></li>
<li><a class="" href="import_export.html"><span class="header-section-number">6</span> Importer et exporter des données</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning_data.html"><span class="header-section-number">7</span> Nettoyage de données et fonctions essentielles</a></li>
<li><a class="" href="working_dates.html"><span class="header-section-number">8</span> Manipuler les dates</a></li>
<li><a class="" href="character_strings.html"><span class="header-section-number">9</span> Caractères et chaînes de caractères</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">10</span> Facteurs</a></li>
<li><a class="" href="pivoting_data.html"><span class="header-section-number">11</span> Restructurer les données</a></li>
<li><a class="active" href="grouping_data.html"><span class="header-section-number">12</span> Travailler sur des données groupées</a></li>
<li><a class="" href="joining_matching.html"><span class="header-section-number">13</span> Joindre des données</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">14</span> De-duplication</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">15</span> Itération, boucles et listes</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive_tables.html"><span class="header-section-number">16</span> Tableaux descriptifs</a></li>
<li><a class="" href="stats_test.html"><span class="header-section-number">17</span> Tests statistiques simples</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">18</span> Régression univariée et multivariable</a></li>
<li><a class="" href="missing_data.html"><span class="header-section-number">19</span> Données manquantes</a></li>
<li><a class="" href="standardisation.html"><span class="header-section-number">20</span> Taux standardisés</a></li>
<li><a class="" href="moving_average.html"><span class="header-section-number">21</span> Moyennes mobiles</a></li>
<li><a class="" href="time_series.html"><span class="header-section-number">22</span> Série temporelle et détection des épidémies</a></li>
<li><a class="" href="contact_tracing.html"><span class="header-section-number">23</span> Suivi des contacts</a></li>
<li><a class="" href="survey_analysis.html"><span class="header-section-number">24</span> Analyse d’enquête</a></li>
<li><a class="" href="survival_analysis.html"><span class="header-section-number">25</span> Analyse de survie</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">26</span> GIS basics</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="tables_presentation.html"><span class="header-section-number">27</span> Présenter avec des tables</a></li>
<li><a class="" href="ggplot_basics.html"><span class="header-section-number">28</span> Les bases de ggplot</a></li>
<li><a class="" href="plot_continuous.html"><span class="header-section-number">29</span> Traçage de données continues</a></li>
<li><a class="" href="tracer-des-donn%C3%A9es-cat%C3%A9gorielles.html"><span class="header-section-number">30</span> Tracer des données catégorielles</a></li>
<li><a class="" href="ggplot_tips.html"><span class="header-section-number">31</span> Trucs et Astuces avec ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> Courbes épidémiques</a></li>
<li><a class="" href="age_pyramid.html"><span class="header-section-number">33</span> Pyramides démographiques et échelles de Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> Graphiques thermiques</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> Diagrammes et schémas</a></li>
<li><a class="" href="combination_analysis.html"><span class="header-section-number">36</span> Analyse des combinaisons</a></li>
<li><a class="" href="transmission_chains.html"><span class="header-section-number">37</span> Chaînes de transmission</a></li>
<li><a class="" href="phylogenetic_trees.html"><span class="header-section-number">38</span> Les arbres phylogénétiques</a></li>
<li><a class="" href="interactive_plots.html"><span class="header-section-number">39</span> Graphiques interactifs</a></li>
<li class="book-part">Reports and dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> Production de rapports avec R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> Organisation des rapports de routine</a></li>
<li><a class="" href="dashboards.html"><span class="header-section-number">42</span> Tableaux de bord avec R Markdown</a></li>
<li><a class="" href="shiny.html"><span class="header-section-number">43</span> Tableaux de bord avec Shiny</a></li>
<li class="book-part">Miscellaneous</li>
<li><a class="" href="writing_functions.html"><span class="header-section-number">44</span> Fonctions d’écriture</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> Interactions avec les répertoires</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Contrôle de version et collaboration avec Git et Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> Erreurs fréquentes</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> Obtenir de l’aide</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">49</span> Relational databases</a></li>
<li><a class="" href="network_drives.html"><span class="header-section-number">50</span> R sur les lecteurs réseau</a></li>
<li><a class="" href="data_table.html"><span class="header-section-number">51</span> Tableau de données</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">52</span> Advanced RStudio</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="grouping_data" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> Travailler sur des données groupées<a class="anchor" aria-label="anchor" href="#grouping_data"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/Grouping_1500x500.png" width="100%"></div>
<p>Ce chapitre explique comment grouper et agréger des données lors une analyse descriptive. Il utilise les fonctions du méta-paquet <strong>tidyverse</strong> pour des fonctions communes et faciles à utiliser.</p>
<p>Grouper les données est une étape essentielle de la gestion et de l’analyse de données. Par exemple, il est souvent nécessaire de créer des résumés statistiques ou des figures “par groupe”. Les fonctions du paquet <strong>dplyr</strong> (qui fait partie de <strong>tidyverse</strong>) permettent de grouper les données et d’effectuer de nombreuses
actions “par groupes très facilement.</p>
<p>Ce chapitre aborde les sujets suivants :</p>
<ul>
<li>Grouper les données avec la fonction <code>group_by()</code>.<br>
</li>
<li>Dé-grouper des données<br>
</li>
<li>Résumer les données groupées avec des statistiques (<code>summarise()</code>)<br>
</li>
<li>La différence entre <code>count()</code> et <code>tally()</code>.<br>
</li>
<li>Trier les données groupées avec la fonction <code>arrange()</code><br>
</li>
<li>Filtrer les données groupées avec la fonction <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code><br>
</li>
<li>Créer de nouvelles colonnes avec la fonction <code>mutate()</code><br>
</li>
<li>Sélectionner les colonnes avec la fonction <code>select()</code><br>
</li>
<li>La commande <strong>base</strong> R <code><a href="https://rdrr.io/r/stats/aggregate.html">aggregate()</a></code>, qui est une alternative aux fonctions de <strong>dplyr</strong>.</li>
</ul>
<!-- ======================================================= --><div id="étapes-préliminaires-1" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> Étapes préliminaires<a class="anchor" aria-label="anchor" href="#%C3%A9tapes-pr%C3%A9liminaires-1"><i class="fas fa-link"></i></a>
</h2>
<div id="importation-des-paquets-2" class="section level3 unnumbered">
<h3>Importation des paquets<a class="anchor" aria-label="anchor" href="#importation-des-paquets-2"><i class="fas fa-link"></i></a>
</h3>
<p>Ces lignes de code chargent les paquets nécessaires aux analyses. Dans ce guide, nous mettons l’accent sur <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, qui installe le paquet si nécessaire <em>puis</em> l’importe pour l’utiliser. Vous pouvez également charger les paquets installés avec <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de <strong>base</strong> R. Voir la page sur <a href="#rbasics">bases de R</a> pour plus d’informations sur les paquets R.</p>
<div class="sourceCode" id="cb513"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">rio</span>,       <span class="co"># import des fichiers</span></span>
<span>  <span class="va">here</span>,      <span class="co"># gestion des chemins d'accès</span></span>
<span>  <span class="va">tidyverse</span>, <span class="co"># gestion des données + graphiques (inclus dplyr)</span></span>
<span>  <span class="va">janitor</span><span class="op">)</span>   <span class="co"># ajout de totaux aux lignes et colonnes</span></span></code></pre></div>
</div>
<div id="import-des-données" class="section level3 unnumbered">
<h3>Import des données<a class="anchor" aria-label="anchor" href="#import-des-donn%C3%A9es"><i class="fas fa-link"></i></a>
</h3>
<p>Dans ce chapitre, nous utiliserons un jeu de données fictif pour une épidémie d’Ebola. Pour reproduire les étapes, <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">cliquez pour télécharger la liste “nettoyée”</a> (sous forme de fichier .rds). Le jeu de données est importé à l’aide de la fonction <code>import()</code> du paquet <strong>rio</strong>. voir la page <a href="import_export">Importation et exportation des données</a> pour plus de détails).</p>
<div class="sourceCode" id="cb514"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Les premières cinquante lignes de la <code>linelist</code> :</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3d15c31a5811e528319c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3d15c31a5811e528319c">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="grouper-des-données" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> Grouper des données<a class="anchor" aria-label="anchor" href="#grouper-des-donn%C3%A9es"><i class="fas fa-link"></i></a>
</h2>
<p>La fonction <code>group_by()</code> de <strong>dplyr</strong> permet de définir des groupes de lignes à partir des valeurs d’une ou de plusieurs colonnes. Chaque valeur unique (ou combinaison de valeurs unique, dans le cas où plusieurs colonnes sont spécifiées) constitue un groupe. Une fois les données groupées, de nombreuses fonctions utilisées pour le nettoyage ou des analyses descriptives seront appliquées <em>à chaque groupe</em>.</p>
<p>Par exemple, le code ci-dessous groupe la <code>linelist</code> en fonction des valeurs uniques de la colonne <code>outcome</code>. La ou les colonnes selon lesquelles grouper les données sont placées entre parenthèses dans la fonction <code>group_by()</code>. La fonction génère un nouveau tableau de données, que nous nommons <code>ll_by_outcome</code>.</p>
<div class="sourceCode" id="cb515"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ll_by_outcome</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span></span></code></pre></div>
<p><strong>Notez que les données elles mêmes n’ont pas été modifiées</strong> après avoir exécuté <code>group_by()</code>. Le fait que le dataframe soit “groupé” se verra lorsqu’une autre fonction du paquet <strong>dplyr</strong> tel que <code>mutate()</code>, <code>summarise()</code>, ou <code>arrange()</code> sera appliquée sur le dataframe “groupé”.</p>
<p>Vous pouvez cependant savoir qu’un dataframe est groupé en l’imprimant dans la console. Vous verrez alors qu’il a été transformé en un <a href="https://tibble.tidyverse.org/">objet de classe <code>tibble</code></a> qui, lorsqu’il est affiché, indique les groupements présents et le nombre de groupes qu’il y a juste au-dessus de la ligne d’en-tête.</p>
<div class="sourceCode" id="cb516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Faire afficher pour voir le schéma de groupement</span></span>
<span><span class="va">ll_by_outcome</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 30
## # Groups:   outcome [3]
##    case_id generation date_infection date_onset date_hospitalisation date_outcome
##    &lt;chr&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;               &lt;date&gt;      
##  1 5fe599           4 2014-05-08     2014-05-13 2014-05-15           NA          
##  2 8689b7           4 NA             2014-05-13 2014-05-14           2014-05-18  
##  3 11f8ea           2 NA             2014-05-16 2014-05-18           2014-05-30  
##  4 b8812a           3 2014-05-04     2014-05-18 2014-05-20           NA          
##  5 893f25           3 2014-05-18     2014-05-21 2014-05-22           2014-05-29  
##  6 be99c8           3 2014-05-03     2014-05-22 2014-05-23           2014-05-24  
##  7 07e3e8           4 2014-05-22     2014-05-27 2014-05-29           2014-06-01  
##  8 369449           4 2014-05-28     2014-06-02 2014-06-03           2014-06-07  
##  9 f393b4           4 NA             2014-06-05 2014-06-06           2014-06-18  
## 10 1389ca           4 NA             2014-06-05 2014-06-07           2014-06-09  
## # ℹ 5,878 more rows
## # ℹ 24 more variables: outcome &lt;chr&gt;, gender &lt;chr&gt;, age &lt;dbl&gt;, age_unit &lt;chr&gt;,
## #   age_years &lt;dbl&gt;, age_cat &lt;fct&gt;, age_cat5 &lt;fct&gt;, hospital &lt;chr&gt;, lon &lt;dbl&gt;,
## #   lat &lt;dbl&gt;, infector &lt;chr&gt;, source &lt;chr&gt;, wt_kg &lt;dbl&gt;, ht_cm &lt;dbl&gt;,
## #   ct_blood &lt;dbl&gt;, fever &lt;chr&gt;, chills &lt;chr&gt;, cough &lt;chr&gt;, aches &lt;chr&gt;, vomit &lt;chr&gt;,
## #   temp &lt;dbl&gt;, time_admission &lt;chr&gt;, bmi &lt;dbl&gt;, days_onset_hosp &lt;dbl&gt;</code></pre>
<div id="groupes-distincts" class="section level3 unnumbered">
<h3>Groupes distincts<a class="anchor" aria-label="anchor" href="#groupes-distincts"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Les groupes sont basés sur les combinaisons uniques de valeurs dans les colonnes de groupement</strong>.</p>
<p>Pour afficher les groupes <em>et le nombre de lignes de chaque groupe</em>, passez les données groupées à la fonction <code>tally()</code>. Pour afficher les groupes présents mais pas le nombre de lignes, passez les données à la fonction <code>group_keys()</code>.</p>
<p>Dans l’exemple ci-dessous, il y a <strong>trois</strong> valeurs uniques dans la colonne de groupement <code>outcome</code> : “Death”, “Recover”, et “NA”. Vous voyez qu’il y avait <code>nrow(linelist %&gt;% filter(outcome == "Death"))</code> morts, <code>nrow(linelist %&gt;% filter(outcome == "Recover"))</code> guéris, et <code>nrow(linelist %&gt;% filter(is.na(outcome)))</code> individus sans information renseignée.</p>
<div class="sourceCode" id="cb518"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   outcome     n
##   &lt;chr&gt;   &lt;int&gt;
## 1 Death    2582
## 2 Recover  1983
## 3 &lt;NA&gt;     1323</code></pre>
<p>Vous pouvez regrouper par plus d’une colonne. Ci-dessous, nous groupons le dataframe par <code>outcome</code> et <code>gender</code>, puis comptons le nombre de lignes dans chaque groupe. Chaque combinaison unique de <code>outcome</code> et <code>gender</code> crée un groupe différent, y compris les valeurs manquantes pour chaque colonne.</p>
<div class="sourceCode" id="cb520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">outcome</span>, <span class="va">gender</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 9 × 3
## # Groups:   outcome [3]
##   outcome gender     n
##   &lt;chr&gt;   &lt;chr&gt;  &lt;int&gt;
## 1 Death   f       1227
## 2 Death   m       1228
## 3 Death   &lt;NA&gt;     127
## 4 Recover f        953
## 5 Recover m        950
## 6 Recover &lt;NA&gt;      80
## 7 &lt;NA&gt;    f        627
## 8 &lt;NA&gt;    m        625
## 9 &lt;NA&gt;    &lt;NA&gt;      71</code></pre>
</div>
<div id="nouvelle-colonne" class="section level3 unnumbered">
<h3>Nouvelle colonne<a class="anchor" aria-label="anchor" href="#nouvelle-colonne"><i class="fas fa-link"></i></a>
</h3>
<p>Vous pouvez également grouper selon une colonne crée <em>directement dans</em> la fonction <code>group_by()</code>. Cela revient à appeler <code>mutate()</code> avant le <code>group_by()</code>. Cela peut être intéressant pour créer de petites tables descriptives rapidement, mais dans d’autres cas, il sera plus lisible de créer la nouvelle colonne avec la fonction <code>mutate()</code> avant de passer le tableau à <code>group_by()</code>.</p>
<div class="sourceCode" id="cb522"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># grouper les données sur la base d'une colonne crée dans la commande group_by()</span></span>
<span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span></span>
<span>    age_class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">18</span>, <span class="st">"adult"</span>, <span class="st">"child"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tally</span><span class="op">(</span>sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   age_class     n
##   &lt;chr&gt;     &lt;int&gt;
## 1 child      3618
## 2 adult      2184
## 3 &lt;NA&gt;         86</code></pre>
</div>
<div id="grouper-selon-plus-ou-moins-de-colonnes" class="section level3 unnumbered">
<h3>Grouper selon plus ou moins de colonnes<a class="anchor" aria-label="anchor" href="#grouper-selon-plus-ou-moins-de-colonnes"><i class="fas fa-link"></i></a>
</h3>
<p>Par défaut, si vous exécutez <code>group_by()</code> sur des données déjà groupées, les anciens groupes seront supprimés et le ou les nouveaux groupes s’appliqueront. Si vous voulez ajouter de nouveaux groupes à ceux qui existent déjà, incluez l’argument <code>.add = TRUE</code>.</p>
<div class="sourceCode" id="cb524"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Grouper par  outcome</span></span>
<span><span class="va">by_outcome</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ajouter gender aux définition de groupe (grouper par une combinaison</span></span>
<span><span class="co"># de gender et outcome)</span></span>
<span><span class="va">by_outcome_gender</span> <span class="op">&lt;-</span> <span class="va">by_outcome</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gender</span>, .add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="conserver-tous-les-groupes" class="section level3 unnumbered">
<h3>Conserver tous les groupes<a class="anchor" aria-label="anchor" href="#conserver-tous-les-groupes"><i class="fas fa-link"></i></a>
</h3>
<p>Si vous groupez les données sur la base d’une colonne de type “facteur”, il se peut que certains niveaux du facteur ne soient pas présents dans le jeu de données dans son état actuel. Dans ce cas, ces niveaux non représentés seront abandonnés par défaut et n’apparaîtront pas dans les groupes. Pour éviter ce comportement et prendre en compte tous les niveaux du facteur, <em>y compris lorsqu’ils ne contiennent pas de données</em>, utilisez l’argument <code>.drop = FALSE</code> dans votre commande <code>group_by()</code>.</p>
</div>
</div>
<div id="dégrouper-les-données" class="section level2" number="12.3">
<h2>
<span class="header-section-number">12.3</span> Dégrouper les données<a class="anchor" aria-label="anchor" href="#d%C3%A9grouper-les-donn%C3%A9es"><i class="fas fa-link"></i></a>
</h2>
<p>Les dataframes qui ont été groupés le resteront jusqu’à ce qu’ils soient spécifiquement dégroupés grâce à la fonction <code>ungroup()</code>.</p>
<p>Attention à ne pas oublier de dégrouper les données avant de passer aux étapes qui nécessitent le jeu de données complet et non groupé.</p>
<div class="sourceCode" id="cb525"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">outcome</span>, <span class="va">gender</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>On peut également dégrouper seulement certaines colonnes, en passant le nom de la colonne à <code>ungroup()</code>.</p>
<div class="sourceCode" id="cb526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">outcome</span>, <span class="va">gender</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="co"># dégroupe gender, mais garde le groupement par outcome</span></span></code></pre></div>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> Le verbe <code>count()</code> dégroupe automatiquement les données après avoir compté les lignes.</span></p>
</div>
<div id="group_summarise" class="section level2" number="12.4">
<h2>
<span class="header-section-number">12.4</span> Résumer les données par groupe<a class="anchor" aria-label="anchor" href="#group_summarise"><i class="fas fa-link"></i></a>
</h2>
<p>Voir la section <strong>dplyr</strong> du chapitre sur les <a href="descriptive_tables.html#descriptive_tables">Tableaux descriptifs</a> pour une explication détaillée sur comment produire des tableaux récapitulatifs à l’aide de la fonction <code>summarise()</code>. Ici, nous décrivons le comportement de <code>summarise()</code> lorsque la fonction est appliquée à des données groupées.</p>
<p>La fonction de <strong>dplyr</strong> <code>summarise()</code> (ou <code>summarize()</code>) prend un dataframe en entrée et le convertit en un <em>nouveau dataframe</em> contenant des statistiques de synthèse définies par l’utilisateur. Sur un tableau non groupé, le calcul de synthèse est effectuée sur toutes les lignes. Sur un tableau groupé, le calcul est effectué <em>pour chaque groupe</em>.</p>
<p>Plus précisement, la syntaxe de la fonction <code>summarise()</code> est du type :
“NOM_NOUVELLE_COLONNE = fonction résumé d’une ou plusieurs colonnes des données source”. Dans la fonction statistique, indiquez la colonne à traiter et tout argument pertinent (par exemple, <code>na.rm = TRUE</code>). Les fonctions régulièrement utilisées incluent par exemple <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>, <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>, ou <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>, mais on peut également utiliser <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> pour compter le nombre de lignes qui répondent à un critère logique (avec l’opérateur <code>==</code>).</p>
<p>Vous trouverez ci-dessous un premier où <code>summarise()</code> est appliquée <em>sur des données non groupées</em> : les statistiques retournées sont produites à partir de l’ensemble des données.</p>
<div class="sourceCode" id="cb527"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># statistiques résumées appliquées sur le jeu de données complet</span></span>
<span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    n_cases  <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    mean_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>    max_age  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">age_years</span>,  na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>    min_age  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">age_years</span>,  na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>    n_males  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"m"</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   n_cases mean_age max_age min_age n_males
## 1    5888 16.01831      84       0    2803</code></pre>
<p>Maintenant, la même commande est appliquée sur la linelist groupée, ce qui génère les résumés statistique pour chaque groupe. Notez que les colonnes utilisées pour définir les groupes sont gardées dans le tableau agrégé généré par <code>summarise()</code>.</p>
<div class="sourceCode" id="cb529"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># statistiques résumées appliquées sur le jeu de données complet </span></span>
<span><span class="co"># mais groupé par outcome</span></span>
<span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    n_cases  <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    mean_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>    max_age  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">age_years</span>,  na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>    min_age  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">age_years</span>,  na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>    n_males  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"m"</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   outcome n_cases mean_age max_age min_age n_males
##   &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt;
## 1 Death      2582     15.9      76       0    1228
## 2 Recover    1983     16.1      84       0     950
## 3 &lt;NA&gt;       1323     16.2      69       0     625</code></pre>
<p><span style="color: darkgreen;"><strong><em>Note:</em></strong> il est possible d’appeler la fonction en utilisant l’orthographe britannique et américaine : <code>summarise()</code> et <code>summarize()</code> sont équivalentes.</span></p>
</div>
<div id="comptes-et-additions" class="section level2" number="12.5">
<h2>
<span class="header-section-number">12.5</span> Comptes et additions<a class="anchor" aria-label="anchor" href="#comptes-et-additions"><i class="fas fa-link"></i></a>
</h2>
<p>Les fonctions <code>count()</code> et <code>tally()</code> fournissent des fonctionnalités similaires mais légèrement différentes. Pour plus de détails sur la distinction entre les deux, voir <a href="https://dplyr.tidyverse.org/reference/tally.html">ici</a>.</p>
<div id="tally" class="section level3 unnumbered">
<h3>
<code>tally()</code><a class="anchor" aria-label="anchor" href="#tally"><i class="fas fa-link"></i></a>
</h3>
<p><code>tally()</code> est un raccourci pour <code>summarise(n = n())</code>, et <em>ne groupe pas</em> les données d’elle même. Ainsi, pour obtenir des totaux groupés, il faut d’abord exécuter la commande <code>group_by()</code> avant la commande <code>tally()</code>. On peut ajouter <code>sort = TRUE</code> pour voir les plus grands groupes en premier.</p>
<p>Exemple sans grouper les données :</p>
<div class="sourceCode" id="cb531"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>##      n
## 1 5888</code></pre>
<p>En groupant les données avant d’applique la fonction <code>tally()</code> :</p>
<div class="sourceCode" id="cb533"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tally</span><span class="op">(</span>sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   outcome     n
##   &lt;chr&gt;   &lt;int&gt;
## 1 Death    2582
## 2 Recover  1983
## 3 &lt;NA&gt;     1323</code></pre>
</div>
<div id="count" class="section level3 unnumbered">
<h3>
<code>count()</code><a class="anchor" aria-label="anchor" href="#count"><i class="fas fa-link"></i></a>
</h3>
<p>En revanche, la fonction <code>count()</code> effectue les actions suivantes :</p>
<ol style="list-style-type: decimal">
<li>applique <code>group_by()</code> sur la ou les colonnes spécifiées<br>
</li>
<li>applique <code>summarise()</code> et retourne la colonne <code>n</code> avec le nombre de lignes par groupe<br>
</li>
<li>puis applique la fonction <code>ungroup()</code>.</li>
</ol>
<div class="sourceCode" id="cb535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   outcome    n
## 1   Death 2582
## 2 Recover 1983
## 3    &lt;NA&gt; 1323</code></pre>
<p>Tout comme avec <code>group_by()</code> il est possible de créer une nouvelle colonne directement dans la commande <code>count()</code> :</p>
<div class="sourceCode" id="cb537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span>age_class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">18</span>, <span class="st">"adult"</span>, <span class="st">"child"</span><span class="op">)</span>, </span>
<span>        sort <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   age_class    n
## 1     child 3618
## 2     adult 2184
## 3      &lt;NA&gt;   86</code></pre>
<p><code>count()</code> peut être utilisée plusieurs fois à la suite pour résumer des données de manière plus en plus compacte. Par exemple, pour résumer le nombre d’hôpitaux présents pour chaque sexe, exécutez ce qui suit. Notez que le nom de la dernière colonne est changé de la valeur par défaut “n” pour plus de clarté (avec <code>name =</code>).</p>
<div class="sourceCode" id="cb539"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># compte le nombre de lignes pour chaque combinaison gender x hospital</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">gender</span>, <span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># en utilisant le jeu de données agrégées, compte le nombre d’hôpitaux pour chaque genre.</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">gender</span>, name <span class="op">=</span> <span class="st">"hospitals per gender"</span> <span class="op">)</span> </span></code></pre></div>
<pre><code>##   gender hospitals per gender
## 1      f                    6
## 2      m                    6
## 3   &lt;NA&gt;                    6</code></pre>
</div>
<div id="ajouter-des-colonnes-contenant-les-décomptes" class="section level3 unnumbered">
<h3>Ajouter des colonnes contenant les décomptes<a class="anchor" aria-label="anchor" href="#ajouter-des-colonnes-contenant-les-d%C3%A9comptes"><i class="fas fa-link"></i></a>
</h3>
<p>Construites sur des principes similaires à <code>count()</code> et <code>tally()</code>, vous pouvez utiliser les fonctions <code>add_count()</code> et <code>add_tally()</code> pour <em>ajouter une nouvelle colonne</em> <code>n</code> avec le nombre de lignes par groupe <em>tout en conservant toutes les autres colonnes</em> du dataframe. Cela signifie que le nombre de lignes total d’un groupe est ajouté pour chaque ligne du groupe dans une nouvelle colonne <code>n</code>.</p>
<p>Dans l’exemple suivant, nous ajoutons cette colonne et ré-arrangeons ensuite les colonnes pour une lecture plus aisée du tableau. Pour un autre exemple, voir la section plus bas sur comment <a href="grouping_data.html#group_filter_grp_size">filtrer sur la taille du groupe</a>.</p>
<div class="sourceCode" id="cb541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># conversion en tibble pour un meilleur affichage</span></span>
<span>  <span class="fu">add_count</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># ajoute la colonne n avec les totaux par hôpitaux</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">n</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># trie les colonnes</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 31
##    hospital        n case_id generation date_infection date_onset date_hospitalisation
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;              
##  1 Other         885 5fe599           4 2014-05-08     2014-05-13 2014-05-15          
##  2 Missing      1469 8689b7           4 NA             2014-05-13 2014-05-14          
##  3 St. Mark's…   422 11f8ea           2 NA             2014-05-16 2014-05-18          
##  4 Port Hospi…  1762 b8812a           3 2014-05-04     2014-05-18 2014-05-20          
##  5 Military H…   896 893f25           3 2014-05-18     2014-05-21 2014-05-22          
##  6 Port Hospi…  1762 be99c8           3 2014-05-03     2014-05-22 2014-05-23          
##  7 Missing      1469 07e3e8           4 2014-05-22     2014-05-27 2014-05-29          
##  8 Missing      1469 369449           4 2014-05-28     2014-06-02 2014-06-03          
##  9 Missing      1469 f393b4           4 NA             2014-06-05 2014-06-06          
## 10 Missing      1469 1389ca           4 NA             2014-06-05 2014-06-07          
## # ℹ 5,878 more rows
## # ℹ 24 more variables: date_outcome &lt;date&gt;, outcome &lt;chr&gt;, gender &lt;chr&gt;, age &lt;dbl&gt;,
## #   age_unit &lt;chr&gt;, age_years &lt;dbl&gt;, age_cat &lt;fct&gt;, age_cat5 &lt;fct&gt;, lon &lt;dbl&gt;,
## #   lat &lt;dbl&gt;, infector &lt;chr&gt;, source &lt;chr&gt;, wt_kg &lt;dbl&gt;, ht_cm &lt;dbl&gt;,
## #   ct_blood &lt;dbl&gt;, fever &lt;chr&gt;, chills &lt;chr&gt;, cough &lt;chr&gt;, aches &lt;chr&gt;, vomit &lt;chr&gt;,
## #   temp &lt;dbl&gt;, time_admission &lt;chr&gt;, bmi &lt;dbl&gt;, days_onset_hosp &lt;dbl&gt;</code></pre>
</div>
<div id="ajouter-les-totaux" class="section level3 unnumbered">
<h3>Ajouter les totaux<a class="anchor" aria-label="anchor" href="#ajouter-les-totaux"><i class="fas fa-link"></i></a>
</h3>
<p>Pour facilement ajouter les totaux par lignes ou colonnes d’un tableau après avoir utilisé <code>tally()</code> ou <code>count()</code>, consultez la section <strong>janitor</strong> de la page <a href="descriptive_tables.html#tbl_janitor">sur les tables descriptives</a>. Ce paquet offre des fonctions telles que <code>adorn_totals()</code> et <code>adorn_percentages()</code> pour ajouter des totaux et pourcentages. Par exemple :</p>
<div class="sourceCode" id="cb543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span>                                  </span>
<span>  <span class="fu">tabyl</span><span class="op">(</span><span class="va">age_cat</span>, <span class="va">gender</span><span class="op">)</span> <span class="op">%&gt;%</span>                  <span class="co"># décomptes croisés de deux colonnes</span></span>
<span>  <span class="fu">adorn_totals</span><span class="op">(</span>where <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span> <span class="op">%&gt;%</span>             <span class="co"># ajoute ligne de totaux</span></span>
<span>  <span class="fu">adorn_percentages</span><span class="op">(</span>denominator <span class="op">=</span> <span class="st">"col"</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># ajoute proportions (dénominateur colonne)</span></span>
<span>  <span class="fu">adorn_pct_formatting</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>                  <span class="co"># formate en %</span></span>
<span>  <span class="fu">adorn_ns</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"front"</span><span class="op">)</span> <span class="op">%&gt;%</span>            <span class="co"># formate en : "N (%)"</span></span>
<span>  <span class="fu">adorn_title</span><span class="op">(</span>                                <span class="co"># ajuste les titres</span></span>
<span>    row_name <span class="op">=</span> <span class="st">"Catégorie d'âge"</span>,</span>
<span>    col_name <span class="op">=</span> <span class="st">"Sexe"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##                            Sexe                            
##  Catégorie d'âge              f              m          NA_
##              0-4   640  (22.8%)   416  (14.8%)  39  (14.0%)
##              5-9   641  (22.8%)   412  (14.7%)  42  (15.1%)
##            10-14   518  (18.5%)   383  (13.7%)  40  (14.4%)
##            15-19   359  (12.8%)   364  (13.0%)  20   (7.2%)
##            20-29   468  (16.7%)   575  (20.5%)  30  (10.8%)
##            30-49   179   (6.4%)   557  (19.9%)  18   (6.5%)
##            50-69     2   (0.1%)    91   (3.2%)   2   (0.7%)
##              70+     0   (0.0%)     5   (0.2%)   1   (0.4%)
##             &lt;NA&gt;     0   (0.0%)     0   (0.0%)  86  (30.9%)
##            Total 2,807 (100.0%) 2,803 (100.0%) 278 (100.0%)</code></pre>
<p>Pour ajouter des lignes de totaux plus complexes qui impliquent des statistiques récapitulatives autres que des <em>sommes</em>, voir <a href="descriptive_tables.html#tbl_dplyr_totals">cette section de la page Tables descriptives</a>.</p>
</div>
</div>
<div id="grouper-par-date" class="section level2" number="12.6">
<h2>
<span class="header-section-number">12.6</span> Grouper par date<a class="anchor" aria-label="anchor" href="#grouper-par-date"><i class="fas fa-link"></i></a>
</h2>
<p>Pour grouper des données par date, il faut avoir, ou créer une colonne contenant l’unité de temps qui vous intéresse (par exemple : “jour”, “semaine épidémiologique”, “mois”, etc). Vous pouvez créer cette colonne en utilisant <code>floor_date()</code> du paquet <strong>lubridate</strong>, tel qu’expliqué dans la section sur les <a href="working_dates.html#dates_epi_wks">Semaines épidémiologiques</a> du chapitre sur les <a href="working_dates.html#working_dates">dates</a>. Cette colonne peut être simplement passée à <code>group_by()</code> ou <code>count()</code> de <strong>dplyr</strong> pour grouper les lignes par les valeurs uniques de date ou obtenir le nombre de lignes par date.</p>
<p>Un besoin spécifique à la gestion et l’analyse de données par date consiste à compléter les dates de la séquence qui ne sont pas présentes dans les données. Pour cela, on peut utiliser <code>complete()</code> du paquet <strong>tidyr</strong> pour que la série de dates agrégées comprenne <em>toutes les unités de dates possibles</em> dans la plage. Sans cette étape, une semaine où aucun cas n’a été signalé n’apparaîtrait pas dans les données…</p>
<p>La fonction <code>complete()</code>, <em>redéfinit</em> la colonne contenant les dates comme une <em>séquence</em> de dates (en passant <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> du minimum au maximum comme argument). Par défaut, les valeurs du nombre de cas (et autres colonnes) dans les nouvelles lignes “développées” contient des “NA”, mais l’on peut modifier ce comportement. Par exemple, on peut mettre le nombre de cas à 0 en utilisant l’argument <code>fill =</code> de <code>complete()</code>, qui prend en entrée une liste nommée (si votre colonne de nombre de cas est nommée <code>n</code>, fournissez <code>fill = list(n = 0)</code>. Voir <code>?complete</code> pour plus de détails et la page <a href="working_dates.html#working_dates">Manipuler les dates</a> pour un exemple.</p>
<div id="grouper-par-jours-linelist" class="section level3 unnumbered">
<h3>Grouper par jours (linelist)<a class="anchor" aria-label="anchor" href="#grouper-par-jours-linelist"><i class="fas fa-link"></i></a>
</h3>
<p>Voici un exemple où l’on va grouper le nombre de cas de la linelist par jour, <em>sans utiliser</em> la fonction <code>complete()</code>. Note : la première ligne permet d’ignorer les cas où il n’y a pas eu de date de rentrée.</p>
<div class="sourceCode" id="cb545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">daily_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>        <span class="co"># Exclut les cas où date_onset est vide</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span>              <span class="co"># Compte le nombre de lignes par date</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-de6f65f8380903056faf" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-de6f65f8380903056faf">{"x":{"filter":"none","vertical":false,"data":[["2014-04-07","2014-04-15","2014-04-21","2014-04-25","2014-04-26","2014-04-27","2014-05-01","2014-05-03","2014-05-04","2014-05-05","2014-05-06","2014-05-07","2014-05-08","2014-05-09","2014-05-10","2014-05-11","2014-05-12","2014-05-13","2014-05-14","2014-05-16","2014-05-17","2014-05-18","2014-05-19","2014-05-20","2014-05-21","2014-05-22","2014-05-23","2014-05-24","2014-05-25","2014-05-26","2014-05-27","2014-05-28","2014-05-29","2014-05-30","2014-05-31","2014-06-02","2014-06-03","2014-06-05","2014-06-06","2014-06-07","2014-06-08","2014-06-09","2014-06-10","2014-06-11","2014-06-12","2014-06-13","2014-06-14","2014-06-15","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-20","2014-06-21","2014-06-22","2014-06-23","2014-06-24","2014-06-25","2014-06-26","2014-06-27","2014-06-28","2014-06-29","2014-06-30","2014-07-01","2014-07-02","2014-07-03","2014-07-04","2014-07-05","2014-07-06","2014-07-07","2014-07-08","2014-07-09","2014-07-10","2014-07-11","2014-07-12","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-21","2014-07-22","2014-07-23","2014-07-24","2014-07-25","2014-07-26","2014-07-27","2014-07-28","2014-07-29","2014-07-30","2014-07-31","2014-08-01","2014-08-02","2014-08-03","2014-08-04","2014-08-05","2014-08-06","2014-08-07","2014-08-08","2014-08-09","2014-08-10","2014-08-11","2014-08-12","2014-08-13","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-25","2014-08-26","2014-08-27","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-08","2014-09-09","2014-09-10","2014-09-11","2014-09-12","2014-09-13","2014-09-14","2014-09-15","2014-09-16","2014-09-17","2014-09-18","2014-09-19","2014-09-20","2014-09-21","2014-09-22","2014-09-23","2014-09-24","2014-09-25","2014-09-26","2014-09-27","2014-09-28","2014-09-29","2014-09-30","2014-10-01","2014-10-02","2014-10-03","2014-10-04","2014-10-05","2014-10-06","2014-10-07","2014-10-08","2014-10-09","2014-10-10","2014-10-11","2014-10-12","2014-10-13","2014-10-14","2014-10-15","2014-10-16","2014-10-17","2014-10-18","2014-10-19","2014-10-20","2014-10-21","2014-10-22","2014-10-23","2014-10-24","2014-10-25","2014-10-26","2014-10-27","2014-10-28","2014-10-29","2014-10-30","2014-10-31","2014-11-01","2014-11-02","2014-11-03","2014-11-04","2014-11-05","2014-11-06","2014-11-07","2014-11-08","2014-11-09","2014-11-10","2014-11-11","2014-11-12","2014-11-13","2014-11-14","2014-11-15","2014-11-16","2014-11-17","2014-11-18","2014-11-19","2014-11-20","2014-11-21","2014-11-22","2014-11-23","2014-11-24","2014-11-25","2014-11-26","2014-11-27","2014-11-28","2014-11-29","2014-11-30","2014-12-01","2014-12-02","2014-12-03","2014-12-04","2014-12-05","2014-12-06","2014-12-07","2014-12-08","2014-12-09","2014-12-10","2014-12-11","2014-12-12","2014-12-13","2014-12-14","2014-12-15","2014-12-16","2014-12-17","2014-12-18","2014-12-19","2014-12-20","2014-12-21","2014-12-22","2014-12-23","2014-12-24","2014-12-25","2014-12-26","2014-12-27","2014-12-28","2014-12-29","2014-12-30","2014-12-31","2015-01-01","2015-01-02","2015-01-03","2015-01-04","2015-01-05","2015-01-06","2015-01-07","2015-01-08","2015-01-09","2015-01-10","2015-01-11","2015-01-12","2015-01-13","2015-01-14","2015-01-15","2015-01-16","2015-01-17","2015-01-18","2015-01-19","2015-01-20","2015-01-21","2015-01-22","2015-01-23","2015-01-24","2015-01-25","2015-01-26","2015-01-27","2015-01-28","2015-01-29","2015-01-30","2015-01-31","2015-02-01","2015-02-02","2015-02-03","2015-02-04","2015-02-05","2015-02-06","2015-02-07","2015-02-08","2015-02-09","2015-02-10","2015-02-11","2015-02-12","2015-02-13","2015-02-14","2015-02-15","2015-02-16","2015-02-17","2015-02-18","2015-02-19","2015-02-20","2015-02-21","2015-02-22","2015-02-23","2015-02-24","2015-02-25","2015-02-26","2015-02-27","2015-02-28","2015-03-01","2015-03-02","2015-03-03","2015-03-04","2015-03-05","2015-03-06","2015-03-07","2015-03-08","2015-03-09","2015-03-10","2015-03-11","2015-03-12","2015-03-13","2015-03-14","2015-03-15","2015-03-16","2015-03-17","2015-03-18","2015-03-19","2015-03-20","2015-03-21","2015-03-22","2015-03-23","2015-03-24","2015-03-25","2015-03-26","2015-03-27","2015-03-28","2015-03-29","2015-03-30","2015-03-31","2015-04-01","2015-04-02","2015-04-03","2015-04-04","2015-04-05","2015-04-06","2015-04-07","2015-04-08","2015-04-09","2015-04-10","2015-04-11","2015-04-12","2015-04-13","2015-04-14","2015-04-15","2015-04-16","2015-04-17","2015-04-18","2015-04-19","2015-04-20","2015-04-21","2015-04-22","2015-04-23","2015-04-24","2015-04-25","2015-04-26","2015-04-27","2015-04-28","2015-04-29","2015-04-30"],[1,1,2,1,1,1,2,1,1,1,3,2,2,2,1,1,2,3,3,2,3,4,2,1,3,1,2,1,3,3,10,1,1,1,2,5,3,4,4,5,1,5,5,3,1,1,2,5,6,4,2,3,7,3,4,2,6,5,3,1,2,2,6,4,3,5,6,5,3,3,7,7,5,4,6,6,10,10,6,6,10,7,11,4,6,11,9,10,7,12,6,15,14,8,9,16,13,18,18,9,9,9,10,13,17,7,17,12,17,31,13,14,14,19,17,26,19,25,21,16,24,23,25,25,22,27,25,28,30,22,33,30,36,33,23,31,27,30,42,40,50,37,38,38,49,52,35,50,37,38,33,33,39,39,45,34,44,29,40,50,41,39,35,28,36,34,37,36,36,34,43,28,38,33,37,29,33,44,43,24,37,30,35,24,37,44,34,40,30,34,26,29,33,31,22,26,26,19,30,24,29,24,21,19,11,22,20,23,32,33,28,15,20,24,18,20,19,22,17,32,21,20,23,17,15,18,20,19,18,21,18,16,20,15,18,15,18,18,15,15,19,18,19,11,15,19,11,13,13,12,11,14,18,17,10,15,16,12,17,19,14,12,18,14,14,15,11,13,21,11,14,11,13,12,14,11,10,16,10,15,13,13,10,11,8,11,11,11,8,9,8,8,10,8,9,11,13,13,16,13,11,16,6,8,10,16,11,11,8,11,16,9,10,8,14,7,10,11,11,7,5,11,6,8,9,13,9,7,9,4,9,7,13,2,7,9,5,5,10,12,10,3,6,4,5,11,3,7,6,7,9,3,7,4,9,6,5,5,9,4,4,4,9,7,8,2,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>date_onset<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Maintenant, le même exemple en utilisant la commande <code>complete()</code> pour s’assurer que tous les jours dans la fourchette temporelle seront représentés dans les données.</p>
<div class="sourceCode" id="cb546"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">daily_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># Exclut les cas où date_onset est vide</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>       <span class="co"># Compte le nombre de lignes par jour</span></span>
<span>  <span class="fu">complete</span><span class="op">(</span>                   <span class="co"># Ajoute les jours manquants (sans cas)</span></span>
<span>    date_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>    <span class="co"># redéfinit la colonne comme une séquence de dates</span></span>
<span>      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, </span>
<span>      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>      by   <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>,</span>
<span>    fill   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>     <span class="co"># remplit les nouvelles dates ajoutées de 0 (aurait été des NA par défaut) </span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b5639f80abe1f22b3290" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b5639f80abe1f22b3290">{"x":{"filter":"none","vertical":false,"data":[["2014-04-07","2014-04-15","2014-04-21","2014-04-25","2014-04-26","2014-04-27","2014-05-01","2014-05-03","2014-05-04","2014-05-05","2014-05-06","2014-05-07","2014-05-08","2014-05-09","2014-05-10","2014-05-11","2014-05-12","2014-05-13","2014-05-14","2014-05-16","2014-05-17","2014-05-18","2014-05-19","2014-05-20","2014-05-21","2014-05-22","2014-05-23","2014-05-24","2014-05-25","2014-05-26","2014-05-27","2014-05-28","2014-05-29","2014-05-30","2014-05-31","2014-06-02","2014-06-03","2014-06-05","2014-06-06","2014-06-07","2014-06-08","2014-06-09","2014-06-10","2014-06-11","2014-06-12","2014-06-13","2014-06-14","2014-06-15","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-20","2014-06-21","2014-06-22","2014-06-23","2014-06-24","2014-06-25","2014-06-26","2014-06-27","2014-06-28","2014-06-29","2014-06-30","2014-07-01","2014-07-02","2014-07-03","2014-07-04","2014-07-05","2014-07-06","2014-07-07","2014-07-08","2014-07-09","2014-07-10","2014-07-11","2014-07-12","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-21","2014-07-22","2014-07-23","2014-07-24","2014-07-25","2014-07-26","2014-07-27","2014-07-28","2014-07-29","2014-07-30","2014-07-31","2014-08-01","2014-08-02","2014-08-03","2014-08-04","2014-08-05","2014-08-06","2014-08-07","2014-08-08","2014-08-09","2014-08-10","2014-08-11","2014-08-12","2014-08-13","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-25","2014-08-26","2014-08-27","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-08","2014-09-09","2014-09-10","2014-09-11","2014-09-12","2014-09-13","2014-09-14","2014-09-15","2014-09-16","2014-09-17","2014-09-18","2014-09-19","2014-09-20","2014-09-21","2014-09-22","2014-09-23","2014-09-24","2014-09-25","2014-09-26","2014-09-27","2014-09-28","2014-09-29","2014-09-30","2014-10-01","2014-10-02","2014-10-03","2014-10-04","2014-10-05","2014-10-06","2014-10-07","2014-10-08","2014-10-09","2014-10-10","2014-10-11","2014-10-12","2014-10-13","2014-10-14","2014-10-15","2014-10-16","2014-10-17","2014-10-18","2014-10-19","2014-10-20","2014-10-21","2014-10-22","2014-10-23","2014-10-24","2014-10-25","2014-10-26","2014-10-27","2014-10-28","2014-10-29","2014-10-30","2014-10-31","2014-11-01","2014-11-02","2014-11-03","2014-11-04","2014-11-05","2014-11-06","2014-11-07","2014-11-08","2014-11-09","2014-11-10","2014-11-11","2014-11-12","2014-11-13","2014-11-14","2014-11-15","2014-11-16","2014-11-17","2014-11-18","2014-11-19","2014-11-20","2014-11-21","2014-11-22","2014-11-23","2014-11-24","2014-11-25","2014-11-26","2014-11-27","2014-11-28","2014-11-29","2014-11-30","2014-12-01","2014-12-02","2014-12-03","2014-12-04","2014-12-05","2014-12-06","2014-12-07","2014-12-08","2014-12-09","2014-12-10","2014-12-11","2014-12-12","2014-12-13","2014-12-14","2014-12-15","2014-12-16","2014-12-17","2014-12-18","2014-12-19","2014-12-20","2014-12-21","2014-12-22","2014-12-23","2014-12-24","2014-12-25","2014-12-26","2014-12-27","2014-12-28","2014-12-29","2014-12-30","2014-12-31","2015-01-01","2015-01-02","2015-01-03","2015-01-04","2015-01-05","2015-01-06","2015-01-07","2015-01-08","2015-01-09","2015-01-10","2015-01-11","2015-01-12","2015-01-13","2015-01-14","2015-01-15","2015-01-16","2015-01-17","2015-01-18","2015-01-19","2015-01-20","2015-01-21","2015-01-22","2015-01-23","2015-01-24","2015-01-25","2015-01-26","2015-01-27","2015-01-28","2015-01-29","2015-01-30","2015-01-31","2015-02-01","2015-02-02","2015-02-03","2015-02-04","2015-02-05","2015-02-06","2015-02-07","2015-02-08","2015-02-09","2015-02-10","2015-02-11","2015-02-12","2015-02-13","2015-02-14","2015-02-15","2015-02-16","2015-02-17","2015-02-18","2015-02-19","2015-02-20","2015-02-21","2015-02-22","2015-02-23","2015-02-24","2015-02-25","2015-02-26","2015-02-27","2015-02-28","2015-03-01","2015-03-02","2015-03-03","2015-03-04","2015-03-05","2015-03-06","2015-03-07","2015-03-08","2015-03-09","2015-03-10","2015-03-11","2015-03-12","2015-03-13","2015-03-14","2015-03-15","2015-03-16","2015-03-17","2015-03-18","2015-03-19","2015-03-20","2015-03-21","2015-03-22","2015-03-23","2015-03-24","2015-03-25","2015-03-26","2015-03-27","2015-03-28","2015-03-29","2015-03-30","2015-03-31","2015-04-01","2015-04-02","2015-04-03","2015-04-04","2015-04-05","2015-04-06","2015-04-07","2015-04-08","2015-04-09","2015-04-10","2015-04-11","2015-04-12","2015-04-13","2015-04-14","2015-04-15","2015-04-16","2015-04-17","2015-04-18","2015-04-19","2015-04-20","2015-04-21","2015-04-22","2015-04-23","2015-04-24","2015-04-25","2015-04-26","2015-04-27","2015-04-28","2015-04-29","2015-04-30"],[1,1,2,1,1,1,2,1,1,1,3,2,2,2,1,1,2,3,3,2,3,4,2,1,3,1,2,1,3,3,10,1,1,1,2,5,3,4,4,5,1,5,5,3,1,1,2,5,6,4,2,3,7,3,4,2,6,5,3,1,2,2,6,4,3,5,6,5,3,3,7,7,5,4,6,6,10,10,6,6,10,7,11,4,6,11,9,10,7,12,6,15,14,8,9,16,13,18,18,9,9,9,10,13,17,7,17,12,17,31,13,14,14,19,17,26,19,25,21,16,24,23,25,25,22,27,25,28,30,22,33,30,36,33,23,31,27,30,42,40,50,37,38,38,49,52,35,50,37,38,33,33,39,39,45,34,44,29,40,50,41,39,35,28,36,34,37,36,36,34,43,28,38,33,37,29,33,44,43,24,37,30,35,24,37,44,34,40,30,34,26,29,33,31,22,26,26,19,30,24,29,24,21,19,11,22,20,23,32,33,28,15,20,24,18,20,19,22,17,32,21,20,23,17,15,18,20,19,18,21,18,16,20,15,18,15,18,18,15,15,19,18,19,11,15,19,11,13,13,12,11,14,18,17,10,15,16,12,17,19,14,12,18,14,14,15,11,13,21,11,14,11,13,12,14,11,10,16,10,15,13,13,10,11,8,11,11,11,8,9,8,8,10,8,9,11,13,13,16,13,11,16,6,8,10,16,11,11,8,11,16,9,10,8,14,7,10,11,11,7,5,11,6,8,9,13,9,7,9,4,9,7,13,2,7,9,5,5,10,12,10,3,6,4,5,11,3,7,6,7,9,3,7,4,9,6,5,5,9,4,4,4,9,7,8,2,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>date_onset<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="grouper-par-semaines-linelist" class="section level3 unnumbered">
<h3>Grouper par semaines (linelist)<a class="anchor" aria-label="anchor" href="#grouper-par-semaines-linelist"><i class="fas fa-link"></i></a>
</h3>
<p>Le même principe peut être appliqué au groupement par semaine. Dans cet exemple, on va d’abord créer une nouvelle colonne contenant la semaine à l’aide de la fonction <code>floor_date()</code> du package <strong>lubridate</strong> (avec <code>unit = "week"</code>). Cela arrondit chaque date au premier jour de la semaine correspondante. Ensuite, on utilise la fonction <code>count()</code> pour obtenir le nombre de cas hebdomadaires. On termine enfin avec un <code>complete()</code> pour compléter toutes les semaines dans le jeu de données agrégées, même il n’y a pas eu de cas cette semaine là.</p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weekly_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>        <span class="co"># Exclut les cas où date_onset est vide</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, </span>
<span>                                      unit <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># Crée colonne avec la date de début des symptomes</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op">%&gt;%</span>                <span class="co"># Compte le nombre de lignes par semaine</span></span>
<span>  <span class="fu">complete</span><span class="op">(</span>                      <span class="co"># Ajoute les semaines non représentées (sans cas)</span></span>
<span>    week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>             <span class="co"># redéfinit la colonne comme une séquence de dates</span></span>
<span>      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">week</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, </span>
<span>      to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">week</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>          <span class="co"># remplit les nouvelles dates ajoutées de 0 (aurait été des NA par </span></span></code></pre></div>
<p>Voici les 50 premières lignes du jeu de données créé :</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a571bc3e6d87d4d45632" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a571bc3e6d87d4d45632">{"x":{"filter":"none","vertical":false,"data":[["2014-04-06","2014-04-13","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26"],[1,1,4,4,12,14,14,21,21,18,30,23,31,35,55,58,80,86,114,122,159,187,210,294,278,270,263,252,243,241,223,176,140,170,151,130,123,122,94,101,106,99,87,80,66,80,80,76,68,61,51,58,39,45,37,28]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>week<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="grouper-par-mois-linelist" class="section level3 unnumbered">
<h3>Grouper par mois (linelist)<a class="anchor" aria-label="anchor" href="#grouper-par-mois-linelist"><i class="fas fa-link"></i></a>
</h3>
<p>Pour agréger les cas par mois, nous utiliserons à nouveau <code>floor_date()</code>, avec l’argument <code>unit = "months"</code>. Cette commande arrondit chaque date au 1er de son mois. La sortie sera donc de la classe Date. Notez que dans l’étape <code>complete()</code>, nous utilisons également <code>by = "months"</code>.</p>
<div class="sourceCode" id="cb548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">monthly_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, </span>
<span>                                       unit <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># nouvelle colonne, 1st du mois de début des symptomes</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span>             <span class="co"># Compte le nombre de cas par mois</span></span>
<span>  <span class="fu">complete</span><span class="op">(</span></span>
<span>    month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">month</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,     <span class="co"># Ajoute les mois non représentées (sans cas)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">month</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>      by<span class="op">=</span><span class="st">"month"</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f5d66f32344a2af04f17" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f5d66f32344a2af04f17">{"x":{"filter":"none","vertical":false,"data":[["2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01"],[7,64,100,226,528,1070,1112,763,562,431,306,277,186]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>month<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="comptes-journaliers-en-semaines-données-agrégées" class="section level3 unnumbered">
<h3>Comptes journaliers en semaines (données agrégées)<a class="anchor" aria-label="anchor" href="#comptes-journaliers-en-semaines-donn%C3%A9es-agr%C3%A9g%C3%A9es"><i class="fas fa-link"></i></a>
</h3>
<p>Pour agréger les nombres de cas quotidiens (données déjà agrégées par jour, donc) en nombre de cas hebdomadaires, utilisez <code>floor_date()</code> de la même manière que dans les exemples précédents. Cependant, il faut ensuite utiliser les fonctions <code>group_by()</code> et <code>summarize()</code> au lieu de <code>count()</code> car il faut <em>faire la somme des nombres de cas quotidiens</em> au lieu de simplement compter le nombre de lignes par semaine.</p>
<div id="comptes-journaliers-en-mois-données-agrégées" class="section level4 unnumbered">
<h4>Comptes journaliers en mois (données agrégées)<a class="anchor" aria-label="anchor" href="#comptes-journaliers-en-mois-donn%C3%A9es-agr%C3%A9g%C3%A9es"><i class="fas fa-link"></i></a>
</h4>
<p>Pour agréger les nombres de cas journaliers par mois, utilisez <code>floor_date()</code> de la même manière que dans les exemples précédents (avec <code>unit = "month"</code>). Cependant, il faut ensuite utiliser les fonctions <code>group_by()</code> et <code>summarize()</code> au lieu de <code>count()</code> car il faut additionner le nombre de cas quotidiens au lieu de simplement compter le nombre de lignes par mois.</p>
</div>
</div>
</div>
<div id="trier-les-données-groupées" class="section level2" number="12.7">
<h2>
<span class="header-section-number">12.7</span> Trier les données groupées<a class="anchor" aria-label="anchor" href="#trier-les-donn%C3%A9es-group%C3%A9es"><i class="fas fa-link"></i></a>
</h2>
<p>La fonction <code>arrange()</code> de <strong>dplyr</strong> qui permet d’ordonner les lignes d’un dataframe se comporte de la même manière lorsque les données sont groupées, <em>sauf</em> si vous définissez l’argument <code>.by_group = TRUE</code>. Dans ce cas, les lignes sont d’abord ordonnées par les colonnes de regroupement, puis par toutes les autres colonnes que vous spécifiez à <code>arrange()</code>.</p>
</div>
<div id="filtrer-les-données-groupées" class="section level2" number="12.8">
<h2>
<span class="header-section-number">12.8</span> Filtrer les données groupées<a class="anchor" aria-label="anchor" href="#filtrer-les-donn%C3%A9es-group%C3%A9es"><i class="fas fa-link"></i></a>
</h2>
<div id="filter" class="section level3 unnumbered">
<h3>
<code>filter()</code><a class="anchor" aria-label="anchor" href="#filter"><i class="fas fa-link"></i></a>
</h3>
<p>Lorsque l’on utilise la fonction <code>filter</code> en conjonction avec des fonctions qui évaluent le dataframe (<code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code> ou <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> par exemple), la commande est désormais appliquée à chaque groupe indépendamment. Par exemple, pour filtrer et conserver les lignes où les patients ont un âge supérieur à l’âge médian, le filtre s’appliquera désormais à l’intérieur de chaque groupe, pour pour conserver les lignes où l’age des patients est supérieur à l’âge médian <em>du groupe</em>.</p>
</div>
<div id="slice" class="section level3 unnumbered">
<h3>
<code>slice()</code><a class="anchor" aria-label="anchor" href="#slice"><i class="fas fa-link"></i></a>
</h3>
<p>La fonction <strong>dplyr</strong> <code>slice()</code>, qui <a href="https://dplyr.tidyverse.org/reference/slice.html">filtre les lignes en fonction de leur position dans les données</a>, peut également être appliquée par groupe. N’oubliez pas de trier les données au sein de chaque groupe pour obtenir la “tranche” souhaitée.</p>
<p>Par exemple, pour extraire uniquement les 5 dernières admissions de chaque hôpital :</p>
<ol style="list-style-type: decimal">
<li>Groupez les données de la linelist par la colonne <code>hospital</code>.<br>
</li>
<li>Triez les enregistrements du plus récent au plus ancien grâce à la colonne <code>date_hospitalisation</code> <em>dans chaque groupe d’hôpitaux</em>.<br>
</li>
<li>Tranchez pour récupérer les 5 premières lignes de chaque hôpital</li>
</ol>
<div class="sourceCode" id="cb549"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">date_hospitalisation</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span>                            <span class="co"># (pour l'affichage)</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">hospital</span>, <span class="va">date_hospitalisation</span><span class="op">)</span>  <span class="co"># (pour l'affichage)</span></span></code></pre></div>
<pre><code>## # A tibble: 30 × 3
## # Groups:   hospital [6]
##    case_id hospital          date_hospitalisation
##    &lt;chr&gt;   &lt;chr&gt;             &lt;date&gt;              
##  1 20b688  Central Hospital  2014-05-06          
##  2 d58402  Central Hospital  2014-05-10          
##  3 b8f2fd  Central Hospital  2014-05-13          
##  4 acf422  Central Hospital  2014-05-28          
##  5 275cc7  Central Hospital  2014-05-28          
##  6 d1fafd  Military Hospital 2014-04-17          
##  7 974bc1  Military Hospital 2014-05-13          
##  8 6a9004  Military Hospital 2014-05-13          
##  9 09e386  Military Hospital 2014-05-14          
## 10 865581  Military Hospital 2014-05-15          
## # ℹ 20 more rows</code></pre>
<p><code>slice_head()</code> : sélectionne les n premières lignes (“par le haut”)<br><code>slice_tail()</code> : sélectionne les n dernières lignes (“par le bas”)<br><code>slice_sample()</code> : sélectionne n lignes aléatoirement. Utiliser <code>replace = TRUE</code> pour un échantillonnage avec remplacement<br><code>slice_min()</code> : sélectionne les n lignes avec les plus petites valeurs dans une colonne donnée (argument <code>order_by =</code>). Utiliser <code>with_ties = TRUE</code> pour garder les ex-æquo<br><code>slice_max()</code> : sélectionne les n lignes avec les plus grandes valeurs dans une colonne donnée (argument <code>order_by =</code>)</p>
<p>Voir le chapitre sur la <a href="cleaning_data.html#deduplication">dé-duplication</a> pour plus d’exemples et de détails sur la fonction <code>slice()</code>.</p>
</div>
<div id="group_filter_grp_size" class="section level3 unnumbered">
<h3>Filtrer sur la taille des groupes<a class="anchor" aria-label="anchor" href="#group_filter_grp_size"><i class="fas fa-link"></i></a>
</h3>
<p>La fonction <code>add_count()</code> ajoute une colonne <code>n</code> aux données originales, ajoutant ainsi, pour chaque ligne, le nombre de lignes du groupe auquel cette ligne appartient.</p>
<p>Dans l’exemple ci-dessous, <code>add_count()</code> est appliqué à la colonne <code>hospital</code>, de sorte que les valeurs de la nouvelle colonne <code>n</code> reflètent le nombre de lignes dans le groupe hospitalier de cette ligne. Bien sûr, cela veut dire que la valeur de la colonne “n” est répétée pour chaque ligne du groupe.</p>
<p>Dans l’exemple ci-dessous, le nom de la colonne <code>n</code> pourrait être modifié en utilisant <code>name =</code> dans <code>add_count()</code>.</p>
<div class="sourceCode" id="cb551"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">add_count</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span>          <span class="co"># ajoute le nombre de patients admis dans cette hôpital, pour chaque groupe</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">n</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Pour un meilleur affichage</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 31
##    hospital        n case_id generation date_infection date_onset date_hospitalisation
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;              
##  1 Other         885 5fe599           4 2014-05-08     2014-05-13 2014-05-15          
##  2 Missing      1469 8689b7           4 NA             2014-05-13 2014-05-14          
##  3 St. Mark's…   422 11f8ea           2 NA             2014-05-16 2014-05-18          
##  4 Port Hospi…  1762 b8812a           3 2014-05-04     2014-05-18 2014-05-20          
##  5 Military H…   896 893f25           3 2014-05-18     2014-05-21 2014-05-22          
##  6 Port Hospi…  1762 be99c8           3 2014-05-03     2014-05-22 2014-05-23          
##  7 Missing      1469 07e3e8           4 2014-05-22     2014-05-27 2014-05-29          
##  8 Missing      1469 369449           4 2014-05-28     2014-06-02 2014-06-03          
##  9 Missing      1469 f393b4           4 NA             2014-06-05 2014-06-06          
## 10 Missing      1469 1389ca           4 NA             2014-06-05 2014-06-07          
## # ℹ 5,878 more rows
## # ℹ 24 more variables: date_outcome &lt;date&gt;, outcome &lt;chr&gt;, gender &lt;chr&gt;, age &lt;dbl&gt;,
## #   age_unit &lt;chr&gt;, age_years &lt;dbl&gt;, age_cat &lt;fct&gt;, age_cat5 &lt;fct&gt;, lon &lt;dbl&gt;,
## #   lat &lt;dbl&gt;, infector &lt;chr&gt;, source &lt;chr&gt;, wt_kg &lt;dbl&gt;, ht_cm &lt;dbl&gt;,
## #   ct_blood &lt;dbl&gt;, fever &lt;chr&gt;, chills &lt;chr&gt;, cough &lt;chr&gt;, aches &lt;chr&gt;, vomit &lt;chr&gt;,
## #   temp &lt;dbl&gt;, time_admission &lt;chr&gt;, bmi &lt;dbl&gt;, days_onset_hosp &lt;dbl&gt;</code></pre>
<p>Il est alors facile de filtrer les lignes de cas qui ont été hospitalisés dans un “petit” hôpital. Par exemple un hôpital qui a admis moins de 500 patients :</p>
<div class="sourceCode" id="cb553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">add_count</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&lt;</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="mutate" class="section level2" number="12.9">
<h2>
<span class="header-section-number">12.9</span> <code>mutate()</code><a class="anchor" aria-label="anchor" href="#mutate"><i class="fas fa-link"></i></a>
</h2>
<p>Pour conserver toutes les colonnes et lignes (sans les résumer) et <em>ajouter une nouvelle colonne contenant des statistiques de groupe</em>, utilisez <code>mutate()</code> après <code>group_by()</code> au lieu de <code>summarise()</code>.</p>
<p>Ceci est utile si vous voulez les statistiques de groupe dans le jeu de données original <em>avec toutes les autres colonnes présentes</em> - par exemple pour les calculs qui comparent une ligne à son groupe.</p>
<p>Par exemple, le code ci-dessous calcule la différence entre le délai d’admission d’une ligne et le délai d’admission médian pour son hôpital. Les étapes sont les suivantes :</p>
<ol style="list-style-type: decimal">
<li>Groupez les données par hôpital<br>
</li>
<li>Utilisez la colonne <code>days_onset_hosp</code> (délai à l’hospitalisation) pour créer une nouvelle colonne contenant le délai moyen de l’hôpital pour chaque patient de cet hôpital<br>
</li>
<li>Calculez la différence entre les deux colonnes</li>
</ol>
<div class="sourceCode" id="cb554"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># grouper les données par hôpital</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  </span>
<span>  <span class="co"># Ajoute de nouvelles colonnes (conserve toutes lies lignes)</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    <span class="co"># Délai moyen d'admission pour chaque hôpital (arrondi à la 1re décimale)</span></span>
<span>    group_delay_admit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">days_onset_hosp</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># Différence entre le délai de chaque patient et le délai moyen de son hôpital</span></span>
<span>    diff_to_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">days_onset_hosp</span> <span class="op">-</span> <span class="va">group_delay_admit</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  </span>
<span>  <span class="co"># Sélectionne colonnes (pour l'affichage)</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">hospital</span>, <span class="va">days_onset_hosp</span>, <span class="va">group_delay_admit</span>, <span class="va">diff_to_group</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 5
## # Groups:   hospital [6]
##    case_id hospital                    days_onset_hosp group_delay_admit diff_to_group
##    &lt;chr&gt;   &lt;chr&gt;                                 &lt;dbl&gt;             &lt;dbl&gt;         &lt;dbl&gt;
##  1 5fe599  Other                                     2               2             0  
##  2 8689b7  Missing                                   1               2.1          -1.1
##  3 11f8ea  St. Mark's Maternity Hospi…               2               2.1          -0.1
##  4 b8812a  Port Hospital                             2               2.1          -0.1
##  5 893f25  Military Hospital                         1               2.1          -1.1
##  6 be99c8  Port Hospital                             1               2.1          -1.1
##  7 07e3e8  Missing                                   2               2.1          -0.1
##  8 369449  Missing                                   1               2.1          -1.1
##  9 f393b4  Missing                                   1               2.1          -1.1
## 10 1389ca  Missing                                   2               2.1          -0.1
## # ℹ 5,878 more rows</code></pre>
</div>
<div id="select-sur-les-données-groupées" class="section level2" number="12.10">
<h2>
<span class="header-section-number">12.10</span> <code>select()</code> sur les données groupées<a class="anchor" aria-label="anchor" href="#select-sur-les-donn%C3%A9es-group%C3%A9es"><i class="fas fa-link"></i></a>
</h2>
<p>La fonction <code>select()</code> fonctionne sur les données groupées, à ce détail près que les colonnes utilisées pour les groupes sont toujours inclues, même si elles n’ont pas été mentionnées dans les colonnes à conserver. Pour se débarrasser de ces colonnes, il faut utiliser <code>ungroup()</code> avant de dégrouper.</p>
<!-- ======================================================= -->
</div>
<div id="resources-2" class="section level2" number="12.11">
<h2>
<span class="header-section-number">12.11</span> Resources<a class="anchor" aria-label="anchor" href="#resources-2"><i class="fas fa-link"></i></a>
</h2>
<p>Pour plus d’information, voici quelques ressources utiles :</p>
<p>Vous pouvez utiliser n’importe quelle fonction agrégeant sur des données groupées ; Voir l’antisèche sur <a href="https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf">la transformation des données avec Rstudio</a></p>
<p>La page de The Data Carpentry sur <a href="https://datacarpentry.org/R-genomics/04-dplyr.html"><strong>dplyr</strong></a></p>
<p>La page de référence de l’aide du <strong>tidyverse</strong> sur <a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a> et <a href="https://dplyr.tidyverse.org/articles/grouping.html">grouping</a></p>
<p>Cette page sur la <a href="https://itsalocke.com/files/DataManipulationinR.pdf">manipulation des données</a></p>
<p><a href="https://stackoverflow.com/questions/23528862/summarize-with-conditions-in-dplyr">Résummer les données avec des conditions avec dplyr</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="pivoting_data.html"><span class="header-section-number">11</span> Restructurer les données</a></div>
<div class="next"><a href="joining_matching.html"><span class="header-section-number">13</span> Joindre des données</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#grouping_data"><span class="header-section-number">12</span> Travailler sur des données groupées</a></li>
<li>
<a class="nav-link" href="#%C3%A9tapes-pr%C3%A9liminaires-1"><span class="header-section-number">12.1</span> Étapes préliminaires</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importation-des-paquets-2">Importation des paquets</a></li>
<li><a class="nav-link" href="#import-des-donn%C3%A9es">Import des données</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#grouper-des-donn%C3%A9es"><span class="header-section-number">12.2</span> Grouper des données</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#groupes-distincts">Groupes distincts</a></li>
<li><a class="nav-link" href="#nouvelle-colonne">Nouvelle colonne</a></li>
<li><a class="nav-link" href="#grouper-selon-plus-ou-moins-de-colonnes">Grouper selon plus ou moins de colonnes</a></li>
<li><a class="nav-link" href="#conserver-tous-les-groupes">Conserver tous les groupes</a></li>
</ul>
</li>
<li><a class="nav-link" href="#d%C3%A9grouper-les-donn%C3%A9es"><span class="header-section-number">12.3</span> Dégrouper les données</a></li>
<li><a class="nav-link" href="#group_summarise"><span class="header-section-number">12.4</span> Résumer les données par groupe</a></li>
<li>
<a class="nav-link" href="#comptes-et-additions"><span class="header-section-number">12.5</span> Comptes et additions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#tally">tally()</a></li>
<li><a class="nav-link" href="#count">count()</a></li>
<li><a class="nav-link" href="#ajouter-des-colonnes-contenant-les-d%C3%A9comptes">Ajouter des colonnes contenant les décomptes</a></li>
<li><a class="nav-link" href="#ajouter-les-totaux">Ajouter les totaux</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#grouper-par-date"><span class="header-section-number">12.6</span> Grouper par date</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#grouper-par-jours-linelist">Grouper par jours (linelist)</a></li>
<li><a class="nav-link" href="#grouper-par-semaines-linelist">Grouper par semaines (linelist)</a></li>
<li><a class="nav-link" href="#grouper-par-mois-linelist">Grouper par mois (linelist)</a></li>
<li><a class="nav-link" href="#comptes-journaliers-en-semaines-donn%C3%A9es-agr%C3%A9g%C3%A9es">Comptes journaliers en semaines (données agrégées)</a></li>
</ul>
</li>
<li><a class="nav-link" href="#trier-les-donn%C3%A9es-group%C3%A9es"><span class="header-section-number">12.7</span> Trier les données groupées</a></li>
<li>
<a class="nav-link" href="#filtrer-les-donn%C3%A9es-group%C3%A9es"><span class="header-section-number">12.8</span> Filtrer les données groupées</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#filter">filter()</a></li>
<li><a class="nav-link" href="#slice">slice()</a></li>
<li><a class="nav-link" href="#group_filter_grp_size">Filtrer sur la taille des groupes</a></li>
</ul>
</li>
<li><a class="nav-link" href="#mutate"><span class="header-section-number">12.9</span> mutate()</a></li>
<li><a class="nav-link" href="#select-sur-les-donn%C3%A9es-group%C3%A9es"><span class="header-section-number">12.10</span> select() sur les données groupées</a></li>
<li><a class="nav-link" href="#resources-2"><span class="header-section-number">12.11</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Le Epi R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-21.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
