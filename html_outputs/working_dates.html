<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>9 Manipuler les dates | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="9 Manipuler les dates | The Epidemiologist R Handbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Manipuler les dates | The Epidemiologist R Handbook" />
  
  <meta name="twitter:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.2/transition.js"></script>
    <script src="libs/bs3compat-0.4.2/tabs.js"></script>
    <script src="libs/bs3compat-0.4.2/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.27/datatables.js"></script>
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
    <script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.9/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.1/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="working_dates" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Manipuler les dates</h1>
<p><img src="images/Dates_500x500.png" width="50%" style="display: block; margin: auto;" /></p>
<p>Travailler avec des dates dans R demande plus d’attention que de travailler avec d’autres classes d’objets. Nous vous proposons ci-dessous quelques outils et exemples pour rendre ce processus moins pénible. Heureusement, les dates peuvent étre facilement manipulées avec de la pratique et avec un ensemble de paquets utiles tels que <strong>lubridate</strong>.</p>
<p>Lors de l’importation de données brutes, R interpréte souvent les dates comme des objets de type caractère, ce qui signifie qu’elles ne peuvent pas être utilisêes pour des opérations générales sur les dates, comme la création de séries chronologiques et le calcul des intervalles de temps. Pour compliquer encore les choses, il existe de nombreuses façons de formater une date et vous devez aider R à savoir quelle partie d’une date représente quoi (mois, jour, heure, etc.).</p>
<p>Les dates dans R sont leur propre classe d’objet - la classe <code>Date</code>. Il est à noter qu’il existe également une classe qui stocke les objets de date <em>et</em> d’heure. Les objets date-heure sont formellement appelés classes <code>POSIXt</code>, <code>POSIXct</code>, et/ou <code>POSIXlt</code> (la différence n’est pas importante). Ces objets sont appelés de maniére informelle des classes <em>datetime</em>.</p>
<ul>
<li>Il est important de s’assurer que R reconnaît lorsqu’une colonne contient des dates.<br />
</li>
<li>Les dates sont une classe d’objet et peut être difficile de travailler avec.<br />
</li>
<li>Nous présentons ici plusieurs façons de convertir les colonnes de dates en classe Date.</li>
</ul>
<!-- ======================================================= -->
<div id="étapes-préliminaires" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> étapes préliminaires</h2>
<div id="importation-des-paquets" class="section level3 unnumbered">
<h3>Importation des paquets</h3>
<p>Ces lignes de code chargent les paquets nécessaires aux analyses. Dans ce guide, nous mettons l’accent sur <code>p_load()</code> de <strong>pacman</strong>, qui installe le paquet si nécessaire <em>puis</em> l’importe pour l’utiliser. Vous pouvez également charger les paquets installés avec <code>library()</code> de <strong>base</strong> R. Voir la page sur <a href="rbasics.html#rbasics">bases de R</a> pour plus d’informations sur les paquets R.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="working_dates.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérifie si le paquet est installé, l&#39;installe si nécessaire, et charge le paquet pour la session en cours.</span></span>
<span id="cb312-2"><a href="working_dates.html#cb312-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-3"><a href="working_dates.html#cb312-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb312-4"><a href="working_dates.html#cb312-4" aria-hidden="true" tabindex="-1"></a>  lubridate,  <span class="co"># paquet général pour la manipulation et la conversion des dates </span></span>
<span id="cb312-5"><a href="working_dates.html#cb312-5" aria-hidden="true" tabindex="-1"></a>  parsedate,   <span class="co"># a une fonction pour &quot;deviner&quot; les dates désordonnées</span></span>
<span id="cb312-6"><a href="working_dates.html#cb312-6" aria-hidden="true" tabindex="-1"></a>  aweek,      <span class="co"># une autre option pour convertir les dates en semaines, et les semaines en dates</span></span>
<span id="cb312-7"><a href="working_dates.html#cb312-7" aria-hidden="true" tabindex="-1"></a>  zoo,        <span class="co"># fonctions supplémentaires de date et d&#39;heure</span></span>
<span id="cb312-8"><a href="working_dates.html#cb312-8" aria-hidden="true" tabindex="-1"></a>  tidyverse,  <span class="co"># gestion et visualisation des données  </span></span>
<span id="cb312-9"><a href="working_dates.html#cb312-9" aria-hidden="true" tabindex="-1"></a>  rio)        <span class="co"># import des fichiers</span></span></code></pre></div>
</div>
<div id="importation-des-données" class="section level3 unnumbered">
<h3>Importation des données</h3>
<p>Nous importons le jeu de données des cas d’une épidémie d’Ebola simulée. Si vous souhaitez télécharger les données pour suivre le processus étape par étape, consultez les instructions de la page <a href="download_book_data.html#download_book_data">télécharger le manuel et les données</a>. Pour ce script, nous supposons que le fichier se trouve dans le répertoire de travail de la session R. Aucun sous-dossier n’est donc spécifié dans ce chemin de fichier.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="working_dates.html#cb313-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist_cleaned.xlsx&quot;</span>)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="date-actuelle" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Date actuelle</h2>
<p>Vous pouvez obtenir la date ou l’heure “système” actuelle de votre ordinateur en effectuant les opérations suivantes avec <strong>base</strong> R.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="working_dates.html#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="co"># obtenir la date du système - il s&#39;agit d&#39;une classe DATE</span></span>
<span id="cb314-2"><a href="working_dates.html#cb314-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.Date</span>()</span></code></pre></div>
<pre><code>## [1] &quot;2023-05-17&quot;</code></pre>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="working_dates.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="co"># obtenir l&#39;heure du système - il s&#39;agit d&#39;une classe DATETIME</span></span>
<span id="cb316-2"><a href="working_dates.html#cb316-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>()</span></code></pre></div>
<pre><code>## [1] &quot;2023-05-17 10:06:21 BST&quot;</code></pre>
<p>Avec le paquet <strong>lubridate</strong>, la date et l’heure du système peuvent aussi être retournées avec <code>today()</code> et <code>now()</code>, respectivement. <code>date()</code> renvoie la date et l’heure actuelles avec les noms des jours de la semaine et du mois.</p>
<!-- ======================================================= -->
</div>
<div id="convertir-en-date" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Convertir en Date</h2>
<p>Après avoir importé un ensemble de données dans R, les valeurs des colonnes de date peuvent ressembler à “1989/12/30”, “05/06/2014” ou “13 Jan 2020”. Dans ces cas, R traite probablement encore ces valeurs comme des valeurs de caractères. Il faut <em>dire</em> à R que ces valeurs sont des dates… et quel est le format de la date (quelle partie est le jour, le mois, l’année, etc.).</p>
<p>Une fois informé, R convertit ces valeurs en classe Date. En arriére-plan de l’interface, R stockera les dates sous forme de nombres (le nombre de jours depuis sa date “d’origine”, le 1er janvier 1970). Vous n’utiliserez pas souvent le nombre de dates, mais cela permet à R de traiter les dates comme des variables continues. Cela permet également à R d’autoriser des opérations spéciales pour les objets Date, comme le calcul de la distance entre les dates.</p>
<p>Par défaut, les valeurs de la classe Date dans R sont affichées sous la forme YYYY-MM-DD. Plus tard dans cette section, nous verrons comment modifier l’affichage des valeurs de date.</p>
<p>Nous présentons ci-dessous deux approches pour convertir une colonne de valeurs de caractères en classe Date.</p>
<p><span style="color: darkgreen;">**__CONSEIL:_** Vous pouvez vérifier la classe actuelle d’une colonne avec la fonction R <strong>base</strong> <code>class()</code>, comme <code>class(linelist$date_onset)</code>.</span></p>
<div id="base-r" class="section level3 unnumbered">
<h3><strong>base</strong> R</h3>
<p><code>as.Date()</code> est la fonction standard de <strong>base</strong> R pour convertir un objet ou une colonne en classe Date (notez la majuscule de “D”).</p>
<p>L’utilisation de <code>as.Date()</code> nécessite que :</p>
<ul>
<li>Vous <em>spécifiez le format <strong>existant</strong> de la date brute en caractères</em> ou la date d’origine si vous fournissez des dates en forme de nombres (voir la section sur les dates Excel).<br />
</li>
<li>Si vous l’utilisez sur une colonne de caractères, toutes les valeurs de date doivent avoir le même format exact (si ce n’est pas le cas, essayez <code>parse_date()</code> du paquet <strong>parsedate</strong>)</li>
</ul>
<p>Processus d’utilisation de as.Date() :</p>
<p><strong>Premiérement</strong>, vérifiez la classe de votre colonne avec <code>class()</code> de <strong>base</strong> R. Si vous n’étiez pas sûr de la classe ou sommes confus au sujet de la classe de vos données (par exemple, vous voyez “POSIXct”, etc.), il peut être plus facile de convertir d’abord la colonne en classe Character avec <code>as.character()</code>, et ensuite de la convertir en classe Date.</p>
<p><strong>Deuxiémement</strong>, dans la fonction <code>as.Date()</code>, utilisez l’argument <code>format =</code> pour indiquer à R le format <em>actuel</em> de la chaîne de caractères de la date - quels caractères font référence au mois, au jour et à l’année, et comment ils sont séparés. Si vos valeurs sont déjà dans un des formats de date standard de R (“YYYY-MM-DD” ou “YYYY/MM/DD”) l’argument <code>format =</code> n’est pas nécessaire.</p>
<p>Pour <code>format =</code>, fournissez une chaîne de caractères (entre guillemets) qui représente le format de date <em>actuel</em> en utilisant les abréviations spéciales “strptime” ci-dessous. Par exemple, si les dates de vos caractères sont actuellement au format “DD/MM/YYYY”, comme “24/04/1968”, vous utiliserez <code>format = "%d/%m/%Y"</code> pour convertir les valeurs en dates. <strong>Il est nécessaire de mettre le format entre guillemets. Et n’oubliez pas les barres obliques ou les tirets!</strong></p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="working_dates.html#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir en classe de date</span></span>
<span id="cb318-2"><a href="working_dates.html#cb318-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb318-3"><a href="working_dates.html#cb318-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">as.Date</span>(date_of_onset, <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>))</span></code></pre></div>
<p>La plupart des abréviations de strptime sont listées ci-dessous. Vous pouvez voir la liste compléte en exécutant <code>?strptime</code>.</p>
<p>%d = numéro du jour du mois (5, 17, 28, etc.)<br />
%j = numéro du jour de l’année (Jour 001-366)<br />
%a = Jour de la semaine abrégé (Lun, Mar, Mer, etc.)<br />
%A = Jour de la semaine (Lundi, Mardi, etc.)
%w = numéro du jour de la semaine (0-6, le dimanche est 0)<br />
%u = numéro du jour de la semaine (1-7, le lundi est 1)<br />
%W = numéro de semaine(00-53, le lundi est le début de la semaine)<br />
%U = numéro de semaine (01-53, le dimanche est le début de la semaine)<br />
%m = numéro du mois (e.g. 01, 02, 03, 04)<br />
%b = Mois abrégé (jan, févr, etc.)<br />
%B = Mois complet (janvier, février, etc.)<br />
%y = année à 2 chiffres (par example 89)<br />
%Y = année à 4 chiffres (par example 1989)<br />
%h = heures (horloge de 24 heures)<br />
%m = minutes<br />
%s = secondes
%z = décalage par rapport à GMT<br />
%Z = Fuseau horaire (caractère)</p>
<p><span style="color: darkgreen;"><strong><em>CONSEIL:</em></strong> L’argument <code>format =</code> de la fonction <code>as.Date()</code> n’indique pas à R le format que vous voulez donner aux dates, mais plutôt comment identifier les parties de la date telles qu’elles sont <em>avant</em> que vous lanciez la commande.</span></p>
<p><span style="color: darkgreen;"><strong><em>CONSEIL:</em></strong> Assurez-vous que dans l’argument <code>format =</code> vous utilisez le <em>séparateur de partie de date</em> (par exemple /, -, ou espace) qui est présent dans vos dates.</span></p>
<p>Une fois que les valeurs sont dans la classe Date, R les affichera par défaut dans le format standard, qui est AAAA-MM-JJ.</p>
</div>
<div id="lubridate" class="section level3 unnumbered">
<h3><strong>lubridate</strong></h3>
<p>La conversion d’objets caractères en dates peut être plus facile en utilisant le paquet <strong>lubridate</strong>. <strong>lubridate</strong> est un paquet <strong>tidyverse</strong> créé pour rendre le travail avec les dates et les heures plus simple et plus cohérent que dans <strong>base</strong> R. Pour ces raisons, <strong>lubridate</strong> est souvent considéré comme le paquet de référence pour les dates et les heures, et il est recommandé de travailler avec des variables de date ou d’heure.</p>
<p>Le paquet <strong>lubridate</strong> fournit plusieurs fonctions d’aide différentes créées pour convertir les objets caractères en dates de maniére intuitive, et plus facile que de spécifier le format dans <code>as.Date()</code>. Ces fonctions sont spécifiques au format de date brut, mais permettent une variété de séparateurs et de synonymes pour les dates (par exemple 01 vs Jan vs Janvier) - les synonymes sont nommés d’après les abréviations des formats de date.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="working_dates.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="co"># installez/chargez lubridate</span></span>
<span id="cb319-2"><a href="working_dates.html#cb319-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(lubridate)</span></code></pre></div>
<p>La fonction <code>ymd()</code> convertit de maniére flexible les valeurs de date fournies sous la forme <strong>année, mois, jour</strong>. Cette fonction fonctionne avec n’importe quel séparateur utilisé dans les variables.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="working_dates.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lire la date au format année-mois-jour</span></span>
<span id="cb320-2"><a href="working_dates.html#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;2020-10-11&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-10-11&quot;</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="working_dates.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;20201011&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-10-11&quot;</code></pre>
<p>La fonction <code>mdy()</code> convertit de maniére flexible les valeurs de date fournies sous la forme <strong>mois, jour, année</strong>.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="working_dates.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lire la date au format mois-jour-année</span></span>
<span id="cb324-2"><a href="working_dates.html#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">&quot;10/11/2020&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-10-11&quot;</code></pre>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="working_dates.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">&quot;Oct 11 20&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-10-11&quot;</code></pre>
<p>La fonction <code>dmy()</code> convertit de maniére flexible les valeurs de date fournies sous la forme <strong>jour, mois, année</strong>.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="working_dates.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lire la date au format jour-mois-année</span></span>
<span id="cb328-2"><a href="working_dates.html#cb328-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">&quot;11 10 2020&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-10-11&quot;</code></pre>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="working_dates.html#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">&quot;11 October 2020&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-10-11&quot;</code></pre>
<!-- Les fonctions `as.character()` et `as.Date()` peuvent aussi être combinées comme :   -->
<!-- ```{r eval=F} -->
<!-- linelist_cleaned$date_of_onset <- as.Date(as.character(linelist_cleaned$date_of_onset), format = "%d/%m/%Y") -->
<!-- ``` -->
<p>Si vous utilisez le piping, la conversion d’une colonne de caractères en dates avec <strong>lubridate</strong> pourrait ressembler à ceci :</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="working_dates.html#cb332-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb332-2"><a href="working_dates.html#cb332-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(date_onset))</span></code></pre></div>
<p>Une fois terminé, vous pouvez exécuter <code>class()</code> pour vérifier la classe de la colonne</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="working_dates.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Vérifiez la classe de la colonne</span></span>
<span id="cb333-2"><a href="working_dates.html#cb333-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>date_onset)  </span></code></pre></div>
<p>Une fois que les valeurs sont dans la classe Date, R les affichera par défaut dans le format standard, qui est AAAA-MM-JJ.</p>
<p>Notez que les fonctions ci-dessus fonctionnent mieux avec des années à 4 chiffres. Les années à 2 chiffres peuvent produire des résultats inattendus, car lubridate va deviner le siècle.</p>
<p>Pour convertir une année à 2 chiffres en une année à 4 chiffres (toutes dans le même siècle), vous pouvez convertir en caractères de classe, puis combiner les chiffres existants avec un préfixe en utilisant <code>str_glue()</code> du paquet <strong>stringr</strong> (voir la page <a href="character_strings.html#character_strings">Caractères et chaînes de caractères</a>). Vous pouvez ensuite convertir la colonne en date.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="working_dates.html#cb334-1" aria-hidden="true" tabindex="-1"></a>two_digit_years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;15&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;17&quot;</span>)</span>
<span id="cb334-2"><a href="working_dates.html#cb334-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">&quot;20{two_digit_years}&quot;</span>)</span></code></pre></div>
<pre><code>## 2015
## 2015
## 2016
## 2017</code></pre>
</div>
<div id="combine-columns" class="section level3 unnumbered">
<h3>Combine columns</h3>
<p>Vous pouvez utiliser les fonctions <strong>lubridate</strong> <code>make_date()</code> et <code>make_datetime()</code> pour combiner plusieurs colonnes numériques en une seule colonne de date. Par exemple, si vous avez les colonnes numériques <code>onset_day</code>, <code>onset_month</code>, et <code>onset_year</code> dans le cadre de données <code>linelist</code> :</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="working_dates.html#cb336-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb336-2"><a href="working_dates.html#cb336-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">onset_date =</span> <span class="fu">make_date</span>(<span class="at">year =</span> onset_year, <span class="at">month =</span> onset_month, <span class="at">day =</span> onset_day))</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="dates-en-excel" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Dates en Excel</h2>
<p>En arriére-plan, la plupart des logiciels stockent les dates sous forme de nombres. R stocke les dates à partir du 1er janvier 1970. Ainsi, si vous exécutez <code>as.numeric(as.Date("1970-01-01))</code> vous obtiendrez <code>0</code>.</p>
<p>Microsoft Excel enregistre les dates à partir du 30 décembre 1899 (Windows) ou du 1er janvier 1904 (Mac), selon votre système d’exploitation. Consultez ce <a href="https://docs.microsoft.com/en-us/office/troubleshoot/excel/1900-and-1904-date-system">guide Microsoft</a> pour plus d’informations.</p>
<p>Les dates d’Excel sont souvent importées dans R sous la forme de ces valeurs numériques plutôt que sous la forme de caractères. Si le jeu de données que vous avez importé d’Excel montre des dates sous forme de nombres ou de caractères comme “41369”… utilisez la fonction <code>as.Date()</code> (ou la fonction <code>as_date()</code> de <strong>lubridate</strong>) pour convertir, mais <strong>au lieu de fournir un “format” comme ci-dessus, fournissez la date d’origine Excel</strong> à l’argument <code>origin =</code> dans la fonction.</p>
<p>Cela ne fonctionnera pas si la date Excel est stockée dans R comme un type de caractère, donc assurez-vous que le nombre est de classe Numérique!</p>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> Vous devez fournir la date d’origine dans le format de date par défaut de R (“YYYY-MM-DD”).</span></p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="working_dates.html#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Un exemple de fourniture de la &quot;date d&#39;origine&quot; d&#39;Excel lors de la conversion de dates numériques d&#39;Excel.</span></span>
<span id="cb337-2"><a href="working_dates.html#cb337-2" aria-hidden="true" tabindex="-1"></a>data_cleaned <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb337-3"><a href="working_dates.html#cb337-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">as.numeric</span>(date_onset)) <span class="sc">%&gt;%</span>   <span class="co"># ensure class is numeric</span></span>
<span id="cb337-4"><a href="working_dates.html#cb337-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">as.Date</span>(date_onset, <span class="at">origin =</span> <span class="st">&quot;1899-12-30&quot;</span>)) <span class="co"># convert to date using Excel origin</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="dates-désordonnées" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Dates désordonnées</h2>
<p>Vous pouvez utiliser la fonction <code>parse_date()</code> du paquet <strong>parsedate</strong> pour lire une colonne de date “désordonnée” qui contient des dates dans de nombreux formats différents et convertir les dates dans un format standard. Vous pouvez <a href="https://readr.tidyverse.org/reference/parse_datetime.html">en savoir plus en ligne sur <code>parse_date()</code></a>.</p>
<p>Par exemple, <code>parse_date</code> lira un vecteur des dates en caractères suivantes : “03 Jan 2018”, “07/03/1982”, et “08/20/85” et les convertira en classe Date sous la forme de : <code>2018-01-03</code>, <code>1982-03-07</code>, et <code>1985-08-20</code>.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="working_dates.html#cb338-1" aria-hidden="true" tabindex="-1"></a>parsedate<span class="sc">::</span><span class="fu">parse_date</span>(<span class="fu">c</span>(<span class="st">&quot;03 January 2018&quot;</span>,</span>
<span id="cb338-2"><a href="working_dates.html#cb338-2" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;07/03/1982&quot;</span>,</span>
<span id="cb338-3"><a href="working_dates.html#cb338-3" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;08/20/85&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2018-01-03 UTC&quot; &quot;1982-07-03 UTC&quot; &quot;1985-08-20 UTC&quot;</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="working_dates.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Un exemple d&#39;utilisation de parse_date() sur la colonne date_onset</span></span>
<span id="cb340-2"><a href="working_dates.html#cb340-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>                 <span class="co"># le dataframe s&#39;appelle linelist, à ne pas confondre avec le paquet &quot;linelist&quot;</span></span>
<span id="cb340-3"><a href="working_dates.html#cb340-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb340-4"><a href="working_dates.html#cb340-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_onset =</span> <span class="fu">parse_date</span>(date_onset))</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="travailler-avec-la-classe-date-heure" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> Travailler avec la classe date-heure</h2>
<p>Comme nous l’avons déjà mentionné, R supporte également une classe <code>datetime</code> - une colonne qui contient des informations de date <strong>et</strong> d’heure. Comme pour la classe <code>Date</code>, il faut souvent convertir les objets <code>caracter</code> en objets <code>datetime</code>.</p>
<div id="convertir-des-dates-avec-des-heures" class="section level3 unnumbered">
<h3>Convertir des dates avec des heures</h3>
<p>Un objet <code>datetime</code> standard est formaté avec la date en premier, qui est suivie par une entrée de temps - par exemple <em>01 Jan 2020, 16:30</em>. Comme pour les dates, il existe de nombreuses façons de formater cet objet. Il existe de nombreux niveaux de précision (heures, minutes, secondes) qui peuvent être fournis à un objet “datetime”.</p>
<p>Il existe des fonctions du paquet <strong>lubridate</strong> pour aider à convertir ces chaînes en objets <code>datetime</code>. Ces fonctions sont des extensions des fonctions d’aide de date, avec <code>_h</code> (seulement les heures fournies), <code>_hm</code> (heures et minutes fournies), ou <code>_hms</code> (heures, minutes et secondes fournies) ajoutées à la fin (par exemple, <code>dmy_hms()</code>). Ils peuvent être utilisês comme indiqué :</p>
<p>Convertir une date avec seulement des heures en objet datetime</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="working_dates.html#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd_h</span>(<span class="st">&quot;2020-01-01 16hrs&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 16:00:00 UTC&quot;</code></pre>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="working_dates.html#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd_h</span>(<span class="st">&quot;2020-01-01 4PM&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 16:00:00 UTC&quot;</code></pre>
<p>Converter une date avec des heures et des minutes en objet datetime.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="working_dates.html#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy_hm</span>(<span class="st">&quot;01 Janvier 2020 16:20&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: All formats failed to parse. No formats found.</code></pre>
<pre><code>## [1] NA</code></pre>
<p>Converrtir une date avec des heures, des minutes et des secondes en un objet de type datetime.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="working_dates.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mdy_hms</span>(<span class="st">&quot;01 Janvier 2020, 16:20:40&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-20 16:20:40 UTC&quot;</code></pre>
<p>Vous pouvez fournir le fuseau horaire mais il est ignoré par la fonction. Allez à la section plus bas dans le chapitre pour en savoir plus sur les fuseaux horaires dans R.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="working_dates.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mdy_hms</span>(<span class="st">&quot;01 Janvier 2020, 16:20:40 PST&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-20 16:20:40 UTC&quot;</code></pre>
<p>Avec un dataframe chargé dans R, les colonnes d’heure et de date peuvent être combinées pour créer une colonne de date en utilisant la fonction <code>str_glue()</code> du paquet <strong>stringr</strong> et la fonction appropriée du paquet <strong>lubridate</strong>, selon le format de date et d’heure dans le dataframe. Voir la page <a href="character_strings.html#character_strings">caractères et chaînes de caractères</a> pour plus de détails sur <strong>stringr</strong>.</p>
<p>Dans cet exemple, le dataframe <code>linelist</code> a une colonne au format “heures:minutes”. Pour la convertir en date, nous suivons quelques étapes :</p>
<ol style="list-style-type: decimal">
<li>Vous créez une colonne de temps d’admission “propre” avec les valeurs manquantes remplies avec la médiane de la colonne. Nous faisons cela parce que <strong>lubridate</strong> ne fonctionne pas sur les valeurs manquantes. Combinez la nouvelle colonne avec la colonne <code>date_hospitalisation</code>, puis utilisez la fonction <code>ymd_hm()</code> pour convertir en objet datetime.</li>
</ol>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="working_dates.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="co"># packages</span></span>
<span id="cb352-2"><a href="working_dates.html#cb352-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, lubridate, stringr)</span>
<span id="cb352-3"><a href="working_dates.html#cb352-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-4"><a href="working_dates.html#cb352-4" aria-hidden="true" tabindex="-1"></a><span class="co"># time_admission est une colonne en heures:minutes</span></span>
<span id="cb352-5"><a href="working_dates.html#cb352-5" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb352-6"><a href="working_dates.html#cb352-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb352-7"><a href="working_dates.html#cb352-7" aria-hidden="true" tabindex="-1"></a><span class="co">#si l&#39;heure d&#39;admission n&#39;est pas donnée, attribuez l&#39;heure d&#39;admission médiane.</span></span>
<span id="cb352-8"><a href="working_dates.html#cb352-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-9"><a href="working_dates.html#cb352-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb352-10"><a href="working_dates.html#cb352-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_admission_clean =</span> <span class="fu">ifelse</span>(</span>
<span id="cb352-11"><a href="working_dates.html#cb352-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(time_admission),         <span class="co"># si l&#39;heure est manquante</span></span>
<span id="cb352-12"><a href="working_dates.html#cb352-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">median</span>(time_admission),          <span class="co"># assigner la médiane</span></span>
<span id="cb352-13"><a href="working_dates.html#cb352-13" aria-hidden="true" tabindex="-1"></a>      time_admission                   <span class="co"># si elle n&#39;est pas manquante, la garder telle quelle</span></span>
<span id="cb352-14"><a href="working_dates.html#cb352-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb352-15"><a href="working_dates.html#cb352-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb352-16"><a href="working_dates.html#cb352-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Utilisez str_glue() pour combiner les colonnes de date et d&#39;heure afin de créer une colonne de caractères.</span></span>
<span id="cb352-17"><a href="working_dates.html#cb352-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># puis utiliser ymd_hm() pour la convertir en classe datetime</span></span>
<span id="cb352-18"><a href="working_dates.html#cb352-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb352-19"><a href="working_dates.html#cb352-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_time_of_admission =</span> <span class="fu">str_glue</span>(<span class="st">&quot;{date_hospitalisation} {time_admission_clean}&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb352-20"><a href="working_dates.html#cb352-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ymd_hm</span>()</span>
<span id="cb352-21"><a href="working_dates.html#cb352-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="convertir-uniquement-les-temps" class="section level3 unnumbered">
<h3>Convertir uniquement les temps</h3>
<p>Si vos données ne contiennent qu’un caractère temps (heures et minutes), vous pouvez les convertir et les manipuler comme des temps en utilisant la fonction <code>strptime()</code> de <strong>base</strong> R. Par exemple, pour obtenir la différence entre deux temps :</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="working_dates.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># temps comme objets de caractère</span></span>
<span id="cb353-2"><a href="working_dates.html#cb353-2" aria-hidden="true" tabindex="-1"></a>time1 <span class="ot">&lt;-</span> <span class="st">&quot;13:45&quot;</span> </span>
<span id="cb353-3"><a href="working_dates.html#cb353-3" aria-hidden="true" tabindex="-1"></a>time2 <span class="ot">&lt;-</span> <span class="st">&quot;15:20&quot;</span></span>
<span id="cb353-4"><a href="working_dates.html#cb353-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-5"><a href="working_dates.html#cb353-5" aria-hidden="true" tabindex="-1"></a><span class="co"># temps converties en une classe de datetime</span></span>
<span id="cb353-6"><a href="working_dates.html#cb353-6" aria-hidden="true" tabindex="-1"></a>time1_clean <span class="ot">&lt;-</span> <span class="fu">strptime</span>(time1, <span class="at">format =</span> <span class="st">&quot;%H:%M&quot;</span>)</span>
<span id="cb353-7"><a href="working_dates.html#cb353-7" aria-hidden="true" tabindex="-1"></a>time2_clean <span class="ot">&lt;-</span> <span class="fu">strptime</span>(time2, <span class="at">format =</span> <span class="st">&quot;%H:%M&quot;</span>)</span>
<span id="cb353-8"><a href="working_dates.html#cb353-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-9"><a href="working_dates.html#cb353-9" aria-hidden="true" tabindex="-1"></a><span class="co"># La différence est de classe &quot;difftime&quot; par défaut, ici convertie en heures numériques. </span></span>
<span id="cb353-10"><a href="working_dates.html#cb353-10" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(time2_clean <span class="sc">-</span> time1_clean)   <span class="co"># différence en heures</span></span></code></pre></div>
<pre><code>## [1] 1.583333</code></pre>
<p>Notez cependant que si aucune valeur de date n’est fournie, la fonction suppose que la date est aujourd’hui. Pour combiner une chaîne de date et une chaîne d’heure, voyez comment utiliser <strong>stringr</strong> dans la section juste au-dessus. Pour en savoir plus sur <code>strptime()</code> <a href="https://rdrr.io/r/base/strptime.html">ici</a>.</p>
<p>Pour convertir des nombres à un chiffre en nombres à deux chiffres (par exemple, pour ajouter des zéros aux heures ou aux minutes afin d’obtenir deux chiffres), consultez la section <a href="character_strings.html#str_pad">“Longueur des caractères” de la page caractères et chaînes de caractères</a>.</p>
</div>
<div id="extraction-déléments-du-temps" class="section level3 unnumbered">
<h3>Extraction d’éléments du temps</h3>
<p>Vous pouvez extraire des éléments du temps avec <code>hour()</code>, <code>minute()</code>, ou <code>second()</code> du paquet <strong>lubridate</strong>.</p>
<p>Voici un exemple d’extraction de l’heure, puis de classement par partie de la journée. Nous commençons par la colonne <code>time_admission</code>, qui est dans la classe Character au format “HH:MM”. D’abord, la fonction <code>strptime()</code> est utilisêe comme décrit ci-dessus pour convertir les caractères en classe datetime. Ensuite, l’heure est extraite avec <code>hour()</code>, retournant un nombre de 0-24. Enfin, une colonne <code>time_period</code> est crée en utilisant la logique de <code>case_when()</code> pour classer les lignes en Matin/Après-midi/Soir/Nuit en fonction de leur heure d’admission.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="working_dates.html#cb355-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb355-2"><a href="working_dates.html#cb355-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hour_admit =</span> <span class="fu">hour</span>(<span class="fu">strptime</span>(time_admission, <span class="at">format =</span> <span class="st">&quot;%H:%M&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb355-3"><a href="working_dates.html#cb355-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_period =</span> <span class="fu">case_when</span>(</span>
<span id="cb355-4"><a href="working_dates.html#cb355-4" aria-hidden="true" tabindex="-1"></a>    hour_admit <span class="sc">&gt;</span> <span class="dv">06</span> <span class="sc">&amp;</span> hour_admit <span class="sc">&lt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">&quot;Matin&quot;</span>,</span>
<span id="cb355-5"><a href="working_dates.html#cb355-5" aria-hidden="true" tabindex="-1"></a>    hour_admit <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> hour_admit <span class="sc">&lt;</span> <span class="dv">17</span> <span class="sc">~</span> <span class="st">&quot;Après-midi&quot;</span>,</span>
<span id="cb355-6"><a href="working_dates.html#cb355-6" aria-hidden="true" tabindex="-1"></a>    hour_admit <span class="sc">&gt;=</span> <span class="dv">17</span> <span class="sc">&amp;</span> hour_admit <span class="sc">&lt;</span> <span class="dv">21</span> <span class="sc">~</span> <span class="st">&quot;Soir&quot;</span>,</span>
<span id="cb355-7"><a href="working_dates.html#cb355-7" aria-hidden="true" tabindex="-1"></a>    hour_admit <span class="sc">&gt;=</span><span class="dv">21</span> <span class="sc">|</span> hour_admit <span class="sc">&lt;=</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">&quot;Nuit&quot;</span>))</span></code></pre></div>
<p>Pour en savoir plus sur la fonction <code>case_when()</code>, consultez la page <a href="cleaning_data.html#cleaning_data">Nettoyage des données et des fonctions de base</a>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="travailler-avec-des-dates" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> Travailler avec des dates</h2>
<p>Le paquet <code>lubridate</code> peut également être utilisê pour une variété d’autres fonctions, telles que <strong>l’extraction d’aspects d’une date/heure</strong>, <strong>l’exécution d’arithmétique pour les dates</strong>, ou <strong>le calcul d’intervalles de dates</strong>.</p>
<p>Nous définissons ici une date à utiliser dans les exemples :</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="working_dates.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="co"># créer un objet de la classe Date</span></span>
<span id="cb356-2"><a href="working_dates.html#cb356-2" aria-hidden="true" tabindex="-1"></a>example_date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">&quot;2020-03-01&quot;</span>)</span></code></pre></div>
<div id="extraire-les-composants-de-la-date" class="section level3 unnumbered">
<h3>Extraire les composants de la date</h3>
<p>Vous pouvez extraire des aspects communs commes le mois, le jour, le jour de la semaine :</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="working_dates.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(example_date) <span class="co"># numéro du mois</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="working_dates.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">day</span>(example_date) <span class="co"># jour (numéro) du mois</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="working_dates.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wday</span>(example_date) <span class="co"># numéro du jour de la semaine (1-7)</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Vous pouvez également extraire les composants temporels d’un objet ou d’une colonne en classe <code>datetime</code>. Cela peut être utile si vous voulez visualiser la distribution des temps d’admission.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="working_dates.html#cb363-1" aria-hidden="true" tabindex="-1"></a>example_datetime <span class="ot">&lt;-</span> <span class="fu">ymd_hm</span>(<span class="st">&quot;2020-03-01 14:45&quot;</span>)</span>
<span id="cb363-2"><a href="working_dates.html#cb363-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-3"><a href="working_dates.html#cb363-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hour</span>(example_datetime) <span class="co"># extraire l&#39;heure</span></span>
<span id="cb363-4"><a href="working_dates.html#cb363-4" aria-hidden="true" tabindex="-1"></a><span class="fu">minute</span>(example_datetime) <span class="co"># extrait la minute</span></span>
<span id="cb363-5"><a href="working_dates.html#cb363-5" aria-hidden="true" tabindex="-1"></a><span class="fu">second</span>(example_datetime) <span class="co"># extrait les secondes</span></span></code></pre></div>
<p>Il existe plusieurs options pour récupérer les semaines. Lisez la section sur les semaines épidémiologiques ci-dessous pour en savoir plus.</p>
<p>Notez que si vous cherchez à <em>afficher</em> une date d’une certaine maniére (par exemple “Jan 2020” ou “Jeudi 20 mars” ou “Semaine 20, 1977”), vous pouvez le faire assez facilement en utilisant les méthodes décrites dans la section sur l’affichage des dates.</p>
</div>
<div id="mathématiques-de-dates" class="section level3 unnumbered">
<h3>Mathématiques de dates</h3>
<p>Vous pouvez ajouter certains nombres de jours ou de semaines en utilisant leur fonction respective du paquet <strong>lubridate</strong>.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="working_dates.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ajouter 3 jours à cette date</span></span>
<span id="cb364-2"><a href="working_dates.html#cb364-2" aria-hidden="true" tabindex="-1"></a>example_date <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-03-04&quot;</code></pre>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="working_dates.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ajoute 7 semaines et soustrait deux jours à cette date</span></span>
<span id="cb366-2"><a href="working_dates.html#cb366-2" aria-hidden="true" tabindex="-1"></a>example_date <span class="sc">+</span> <span class="fu">weeks</span>(<span class="dv">7</span>) <span class="sc">-</span> <span class="fu">days</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-04-17&quot;</code></pre>
</div>
<div id="intervalles-entre-les-dates" class="section level3 unnumbered">
<h3>Intervalles entre les dates</h3>
<p>La différence entre les dates peut être calculée par :</p>
<ol style="list-style-type: decimal">
<li>Assurez-vous que les deux dates sont de la classe Date<br />
</li>
<li>Utilisez la soustraction pour obtenir la différence “difftime” entre les deux dates.<br />
</li>
<li>Si nécessaire, convertissez le résultat en classe numérique pour effectuer les calculs mathématiques suivants.</li>
</ol>
<p>Ci-dessous, l’intervalle entre deux dates est calculé et affiché. Vous pouvez trouver des intervalles en utilisant le symbole “moins” de la soustraction sur des valeurs de la classe Date. Notez que la classe de la valeur retournée est “difftime” comme affiché ci-dessous, et doit être convertie en classe numérique.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="working_dates.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="co"># trouver l&#39;intervalle entre example_date et le 20 février 2020 </span></span>
<span id="cb368-2"><a href="working_dates.html#cb368-2" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> example_date <span class="sc">-</span> <span class="fu">ymd</span>(<span class="st">&quot;2020-02-20&quot;</span>)</span>
<span id="cb368-3"><a href="working_dates.html#cb368-3" aria-hidden="true" tabindex="-1"></a>output    <span class="co"># imprimer</span></span></code></pre></div>
<pre><code>## Time difference of 10 days</code></pre>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="working_dates.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(output)</span></code></pre></div>
<pre><code>## [1] &quot;difftime&quot;</code></pre>
<p>Pour effectuer d’autres opérations sur un objet de classe “difftime”, convertissez-le en numérique avec la fonction <code>as.numeric()</code>.</p>
<p>Tout ceci peut être rassemblé pour travailler avec des données - par exemple :</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="working_dates.html#cb372-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(lubridate, tidyverse) <span class="co"># charger les paquets</span></span>
<span id="cb372-2"><a href="working_dates.html#cb372-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-3"><a href="working_dates.html#cb372-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> <span class="co"># conversion de la date d&#39;apparition en caractères</span></span>
<span id="cb372-4"><a href="working_dates.html#cb372-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb372-5"><a href="working_dates.html#cb372-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convertir la date d&#39;apparition de objets caractères en objets date en spécifiant le format dmy</span></span>
<span id="cb372-6"><a href="working_dates.html#cb372-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">dmy</span>(date_onset),</span>
<span id="cb372-7"><a href="working_dates.html#cb372-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_hospitalisation =</span> <span class="fu">dmy</span>(date_hospitalisation)) <span class="sc">%&gt;%</span></span>
<span id="cb372-8"><a href="working_dates.html#cb372-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb372-9"><a href="working_dates.html#cb372-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filtre tous les cas dont la date d&#39;apparition n&#39;est pas en mars</span></span>
<span id="cb372-10"><a href="working_dates.html#cb372-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">month</span>(date_onset) <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="co"># filtrer tous les cas sans apparition en mars</span></span>
<span id="cb372-11"><a href="working_dates.html#cb372-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb372-12"><a href="working_dates.html#cb372-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># trouver la différence en jours entre l&#39;apparition et l&#39;hospitalisation pour tous les cas</span></span>
<span id="cb372-13"><a href="working_dates.html#cb372-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">days_onset_to_hosp =</span> date_hospitalisation <span class="sc">-</span> date_of_onset)</span></code></pre></div>
<p>Dans le dataframe, si l’une des dates ci-dessus est manquante, l’opération échouera pour cette ligne. Il en résultera un <code>NA</code> au lieu d’une valeur numérique. Lorsque vous utilisez cette colonne pour des calculs, assurez-vous de mettre l’argument <code>na.rm =</code> à <code>TRUE</code> (vrai). Par exemple :</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="working_dates.html#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculez le nombre médian de jours d&#39;hospitalisation pour tous les cas pour lesquels des données sont disponibles.</span></span>
<span id="cb373-2"><a href="working_dates.html#cb373-2" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(linelist_delay<span class="sc">$</span>days_onset_to_hosp, <span class="at">na.rm =</span> T)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="affichage-des-dates" class="section level2" number="9.8">
<h2><span class="header-section-number">9.8</span> Affichage des dates</h2>
<p>Une fois que les dates ont la bonne classe, vous voudrez peut-être qu’elles s’affichent différemment, par exemple qu’elles s’affichent comme “Lundi 05 Janvier” au lieu de “2018-01-05”. Vous pouvez aussi vouloir ajuster l’affichage afin de regrouper ensuite les lignes en fonction des éléments de date affichés - par exemple pour regrouper par mois-année.</p>
<div id="format" class="section level3 unnumbered">
<h3><code>format()</code></h3>
<p>Ajustez l’affichage de la date avec la fonction <code>format()</code> de <strong>base</strong> R. Cette fonction accepte une chaîne de caractères (entre guillemets) spécifiant le format final <em>souhaité</em> dans les abréviations “%” strptime (la même syntaxe que celle utilisêe dans la fonction <code>as.Date()</code>). Vous trouverez ci-dessous la plupart des abréviations courantes.</p>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> l’’utilisation de <code>format()</code> convertira les valeurs dans la classe Character, donc cette fonction est généralement utilisêe vers la fin d’une analyse ou uniquement pour l’affichage ! Vous pouvez voir la liste complète en exécutant <code>?strptime</code>.</p>
<p>%d = numéro du jour du mois (5, 17, 28, etc.)<br />
%j = numéro du jour de l’année (Jday 001-366)<br />
%a = Jour de la semaine abrégé (lun, mar, mer, etc.)<br />
%A = Jour de la semaine complet (lundi, mardi, etc.)<br />
%w = numéro du jour de la semaine (0-6, le dimanche est 0)<br />
%u = numéro du jour de la semaine (1-7, le lundi est 1)<br />
%W = numéro de la semaine (00-53, le lundi est le début de la semaine)<br />
%U = numéro de la semaine (01-53, le dimanche est le début de la semaine)<br />
%m = numéro du mois (par exemple 01, 02, 03, 04)<br />
%b = Mois abrégé (Jan, Feb, etc.)<br />
%B = Mois complet (janvier, février, etc.)<br />
%y = année à 2 chiffres (ex. 89)<br />
%Y = année à 4 chiffres (ex. 1989)<br />
%h = heures (horloge de 24 heures)<br />
%m = minutes<br />
%s = secondes<br />
%z = décalage par rapport à GMT<br />
%Z = Fuseau horaire (caractère)</p>
<p>Un exemple de formatage de la date du jour:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="working_dates.html#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="co"># date du jour, avec formatage</span></span>
<span id="cb374-2"><a href="working_dates.html#cb374-2" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="at">format =</span> <span class="st">&quot;%d %B %Y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;17 May 2023&quot;</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="working_dates.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="co"># moyen simple d&#39;obtenir la date et l&#39;heure complètes (formatage par défaut)</span></span>
<span id="cb376-2"><a href="working_dates.html#cb376-2" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Wed May 17 10:06:22 2023&quot;</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="working_dates.html#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="co"># formatage de la date, de l&#39;heure et du fuseau horaire combinés ensemble avec la fonction str_glue()</span></span>
<span id="cb378-2"><a href="working_dates.html#cb378-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">&quot;{format(Sys.Date(), format = &#39;%A, %B %d %Y, %z %Z, &#39;)}{format(Sys.time(), format = &#39;%H:%M:%S&#39;)}&quot;</span>)</span></code></pre></div>
<pre><code>## Wednesday, May 17 2023, +0000 UTC, 10:06:22</code></pre>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="working_dates.html#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Utilisation du formatage pour afficher les semaines</span></span>
<span id="cb380-2"><a href="working_dates.html#cb380-2" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">&quot;%Y Week %W&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2023 Week 20&quot;</code></pre>
<p>Notez que si vous utilisez la fonction <code>str_glue()</code>, sachez qu’à l’intérieur des guillemets doubles ” vous ne devez utiliser que des guillemets simples (comme ci-dessus).</p>
</div>
<div id="mois-année" class="section level3 unnumbered">
<h3>Mois-année</h3>
<p>Pour convertir une colonne de date au format mois-année, nous vous suggérons d’utiliser la fonction <code>as.yearmon()</code> du paquet <strong>zoo</strong>. Cette fonction convertit la date en classe “yearmon” et conserve l’ordre correct. En revanche, l’utilisation de la fonction <code>format(colonne, "%Y %B")</code> convertira la date en classe caractère et classera les valeurs par ordre alphabétique (de maniére incorrecte).</p>
<p>Ci-dessous, une nouvelle colonne <code>yearmonth</code> est créée à partir de la colonne <code>date_onset</code>, en utilisant la fonction <code>as.yearmon()</code>. L’ordre par défaut (correct) des valeurs résultantes est indiqué dans le tableau.</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="working_dates.html#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="co"># créer une nouvelle colonne </span></span>
<span id="cb382-2"><a href="working_dates.html#cb382-2" aria-hidden="true" tabindex="-1"></a>test_zoo <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb382-3"><a href="working_dates.html#cb382-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">yearmonth =</span> zoo<span class="sc">::</span><span class="fu">as.yearmon</span>(date_onset))</span>
<span id="cb382-4"><a href="working_dates.html#cb382-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-5"><a href="working_dates.html#cb382-5" aria-hidden="true" tabindex="-1"></a><span class="co"># imprimer le tableau</span></span>
<span id="cb382-6"><a href="working_dates.html#cb382-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(test_zoo<span class="sc">$</span>yearmon)</span></code></pre></div>
<pre><code>## 
## Apr 2014 May 2014 Jun 2014 Jul 2014 Aug 2014 Sep 2014 Oct 2014 Nov 2014 Dec 2014 Jan 2015 Feb 2015 Mar 2015 Apr 2015 
##        7       64      100      226      528     1070     1112      763      562      431      306      277      186</code></pre>
<p>En revanche, vous pouvez voir comment la seule utilisation de <code>format()</code> permet d’obtenir le format d’affichage souhaité, mais pas l’ordre correct.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="working_dates.html#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="co"># créer une nouvelle colonne</span></span>
<span id="cb384-2"><a href="working_dates.html#cb384-2" aria-hidden="true" tabindex="-1"></a>test_format <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb384-3"><a href="working_dates.html#cb384-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">yearmonth =</span> <span class="fu">format</span>(date_onset, <span class="st">&quot;%b %Y&quot;</span>))</span>
<span id="cb384-4"><a href="working_dates.html#cb384-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-5"><a href="working_dates.html#cb384-5" aria-hidden="true" tabindex="-1"></a><span class="co"># imprimer le tableau</span></span>
<span id="cb384-6"><a href="working_dates.html#cb384-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(test_format<span class="sc">$</span>yearmon)</span></code></pre></div>
<pre><code>## 
## Apr 2014 Apr 2015 Aug 2014 Dec 2014 Feb 2015 Jan 2015 Jul 2014 Jun 2014 Mar 2015 May 2014 Nov 2014 Oct 2014 Sep 2014 
##        7      186      528      562      306      431      226      100      277       64      763     1112     1070</code></pre>
<p>Note : si vous travaillez dans un <code>ggplot()</code> et vous voulez ajuster la façon dont les dates sont <em>affichées</em> uniquement, il peut être suffisant de fournir un format strptime à l’argument <code>date_labels =</code> dans <code>scale_x_date()</code> - vous pouvez utiliser <code>"%b %Y"</code> ou <code>"%Y %b"</code>. Consultez la page <a href="ggplot_tips.html#ggplot_tips">Astuces de ggplot</a> pour une explication plus approfondie.</p>
<p>Alternativement, le paquet <strong>zoo</strong> posséde la fonction <code>as.yearqtr()</code>, et vous pouvez utiliser <code>scale_x_yearmon()</code> lorsque vous utilisez <code>ggplot()</code> pour ajuster la façon dont les dates sont <em>affichées</em> sur le graphique.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="dates_epi_wks" class="section level2" number="9.9">
<h2><span class="header-section-number">9.9</span> Semaines épidémiologiques</h2>
<div id="lubridate-1" class="section level3 unnumbered">
<h3><strong>lubridate</strong></h3>
<p>Consultez la page <a href="grouping_data.html#grouping_data">Regroupement de données</a> pour des exemples plus complets de regroupement de données par date. Ci-dessous, nous décrivons briévement le regroupement des données par semaine.</p>
<p>Nous recommandons généralement d’utiliser la fonction <code>floor_date()</code> du package <strong>lubridate</strong>, avec l’argument <code>unit = "week"</code>. Cela arrondit la date au “début” de la semaine, comme défini par l’argument <code>week_start =</code>. Le début de semaine par défaut est 1 (pour les lundis) mais vous pouvez spécifier n’importe quel jour de la semaine comme début (par exemple 7 pour les dimanches). <code>floor_date()</code> est polyvalent et peut être utilisê pour arrondir à d’autres unités de temps en définissant <code>unit =</code> à “seconde”, “minute”, “heure”, “jour”, “mois” ou “année”.</p>
<p>La valeur retournée est la date de début de la semaine, dans la classe Date. La classe Date est utile pour tracer les données, car elle est ordonnée correctement et elle sera facilement reconnue par <code>ggplot()</code>.</p>
<p>Si vous êtes seulement intéressé par l’ajustement des dates pour <em>afficher</em> par semaine dans un graphique, voyez la section de ce chapitre sur l’affichage des dates. Par exemple, lorsque vous tracez une épicurve, vous pouvez formater l’affichage de la date en fournissant la nomenclature strptime “%” désirée. Par exemple, utilisez “%Y-%W” ou “%Y-%U” pour spécifier l’année et le numéro de semaine (respectivement le lundi ou le dimanche en début de semaine).</p>
</div>
<div id="comptages-hebdomadaires" class="section level3 unnumbered">
<h3>Comptages hebdomadaires</h3>
<p>Allez à la page <a href="grouping_data.html#grouping_data">Regroupement des données</a> pour une explication détaillée du regroupement des données avec <code>count()</code>, <code>group_by()</code>, et <code>summarise()</code>. Voici un bref exemple.</p>
<ol style="list-style-type: decimal">
<li>créez une nouvelle colonne ‘semaine’ avec <code>mutate()</code>, en utilisant <code>floor_date()</code> avec <code>unit = "week"</code>.<br />
</li>
<li>Obtenez le nombre de lignes (cas) par semaine avec <code>count()</code> ; filtrez les cas dont la date est manquante.<br />
</li>
<li>Terminez avec <code>complete()</code> du paquet <strong>tidyr</strong> pour vous assurer que <em>toutes</em> les semaines apparaissent dans les données - même celles qui n’ont pas de lignes/cas. Par défaut, les valeurs de comptage pour toutes les “nouvelles” lignes sont NA, mais vous pouvez les rendre 0 avec l’argument <code>fill =</code>, qui attend une liste nommée (ci-dessous, <code>n</code> est le nom de la colonne de comptage).</li>
</ol>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="working_dates.html#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co"># créez un jeu de données agrégé des comptes hebdomadaires de cas.</span></span>
<span id="cb386-2"><a href="working_dates.html#cb386-2" aria-hidden="true" tabindex="-1"></a>weekly_counts <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb386-3"><a href="working_dates.html#cb386-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(date_onset) <span class="sc">%&gt;%</span>             <span class="co"># Suppression des cas pour lesquels il manque la date de début de la maladie</span></span>
<span id="cb386-4"><a href="working_dates.html#cb386-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weekly_cases =</span> <span class="fu">floor_date</span>(   <span class="co"># créer une nouvelle colonne, semaine d&#39;apparition du cas</span></span>
<span id="cb386-5"><a href="working_dates.html#cb386-5" aria-hidden="true" tabindex="-1"></a>    date_onset,</span>
<span id="cb386-6"><a href="working_dates.html#cb386-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">unit =</span> <span class="st">&quot;week&quot;</span>)) <span class="sc">%&gt;%</span>            </span>
<span id="cb386-7"><a href="working_dates.html#cb386-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(weekly_cases) <span class="sc">%&gt;%</span>           <span class="co"># grouper les données par semaine et compter les lignes par groupe (crée la colonne &#39;n&#39;)</span></span>
<span id="cb386-8"><a href="working_dates.html#cb386-8" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">complete</span>(                  <span class="co"># Assurez-vous que toutes les semaines sont présentes, même celles où aucun cas n&#39;a été observé.</span></span>
<span id="cb386-9"><a href="working_dates.html#cb386-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">weekly_cases =</span> <span class="fu">seq.Date</span>(          <span class="co"># definir la colonne &quot;weekly_cases&quot; comme une séquence complète</span></span>
<span id="cb386-10"><a href="working_dates.html#cb386-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">min</span>(weekly_cases),       <span class="co"># à partir de la date minimum</span></span>
<span id="cb386-11"><a href="working_dates.html#cb386-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">to =</span> <span class="fu">max</span>(weekly_cases),         <span class="co"># jusqu&#39;à la date maximale</span></span>
<span id="cb386-12"><a href="working_dates.html#cb386-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">&quot;week&quot;</span>),                   <span class="co"># agrégé par semaines</span></span>
<span id="cb386-13"><a href="working_dates.html#cb386-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>))             <span class="co"># Remplir les NA dans la colonne des comptes n avec 0</span></span></code></pre></div>
<p>Voici les premiéres lignes du jeu de données résultant :</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-241817af8d2f3578f82a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-241817af8d2f3578f82a">{"x":{"filter":"none","vertical":false,"data":[["2014-04-06","2014-04-13","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17"],[1,1,4,4,12,14,14,21,21,18,30,23,31,35,55,58,80,86,114,122]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>weekly_cases<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="différentes-méthodes-pour-les-epiweeks" class="section level3 unnumbered">
<h3>différentes méthodes pour les epiweeks</h3>
<p>Notez que le paquet <strong>lubridate</strong> posséde des fonctions alternatives <code>week()</code>, <code>epiweek()</code>, et <code>isoweek()</code>, dont chacune a des dates de début légérement différentes et d’autres nuances. De maniére générale, <code>floor_date()</code> devrait suffire à vos besoins. Pour en savoir plus sur ces fonctions, entrez <code>?week</code> dans la console ou lisez la documentation <a href="https://www.rdocumentation.org/packages/lubridate/versions/1.7.4/topics/week">ici</a>.</p>
<p>Vous pouvez également utiliser le paquet <strong>aweek</strong> pour définir les semaines épidémiologiques. Vous pouvez en savoir plus sur le paquet <strong>aweek</strong> <a href="https://www.repidemicsconsortium.org/aweek/">sur le site de RECON</a>. <strong>aweek</strong> contient les fonctions <code>date2week()</code> et <code>week2date()</code> dans lesquelles vous pouvez définir le jour de début de semaine avec <code>week_start = "Monday"</code>. <strong>aweek</strong> est le plus simple si vous voulez spécifier vos dates sous forme de numéro de semaine (par exemple “2020-W12”). Un autre avantage du package <strong>aweek</strong> est que lorsque <code>date2week()</code> est appliqué à une colonne de date, la colonne retournée (format de semaine) est automatiquement de la classe Factor et inclut les niveaux de toutes les semaines de l’intervalle de temps (cela évite l’étape supplémentaire de <code>complete()</code> décrite ci-dessus). Cependant, <strong>aweek</strong> n’a pas la fonctionnalité d’arrondir les dates à d’autres unités de temps comme les mois, les années, etc.</p>
<p>Une autre alternative pour les séries temporelles qui fonctionne également bien pour afficher un format “semaine” (“2020 W12”) est <code>yearweek()</code> du paquet <strong>tsibble</strong>, comme démontré dans la page sur <a href="time_series.html#time_series">Série temporelle et détection des épidémies</a>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="conversion-des-datesfuseaux-horaires" class="section level2" number="9.10">
<h2><span class="header-section-number">9.10</span> Conversion des dates/fuseaux horaires</h2>
<p>Lorsque des données sont présentes dans différents fuseaux horaires, il peut souvent être important de standardiser ces données dans un fuseau horaire unifié. Cela peut présenter un défi supplémentaire, car la l’élément fuseau horaire des données doit être codée manuellement dans la plupart des cas.</p>
<p>Dans R, chaque objet <em>datetime</em> posséde un élément fuseau horaire. Par défaut, tous les objets datetime portent le fuseau horaire local de l’ordinateur utilisê - ce fuseau est généralement spécifique à une <em>localisation</em> plutôt qu’à un fuseau horaire nommé, car les fuseaux horaires changent souvent en fonction de l’heure d’été. Il n’est pas possible de compenser avec précision les fuseaux horaires sans la composante temporelle d’une date, car l’événement que représente une colonne de date ne peut être attribué à une heure spécifique, et les décalages horaires mesurés en heures ne peuvent donc pas être raisonnablement pris en compte.</p>
<p>Pour définir des fuseaux horaires différents, il existe un certain nombre de fonctions dans le paquet <strong>lubridate</strong> qui peuvent être utilisêes pour changer le fuseau horaire d’un objet datetime du fuseau horaire local à un fuseau horaire différent. Les fuseaux horaires sont définis en attribuant un fuseau horaire valide de la base de données tz à l’objet datetime. Une liste de ces fuseaux est disponible ici - si le lieu dont vous utilisez les données ne figure pas sur cette liste, les grandes villes voisines dans le fuseau horaire sont disponibles et servent le même objectif.</p>
<p><a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" class="uri">https://en.wikipedia.org/wiki/List_of_tz_database_time_zones</a></p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="working_dates.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assignez l&#39;heure actuelle à une colonne </span></span>
<span id="cb387-2"><a href="working_dates.html#cb387-2" aria-hidden="true" tabindex="-1"></a>time_now <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb387-3"><a href="working_dates.html#cb387-3" aria-hidden="true" tabindex="-1"></a>time_now</span></code></pre></div>
<pre><code>## [1] &quot;2023-05-17 10:06:22 BST&quot;</code></pre>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="working_dates.html#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="co"># utilisez with_tz() pour affecter un nouveau fuseau horaire à la colonne, tout en CHANGEANT l&#39;heure de l&#39;horloge</span></span>
<span id="cb389-2"><a href="working_dates.html#cb389-2" aria-hidden="true" tabindex="-1"></a>time_london_real <span class="ot">&lt;-</span> <span class="fu">with_tz</span>(time_now, <span class="st">&quot;Europe/London&quot;</span>)</span>
<span id="cb389-3"><a href="working_dates.html#cb389-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-4"><a href="working_dates.html#cb389-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilisez force_tz() pour assigner un nouveau fuseau horaire à la colonne, tout en conservant l&#39;heure de l&#39;horloge.</span></span>
<span id="cb389-5"><a href="working_dates.html#cb389-5" aria-hidden="true" tabindex="-1"></a>time_london_local <span class="ot">&lt;-</span> <span class="fu">force_tz</span>(time_now, <span class="st">&quot;Europe/London&quot;</span>)</span>
<span id="cb389-6"><a href="working_dates.html#cb389-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-7"><a href="working_dates.html#cb389-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-8"><a href="working_dates.html#cb389-8" aria-hidden="true" tabindex="-1"></a><span class="co"># notez que tant que l&#39;ordinateur qui a été utilisê pour exécuter ce code n&#39;est PAS réglé sur l&#39;heure de Londres,</span></span>
<span id="cb389-9"><a href="working_dates.html#cb389-9" aria-hidden="true" tabindex="-1"></a><span class="co"># il y aura une différence dans les heures </span></span>
<span id="cb389-10"><a href="working_dates.html#cb389-10" aria-hidden="true" tabindex="-1"></a><span class="co"># (le nombre d&#39;heures de différence entre le fuseau horaire de l&#39;ordinateur et l&#39;heure de Londres)</span></span>
<span id="cb389-11"><a href="working_dates.html#cb389-11" aria-hidden="true" tabindex="-1"></a>time_london_real <span class="sc">-</span> time_london_local</span></code></pre></div>
<pre><code>## Time difference of 0 secs</code></pre>
<p>Cela peut sembler largement abstrait, et n’est souvent pas nécessaire si l’utilisateur ne travaille pas sur plusieurs fuseaux horaires.</p>
<!-- ======================================================= -->
</div>
<div id="calculs-de-décalage-et-davance" class="section level2" number="9.11">
<h2><span class="header-section-number">9.11</span> Calculs de décalage et d’avance</h2>
<p><code>lead()</code> et <code>lag()</code> sont des fonctions du paquet <strong>dplyr</strong> qui aident à trouver les valeurs précédentes (décalées) ou suivantes (en avance) dans un vecteur - généralement pour un vecteur numérique ou de date. Ces fonctions sont utiles pour calculer les changements/différences entre les unités de temps.</p>
<p>Supposons que vous vouliez calculer la différence de cas entre la semaine en cours et la semaine précédente. Les données sont initialement fournies en nombre de cas hebdomadaires, comme indiqué ci-dessous.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f216cea62d0f67afacb0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f216cea62d0f67afacb0">{"x":{"filter":"none","vertical":false,"data":[["2019-06-23","2019-06-30","2019-07-07","2019-07-14","2019-07-21","2019-07-28","2019-08-04","2019-08-11","2019-08-18","2019-08-25","2019-09-01","2019-09-08","2019-09-15","2019-09-22","2019-09-29","2019-10-06","2019-10-13","2019-10-20","2019-10-27","2019-11-03","2019-11-10","2019-11-17","2019-11-24","2019-12-01","2019-12-08","2019-12-15","2019-12-22","2019-12-29"],[0,25,59,90,65,79,41,47,31,32,28,28,76,41,70,90,124,278,371,329,177,69,77,97,100,39,19,0]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>week_start<\/th>\n      <th>cases_wk<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><strong>Lorsque vous utilisez <code>lag()</code> ou <code>lead()</code>, l’ordre des lignes dans le dataframe est très important ! - Faites attention à ce que vos dates/chiffres soient ascendants ou descendants</strong>.</p>
<p>La premiére étape consiste à créer une nouvelle colonne contenant la valeur de la semaine précédente (décalée).</p>
<ul>
<li>Contrôlez le nombre d’unités en arriére/en avant avec <code>n =</code> (doit être un integer non-négatif)<br />
</li>
<li>Utilisez <code>default =</code> pour définir la valeur placée dans les lignes inexistantes (par exemple, la premiére ligne pour laquelle il n’y a pas de valeur décalée). Par défaut, c’est <code>NA</code>.<br />
</li>
<li>Utilisez <code>order_by = TRUE</code> si vos lignes ne sont pas ordonnées par votre colonne de référence.</li>
</ul>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="working_dates.html#cb391-1" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> counts <span class="sc">%&gt;%</span> </span>
<span id="cb391-2"><a href="working_dates.html#cb391-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cases_prev_wk =</span> <span class="fu">lag</span>(cases_wk, <span class="at">n =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-db963c5fcfcad8508192" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-db963c5fcfcad8508192">{"x":{"filter":"none","vertical":false,"data":[["2019-06-23","2019-06-30","2019-07-07","2019-07-14","2019-07-21","2019-07-28","2019-08-04","2019-08-11","2019-08-18","2019-08-25","2019-09-01","2019-09-08","2019-09-15","2019-09-22","2019-09-29","2019-10-06","2019-10-13","2019-10-20","2019-10-27","2019-11-03","2019-11-10","2019-11-17","2019-11-24","2019-12-01","2019-12-08","2019-12-15","2019-12-22","2019-12-29"],[0,25,59,90,65,79,41,47,31,32,28,28,76,41,70,90,124,278,371,329,177,69,77,97,100,39,19,0],[null,0,25,59,90,65,79,41,47,31,32,28,28,76,41,70,90,124,278,371,329,177,69,77,97,100,39,19]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>week_start<\/th>\n      <th>cases_wk<\/th>\n      <th>cases_prev_wk<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>L’étape suivante consiste à créer une nouvelle colonne qui est la différence entre les deux colonnes de cas :</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="working_dates.html#cb392-1" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> counts <span class="sc">%&gt;%</span> </span>
<span id="cb392-2"><a href="working_dates.html#cb392-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cases_prev_wk =</span> <span class="fu">lag</span>(cases_wk, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb392-3"><a href="working_dates.html#cb392-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">case_diff =</span> cases_wk <span class="sc">-</span> cases_prev_wk)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-07c5f83589ed8f4f59b0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-07c5f83589ed8f4f59b0">{"x":{"filter":"none","vertical":false,"data":[["2019-06-23","2019-06-30","2019-07-07","2019-07-14","2019-07-21","2019-07-28","2019-08-04","2019-08-11","2019-08-18","2019-08-25","2019-09-01","2019-09-08","2019-09-15","2019-09-22","2019-09-29","2019-10-06","2019-10-13","2019-10-20","2019-10-27","2019-11-03","2019-11-10","2019-11-17","2019-11-24","2019-12-01","2019-12-08","2019-12-15","2019-12-22","2019-12-29"],[0,25,59,90,65,79,41,47,31,32,28,28,76,41,70,90,124,278,371,329,177,69,77,97,100,39,19,0],[null,0,25,59,90,65,79,41,47,31,32,28,28,76,41,70,90,124,278,371,329,177,69,77,97,100,39,19],[null,25,34,31,-25,14,-38,6,-16,1,-4,0,48,-35,29,20,34,154,93,-42,-152,-108,8,20,3,-61,-20,-19]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>week_start<\/th>\n      <th>cases_wk<\/th>\n      <th>cases_prev_wk<\/th>\n      <th>case_diff<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Vous pouvez en savoir plus sur <code>lead()</code> et <code>lag()</code> dans la documentation <a href="https://dplyr.tidyverse.org/reference/lead-lag.html">ici</a> ou en entrant <code>?lag</code> dans votre console.</p>
<!-- ======================================================= -->
</div>
<div id="ressources-2" class="section level2" number="9.12">
<h2><span class="header-section-number">9.12</span> Ressources</h2>
<p><strong>lubridate</strong> <a href="https://lubridate.tidyverse.org/">tidyverse page</a><br />
<strong>lubridate</strong> RStudio <a href="https://rawgit.com/rstudio/cheatsheets/master/lubridate.pdf">cheatsheet</a><br />
R for Data Science page on <a href="https://r4ds.had.co.nz/dates-and-times.html">dates and times</a><br />
<a href="https://www.statmethods.net/input/dates.html">Online tutorial</a>
<a href="https://www.r-bloggers.com/2013/08/date-formats-in-r/">Date formats</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
