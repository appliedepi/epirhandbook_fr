<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>32 Courbes épidémiques | Le Epi R Handbook</title>
<meta name="author" content="the handbook team">
<meta name="description" content="Une courbe épidémique (également connue sous le nom de “courbe épi”) est un graphique épidémiologique de base généralement utilisé pour visualiser le schéma temporel d’apparition de la maladie...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="32 Courbes épidémiques | Le Epi R Handbook">
<meta property="og:type" content="book">
<meta property="og:description" content="Une courbe épidémique (également connue sous le nom de “courbe épi”) est un graphique épidémiologique de base généralement utilisé pour visualiser le schéma temporel d’apparition de la maladie...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="32 Courbes épidémiques | Le Epi R Handbook">
<meta name="twitter:description" content="Une courbe épidémique (également connue sous le nom de “courbe épi”) est un graphique épidémiologique de base généralement utilisé pour visualiser le schéma temporel d’apparition de la maladie...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.28/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.10/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>
</head>
<body>
<div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
      <strong>Besoin d'aide pour apprendre R ?</strong> Inscrivez-vous au <a href="https://www.appliedepi.org/live/" class="alert-link">cours d'introduction à R d'Applied Epi</a>, essayez nos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriels R gratuits</a>, postez dans notre forum de <a href="https://community.appliedepi.org/" class="alert-link">questions et réponses de la communauté</a>, ou demandez-nous des informations sur <a href="mailto:contact@appliedepi.org" class="alert-link">notre service d'assistance R</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Le Epi R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">À propos de ce livre</li>
<li><a class="" href="editorial_notes.html"><span class="header-section-number">1</span> Notes techniques et choix éditoriaux</a></li>
<li><a class="" href="download_book_data.html"><span class="header-section-number">2</span> Télécharger le manuel et les données</a></li>
<li class="book-part">Les bases de R</li>
<li><a class="" href="rbasics.html"><span class="header-section-number">3</span> R - les bases</a></li>
<li><a class="" href="transition_to_r.html"><span class="header-section-number">4</span> Transition vers R</a></li>
<li><a class="" href="suggested_packages.html"><span class="header-section-number">5</span> Paquets conseillés</a></li>
<li><a class="" href="r_projects.html"><span class="header-section-number">6</span> Projets R</a></li>
<li><a class="" href="import_export.html"><span class="header-section-number">7</span> Importer et exporter des données</a></li>
<li class="book-part">Gestion des données</li>
<li><a class="" href="cleaning_data.html"><span class="header-section-number">8</span> Nettoyage de données et fonctions essentielles</a></li>
<li><a class="" href="working_dates.html"><span class="header-section-number">9</span> Manipuler les dates</a></li>
<li><a class="" href="character_strings.html"><span class="header-section-number">10</span> Caractères et chaînes de caractères</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Facteurs</a></li>
<li><a class="" href="pivoting_data.html"><span class="header-section-number">12</span> Restructurer les données</a></li>
<li><a class="" href="grouping_data.html"><span class="header-section-number">13</span> Travailler sur des données groupées</a></li>
<li><a class="" href="joining_matching.html"><span class="header-section-number">14</span> Joindre des données</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> De-duplication</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Itération, boucles et listes</a></li>
<li class="book-part">Analyse</li>
<li><a class="" href="descriptive_tables.html"><span class="header-section-number">17</span> Tableaux descriptifs</a></li>
<li><a class="" href="stats_test.html"><span class="header-section-number">18</span> Tests statistiques simples</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Régression univariée et multivariable</a></li>
<li><a class="" href="missing_data.html"><span class="header-section-number">20</span> Données manquantes</a></li>
<li><a class="" href="standardisation.html"><span class="header-section-number">21</span> Taux standardisés</a></li>
<li><a class="" href="moving_average.html"><span class="header-section-number">22</span> Moyennes mobiles</a></li>
<li><a class="" href="time_series.html"><span class="header-section-number">23</span> Série temporelle et détection des épidémies</a></li>
<li><a class="" href="epidemic_models.html"><span class="header-section-number">24</span> Modélisation des épidémies</a></li>
<li><a class="" href="contact_tracing.html"><span class="header-section-number">25</span> Suivi des contacts</a></li>
<li><a class="" href="survey_analysis.html"><span class="header-section-number">26</span> Analyse d’enquête</a></li>
<li><a class="" href="survival_analysis.html"><span class="header-section-number">27</span> Analyse de survie</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS basics</a></li>
<li class="book-part">Visualisation des données</li>
<li><a class="" href="tables_presentation.html"><span class="header-section-number">29</span> Présenter avec des tables</a></li>
<li><a class="" href="ggplot_basics.html"><span class="header-section-number">30</span> Les bases de ggplot</a></li>
<li><a class="" href="ggplot_tips.html"><span class="header-section-number">31</span> Trucs et Astuces avec ggplot</a></li>
<li><a class="active" href="epicurves.html"><span class="header-section-number">32</span> Courbes épidémiques</a></li>
<li><a class="" href="age_pyramid.html"><span class="header-section-number">33</span> Pyramides démographiques et échelles de Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> Graphiques thermiques</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> Diagrammes et schémas</a></li>
<li><a class="" href="combination_analysis.html"><span class="header-section-number">36</span> Analyse des combinaisons</a></li>
<li><a class="" href="transmission_chains.html"><span class="header-section-number">37</span> Chaînes de transmission</a></li>
<li><a class="" href="phylogenetic_trees.html"><span class="header-section-number">38</span> Les arbres phylogénétiques</a></li>
<li><a class="" href="interactive_plots.html"><span class="header-section-number">39</span> Graphiques interactifs</a></li>
<li class="book-part">Rapports et tableaux de bord</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> Production de rapports avec R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> Organisation des rapports de routine</a></li>
<li><a class="" href="dashboards.html"><span class="header-section-number">42</span> Tableaux de bord avec R Markdown</a></li>
<li><a class="" href="shiny.html"><span class="header-section-number">43</span> Tableaux de bord avec Shiny</a></li>
<li class="book-part">Autres sujets</li>
<li><a class="" href="writing_functions.html"><span class="header-section-number">44</span> Fonctions d’écriture</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> Interactions avec les répertoires</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Contrôle de version et collaboration avec Git et Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> Erreurs fréquentes</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> Obtenir de l’aide</a></li>
<li><a class="" href="network_drives.html"><span class="header-section-number">49</span> R sur les lecteurs réseau</a></li>
<li><a class="" href="data_table.html"><span class="header-section-number">50</span> Tableau de données</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="epicurves" class="section level1" number="32">
<h1>
<span class="header-section-number">32</span> Courbes épidémiques<a class="anchor" aria-label="anchor" href="#epicurves"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/epicurve_top.png" width="75%"></div>
<p>Une courbe épidémique (également connue sous le nom de “courbe épi”) est un graphique épidémiologique de base généralement utilisé pour visualiser le schéma temporel d’apparition de la maladie parmi un groupe de cas ou une épidémie.</p>
<p>L’analyse de la courbe épi peut révéler des tendances temporelles, des valeurs aberrantes, l’ampleur de l’épidémie, la période d’exposition la plus probable, les intervalles de temps entre les générations de cas, et peut même aider à identifier le mode de transmission d’une maladie non identifie (par exemple, source ponctuelle, source commune continue, propagation de personne à personne). Une leçon en ligne sur l’interprétation des courbes épi est disponible sur le site Web du <a href="https://www.cdc.gov/training/quicklearns/epimode/index.html">US CDC</a>.</p>
<p>Dans cette page, nous démontrons le paquet <strong>ggplot2</strong> pour produire des épicurves dans R, qui permet une personnalisation avancé via des commandes plus complexes.</p>
<p>Nous abordons également des cas d’utilisation spécifiques tels que :</p>
<ul>
<li>Les tracés de données de comptages agrégées<br>
</li>
<li>Le facettage ou la production de petits multiples<br>
</li>
<li>Application de moyennes mobiles<br>
</li>
<li>Montrer quelles données sont “provisoires” ou sujettes à des retards de rapport<br>
</li>
<li>Superposer l’incidence cumulative des cas à l’aide d’un deuxiéme axe</li>
</ul>
<!-- ======================================================= --><div id="préparation-15" class="section level2" number="32.1">
<h2>
<span class="header-section-number">32.1</span> Préparation<a class="anchor" aria-label="anchor" href="#pr%C3%A9paration-15"><i class="fas fa-link"></i></a>
</h2>
<div id="paquets-2" class="section level3 unnumbered">
<h3>Paquets<a class="anchor" aria-label="anchor" href="#paquets-2"><i class="fas fa-link"></i></a>
</h3>
<p>Ce chunk de code montre le chargement des paquets nécessaires aux analyses. Dans ce manuel, nous mettons l’accent sur <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, qui installe le paquet si nécessaire <em>et</em> le charge pour l’utiliser. Vous pouvez également charger les paquets installs avec <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de <strong>base</strong> R. Voir la page sur <a href="rbasics.html#rbasics">R basics</a> pour plus d’informations sur les paquets R.</p>
<div class="sourceCode" id="cb1517"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">rio</span>,         <span class="co"># import/export de fichiers</span></span>
<span>  <span class="va">here</span>,        <span class="co"># chemins de fichiers relatifs </span></span>
<span>  <span class="va">lubridate</span>,   <span class="co"># travailler avec des dates/epiweeks</span></span>
<span>  <span class="va">aweek</span>,       <span class="co"># paquet alternatif pour travailler avec les dates/semaines</span></span>
<span>  <span class="co">#incidence2, # paquet alternatif </span></span>
<span>  <span class="co">#i2extras,    # supplément à incidence2</span></span>
<span>  <span class="va">scales</span>,      <span class="co"># fonctions utiles pour les échelles d'axes</span></span>
<span>  <span class="va">stringr</span>,     <span class="co"># recherche et manipulation de chaînes de caractères</span></span>
<span>  <span class="va">forcats</span>,     <span class="co"># travail avec des facteurs</span></span>
<span>  <span class="va">RColorBrewer</span>,<span class="co"># palettes de couleurs de colorbrewer2.org</span></span>
<span>  <span class="va">tidyverse</span>    <span class="co"># gestion des données + graphiques ggplot2</span></span>
<span><span class="op">)</span> </span></code></pre></div>
</div>
<div id="importer-des-données-6" class="section level3 unnumbered">
<h3>Importer des données<a class="anchor" aria-label="anchor" href="#importer-des-donn%C3%A9es-6"><i class="fas fa-link"></i></a>
</h3>
<p>Deux exemples de jeux de données sont utilisés dans cette section :</p>
<ul>
<li>Liste de cas individuels d’une épidémie simulée.<br>
</li>
<li>Comptage agrégé par hôpital à partir de la même épidémie simulée.</li>
</ul>
<p>Les jeux de données sont importés à l’aide de la fonction <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> du paquetage <strong>rio</strong>. Voir la page <a href="import_export.html#import_export">Importation et exportation</a> pour les différentes maniéres d’importer des données.</p>
<p><strong>Liste de cas</strong></p>
<p>Nous importons le jeu de données des cas d’une épidémie d’Ebola simulée. Si vous souhaitez télécharger les données pour les suivre pas à pas, consultez les instructions de la page <a href="download_book_data.html#download_book_data">Télécharger le manuel et les données</a>. Nous supposons que le fichier est dans le répertoire de travail, donc aucun sous-dossier n’est spécifié dans ce chemin de fichier.</p>
<div class="sourceCode" id="cb1518"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>Les 50 premiéres lignes sont affichées ci-dessous.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-eeb69c9cb83a480b6399" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-eeb69c9cb83a480b6399">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p><strong>Comptes de cas agrégés par hôpital</strong></p>
<p>Pour les besoins du manuel, le jeu de données des comptages hebdomadaires agrégés par hôpital est créé à partir de la <code>linelist</code> avec le code suivant.</p>
<div class="sourceCode" id="cb1519"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Importez les données de comptage dans R</span></span>
<span><span class="va">count_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">date_hospitalisation</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n_cases <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Les 50 premiéres lignes sont affichées ci-dessous :</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9bf82ad40161775df901" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9bf82ad40161775df901">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="définir-les-paramétres" class="section level3 unnumbered">
<h3>Définir les paramétres<a class="anchor" aria-label="anchor" href="#d%C3%A9finir-les-param%C3%A9tres"><i class="fas fa-link"></i></a>
</h3>
<p>Pour la production d’un rapport, vous pouvez souhaiter définir des paramétres modifiables tels que la date à laquelle les données sont actuelles (la “date des données”). Vous pouvez ensuite faire référence à l’objet <code>data_date</code> dans votre code lorsque vous appliquez des filtres ou dans des légendes dynamiques.</p>
<div class="sourceCode" id="cb1520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## définit la date du rapport pour le rapport</span></span>
<span><span class="co">## note : peut étre défini à Sys.Date() pour la date actuelle</span></span>
<span><span class="va">data_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-05-15"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="vérifier-les-dates" class="section level3 unnumbered">
<h3>Vérifier les dates<a class="anchor" aria-label="anchor" href="#v%C3%A9rifier-les-dates"><i class="fas fa-link"></i></a>
</h3>
<p>Vérifiez que chaque colonne de date pertinente est de la classe Date et posséde une plage de valeurs appropriée. Vous pouvez le faire simplement en utilisant <code><a href="https://rdrr.io/r/graphics/hist.html">hist()</a></code> pour les histogrammes, ou <code><a href="https://rdrr.io/r/base/range.html">range()</a></code> avec <code>na.rm=TRUE</code>, ou avec <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> comme ci-dessous.</p>
<div class="sourceCode" id="cb1521"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># vérifier la plage de dates d'apparition</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1111-1.png" width="50%"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="epicurves-avec-ggplot2" class="section level2" number="32.2">
<h2>
<span class="header-section-number">32.2</span> Epicurves avec ggplot2<a class="anchor" aria-label="anchor" href="#epicurves-avec-ggplot2"><i class="fas fa-link"></i></a>
</h2>
<p>L’utilisation de <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> pour construire votre épicurve permet plus de flexibilité et de personnalisation, mais nécessite plus d’efforts et de compréhension du fonctionnement de <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>.</p>
<p>Contrairement à l’utilisation du paquet <strong>incidence2</strong>, vous devez <em>manuellement</em> contrôler l’agrégation des cas par temps (en semaines, mois, etc.) <em>et</em> les intervalles des étiquettes sur l’axe des dates. Ceci doit étre soigneusement géré.</p>
<p>Ces exemples utilisent un sous-ensemble de l’ensemble de données <code>linelist</code> - seulement les cas de l’hôpital central.</p>
<div class="sourceCode" id="cb1522"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span></span></code></pre></div>
<p>Pour produire une épicurve avec <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, il y a trois éléments principaux :</p>
<ul>
<li>Un histogramme, avec les cas de la liste de lignes agrégés en “bins” distingués par des points de “rupture” spécifiques.<br>
</li>
<li>Des échelles pour les axes et leurs étiquettes<br>
</li>
<li>Des thèmes pour l’apparence du graphique, y compris les titres, les étiquettes, les légendes, etc.</li>
</ul>
<div id="spécifier-les-cas-en-bacs" class="section level3 unnumbered">
<h3>Spécifier les cas en bacs<a class="anchor" aria-label="anchor" href="#sp%C3%A9cifier-les-cas-en-bacs"><i class="fas fa-link"></i></a>
</h3>
<p>Nous montrons ici comment spécifier la façon dont les cas seront agrégés dans des cases d’histogramme (“barres”). Il est important de reconnaétre que l’agrégation des cas dans les cases de l’histogramme n’est <strong>pas</strong> nécessairement les mêmes intervalles que les dates qui apparaîtront sur l’axe des abscisses.</p>
<p>Vous trouverez ci-dessous le code le plus simple pour produire des épicurves quotidiennes et hebdomadaires.</p>
<p>Dans la commande globale <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, le jeu de données est fourni avec <code>data =</code>. Sur cette base, la géométrie d’un histogramme est ajoutée avec un <code>+</code>. Dans la commande <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code>, nous mappons l’esthétique de telle sorte que la colonne <code>date_onset</code> soit mappée sur l’axe des x. Toujours dans <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code> mais <em>non</em> dans <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, nous définissons la <code>binwidth =</code> des bins de l’histogramme, en jours. Si cette syntaxe <strong>ggplot2</strong> est confuse, revoyez la page sur <a href="ggplot_basics.html#ggplot_basics">les bases de ggplot</a>.</p>
<p><span style="color : orange ;"><strong><em>CAUTION:</em></strong> Tracer des cas hebdomadaires en utilisant <code>binwidth = 7</code> fait démarrer le premier bin de 7 jours au premier cas, qui pourrait étre n’importe quel jour de la semaine ! Pour créer des semaines spécifiques, voir la section ci-dessous .</span></p>
<div class="sourceCode" id="cb1523"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># quotidien </span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> <span class="co"># set data</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span> <span class="co"># ajouter un histogramme</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>, <span class="co"># map date column to x-axis</span></span>
<span>    binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span> <span class="co"># cas groupés par 1 jour </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Central Hospital - Quotidiennement"</span><span class="op">)</span> <span class="co"># titre</span></span>
<span></span>
<span><span class="co"># hebdomadaire</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> <span class="co"># set data </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span> <span class="co"># ajouter un histogramme</span></span>
<span>      mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>, <span class="co"># mappage de la colonne date sur l'axe des x</span></span>
<span>      binwidth <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">+</span> <span class="co"># cas classés tous les 7 jours, à partir du premier cas ( !) </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Central Hospital - Tranches de 7 jours, à partir du premier cas"</span><span class="op">)</span> <span class="co"># titre</span></span></code></pre></div>
<p><img src="_main_files/figure-html/ggplot_simple-1.png" width="50%"><img src="_main_files/figure-html/ggplot_simple-2.png" width="50%"></p>
<p>Notons que le premier cas de cet ensemble de données de l’hôpital Central a vu ses symptômes apparaître le :</p>
<div class="sourceCode" id="cb1524"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"%A %d %b, %Y"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Thursday 01 May, 2014"</code></pre>
<p><strong>Pour spécifier manuellement les ruptures des cases de l’histogramme, n’utilisez pas l’argument <code>binwidth =</code>, mais fournissez un vecteur de dates à <code>breaks =</code>.</strong>.</p>
<p>créez le vecteur de dates avec la fonction R <strong>base</strong> <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code>. Cette fonction attend les arguments <code>to =</code>, <code>from =</code>, et <code>by =</code>. Par exemple, la commande ci-dessous renvoie les dates mensuelles commençant le 15 janvier et se terminant le 28 juin.</p>
<div class="sourceCode" id="cb1526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">monthly_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-02-01"</span><span class="op">)</span>,</span>
<span>                           to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-07-15"</span><span class="op">)</span>,</span>
<span>                           by <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">monthly_breaks</span> <span class="co"># print</span></span></code></pre></div>
<pre><code>##  [1] "2014-02-01" "2014-03-01" "2014-04-01" "2014-05-01" "2014-06-01" "2014-07-01" "2014-08-01"
##  [8] "2014-09-01" "2014-10-01" "2014-11-01" "2014-12-01" "2015-01-01" "2015-02-01" "2015-03-01"
## [15] "2015-04-01" "2015-05-01" "2015-06-01" "2015-07-01"</code></pre>
<p>Ce vecteur peut étre fourni à <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code> sous la forme <code>breaks =</code> :</p>
<div class="sourceCode" id="cb1528"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mensuel </span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="va">monthly_breaks</span><span class="op">)</span><span class="op">+</span> <span class="co"># fournit le vecteur prédéfini de breaks                    </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Bins de cas mensuels"</span><span class="op">)</span> <span class="co"># titre</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1117-1.png" width="672"></div>
<p>Une simple séquence de date hebdomadaire peut étre retournée en définissant <code>by = "week"</code>. Par exemple :</p>
<div class="sourceCode" id="cb1529"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weekly_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-02-01"</span><span class="op">)</span>,</span>
<span>                          to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-07-15"</span><span class="op">)</span>,</span>
<span>                          by <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></span></code></pre></div>
<p>Une alternative à la fourniture de dates de début et de fin spécifiques consiste à écrire un code <em>dynamique</em> pour que les bacs hebdomadaires commencent <em>le lundi précédant le premier cas</em>. **Nous utiliserons ces vecteurs de date dans les exemples ci-dessous.</p>
<div class="sourceCode" id="cb1530"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Séquence de dates hebdomadaires du lundi pour CENTRAL HOSPITAL</span></span>
<span><span class="va">weekly_breaks_central</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># lundi avant le premier cas</span></span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># lundi aprés la derniére affaire</span></span>
<span>  by <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></span></code></pre></div>
<p>Décortiquons le code plutôt déconcertant ci-dessus :</p>
<ul>
<li>La valeur “from” (date la plus ancienne de la séquence) est crée comme suit : la valeur minimale de la date (<code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code> avec <code>na.rm=TRUE</code>) dans la colonne <code>date_onset</code> est introduite dans <code><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> du paquet <strong>lubridate</strong>. <code><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code> défini sur “week” renvoie la date de début de la “semaine” de ce cas, étant donné que le jour de début de chaque semaine est un lundi (<code>week_start = 1</code>).<br>
</li>
<li>De même, la valeur “to” (date de fin de la séquence) est créée en utilisant la fonction inverse <code><a href="https://lubridate.tidyverse.org/reference/round_date.html">ceiling_date()</a></code> pour retourner le lundi <em>aprés</em> le dernier cas.<br>
</li>
<li>L’argument “by” de <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> peut étre défini sur un nombre quelconque de jours, de semaines ou de mois.<br>
</li>
<li>Utilisez <code>week_start = 7</code> pour les semaines de dimanche.</li>
</ul>
<p>Comme nous utiliserons ces vecteurs de date tout au long de cette page, nous en définissons également un pour l’ensemble du foyer (ce qui précéde ne concerne que l’hôpital central).</p>
<div class="sourceCode" id="cb1531"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Séquence pour l'ensemble du foyer</span></span>
<span><span class="va">weekly_breaks_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># lundi avant le premier cas</span></span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># lundi aprés la derniére affaire</span></span>
<span>  by <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></span></code></pre></div>
<p>Ces sorties <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> peuvent étre utilisées pour créer les ruptures des cases de l’histogramme, mais aussi les ruptures pour les étiquettes de date, qui peuvent étre indépendantes des cases. Vous en saurez plus sur les étiquettes de date dans les sections suivantes.</p>
<p><span style="color : darkgreen ;"><strong><em>TIP:</em></strong> Pour une commande <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> plus simple, sauvegardez à l’avance les ruptures de bacs et les ruptures d’étiquettes de dates en tant que vecteurs nommés, et fournissez simplement leurs noms à <code>breaks =</code>.</span>.</p>
</div>
<div id="exemple-dépicurve-hebdomadaire" class="section level3 unnumbered">
<h3>Exemple d’épicurve hebdomadaire<a class="anchor" aria-label="anchor" href="#exemple-d%C3%A9picurve-hebdomadaire"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Vous trouverez ci-dessous un exemple de code détaillé pour produire des épicurves hebdomadaires pour les semaines du lundi, avec des barres alignées, des étiquettes de date et des lignes de grille verticales.</strong> Cette section est destinée à l’utilisateur qui a besoin de code rapidement. Pour comprendre en profondeur chaque aspect (thèmes, étiquettes de date, etc.), passez aux sections suivantes. A noter :</p>
<ul>
<li>Les <em>cassures de l’histogramme</em> sont définies avec <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> comme expliqué ci-dessus pour commencer le lundi avant le premier cas et pour finir le lundi aprés le dernier cas.<br>
</li>
<li>L’intervalle des <em>étiquettes de date</em> est spécifié manuellement par <code>date_breaks =</code> dans <code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></code>, ou automatiquement par <code>label = label_date_short()</code> (paquet <strong>scales</strong>).<br>
</li>
<li>L’intervalle des petites lignes verticales entre les étiquettes de date est spécifié par <code>date_minor_breaks =</code>.<br>
</li>
<li>Nous utilisons <code>closed = "left"</code> dans le <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code> pour nous assurer que les dates sont comptées dans les bonnes bins.<br>
</li>
<li>
<code>expand = c(0,0)</code> dans les échelles x et y supprime l’espace excédentaire de chaque côte des axes, ce qui garantit également que les étiquettes de date commencent à partir de la premiére barre.</li>
</ul>
<div class="sourceCode" id="cb1532"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ALIGNEMENT TOTAL DE LA SEMAINE DU LUNDI</span></span>
<span><span class="co">#############################</span></span>
<span><span class="co"># définir la séquence des pauses hebdomadaires</span></span>
<span><span class="va">weekly_breaks_central</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>      from <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># lundi avant la premiére affaire</span></span>
<span>      to <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># lundi aprés la derniére affaire</span></span>
<span>      by <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>    <span class="co"># les bins sont de 7 jours </span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># créer un histogramme : spécifier les points de rupture des bacs : commence le lundi avant le premier cas, se termine le lundi aprés le dernier cas</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="co"># esthétique de la mapping</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>, <span class="co"># colonne de date mappée sur l'axe des x</span></span>
<span>    </span>
<span>    <span class="co"># ruptures de la case de l'histogramme</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>, <span class="co"># pauses des cases de l'histogramme définies précédemment</span></span>
<span>    </span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span>,  <span class="co"># compter les cas à partir du début du point d'bin</span></span>
<span></span>
<span>    <span class="co"># barres</span></span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>, <span class="co"># couleur des lignes autour des barres</span></span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span> <span class="co"># couleur de remplissage dans les barres</span></span>
<span>  <span class="op">)</span><span class="op">+</span> </span>
<span>    </span>
<span>  <span class="co"># étiquettes de l'axe des x</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># suppression de l'espace excédentaire sur l'axe des x avant et aprés les barres de cas</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"4 weeks"</span>, <span class="co"># les étiquettes de date et les principales lignes de grille verticales apparaissent toutes les 3 semaines du lundi</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>, <span class="co"># les lignes verticales mineures apparaissent chaque lundi de semaine</span></span>
<span>    <span class="co">#date_labels = "%a\n%d\n%b\n'%y", # option de formatage manuel des étiquettes de date</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes automatique</span></span>
<span>  </span>
<span>  <span class="co"># Axe des y</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># suppression de l'espace excédentaire sur l'axe des y en dessous de 0 (alignement de l'histogramme sur l'axe des x)</span></span>
<span>  </span>
<span>  <span class="co"># thèmes esthétiques</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="co"># simplifie le fond du graphique</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>, <span class="co"># légende sur le côte gauche</span></span>
<span>                                face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>, <span class="co"># légende en italique</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># titres des axes en gras</span></span>
<span>  </span>
<span>  <span class="co"># étiquettes incluant une légende dynamique</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Incidence hebdomadaire des cas (semaines de lundi)"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Notez l'alignement des barres, des lignes de grille verticales et des étiquettes d'axe sur les semaines du lundi"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Semaine d'apparition des symptômes"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Incidence hebdomadaire des cas signalés"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} de Central Hospital ; Les occurrences de cas ranges de {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} à {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}{nrow(central_data %&gt;% filter(is.na(date_onset)))} cas dont la date d'apparition est manquante et qui ne sont pas indiqués"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1121-1.png" width="672"></div>
<div id="semaines-de-dimanche" class="section level4 unnumbered">
<h4>Semaines de dimanche<a class="anchor" aria-label="anchor" href="#semaines-de-dimanche"><i class="fas fa-link"></i></a>
</h4>
<p>Pour obtenir le graphique ci-dessus pour les semaines de dimanche, quelques modifications sont nécessaires, car les <code>date_breaks = "weeks"</code> ne fonctionnent que pour les semaines de lundi.</p>
<ul>
<li>Les points de rupture des <em>bins de l’histogramme</em> doivent étre fixés au dimanche (<code>week_start = 7</code>)<br>
</li>
<li>Dans <code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></code>, les ruptures de date similaires doivent étre fournies à <code>breaks =</code> et <code>minor_breaks =</code> pour s’assurer que les étiquettes de date et les lignes de grille verticales s’alignent sur les dimanches.</li>
</ul>
<p>Par exemple, la commande <code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></code> pour les semaines du dimanche pourrait ressembler à ceci :</p>
<div class="sourceCode" id="cb1533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1533-1"><a href="epicurves.html#cb1533-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_date</span>(</span>
<span id="cb1533-2"><a href="epicurves.html#cb1533-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb1533-3"><a href="epicurves.html#cb1533-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1533-4"><a href="epicurves.html#cb1533-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># spécifie l'intervalle des étiquettes de date et des principales lignes de grille verticales</span></span>
<span id="cb1533-5"><a href="epicurves.html#cb1533-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb1533-6"><a href="epicurves.html#cb1533-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">7</span>), <span class="co"># dimanche avant la premiére affaire</span></span>
<span id="cb1533-7"><a href="epicurves.html#cb1533-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">to =</span> <span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">7</span>), <span class="co"># dimanche aprés la derniére affaire</span></span>
<span id="cb1533-8"><a href="epicurves.html#cb1533-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"4 weeks"</span>),</span>
<span id="cb1533-9"><a href="epicurves.html#cb1533-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1533-10"><a href="epicurves.html#cb1533-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># spécifier l'intervalle de la ligne de grille verticale mineure </span></span>
<span id="cb1533-11"><a href="epicurves.html#cb1533-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">minor_breaks =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb1533-12"><a href="epicurves.html#cb1533-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">7</span>), <span class="co"># dimanche avant le premier cas</span></span>
<span id="cb1533-13"><a href="epicurves.html#cb1533-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">to =</span> <span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">7</span>), <span class="co"># dimanche aprés la derniére affaire</span></span>
<span id="cb1533-14"><a href="epicurves.html#cb1533-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"week"</span>),</span>
<span id="cb1533-15"><a href="epicurves.html#cb1533-15" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb1533-16"><a href="epicurves.html#cb1533-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># format des étiquettes de date</span></span>
<span id="cb1533-17"><a href="epicurves.html#cb1533-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#date_labels = "%a\n%d\n%b\n'%y", # option de formatage manuel des étiquettes de date.</span></span>
<span id="cb1533-18"><a href="epicurves.html#cb1533-18" aria-hidden="true" tabindex="-1"></a>                                      <span class="co"># Jour, au-dessus abréviation du mois, au-dessus</span></span>
<span id="cb1533-19"><a href="epicurves.html#cb1533-19" aria-hidden="true" tabindex="-1"></a>                                      <span class="co"># année à 2 chiffres</span></span>
<span id="cb1533-20"><a href="epicurves.html#cb1533-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># format des étiquettes automatique</span></span></code></pre></div>
</div>
</div>
<div id="groupercolorer-par-valeur" class="section level3 unnumbered">
<h3>Grouper/colorer par valeur<a class="anchor" aria-label="anchor" href="#groupercolorer-par-valeur"><i class="fas fa-link"></i></a>
</h3>
<p>Les barres de l’histogramme peuvent étre colorées par groupe et “empilées”. Pour désigner la colonne de regroupement, effectuez les modifications suivantes. Voir la page <a href="ggplot_basics.html#ggplot_basics">ggplot basics</a> pour plus de détails.</p>
<ul>
<li>Dans le mappage esthétique de l’histogramme <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, mettez en correspondance le nom de la colonne avec les arguments <code>group =</code> et <code>fill =</code>.<br>
</li>
<li>Supprimez tout argument <code>fill =</code> à l’extérieur de <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, car il remplacera celui qui se trouve à l’intérieur.<br>
</li>
<li>Les arguments <em>inside</em> de <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> s’appliqueront <em>par groupe</em>, alors que les arguments <em>outside</em> s’appliqueront à toutes les barres (par exemple, vous pouvez toujours vouloir <code>color =</code> à l’extérieur, pour que chaque barre ait la même bordure).</li>
</ul>
<p>Voici à quoi ressemblerait la commande <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> pour grouper et colorer les barres par sexe :</p>
<div class="sourceCode" id="cb1534"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, group <span class="op">=</span> <span class="va">gender</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span></span></code></pre></div>
<p>Le voici appliqué :</p>
<div class="sourceCode" id="cb1535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span> <span class="op">+</span> <span class="co"># commencer avec linelist (many hospitals)</span></span>
<span>  </span>
<span>  <span class="co"># faire un histogramme : spécifier les points de rupture de la benne : commence le lundi avant le premier cas, se termine le lundi aprés le dernier cas</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>      group <span class="op">=</span> <span class="va">hospital</span>, <span class="co"># définir les données pour qu'elles soient groupées par hôpital</span></span>
<span>      fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>, <span class="co"># remplissage des barres (couleur intérieure) par hôpital</span></span>
<span>    </span>
<span>    <span class="co"># les pauses sont les semaines de lundi</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span>, <span class="co"># séquence de pauses hebdomadaires du lundi pour toute l'épidémie, définie dans le code précédent </span></span>
<span>    </span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span>, <span class="co"># Compter les cas à partir du début du point d'arrêt</span></span>
<span>    </span>
<span>    <span class="co"># Couleur autour des barres</span></span>
<span>    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1124-1.png" width="672"></div>
</div>
<div id="ajuster-les-couleurs" class="section level3 unnumbered">
<h3>Ajuster les couleurs<a class="anchor" aria-label="anchor" href="#ajuster-les-couleurs"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Pour <em>manuellement</em> régler le remplissage pour chaque groupe, utilisez <code><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual()</a></code> (note : <code><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual()</a></code> est différent !).
<ul>
<li>Utilisez l’argument <code>values =</code> pour appliquer un vecteur de couleurs.<br>
</li>
<li>Utilisez <code>na.value =</code> pour spécifier une couleur pour les valeurs <code>NA</code>.<br>
</li>
<li>Utilisez l’argument <code>labels =</code> pour changer le texte des éléments de la légende. Pour étre sur, fournissez un vecteur nommé comme <code>c("old" = "new", "old" = "new")</code> ou ajustez les valeurs dans les données elles-mêmes.<br>
</li>
<li>Utilisez <code>name =</code> pour donner un titre correct à la légende.<br>
</li>
</ul>
</li>
<li>Pour plus d’informations sur les échelles et les palettes de couleurs, consultez la page sur <a href="ggplot_basics.html#ggplot_basics">les bases de ggplot</a>.</li>
</ul>
<div class="sourceCode" id="cb1536"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span> <span class="co"># commencer avec linelist (plusieurs hôpitaux)</span></span>
<span>  </span>
<span>  <span class="co"># faire un histogramme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>        group <span class="op">=</span> <span class="va">hospital</span>, <span class="co"># cas groupés par hôpital</span></span>
<span>        fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>, <span class="co"># remplissage des barres par hôpital</span></span>
<span>    </span>
<span>    <span class="co"># bin breaks</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span>, <span class="co"># séquence de bin breaks hebdomadaires du lundi, définie dans le code précédent</span></span>
<span>    </span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span>, <span class="co"># Compter les cas à partir du début du point d'arrêt</span></span>
<span>  </span>
<span>    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span> <span class="co"># couleur de la bordure de chaque barre</span></span>
<span>  </span>
<span>  <span class="co"># spécification manuelle des couleurs</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"orange"</span>, <span class="st">"grey"</span>, <span class="st">"beige"</span>, <span class="st">"blue"</span>, <span class="st">"brown"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St.Mark's"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span> <span class="co"># spécifier les couleurs de remplissage ("values") - attention à l'ordre !</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1125-1.png" width="672"></div>
</div>
<div id="ajuster-lordre-des-niveaux" class="section level3 unnumbered">
<h3>Ajuster l’ordre des niveaux<a class="anchor" aria-label="anchor" href="#ajuster-lordre-des-niveaux"><i class="fas fa-link"></i></a>
</h3>
<p>Le meilleur moyen d’ajuster l’ordre dans lequel les barres groupées sont empilées est de classer la colonne de groupage en tant que classe Facteur. Vous pouvez alors désigner l’ordre des niveaux de facteurs (et leurs étiquettes d’affichage). Voir la page sur <a href="factors.html#factors">facteurs</a> ou <a href="ggplot_tips.html#ggplot_tips">ggplot tips</a> pour plus de détails.</p>
<p>Avant de réaliser le tracé, utilisez la fonction <code><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel()</a></code> du paquet <strong>forcats</strong> pour convertir la colonne de regroupement en classe facteur et ajuster manuellement l’ordre des niveaux, comme détaillé dans la page sur les <a href="factors.html#factors">facteurs</a>. Pour ajuster les niveaux de manière plus avancée, utilisez <code><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump()</a></code>, qui combine automatiquement les petites catégories en une catégorie “Autre”.</p>
<div class="sourceCode" id="cb1537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># charger le paquet forcats pour travailler avec les facteurs</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">forcats</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># définir un nouvel ensemble de données avec l'hôpital comme facteur</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Missing"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Convertir en facteur et définir "Manquant" et "Autre" comme niveaux supérieurs pour apparaétre sur le sommet de l'épicurve.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span> <span class="co"># Imprime les niveaux dans l'ordre</span></span></code></pre></div>
<pre><code>## [1] "Missing"                              "Other"                               
## [3] "Central Hospital"                     "Military Hospital"                   
## [5] "Port Hospital"                        "St. Mark's Maternity Hospital (SMMH)"</code></pre>
<p>Dans le graphique ci-dessous, les seules différences par rapport au précédent sont que la colonne <code>hospital</code> a été consolidée comme ci-dessus, et que nous utilisons <code><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides()</a></code> pour inverser l’ordre de la légende, de sorte que “Missing” se trouve en bas de la légende.</p>
<div class="sourceCode" id="cb1539"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Utiliser le NOUVEL ensemble de données avec les hôpitaux comme facteurs réordonnés.</span></span>
<span>  </span>
<span>  <span class="co"># créer un histogramme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>        group <span class="op">=</span> <span class="va">hospital</span>, <span class="co"># cas groupés par hôpital</span></span>
<span>        fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>, <span class="co"># remplissage des barres (couleur) par hôpital</span></span>
<span>    </span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span>, <span class="co"># séquence de pauses hebdomadaires du lundi pour toute l'épidémie, définie en haut de la section ggplot</span></span>
<span>    </span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span>, <span class="co"># Compter les cas à partir du début du point d'arrêt</span></span>
<span></span>
<span>    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span> <span class="co"># couleur de la bordure autour de chaque barre</span></span>
<span>    </span>
<span>  <span class="co"># étiquettes de l'axe des x</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># supprimer l'espace excédentaire sur l'axe des x avant et aprés les barres de cas</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>, <span class="co"># les étiquettes apparaissent toutes les 3 semaines du lundi</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>, <span class="co"># les lignes verticales apparaissent tous les lundis de la semaine</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes de date efficace</span></span>
<span>  </span>
<span>  <span class="co"># Axe des y</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># suppression de l'espace excédentaire sur l'axe des y en dessous de 0</span></span>
<span>  </span>
<span>  <span class="co"># spécification manuelle des couleurs, ! attention à l'ordre</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"beige"</span>, <span class="st">"black"</span>, <span class="st">"orange"</span>, <span class="st">"blue"</span>, <span class="st">"brown"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St.Marks"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span><span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># thèmes esthétiques</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="co"># simplifier le fond du graphique</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, <span class="co"># légende à gauche en italique</span></span>
<span>                                hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># titres des axes en gras</span></span>
<span>  </span>
<span>  <span class="co"># étiquettes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Incidence hebdomadaire des cas par hôpital"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Hospital as re-ordered factor"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Semaine d'apparition des symptômes"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cas hebdomadaires"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1127-1.png" width="672"></div>
<p><span style="color : darkgreen ;"><strong><em>TIP:</em></strong> Pour inverser l’ordre de la légende uniquement, ajoutez cette commande <strong>ggplot2</strong> : <code>guides(fill = guide_legend(reverse = TRUE))</code>.</span></p>
</div>
<div id="ajuster-la-légende" class="section level3 unnumbered">
<h3>Ajuster la légende<a class="anchor" aria-label="anchor" href="#ajuster-la-l%C3%A9gende"><i class="fas fa-link"></i></a>
</h3>
<p>Pour en savoir plus sur les légendes et les échelles, consultez la page <a href="ggplot_tips.html#ggplot_tips">ggplot tips</a>. Voici quelques points saillants :</p>
<ul>
<li>Modifiez le titre de la légende soit dans la fonction d’échelle, soit avec <code>labs(fill = "Legend title")</code> (si vous utilisez <code>color =</code> esthétique, alors utilisez <code>labs(color = "")</code>).<br>
</li>
<li>
<code>theme(legend.title = element_blank())</code> pour ne pas avoir de titre de légende<br>
</li>
<li>
<code>theme(legend.position = "top")</code> (“bottom”, “left”, “right”, ou “none” pour supprimer la légende)</li>
<li>
<code>theme(legend.direction = "horizontal")</code> légende horizontale</li>
<li>
<code>guides(fill = guide_legend(reverse = TRUE))</code> pour inverser l’ordre de la légende</li>
</ul>
</div>
<div id="barres-côte-à-côte" class="section level3 unnumbered">
<h3>Barres côte à côte<a class="anchor" aria-label="anchor" href="#barres-c%C3%B4te-%C3%A0-c%C3%B4te"><i class="fas fa-link"></i></a>
</h3>
<p>L’affichage côte à côte des barres de groupe (par opposition à l’empilement) est spécifié dans <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code> avec <code>position = "dodge"</code> placé en dehors de <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>.</p>
<p>S’il y a plus de deux groupes de valeurs, ceux-ci peuvent devenir difficiles à lire. Envisagez plutôt d’utiliser un graphique à facettes (petits multiples). Pour améliorer la lisibilité dans cet exemple, les valeurs de sexe manquantes sont supprimées.</p>
<div class="sourceCode" id="cb1540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">central_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># Commencez par les cas de l'hôpital central en supprimant les valeurs manquantes pour le sexe.</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>        mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>          x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>          group <span class="op">=</span> <span class="va">gender</span>, <span class="co"># cas groupés par sexe</span></span>
<span>          fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>, <span class="co"># barres remplies par sexe</span></span>
<span>        </span>
<span>        <span class="co"># histogramme bin breaks</span></span>
<span>        breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>, <span class="co"># séquence de dates hebdomadaires pour le foyer central - définie en haut de la section ggplot</span></span>
<span>        </span>
<span>        closed <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>        </span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, <span class="co"># couleur du bord des barres</span></span>
<span>        </span>
<span>        position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span><span class="op">+</span> <span class="co"># barres SIDE-BY-SIDE</span></span>
<span>                      </span>
<span>  </span>
<span>  <span class="co"># Les étiquettes sur l'axe des x</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>       expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># supprimer l'espace excédentaire de l'axe des x sous et aprés les barres de cas</span></span>
<span>       date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>, <span class="co"># les étiquettes apparaissent toutes les 3 semaines du lundi</span></span>
<span>       date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>, <span class="co"># les lignes verticales apparaissent tous les lundis de la semaine</span></span>
<span>       label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes de date efficace</span></span>
<span></span>
<span>  </span>
<span>  <span class="co"># Axe des y</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># supprime l'espace excédentaire sur l'axe des y entre le bas des barres et les étiquettes</span></span>
<span>  </span>
<span>  <span class="co">#échelle des couleurs et des étiquettes de légende</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"brown"</span>, <span class="st">"orange"</span><span class="op">)</span>, <span class="co"># spécifie les couleurs de remplissage ("values") - attention à l'ordre !</span></span>
<span>                    na.value <span class="op">=</span> <span class="st">"grey"</span> <span class="op">)</span><span class="op">+</span>     </span>
<span></span>
<span>  <span class="co"># thèmes esthétiques</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="co"># un ensemble de thèmes pour simplifier le graphe</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># légende à gauche en italique</span></span>
<span>        axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># titres des axes en gras</span></span>
<span>  </span>
<span>  <span class="co"># étiquettes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Incidence hebdomadaire des cas, par sexe"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Sous-titre"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Gender"</span>, <span class="co"># fournir un nouveau titre pour la légende</span></span>
<span>       x <span class="op">=</span> <span class="st">"Semaine d'apparition des symptômes"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Incidence hebdomadaire des cas signalés"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1128-1.png" width="672"></div>
</div>
<div id="limites-de-laxe" class="section level3 unnumbered">
<h3>Limites de l’axe<a class="anchor" aria-label="anchor" href="#limites-de-laxe"><i class="fas fa-link"></i></a>
</h3>
<p>Il existe deux façons de limiter l’étendue des valeurs des axes.</p>
<p>Généralement, la méthode préférée est d’utiliser la commande <code><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian()</a></code>, qui accepte <code>xlim = c(min, max)</code> et <code>ylim = c(min, max)</code> (où vous fournissez les valeurs min et max). Ceci agit comme un “zoom” sans réellement supprimer de données, ce qui est important pour les statistiques et les mesures sommaires.</p>
<p>Alternativement, vous pouvez définir les valeurs maximales et minimales de la date en utilisant <code>limits = c()</code> dans <code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></code>. Par exemple :</p>
<div class="sourceCode" id="cb1541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-04-01"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="co"># définit une date minimum mais laisse la date maximum ouverte.  </span></span></code></pre></div>
<p>Si vous souhaitez que l’axe des abscisses s’tende jusqu’é une date spécifique (par exemple, la date du jour), même si aucun nouveau cas n’a été signalé, vous pouvez utiliser :</p>
<div class="sourceCode" id="cb1542"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># garantit que l'axe des dates s'étendra jusqu'à la date du jour  </span></span></code></pre></div>
<p><span style="color : red ;"><strong><em>DANGER:</em></strong> Soyez prudent en fixant les ruptures d’échelle ou les limites de l’axe des y (par exemple, 0 à 30 par 5 : <code>seq(0, 30, 5)</code>). De tels nombres statiques peuvent couper votre tracé trop court si les données changent pour dépasser la limite !</span>.</p>
</div>
<div id="libellés-des-axes-de-date-lignes-de-grille" class="section level3 unnumbered">
<h3>Libellés des axes de date / lignes de grille<a class="anchor" aria-label="anchor" href="#libell%C3%A9s-des-axes-de-date-lignes-de-grille"><i class="fas fa-link"></i></a>
</h3>
<p><span style="color : darkgreen ;"><strong><em>TIP:</em></strong> Rappelez-vous que les <strong>étiquettes de l’axe des dates</strong> sont indépendantes de l’agrégation des données en barres, mais visuellement, il peut étre important d’aligner les bacs, les étiquettes de date et les lignes de grille verticales.</span></p>
<p>Pour <strong>modifier les étiquettes de date et les lignes de grille</strong>, utilisez <code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></code> de l’une de ces façons :</p>
<ul>
<li>
<strong>Si vos bins d’histogramme sont des jours, lundi des semaines, des mois ou des années</strong> :
<ul>
<li>Utilisez <code>date_breaks =</code> pour spécifier l’intervalle des étiquettes et des lignes de grille principales (par exemple “jour”, “semaine”, “3 semaines”, “mois” ou “année”).</li>
<li>Utilisez <code>date_minor_breaks =</code> pour spécifier l’intervalle des lignes verticales mineures (entre les étiquettes de date)<br>
</li>
<li>Ajoutez <code>expand = c(0,0)</code> pour que les étiquettes commencent à la premiére barre.<br>
</li>
<li>Utilisez <code>date_labels =</code> pour spécifier le format des étiquettes de date avec la syntaxe <code>strptime</code> - voir la page Dates pour des conseils (e.g. utilisez <code>\n</code> pour une nouvelle ligne), OU utilisez <code>label = label_date_short()</code> (du paquet <strong>scales</strong>) pour des étiquettes de date automatiques et efficaces.<br>
</li>
<li>
<strong>Si les cases de votre histogramme sont des semaines de dimanche</strong> :<br>
</li>
<li>Utilisez <code>breaks =</code> et <code>minor_breaks =</code> en fournissant une séquence de ruptures de date pour chacun d’entre eux.</li>
<li>Vous pouvez toujours utiliser <code>date_labels =</code> et <code>expand =</code> pour le formatage comme décrit ci-dessus.</li>
</ul>
</li>
</ul>
<p>Quelques notes :</p>
<ul>
<li>Voir la section ggplot d’ouverture pour des instructions sur la façon de créer une séquence de dates en utilisant <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code>.<br>
</li>
<li>Voir <a href="https://rdrr.io/r/base/strptime.html">cette page</a> ou la page <a href="working_dates.html#working_dates">travailler avec des dates</a> pour des conseils sur la création d’étiquettes de date.</li>
</ul>
<div id="démonstrations" class="section level4 unnumbered">
<h4>Démonstrations<a class="anchor" aria-label="anchor" href="#d%C3%A9monstrations"><i class="fas fa-link"></i></a>
</h4>
<p>Vous trouverez ci-dessous une démonstration de tracés où les bacs et les étiquettes/grilles sont alignés et non alignés :</p>
<div class="sourceCode" id="cb1543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bacs de 7 jours + étiquettes du lundi</span></span>
<span><span class="co">#############################</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    binwidth <span class="op">=</span> <span class="fl">7</span>, <span class="co"># bins de 7 jours avec début au premier cas</span></span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># supprime l'espace excédentaire sur l'axe des x en dessous et aprés les barres de cas</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>, <span class="co"># Lundi toutes les 3 semaines</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>, <span class="co"># lundi semaines</span></span>
<span>    </span>
<span>    <span class="co">#date_labels = "%a\n%d\n%b\n'%y", # option de formatage manuel des étiquettes de date</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes automatique</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># suppression de l'espace excédentaire sous l'axe des x, mise à plat</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"MAL ALIGNÉ"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">" ! ATTENTION : Les barres de 7 jours commencent le jeudi avec le premier cas.\n Grandes lignes de grille et étiquettes de date au 1er de chaque mois.\n Lignes de grille mineures chaque lundi."</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Tranches de 7 jours + Mois</span></span>
<span><span class="co">#####################</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    binwidth <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># supprime l'espace excédentaire de l'axe des x sous et aprés les barres de cas</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"months"</span>, <span class="co"># 1er du mois</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>, <span class="co"># semaines de lundi</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes automatique</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Suppression de l'espace excédentaire sous l'axe des x, mise à plat des données </span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"MAL ALIGNÉ"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">" ! ATTENTION : Les barres de 7 jours commencent le jeudi avec le premier cas\nLes lignes de grille principales et les étiquettes de date au 1er de chaque mois\nLes lignes de grille mineures sont hebdomadaires le lundi\nNotez l'espacement inégal de certaines lignes de grille et les tics non alignés avec les barres"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># ALIGNEMENT TOTAL DU LUNDI : spécifier que les pauses manuelles sont des lundis</span></span>
<span><span class="co">#################################################################</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># les ruptures d'histogramme sont fixées à 7 jours commençant le lundi avant le premier cas</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>, <span class="co"># défini plus tôt dans cette page</span></span>
<span>    </span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    </span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    </span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># supprime l'espace excédentaire sur l'axe x en dessous et aprés les barres de cas</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"4 weeks"</span>, <span class="co"># Lundi toutes les 4 semaines</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>, <span class="co"># lundi semaines </span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes automatique</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># Suppression de l'espace excédentaire sous l'axe des x, mise à plat des données </span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Lundis ALIGNÉS"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Les intervalles de 7 jours sont réglés manuellement pour commencer le lundi avant le premier cas (28 avr.)\n Les étiquettes de date et les lignes de grille sont aussi sur les lundis"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># ALIGNEMENT TOTAL DES LUNDIS AVEC LES étiQUETTES DE MOIS :</span></span>
<span><span class="co">############################################</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># ruptures d'histogramme fixées à 7 jours commençant le lundi avant le premier cas</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>, <span class="co"># défini plus tôt dans cette page</span></span>
<span>    </span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    </span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    </span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># supprime l'espace excédentaire sur l'axe x en dessous et aprés les barres de cas</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"months"</span>, <span class="co"># Lundi toutes les 4 semaines</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>, <span class="co"># lundi semaines </span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes automatique</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># suppression de l'espace excédentaire sous l'axe des x, mise à plat </span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># Suppression des lignes de grille principales (tombent le 1er du mois)</span></span>
<span>          </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Lundis ALIGNÉS avec étiquettes MONTHLY"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Bacs de 7 jours réglés manuellement pour commencer le lundi avant le premier cas (28 avril) - étiquettes de date le 1er du mois - Suppression des principaux quadrillages mensuels"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># ALIGNEMENT TOTAL DU DIMANCHE : spécifier les ruptures manuelles des bacs ET les étiquettes pour les dimanches</span></span>
<span><span class="co">############################################################################</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># ruptures d'histogramme fixées à 7 jours commençant le dimanche avant le premier cas</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>                      to <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>                      by <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    </span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    </span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="co"># les ruptures de l'étiquette de date et les principales lignes de la grille sont fixées à toutes les 3 semaines, en commençant le dimanche avant le premier cas.</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>         from <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>         to <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>         by <span class="op">=</span> <span class="st">"3 weeks"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># grilles mineures fixées à la semaine commençant le dimanche avant le premier cas</span></span>
<span>    minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>         from <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>         to <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>         by <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes automatique</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># suppression de l'espace excédentaire sous l'axe des x, mise à plat </span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Dimanches ALIGNÉS"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Les intervalles de 7 jours ont été réglés manuellement pour commencer le dimanche avant le premier cas (27 avril)\n Les étiquettes de date et les lignes de grille ont également été réglées manuellement sur les dimanches"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1131-1.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-1131-2.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-1131-3.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-1131-4.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-1131-5.png" width="672"></p>
</div>
</div>
<div id="données-agrégées" class="section level3 unnumbered">
<h3>Données agrégées<a class="anchor" aria-label="anchor" href="#donn%C3%A9es-agr%C3%A9g%C3%A9es"><i class="fas fa-link"></i></a>
</h3>
<p>Souvent, au lieu d’une liste de lignes, vous commencez par des comptages agrégés d’établissements, de districts, etc. Vous pouvez faire une épicurve avec <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> mais le code sera légérement différent. Cette section va utiliser le jeu de données <code>count_data</code> qui a été importé plus tôt, dans la section de préparation des données. Ce jeu de données est la <code>linelist</code> agrégée au nombre de jours d’hospitalisation. Les 50 premiéres lignes sont affichôes ci-dessous.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-04b520322c834743d42c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-04b520322c834743d42c">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399334400000\" data-max=\"1410307200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><div id="tracer-des-épicentres-quotidiens" class="section level4 unnumbered">
<h4>Tracer des épicentres quotidiens<a class="anchor" aria-label="anchor" href="#tracer-des-%C3%A9picentres-quotidiens"><i class="fas fa-link"></i></a>
</h4>
<p>Nous pouvons tracer une épicurve quotidienne à partir de ces <em>comptes quotidiens</em>. Voici les différences par rapport au code :</p>
<ul>
<li>Dans le mappage esthétique <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, spécifiez <code>y =</code> comme colonne de comptage (dans ce cas, le nom de la colonne est <code>n_cases</code>).</li>
<li>Ajoutez l’argument <code>stat = "identity"</code> dans <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code>, qui spécifie que la hauteur de la barre doit étre la valeur <code>y =</code>, et non le nombre de lignes comme c’est le cas par défaut.<br>
</li>
<li>Ajoutez l’argument <code>width =</code> pour éviter les lignes blanches verticales entre les barres. Pour les données quotidiennes, fixez la valeur à 1. Pour les données de comptage hebdomadaire, fixez la valeur à 7. Pour les données de comptage mensuel, les lignes blanches sont un probléme (chaque mois a un nombre de jours différent) - envisagez de transformer votre axe des x en un facteur ordonné catégorique (mois) et utilisez `geom_col()``.</li>
</ul>
<div class="sourceCode" id="cb1544"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_hospitalisation</span>, y <span class="op">=</span> <span class="va">n_cases</span><span class="op">)</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="co"># pour les comptages quotidiens, définir width = 1 pour éviter les espaces blancs entre les barres</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Date du rapport"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Nombre de cas"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Incidence quotidienne des cas, à partir des données de comptage quotidiennes"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1133-1.png" width="672"></div>
</div>
<div id="tracer-les-comptages-hebdomadaires" class="section level4 unnumbered">
<h4>Tracer les comptages hebdomadaires<a class="anchor" aria-label="anchor" href="#tracer-les-comptages-hebdomadaires"><i class="fas fa-link"></i></a>
</h4>
<p>Si vos données sont déjà des comptages de cas par semaine, elles peuvent ressembler à cet ensemble de données (appelé <code>count_data_weekly</code>) :</p>
<p>Les 50 premiéres lignes de <code>count_data_weekly</code> sont affichées ci-dessous. Vous pouvez voir que les comptes ont été agrégés en semaines. Chaque semaine est affichée par le premier jour de la semaine (lundi par défaut).</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-efaaa9f801e8e6fa77a1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-efaaa9f801e8e6fa77a1">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)"],["2014-05-04","2014-05-11","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-07-06","2014-07-13","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-13","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-20","2014-05-04","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-05-04","2014-05-18","2014-05-25","2014-06-01","2014-06-15","2014-06-22","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26"],[2,1,2,1,2,1,3,7,5,6,6,13,9,15,12,23,24,23,25,26,23,19,25,19,14,9,10,9,8,12,5,10,5,6,6,4,8,9,8,2,5,3,4,5,6,3,6,5,1,6,3,4,2,3,3,2,3,4,6,13,11,17,18,16,18,31,33,46,44,43,42,39,36,39,51,22,15,31,27,23,24,12,15,22,22,20,17,16,8,13,9,15,13,6,10,4,5,4,5,4,2,1,4,2,5,8,5,9,11,7,12,8,10,12,27,21,34,40,48,53,75,79,85,84,80,77,54,43,41,31,33,37,26,39,30,31,24,33,20,21,21,22,19,20,23,10,13,19,18,10,12,12,8,1,1,1,3,3,3,2,4,2,5,3,8,10,8,11,16,11,15,25,23,39,46,50,49,40,53,44,38,29,29,23,26,26,19,17,19,14,18,16,15,14,17,6,6,9,11,8,11,12,5,5,7,6,3,1,4,3,8,6,3,9,9,9,11,14,15,21,25,22,37,59,53,70,93,107,103,87,64,77,74,75,59,56,58,49,46,34,40,24,20,27,27,28,24,22,15,28,24,18,23,13,22,11,10,12,13,2,3,1,3,1,2,5,3,6,5,7,4,8,7,12,20,27,19,22,23,15,18,13,16,20,10,17,6,13,8,8,8,9,1,8,7,6,6,8,6,4,13,5,2,3,5,2,3,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>epiweek<\/th>\n      <th>n_cases_weekly<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Maintenant, tracez le graphique de façon à ce que <code>x =</code> la colonne epiweek. N’oubliez pas d’ajouter <code>y =</code> la colonne des comptes à la mapping esthétique, et ajoutez <code>stat = "identity"</code> comme expliqué ci-dessus.</p>
<div class="sourceCode" id="cb1545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data_weekly</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">epiweek</span>, <span class="co"># l'axe des x est l'epiweek (en tant que classe Date)</span></span>
<span>      y <span class="op">=</span> <span class="va">n_cases_weekly</span>, <span class="co"># l'axe des y est la hauteur du nombre de cas hebdomadaires</span></span>
<span>      group <span class="op">=</span> <span class="va">hospital</span>, <span class="co"># nous regroupons les barres et les couleurs par hôpital</span></span>
<span>      fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span> <span class="co"># ceci est également nécessaire lorsque l'on trace des données de comptage</span></span>
<span>     </span>
<span>  <span class="co"># étiquettes pour l'axe des x</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"2 months"</span>, <span class="co"># étiquettes tous les 2 mois </span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>, <span class="co"># grilles tous les mois</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes automatique</span></span>
<span>     </span>
<span>  <span class="co"># Choisissez la palette de couleurs (utilise le paquet RColorBrewer)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Pastel2"</span><span class="op">)</span><span class="op">+</span> </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Semaine d'apparition"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Incidence hebdomadaire des cas"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Hospital"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Incidence hebdomadaire des cas, à partir des données de comptage agrégées par hôpital"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1136-1.png" width="672"></div>
</div>
</div>
<div id="moyennes-mobiles" class="section level3 unnumbered">
<h3>Moyennes mobiles<a class="anchor" aria-label="anchor" href="#moyennes-mobiles"><i class="fas fa-link"></i></a>
</h3>
<p>Voir la page sur les <a href="moving_average.html#moving_average">Moyennes mobiles</a> pour une description détaillée et plusieurs options. Vous trouverez ci-dessous une option pour calculer des moyennes mobiles avec le package <strong>slider</strong>. Dans cette approche, <em>la moyenne mobile est calculée dans l’ensemble de données avant le tracé</em> :</p>
<ol style="list-style-type: decimal">
<li>Regroupez les données en comptes si nécessaire (quotidien, hebdomadaire, etc.) (voir la page sur <a href="grouping_data.html#grouping_data">groupage des données</a>).<br>
</li>
<li>créez une nouvelle colonne pour contenir la moyenne mobile, créée avec <code>slide_index()</code> du paquet <strong>slider</strong>.<br>
</li>
<li>Tracez la moyenne mobile comme une <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> au-dessus (aprés) l’histogramme épicurvien</li>
</ol>
<p>Voir l’utile <a href="https://cran.r-project.org/web/packages/slider/vignettes/slider.html">vignette pour le paquet <strong>slider</strong></a></p>
<div class="sourceCode" id="cb1546"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># charger le paquet</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">slider</span><span class="op">)</span> <span class="co"># slider utilisé pour calculer les moyennes mobiles</span></span>
<span></span>
<span><span class="co"># créer un jeu de données de comptages quotidiens et de moyennes mobiles sur 7 jours</span></span>
<span><span class="co">#######################################################</span></span>
<span><span class="va">ll_counts_7day</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># commencer avec linelist</span></span>
<span>  </span>
<span>  <span class="co">## compter les cas par date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date_onset</span>, name <span class="op">=</span> <span class="st">"new_cases"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># nommer une nouvelle colonne avec les comptages comme "new_cases".</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># supprime les cas dont la date_onset est manquante</span></span>
<span>  </span>
<span>  <span class="co">## calculer le nombre moyen de cas dans la fenétre de 7 jours</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    avg_7day <span class="op">=</span> <span class="fu">slider</span><span class="fu">::</span><span class="fu"><a href="https://slider.r-lib.org/reference/slide_index.html">slide_index</a></span><span class="op">(</span> <span class="co"># créer une nouvelle colonne</span></span>
<span>      <span class="va">new_cases</span>, <span class="co"># calcul basé sur la valeur de la colonne new_cases</span></span>
<span>      .i <span class="op">=</span> <span class="va">date_onset</span>, <span class="co"># l'index est la colonne date_onset, donc les dates non présentes sont incluses dans la fenétre </span></span>
<span>      .f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># La fonction est mean() avec les valeurs manquantes supprimées.</span></span>
<span>      .before <span class="op">=</span> <span class="fl">6</span>, <span class="co"># la fenétre est le jour et les 6 jours précédents</span></span>
<span>      .complete <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="co"># doit étre FALSE pour que unlist() fonctionne à l'étape suivante</span></span>
<span>    avg_7day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">avg_7day</span><span class="op">)</span><span class="op">)</span> <span class="co"># convertit la liste des classes en classes numériques</span></span>
<span></span>
<span></span>
<span><span class="co"># tracer</span></span>
<span><span class="co">######</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ll_counts_7day</span><span class="op">)</span> <span class="op">+</span> <span class="co"># commencer avec le nouvel ensemble de données défini ci-dessus </span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span> <span class="co"># crée un histogramme épicurve</span></span>
<span>      mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">date_onset</span>, <span class="co"># colonne de date comme axe des x</span></span>
<span>        y <span class="op">=</span> <span class="va">new_cases</span><span class="op">)</span>, <span class="co"># la hauteur est le nombre de nouveaux cas quotidiens</span></span>
<span>        stat <span class="op">=</span> <span class="st">"identity"</span>, <span class="co"># la hauteur est la valeur y</span></span>
<span>        fill<span class="op">=</span><span class="st">"#92a8d1"</span>, <span class="co"># couleur froide pour les barres</span></span>
<span>        colour <span class="op">=</span> <span class="st">"#92a8d1"</span>, <span class="co"># même couleur pour la bordure des barres</span></span>
<span>        <span class="op">)</span><span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span> <span class="co"># créer une ligne pour la moyenne mobile</span></span>
<span>      mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">date_onset</span>, <span class="co"># colonne de date pour l'axe des x</span></span>
<span>        y <span class="op">=</span> <span class="va">avg_7day</span>, <span class="co"># valeur y définie dans la colonne de la moyenne mobile</span></span>
<span>        lty <span class="op">=</span> <span class="st">"7-day \nrolling avg"</span><span class="op">)</span>, <span class="co"># nom de la ligne dans la légende</span></span>
<span>      color<span class="op">=</span><span class="st">"red"</span>, <span class="co"># couleur de la ligne</span></span>
<span>      size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="co"># largeur de la ligne</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span> <span class="co"># échelle de date</span></span>
<span>      date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,</span>
<span>      label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># format des étiquettes automatique</span></span>
<span>      expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span> <span class="co"># échelle de l'axe des y</span></span>
<span>      expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>      limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>       </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      x<span class="op">=</span><span class="st">""</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Nombre de cas confirmés"</span>,</span>
<span>      fill <span class="op">=</span> <span class="st">"Legende"</span><span class="op">)</span><span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># supprime le titre de la légende</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1137-1.png" width="672"></div>
</div>
<div id="facettespetits-multiples" class="section level3 unnumbered">
<h3>Facettes/petits-multiples<a class="anchor" aria-label="anchor" href="#facettespetits-multiples"><i class="fas fa-link"></i></a>
</h3>
<p>Comme pour les autres ggplots, vous pouvez créer des graphiques à facettes (“petits multiples”). Comme expliqué dans la page <a href="ggplot_tips.html#ggplot_tips">ggplot tips</a> de ce manuel, vous pouvez utiliser soit <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> soit <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code>. Ici, nous faisons une démonstration avec <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code>. Pour les épicurves, <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> est typiquement plus facile car il est probable que vous n’ayez besoin de faire une facette que sur une seule colonne.</p>
<p>La syntaxe générale est <code>facet_wrap(rows ~ cols)</code>, où à gauche du tilde (~) est le nom d’une colonne à répartir sur les “rows” du graphique à facettes, et à droite du tilde est le nom d’une colonne à répartir sur les “columns” du graphique à facettes. Plus simplement, il suffit d’utiliser un seul nom de colonne, à droite du tilde : <code>facet_wrap(~age_cat)</code>.</p>
<p><strong>Axes libres</strong><br>
Vous devrez décider si les échelles des axes pour chaque facette sont “fixées” aux mêmes dimensions (par défaut), ou “libres” (ce qui signifie qu’elles changeront en fonction des données de la facette). Faites-le avec l’argument <code>scales =</code> dans <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> en spécifiant “free_x” ou “free_y”, ou “free”.</p>
<p><strong>Nombre de cols et de rangs de facettes</strong><br>
Cela peut étre spécifié avec <code>ncol =</code> et <code>nrow =</code> dans <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code>.</p>
<p><strong>Ordre des facettes</strong><br>
Pour changer l’ordre d’apparition, changez l’ordre sous-jacent des niveaux de la colonne de facteurs utilisée pour créer les facettes.</p>
<p><strong>esthétique</strong><br>
La taille et le visage de la police, la couleur de la bande, etc. peuvent étre modifiés par <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> avec des arguments comme :</p>
<ul>
<li>
<code>strip.text = element_text()</code> (taille, couleur, face, angle…)</li>
<li>
<code>strip.background = element_rect()</code> (par exemple element_rect(fill=“grey”))<br>
</li>
<li>
<code>strip.position =</code> (position de la bande “bas”, “haut”, “gauche” ou “droite”)</li>
</ul>
<p><strong>Libellés des bandes</strong><br>
Les étiquettes des graphiques à facettes peuvent étre modifiées par les “étiquettes” de la colonne comme facteur, ou par l’utilisation d’un “labeller”.</p>
<p>Faites une étiquette comme celle-ci, en utilisant la fonction <code><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller()</a></code> de <strong>ggplot2</strong>. Puis fournissez l’étiqueteuse à l’argument <code>labeller =</code> de <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> comme indiqué ci-dessous.</p>
<div class="sourceCode" id="cb1547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>     <span class="st">"0-4"</span> <span class="op">=</span> <span class="st">"0-4 ans"</span>,</span>
<span>     <span class="st">"5-9"</span> <span class="op">=</span> <span class="st">"5-9 ans"</span>,</span>
<span>     <span class="st">"10-14"</span> <span class="op">=</span> <span class="st">"10-14 ans"</span>,</span>
<span>     <span class="st">"15-19"</span> <span class="op">=</span> <span class="st">"15-19 ans"</span>,</span>
<span>     <span class="st">"20-29"</span> <span class="op">=</span> <span class="st">"20-29 ans"</span>,</span>
<span>     <span class="st">"30-49"</span> <span class="op">=</span> <span class="st">"30-49 ans"</span>,</span>
<span>     <span class="st">"50-69"</span> <span class="op">=</span> <span class="st">"50-69 ans"</span>,</span>
<span>     <span class="st">"70+"</span> <span class="op">=</span> <span class="st">"Plus de 70 ans"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Un exemple de graphique à facettes</strong> - facetté par la colonne <code>age_cat</code>.</p>
<div class="sourceCode" id="cb1548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># faire le graphe</span></span>
<span><span class="co">###########</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>      group <span class="op">=</span> <span class="va">age_cat</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>, <span class="co"># les arguments à l'intérieur de aes() s'appliquent par groupe</span></span>
<span>      </span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>, <span class="co"># les arguments hors aes() s'appliquent à toutes les données</span></span>
<span>        </span>
<span>    <span class="co"># ruptures d'histogramme</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,</span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span><span class="op">+</span> <span class="co"># vecteur de date prédéfini (voir plus haut dans cette page)</span></span>
<span>                      </span>
<span>  <span class="co"># Les étiquettes sur l'axe des x</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># supprimez l'espace excédentaire sur l'axe des x en dessous et aprés les barres de cas</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"2 months"</span>, <span class="co"># les étiquettes apparaissent tous les 2 mois</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>, <span class="co"># les lignes verticales apparaissent tous les 1 mois </span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes automatique</span></span>
<span>  </span>
<span>  <span class="co"># Axe des y</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># supprime l'espace excédentaire sur l'axe des y entre le bas des barres et les étiquettes</span></span>
<span>  </span>
<span>  <span class="co"># thèmes esthétiques</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="co"># un ensemble de thèmes pour simplifier le graphique</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># légende à gauche en italique</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># titres des axes en gras</span></span>
<span>  </span>
<span>  <span class="co"># créer des facettes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">age_cat</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    strip.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    labeller <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">+</span>             </span>
<span>  </span>
<span>  <span class="co"># étiquettes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Incidence hebdomadaire des cas, par catégorie d'âge"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Sous-titre"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Catégorie d'âge"</span>, <span class="co"># fournir un nouveau titre pour la légende</span></span>
<span>    x <span class="op">=</span> <span class="st">"Semaine d'apparition des symptômes"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cas incidents hebdomadaires signalés"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital ; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} à {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}{nrow(central_data %&gt;% filter(is.na(date_onset)))} cas dont la date d'apparition est manquante et qui ne sont pas indiqués"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1139-1.png" width="672"></div>
<p>Voir ce <a href="https://ggplot2.tidyverse.org/reference/labellers.html">lien</a> pour plus d’informations sur les étiqueteuses.</p>
<div id="épidémie-totale-dans-larriére-plan-de-la-facette" class="section level4 nonnumbered" number="32.2.0.1">
<h4>
<span class="header-section-number">32.2.0.1</span> Épidémie totale dans l’arriére-plan de la facette<a class="anchor" aria-label="anchor" href="#%C3%A9pid%C3%A9mie-totale-dans-larri%C3%A9re-plan-de-la-facette"><i class="fas fa-link"></i></a>
</h4>
<p>Pour afficher l’épidémie totale en arriére-plan de chaque facette, ajoutez la fonction <code><a href="https://yutannihilation.github.io/gghighlight/reference/gghighlight.html">gghighlight()</a></code> avec des parenthôses vides au ggplot. Cette fonction provient du paquet <strong>gghighlight</strong>. Notez que le maximum de l’axe des y dans toutes les facettes est maintenant basé sur le pic de l’épidémie entiére. Il y a plus d’exemples de ce package dans la page <a href="ggplot_tips.html#ggplot_tips">ggplot tips</a>.</p>
<div class="sourceCode" id="cb1549"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># Epicurves par groupe</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>      group <span class="op">=</span> <span class="va">age_cat</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>, <span class="co"># les arguments à l'intérieur de aes() s'appliquent par groupe</span></span>
<span>    </span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>, <span class="co"># les arguments hors aes() s'appliquent à toutes les données</span></span>
<span>    </span>
<span>    <span class="co"># ruptures d'histogramme</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,</span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span><span class="op">+</span> <span class="co"># vecteur de dates prédéfini (voir en haut de la section ggplot)                </span></span>
<span>  </span>
<span>  <span class="co"># ajoute une épidémie grise en arriére-plan à chaque facette</span></span>
<span>  <span class="fu">gghighlight</span><span class="fu">::</span><span class="fu"><a href="https://yutannihilation.github.io/gghighlight/reference/gghighlight.html">gghighlight</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># étiquettes sur l'axe des x</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># Suppression de l'espace excédentaire sur l'axe des x sous et aprés les barres de cas</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"2 months"</span>, <span class="co"># les étiquettes apparaissent tous les 2 mois</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>, <span class="co"># les lignes verticales apparaissent tous les 1 mois </span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes automatique</span></span>
<span>  </span>
<span>  <span class="co"># Axe des y</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># supprime l'espace excédentaire de l'axe des y en dessous de 0</span></span>
<span>  </span>
<span>  <span class="co"># thèmes esthétiques</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="co"># un ensemble de thèmes pour simplifier le graphique</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># légende à gauche en italique</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># titres des axes en gras</span></span>
<span>  </span>
<span>  <span class="co"># créer des facettes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">age_cat</span>, <span class="co"># chaque facette est une valeur de age_cat</span></span>
<span>    ncol <span class="op">=</span> <span class="fl">4</span>, <span class="co"># nombre de colonnes</span></span>
<span>    strip.position <span class="op">=</span> <span class="st">"top"</span>, <span class="co"># position du titre/strip de la facette</span></span>
<span>    labeller <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">+</span> <span class="co"># labeller définit ci-dessus</span></span>
<span>  </span>
<span>  <span class="co"># étiquettes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Incidence hebdomadaire des cas, par catégorie d'âge"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Sous-titre"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Catégorie d'âge"</span>, <span class="co"># fournit un nouveau titre pour la légende</span></span>
<span>    x <span class="op">=</span> <span class="st">"Semaine d'apparition des symptômes"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cas incidents hebdomadaires signalés"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital ; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} à {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}{nrow(central_data %&gt;% filter(is.na(date_onset)))} cas dont la date d'apparition est manquante et qui ne sont pas indiqués"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1140-1.png" width="672"></div>
</div>
<div id="une-facette-avec-des-données" class="section level4 unnumbered">
<h4>Une facette avec des données<a class="anchor" aria-label="anchor" href="#une-facette-avec-des-donn%C3%A9es"><i class="fas fa-link"></i></a>
</h4>
<p>Si vous voulez avoir une seule boîte à facettes qui contient toutes les données, dupliquez l’ensemble des données et traitez les doublons comme une seule valeur de facette. La fonction “helper” <code>CreateAllFacet()</code> ci-dessous peut vous aider (gràce à cet <a href="https://stackoverflow.com/questions/18933575/easily-add-an-all-facet-to-facet-wrap-in-ggplot2">article de blog</a>). Quand elle est exécutée, le nombre de lignes double et il y aura une nouvelle colonne appelée <code>facet</code> dans laquelle les lignes dupliquées auront la valeur “all”, et les lignes originales auront la valeur originale de la colonne de facettes. Il ne vous reste plus qu’à effectuer la facette sur la colonne <code>facet</code>.</p>
<p>Voici la fonction d’aide. Exécutez-la pour qu’elle soit disponible pour vous.</p>
<div class="sourceCode" id="cb1550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># définir la fonction d'aide</span></span>
<span><span class="va">CreateAllFacet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">col</span><span class="op">)</span><span class="op">{</span></span>
<span>     <span class="va">df</span><span class="op">$</span><span class="va">facet</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span></span>
<span>     <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">df</span></span>
<span>     <span class="va">temp</span><span class="op">$</span><span class="va">facet</span> <span class="op">&lt;-</span> <span class="st">"all"</span></span>
<span>     <span class="va">merged</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">df</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="co"># s'assurer que la valeur de la facette est un facteur</span></span>
<span>     <span class="va">merged</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">merged</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">merged</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Appliquez maintenant la fonction d’aide à l’ensemble de données, sur la colonne <code>age_cat</code> :</p>
<div class="sourceCode" id="cb1551"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># créez un jeu de données dupliqué et avec une nouvelle colonne "facet" pour afficher "toutes" les catégories d'âge comme autre niveau de facette.</span></span>
<span><span class="va">central_data2</span> <span class="op">&lt;-</span> <span class="fu">CreateAllFacet</span><span class="op">(</span><span class="va">central_data</span>, col <span class="op">=</span> <span class="st">"age_cat"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># définir les niveaux de facteurs</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>facet <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">facet</span>, <span class="st">"all"</span>, <span class="st">"0-4"</span>, <span class="st">"5-9"</span>,</span>
<span>                             <span class="st">"10-14"</span>, <span class="st">"15-19"</span>, <span class="st">"20-29"</span>,</span>
<span>                             <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70+"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `facet = fct_relevel(...)`.
## Caused by warning:
## ! 1 unknown level in `f`: 70+</code></pre>
<div class="sourceCode" id="cb1553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># vérifier les niveaux</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">central_data2</span><span class="op">$</span><span class="va">facet</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
##   all   0-4   5-9 10-14 15-19 20-29 30-49 50-69  &lt;NA&gt; 
##   454    84    84    82    58    73    57     7     9</code></pre>
<p>Les changements notables de la commande <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> sont les suivants :</p>
<ul>
<li>Les données utilisées sont maintenant central_data2 (deux fois plus de lignes, avec une nouvelle colonne “facet”).</li>
<li>L’étiqueteuse devra étre mise à jour, si elle est utilisée.<br>
</li>
<li>Optionnel : pour obtenir des facettes empilées verticalement : la colonne facette est déplacée vers les lignes de l’équation et remplacée à droite par “.” (<code>facet_wrap(facet~.)</code>), et <code>ncol = 1</code>. Vous pouvez aussi avoir besoin d’ajuster la largeur et la hauteur de l’image du graphique en png (voir <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave()</a></code> dans <a href="ggplot_tips.html#ggplot_tips">ggplot tips</a>).</li>
</ul>
<div class="sourceCode" id="cb1555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">central_data2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># Epicurves réelles par groupe</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>        mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>          x <span class="op">=</span> <span class="va">date_onset</span>,</span>
<span>          group <span class="op">=</span> <span class="va">age_cat</span>,</span>
<span>          fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>, <span class="co"># les arguments à l'intérieur de aes() s'appliquent par groupe</span></span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, <span class="co"># les arguments hors aes() s'appliquent à toutes les données</span></span>
<span>        </span>
<span>        <span class="co"># ruptures d'histogramme</span></span>
<span>        breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>, <span class="co"># vecteur de dates prédéfini (voir en haut de la section ggplot)</span></span>
<span>        closed <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span><span class="op">+</span> </span>
<span>                     </span>
<span>  <span class="co"># étiquettes sur l'axe des x</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># supprime l'espace excédentaire de l'axe des x sous et aprés les barres de cas</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"2 months"</span>, <span class="co"># les étiquettes apparaissent tous les 2 mois</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>, <span class="co"># les lignes verticales apparaissent tous les 1 mois </span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes automatique</span></span>
<span>  </span>
<span>  <span class="co"># Axe des y</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># supprime l'espace excédentaire sur l'axe des y entre le bas des barres et les étiquettes</span></span>
<span>  </span>
<span>  <span class="co"># thèmes esthétiques</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="co"># un ensemble de thèmes pour simplifier le graphique</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># légende à gauche en italique</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span>               </span>
<span>  </span>
<span>  <span class="co"># créer des facettes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">facet</span><span class="op">~</span><span class="va">.</span> , <span class="co"># chaque parcelle est une valeur de la facette</span></span>
<span>             ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>            </span>
<span></span>
<span>  <span class="co"># étiquettes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Incidence hebdomadaire des cas, par catégorie d'âge"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Sous-titre"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Catégorie d'âge"</span>, <span class="co"># fournit un nouveau titre pour la légende</span></span>
<span>       x <span class="op">=</span> <span class="st">"Semaine d'apparition des symptômes"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cas incidents hebdomadaires signalés"</span>,</span>
<span>       caption <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital ; Case onsets range from</span></span>
<span><span class="st">                                   {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} à</span></span>
<span><span class="st">                                   {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cas dont la date d'apparition est manquante et qui ne sont pas indiqués"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1143-1.png" width="480"></div>
</div>
</div>
</div>
<div id="données-provisoires" class="section level2" number="32.3">
<h2>
<span class="header-section-number">32.3</span> Données provisoires<a class="anchor" aria-label="anchor" href="#donn%C3%A9es-provisoires"><i class="fas fa-link"></i></a>
</h2>
<p>Les données les plus récentes présentées dans les épicurves doivent souvent étre marquées comme provisoires, ou sujettes à des retards de déclaration. Ceci peut étre fait en ajoutant une ligne verticale et/ou un rectangle sur un nombre de jours spécifié. Voici deux options :</p>
<ol style="list-style-type: decimal">
<li>Utilisez <code><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate()</a></code> :
<ul>
<li>Pour une ligne, utilisez <code>annotate(geom = "segment")</code>. Fournissez <code>x</code>, <code>xend</code>, <code>y</code>, et <code>yend</code>. Ajustez la taille, le type de ligne (<code>lty</code>) et la couleur.<br>
</li>
<li>Pour un rectangle, utilisez <code>annotate(geom = "rect")</code>. Fournissez xmin/xmax/ymin/ymax. Ajustez la couleur et l’alpha.<br>
</li>
</ul>
</li>
<li>Regroupez les données par statut provisoire et colorez ces barres différemment.</li>
</ol>
<p><span style="color : orange ;"><strong><em>CAUTION:</em></strong> Vous pourriez essayer <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect()</a></code> pour dessiner un rectangle, mais l’ajustement de la transparence ne fonctionne pas dans un contexte de linelist. Cette fonction superpose un rectangle pour chaque observation/rangée ! Utilisez soit un alpha trés faible (par exemple 0,01), soit une autre approche. </span></p>
<div id="utilisation-de-annotate" class="section level3 unnumbered">
<h3>Utilisation de <code>annotate()</code><a class="anchor" aria-label="anchor" href="#utilisation-de-annotate"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Dans <code>annotate(geom = "rect")</code>, les arguments <code>xmin</code> et <code>xmax</code> doivent recevoir des entrées de la classe Date.<br>
</li>
<li>Notez que, comme ces données sont agrégées en barres hebdomadaires et que la derniére barre s’étend jusqu’au lundi suivant le dernier point de données, la région ombrée peut sembler couvrir 4 semaines.<br>
</li>
<li>Voici un <code><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate()</a></code> <a href="https://ggplot2.tidyverse.org/reference/annotate.html">exemple en ligne</a>
</li>
</ul>
<div class="sourceCode" id="cb1556"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># histogramme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    </span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>, <span class="co"># vecteur de date prédéfini - voir en haut de la section ggplot</span></span>
<span>    </span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    </span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    </span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># échelles</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># Suppression de l'espace excédentaire sur l'axe des x sous et aprés les barres de cas</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, <span class="co"># 1er du mois</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>, <span class="co"># 1er du mois</span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes automatique</span></span>
<span>  </span>
<span>  <span class="co"># étiquettes et theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Utilisant annotate()\nRectangle et ligne montrant que les données des 21 derniers jours sont provisoires"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Semaine d'apparition des symptômes"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Indication hebdomadaire des cas"</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># ajoute un rectangle rouge semi-transparent aux données provisoires</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"rect"</span>,</span>
<span>    xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span><span class="op">)</span>, <span class="co"># la note doit étre enveloppée dans as.Date()</span></span>
<span>    xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">Inf</span><span class="op">)</span>, <span class="co"># la note doit étre enveloppée dans as.Date()</span></span>
<span>    ymin <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    ymax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.2</span>, <span class="co"># alpha facile et intuitif à ajuster en utilisant annotate()</span></span>
<span>    fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># ajoute une ligne verticale noire au-dessus des autres couches</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"segment"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>, <span class="co"># 21 jours avant les derniéres données</span></span>
<span>    xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>, </span>
<span>    y <span class="op">=</span> <span class="fl">0</span>, <span class="co"># la ligne commence à y = 0</span></span>
<span>    yend <span class="op">=</span> <span class="cn">Inf</span>, <span class="co"># ligne jusqu'au sommet du graphique</span></span>
<span>    size <span class="op">=</span> <span class="fl">2</span>, <span class="co"># taille de la ligne</span></span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    lty <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span><span class="op">+</span> <span class="co"># type de ligne, par exemple "solid", "dashed".</span></span>
<span></span>
<span>  <span class="co"># ajouter du texte dans le rectangle</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">15</span>,</span>
<span>    y <span class="op">=</span> <span class="fl">15</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"Sujet à des délais de déclaration"</span>,</span>
<span>    angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1144-1.png" width="672"></div>
<p>La même ligne verticale noire peut étre obtenue avec le code ci-dessous, mais en utilisant <code><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline()</a></code> vous perdez la possibilité de contrôler la hauteur :</p>
<div class="sourceCode" id="cb1557"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>,</span>
<span>           size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>           color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="couleur-des-barres" class="section level3 unnumbered">
<h3>Couleur des barres<a class="anchor" aria-label="anchor" href="#couleur-des-barres"><i class="fas fa-link"></i></a>
</h3>
<p>Une autre approche pourrait consister à ajuster la couleur ou l’affichage des barres de données provisoires elles-mêmes. Vous pouvez créer une nouvelle colonne dans l’étape de préparation des données et l’utiliser pour regrouper les données, de sorte que les ” aes(fill = )`” des données provisoires puissent avoir une couleur ou un alpha différent des autres barres.</p>
<div class="sourceCode" id="cb1558"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ajouter une colonne</span></span>
<span><span class="co">############</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">central_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>tentative <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">date_onset</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">7</span> <span class="op">~</span> <span class="st">"Tentative"</span>, <span class="co"># tenative si dans les 7 derniers jours</span></span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Reliable"</span><span class="op">)</span><span class="op">)</span> <span class="co"># tout le reste est fiable</span></span>
<span></span>
<span><span class="co"># tracé</span></span>
<span><span class="co">######</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, fill <span class="op">=</span> <span class="va">tentative</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># histogramme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>, <span class="co"># vecteur de données prédéfini, voir en haut de la page ggplot</span></span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># échelles</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lightblue"</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># Supprimez l'espace excédentaire de l'axe des x sous et aprés les barres de cas</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>, <span class="co"># Lundi toutes les 3 semaines</span></span>
<span>    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>, <span class="co"># lundi semaines </span></span>
<span>    label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># format des étiquettes automatique</span></span>
<span>  </span>
<span>  <span class="co"># étiquettes et theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Afficher les jours de déclaration provisoire"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># supprimer le titre de la légende</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1146-1.png" width="672"></div>
</div>
</div>
<div id="étiquettes-de-date-à-plusieurs-niveaux" class="section level2" number="32.4">
<h2>
<span class="header-section-number">32.4</span> Étiquettes de date à plusieurs niveaux<a class="anchor" aria-label="anchor" href="#%C3%A9tiquettes-de-date-%C3%A0-plusieurs-niveaux"><i class="fas fa-link"></i></a>
</h2>
<p>Si vous voulez des étiquettes de date à plusieurs niveaux (par exemple, le mois et l’année) <em>sans dupliquer les niveaux d’étiquette inférieurs</em>, envisagez l’une des approches ci-dessous :<br>
Rappelez-vous - vous pouvez utiliser des outils tels que <code>\n</code> <em>avec</em> les arguments <code>date_labels</code> ou <code>labels</code> pour placer des parties de chaque étiquette sur une nouvelle ligne en dessous. Toutefois, les codes ci-dessous vous aident à placer les années ou les mois (par exemple) sur une ligne inférieure <em>et seulement une fois</em>.</p>
<p>La méthode la plus simple est l’argument <code>labels =</code> de <code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></code> à la fonction <code>label_date_short()</code> du package <strong>scales</strong> (note : n’oubliez pas d’inclure des parenthèses vides (), comme indiqué ci-dessous). Cette fonction construira automatiquement des étiquettes de date efficaces (pour en savoir plus, cliquez <a href="https://scales.r-lib.org/reference/label_date.html">ici</a>). Un autre avantage de cette fonction est que les étiquettes s’adaptent automatiquement à l’évolution de vos données dans le temps : de jours, en semaines, en mois et en années.</p>
<div class="sourceCode" id="cb1559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># histogram</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,   </span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span>,                  </span>
<span>    color <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># y-axis </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># x-axis</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                      </span>
<span>    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, </span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># étiquettes de date efficaces</span></span>
<span>  </span>
<span>  <span class="co"># extra</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Using label_date_short()\nTo make automatic and efficient date labels"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Weekly case indicence"</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1147-1.png" width="672"></div>
<p>Une deuxième option consiste à utiliser le facettage. Ci-dessous :</p>
<ul>
<li>Le nombre de cas est agrégé en semaines pour des raisons esthétiques. Voir la page Epicurves (onglet données agrégées) pour plus de détails.<br>
</li>
<li>Une ligne <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area()</a></code> est utilisée au lieu d’un histogramme, car l’approche par facettes ci-dessous ne fonctionne pas bien avec les histogrammes.</li>
</ul>
<p><strong>Aggréger en comptages hebdomadaires</strong></p>
<div class="sourceCode" id="cb1560"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># créez un ensemble de données sur le nombre de cas par semaine.</span></span>
<span><span class="co">#######################################</span></span>
<span><span class="va">central_weekly</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># Filtrer linelist</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, unit <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># count(week) %&gt;% # count(week)  </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># résume le nombre de cas hebdomadaires</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># Suppression des cas dont la date d'apparition est manquante</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span> <span class="co"># remplir toutes les semaines où aucun cas n'a été signalé</span></span>
<span>    week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,   </span>
<span>      to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>                        <span class="co"># convertir les nouvelles valeurs NA en comptage 0</span></span></code></pre></div>
<p><strong>Faire des graphiques</strong></p>
<div class="sourceCode" id="cb1561"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tracer avec une bordure de boîte sur l'année</span></span>
<span><span class="co">#################################</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">central_weekly</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># établir x et y pour tout le graphique</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, <span class="co"># créer une ligne, la hauteur de la ligne est le nombre de comptage</span></span>
<span>            color <span class="op">=</span> <span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># couleur de la ligne</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># faire des points aux points de données hebdomadaires</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#69b3a2"</span>, <span class="co"># zone de remplissage sous la ligne</span></span>
<span>            alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">+</span> <span class="co"># transparence du remplissage</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_labels<span class="op">=</span><span class="st">"%b"</span>, <span class="co"># format de l'étiquette de la date pour montrer le mois </span></span>
<span>               date_breaks<span class="op">=</span><span class="st">"month"</span>, <span class="co"># étiquettes de date au 1er de chaque mois</span></span>
<span>               expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># supprimer l'espace excédentaire</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># suppression de l'espace excédentaire sous l'axe des x</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>, <span class="co"># facette sur l'année (de la colonne de la classe Date)</span></span>
<span>             space<span class="op">=</span><span class="st">"free_x"</span>,                </span>
<span>             scales<span class="op">=</span><span class="st">"free_x"</span>, <span class="co"># les axes x s'adaptent à la plage de données (pas "fixe")</span></span>
<span>             switch<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># étiquettes des facettes (année) en bas de page</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>, <span class="co"># placement des étiquettes de facettes</span></span>
<span>          strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># pas de fond d'étiquette de facette</span></span>
<span>          panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,          </span>
<span>          panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"grey40"</span><span class="op">)</span>, <span class="co"># bordure grise du PANEL de la facette</span></span>
<span>          panel.spacing<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># Pas d'espace entre les panneaux à facettes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Étiquettes annuelles imbriquées - points, ombrées, bordure d'étiquette"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1149-1.png" width="672"></div>
<p>Les techniques ci-dessus ont été adaptées de <a href="https://stackoverflow.com/questions/44616530/axis-labels-on-two-lines-with-nested-x-variables-year-below-months">this</a> et <a href="https://stackoverflow.com/questions/20571306/multi-row-x-axis-labels-in-ggplot-line-chart">this</a> post sur stackoverflow.com.</p>
<!-- ======================================================= -->
</div>
<div id="double-axe" class="section level2" number="32.5">
<h2>
<span class="header-section-number">32.5</span> Double axe<a class="anchor" aria-label="anchor" href="#double-axe"><i class="fas fa-link"></i></a>
</h2>
<p>Bien qu’il y ait des discussions acharnées sur la validité des doubles axes au sein de la communauté de visualisation des données, de nombreux superviseurs d’épi veulent toujours voir une épicurve ou un graphique similaire avec un pourcentage superposé à un deuxiéme axe. Ce sujet est abordé plus en détail dans la page <a href="ggplot_tips.html#ggplot_tips">ggplot tips</a>, mais un exemple utilisant la méthode <strong>cowplot</strong> est présenté ci-dessous :</p>
<ul>
<li>Deux graphiques distincts sont créés, puis combinés avec le paquet <strong>cowplot</strong>.<br>
</li>
<li>Les graphiques doivent avoir exactement le même axe des x (limites définies), sinon les données et les étiquettes ne seront pas alignées.<br>
</li>
<li>Chacun utilise <code>theme_cowplot()</code> et l’un d’entre eux a l’axe des y déplacé sur le côte droit du graphique</li>
</ul>
<div class="sourceCode" id="cb1562"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Chargez le paquet</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Faire le premier tracé de l'histogramme épicurve</span></span>
<span><span class="co">#######################################</span></span>
<span><span class="va">plot_cases</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># Tracer les cas par semaine</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># créer un histogramme  </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    </span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># bin breaks chaque semaine en commençant le lundi avant le premier cas, jusqu'au lundi aprés le dernier cas</span></span>
<span>    closed <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span><span class="op">)</span><span class="op">+</span> <span class="co"># vecteur prédéfini de dates hebdomadaires (voir en haut de la section ggplot)</span></span>
<span>        </span>
<span>  <span class="co"># spécifier le début et la fin de l'axe des dates pour l'aligner avec les autres graphiques</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># min/max des pauses hebdomadaires prédéfinies de l'histogramme</span></span>
<span>  </span>
<span>  <span class="co"># étiquettes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="st">"Cas quotidiens"</span>,</span>
<span>      x <span class="op">=</span> <span class="st">"Date d'apparition des symptômes"</span></span>
<span>    <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># faire un second tracé du pourcentage de décés par semaine</span></span>
<span><span class="co">###########################################</span></span>
<span><span class="va">plot_deaths</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># commence avec linelist</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># créer une colonne semaine</span></span>
<span>  </span>
<span>  <span class="co"># résumer pour obtenir le pourcentage hebdomadaire de cas décédés</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_cases <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            died <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>            pct_died <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="va">died</span><span class="op">/</span><span class="va">n_cases</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># commencer le tracé</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># ligne du pourcentage hebdomadaire de décés</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span> <span class="co"># créer une ligne de pourcentage de décés</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">pct_died</span><span class="op">)</span>, <span class="co"># spécifie la hauteur des y comme colonne pct_died</span></span>
<span>    stat <span class="op">=</span> <span class="st">"identity"</span>, <span class="co"># fixer la hauteur de la ligne à la valeur de la colonne pct_death, et non au nombre de lignes (par défaut)</span></span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># mêmes limites de l'axe des dates que l'autre graphique - alignement parfait</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># min/max des pauses hebdomadaires prédéfinies de l'histogramme</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># ajustements de l'axe des y</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span> <span class="co"># ajuster l'axe des y</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>, <span class="co"># définit les intervalles de rupture de l'axe des pourcentages</span></span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, <span class="co"># définit l'étendue de l'axe des pourcentages</span></span>
<span>    position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span> <span class="co"># déplace l'axe des pourcentages vers la droite</span></span>
<span>  </span>
<span>  <span class="co"># étiquette pour l'axe des Y, pas d'étiquette pour l'axe des X</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Pourcentage décédé"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># étiquette de l'axe des pourcentages</span></span>
<span>  </span>
<span>  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="co"># ajoutez ceci pour que les deux graphiques fusionnent bien ensemble</span></span></code></pre></div>
<p>Utilisez maintenant <strong>cowplot</strong> pour superposer les deux graphiques. Une attention particuliére a été portée à l’alignement de l’axe des x, au côte de l’axe des y et à l’utilisation de <code>theme_cowplot()</code>.</p>
<div class="sourceCode" id="cb1563"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aligned_plots</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/align_plots.html">align_plots</a></span><span class="op">(</span><span class="va">plot_cases</span>, <span class="va">plot_deaths</span>, align<span class="op">=</span><span class="st">"hv"</span>, axis<span class="op">=</span><span class="st">"tblr"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggdraw</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">draw_plot</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1151-1.png" width="672"></div>
</div>
<div id="incidence-cumulée" class="section level2" number="32.6">
<h2>
<span class="header-section-number">32.6</span> Incidence cumulée<a class="anchor" aria-label="anchor" href="#incidence-cumul%C3%A9e"><i class="fas fa-link"></i></a>
</h2>
<p>Cette page traitera de la façon de calculer l’incidence cumulée et de la tracer avec <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>.</p>
<p>Si vous commencez avec une liste de cas, créez une nouvelle colonne contenant le nombre cumulé de cas par jour dans une épidémie en utilisant <code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code> de <strong>base</strong> R :</p>
<div class="sourceCode" id="cb1564"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cumulative_case_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># nombre de lignes par jour (retourné dans la colonne "n")   </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>                         </span>
<span>    cumulative_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="co"># nouvelle colonne du nombre cumulé de lignes à chaque date</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>Les 10 premiéres lignes sont affichôes ci-dessous :</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e6c90c3b09af4742c638" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e6c90c3b09af4742c638">{"x":{"filter":"none","vertical":false,"data":[["2014-04-07","2014-04-15","2014-04-21","2014-04-25","2014-04-26","2014-04-27","2014-05-01","2014-05-03","2014-05-04","2014-05-05"],[1,1,2,1,1,1,2,1,1,1],[1,2,4,5,6,7,9,10,11,12]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>date_onset<\/th>\n      <th>n<\/th>\n      <th>cumulative_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Cette colonne cumulative peut ensuite étre tracée en fonction de la <code>date_onset</code>, en utilisant `geom_line()`` :</p>
<div class="sourceCode" id="cb1565"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_cumulative</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">cumulative_case_counts</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, y <span class="op">=</span> <span class="va">cumulative_cases</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_cumulative</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1154-1.png" width="672"></div>
<p>On peut aussi le superposer à l’épicurve, avec un double axe en utilisant la méthode <strong>cowplot</strong> décrite ci-dessus et dans la page <a href="ggplot_tips.html#ggplot_tips">ggplot tips</a> :</p>
<div class="sourceCode" id="cb1566"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#charger le paquet</span></span>
<span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Faire le premier tracé de l'histogramme épicurve</span></span>
<span><span class="va">plot_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>          </span>
<span>    data <span class="op">=</span> <span class="va">linelist</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,</span>
<span>    binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="st">"Cas quotidiens"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date d'apparition des symptômes"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># créer un second tracé de la ligne des cas cumulés</span></span>
<span><span class="va">plot_cumulative</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">cumulative_case_counts</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, y <span class="op">=</span> <span class="va">cumulative_cases</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cas cumulés"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Utilisez maintenant <strong>cowplot</strong> pour superposer les deux graphiques. Une attention particuliére a été portée à l’alignement de l’axe des x, au côte de l’axe des y et à l’utilisation de <code>theme_cowplot()</code>.</p>
<div class="sourceCode" id="cb1567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aligned_plots</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/align_plots.html">align_plots</a></span><span class="op">(</span><span class="va">plot_cases</span>, <span class="va">plot_cumulative</span>, align<span class="op">=</span><span class="st">"hv"</span>, axis<span class="op">=</span><span class="st">"tblr"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggdraw</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">draw_plot</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1156-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="ressources-17" class="section level2" number="32.7">
<h2>
<span class="header-section-number">32.7</span> Ressources<a class="anchor" aria-label="anchor" href="#ressources-17"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="ggplot_tips.html"><span class="header-section-number">31</span> Trucs et Astuces avec ggplot</a></div>
<div class="next"><a href="age_pyramid.html"><span class="header-section-number">33</span> Pyramides démographiques et échelles de Likert</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#epicurves"><span class="header-section-number">32</span> Courbes épidémiques</a></li>
<li>
<a class="nav-link" href="#pr%C3%A9paration-15"><span class="header-section-number">32.1</span> Préparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#paquets-2">Paquets</a></li>
<li><a class="nav-link" href="#importer-des-donn%C3%A9es-6">Importer des données</a></li>
<li><a class="nav-link" href="#d%C3%A9finir-les-param%C3%A9tres">Définir les paramétres</a></li>
<li><a class="nav-link" href="#v%C3%A9rifier-les-dates">Vérifier les dates</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#epicurves-avec-ggplot2"><span class="header-section-number">32.2</span> Epicurves avec ggplot2</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sp%C3%A9cifier-les-cas-en-bacs">Spécifier les cas en bacs</a></li>
<li><a class="nav-link" href="#exemple-d%C3%A9picurve-hebdomadaire">Exemple d’épicurve hebdomadaire</a></li>
<li><a class="nav-link" href="#groupercolorer-par-valeur">Grouper/colorer par valeur</a></li>
<li><a class="nav-link" href="#ajuster-les-couleurs">Ajuster les couleurs</a></li>
<li><a class="nav-link" href="#ajuster-lordre-des-niveaux">Ajuster l’ordre des niveaux</a></li>
<li><a class="nav-link" href="#ajuster-la-l%C3%A9gende">Ajuster la légende</a></li>
<li><a class="nav-link" href="#barres-c%C3%B4te-%C3%A0-c%C3%B4te">Barres côte à côte</a></li>
<li><a class="nav-link" href="#limites-de-laxe">Limites de l’axe</a></li>
<li><a class="nav-link" href="#libell%C3%A9s-des-axes-de-date-lignes-de-grille">Libellés des axes de date / lignes de grille</a></li>
<li><a class="nav-link" href="#donn%C3%A9es-agr%C3%A9g%C3%A9es">Données agrégées</a></li>
<li><a class="nav-link" href="#moyennes-mobiles">Moyennes mobiles</a></li>
<li><a class="nav-link" href="#facettespetits-multiples">Facettes/petits-multiples</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#donn%C3%A9es-provisoires"><span class="header-section-number">32.3</span> Données provisoires</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#utilisation-de-annotate">Utilisation de annotate()</a></li>
<li><a class="nav-link" href="#couleur-des-barres">Couleur des barres</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%C3%A9tiquettes-de-date-%C3%A0-plusieurs-niveaux"><span class="header-section-number">32.4</span> Étiquettes de date à plusieurs niveaux</a></li>
<li><a class="nav-link" href="#double-axe"><span class="header-section-number">32.5</span> Double axe</a></li>
<li><a class="nav-link" href="#incidence-cumul%C3%A9e"><span class="header-section-number">32.6</span> Incidence cumulée</a></li>
<li><a class="nav-link" href="#ressources-17"><span class="header-section-number">32.7</span> Ressources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Le Epi R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-25.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
