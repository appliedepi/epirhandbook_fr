<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>20 Données manquantes | Le Epi R Handbook</title>
<meta name="author" content="the handbook team">
<meta name="description" content="Dans ce chapitre nous allons : 1) Évaluer l’ampleur des données manquantes 2) Filtrer les lignes en contenant des données manquantes 3) Visualiser les données manquantes au cours du temps 4) Gérer...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="20 Données manquantes | Le Epi R Handbook">
<meta property="og:type" content="book">
<meta property="og:description" content="Dans ce chapitre nous allons : 1) Évaluer l’ampleur des données manquantes 2) Filtrer les lignes en contenant des données manquantes 3) Visualiser les données manquantes au cours du temps 4) Gérer...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="20 Données manquantes | Le Epi R Handbook">
<meta name="twitter:description" content="Dans ce chapitre nous allons : 1) Évaluer l’ampleur des données manquantes 2) Filtrer les lignes en contenant des données manquantes 3) Visualiser les données manquantes au cours du temps 4) Gérer...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.28/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.10/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>
</head>
<body>
<div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
      <strong>Tu as besoin d'aide pour apprendre R?</strong> Inscris-toi au <a href="https://www.appliedepi.org/live/" class="alert-link">cours d'introduction à R</a> d'Applied Epi, essaie nos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriels R gratuits</a>, publie dans notre <a href="https://community.appliedepi.org/" class="alert-link">forum de questions et réponses</a>, ou demande notre <a href="mailto:contact@appliedepi.org" class="alert-link">assistance R</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Le Epi R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">About this book</li>
<li><a class="" href="editorial_notes.html"><span class="header-section-number">1</span> Notes techniques et choix éditoriaux</a></li>
<li><a class="" href="download_book_data.html"><span class="header-section-number">2</span> Télécharger le manuel et les données</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="rbasics.html"><span class="header-section-number">3</span> R - les bases</a></li>
<li><a class="" href="transition_to_r.html"><span class="header-section-number">4</span> Transition vers R</a></li>
<li><a class="" href="suggested_packages.html"><span class="header-section-number">5</span> Paquets conseillés</a></li>
<li><a class="" href="r_projects.html"><span class="header-section-number">6</span> Projets R</a></li>
<li><a class="" href="import_export.html"><span class="header-section-number">7</span> Importer et exporter des données</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning_data.html"><span class="header-section-number">8</span> Nettoyage de données et fonctions essentielles</a></li>
<li><a class="" href="working_dates.html"><span class="header-section-number">9</span> Manipuler les dates</a></li>
<li><a class="" href="character_strings.html"><span class="header-section-number">10</span> Caractères et chaînes de caractères</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Facteurs</a></li>
<li><a class="" href="pivoting_data.html"><span class="header-section-number">12</span> Restructurer les données</a></li>
<li><a class="" href="grouping_data.html"><span class="header-section-number">13</span> Travailler sur des données groupées</a></li>
<li><a class="" href="joining_matching.html"><span class="header-section-number">14</span> Joindre des données</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> De-duplication</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Itération, boucles et listes</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive_tables.html"><span class="header-section-number">17</span> Tableaux descriptifs</a></li>
<li><a class="" href="stats_test.html"><span class="header-section-number">18</span> Tests statistiques simples</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Régression univariée et multivariable</a></li>
<li><a class="active" href="missing_data.html"><span class="header-section-number">20</span> Données manquantes</a></li>
<li><a class="" href="standardisation.html"><span class="header-section-number">21</span> Taux standardisés</a></li>
<li><a class="" href="moving_average.html"><span class="header-section-number">22</span> Moyennes mobiles</a></li>
<li><a class="" href="time_series.html"><span class="header-section-number">23</span> Série temporelle et détection des épidémies</a></li>
<li><a class="" href="epidemic_models.html"><span class="header-section-number">24</span> Modélisation des épidémies</a></li>
<li><a class="" href="contact_tracing.html"><span class="header-section-number">25</span> Suivi des contacts</a></li>
<li><a class="" href="survey_analysis.html"><span class="header-section-number">26</span> Analyse d’enquête</a></li>
<li><a class="" href="survival_analysis.html"><span class="header-section-number">27</span> Analyse de survie</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS basics</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="tables_presentation.html"><span class="header-section-number">29</span> Présenter avec des tables</a></li>
<li><a class="" href="ggplot_basics.html"><span class="header-section-number">30</span> Les bases de ggplot</a></li>
<li><a class="" href="ggplot_tips.html"><span class="header-section-number">31</span> Trucs et Astuces avec ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> Courbes épidémiques</a></li>
<li><a class="" href="age_pyramid.html"><span class="header-section-number">33</span> Pyramides démographiques et échelles de Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> Graphiques thermiques</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> Diagrammes et schémas</a></li>
<li><a class="" href="combination_analysis.html"><span class="header-section-number">36</span> Analyse des combinaisons</a></li>
<li><a class="" href="transmission_chains.html"><span class="header-section-number">37</span> Chaînes de transmission</a></li>
<li><a class="" href="phylogenetic_trees.html"><span class="header-section-number">38</span> Les arbres phylogénétiques</a></li>
<li><a class="" href="interactive_plots.html"><span class="header-section-number">39</span> Graphiques interactifs</a></li>
<li class="book-part">Reports and dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> Production de rapports avec R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> Organisation des rapports de routine</a></li>
<li><a class="" href="dashboards.html"><span class="header-section-number">42</span> Tableaux de bord avec R Markdown</a></li>
<li><a class="" href="shiny.html"><span class="header-section-number">43</span> Tableaux de bord avec Shiny</a></li>
<li class="book-part">Miscellaneous</li>
<li><a class="" href="writing_functions.html"><span class="header-section-number">44</span> Fonctions d’écriture</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> Interactions avec les répertoires</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Contrôle de version et collaboration avec Git et Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> Erreurs fréquentes</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> Obtenir de l’aide</a></li>
<li><a class="" href="network_drives.html"><span class="header-section-number">49</span> R sur les lecteurs réseau</a></li>
<li><a class="" href="data_table.html"><span class="header-section-number">50</span> Tableau de données</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="missing_data" class="section level1" number="20">
<h1>
<span class="header-section-number">20</span> Données manquantes<a class="anchor" aria-label="anchor" href="#missing_data"><i class="fas fa-link"></i></a>
</h1>
<p><img src="images/missingness.png" width="50%"><img src="images/missingness_overview.png" width="50%"></p>
<p>Dans ce chapitre nous allons :<br>
1) Évaluer l’ampleur des données manquantes<br>
2) Filtrer les lignes en contenant des données manquantes<br>
3) Visualiser les données manquantes au cours du temps<br>
4) Gérer comment les <code>NA</code> apparaissent dans les graphes<br>
5) Imputer des données manquantes : MMCA, MA, MOP</p>
<!-- ======================================================= -->
<div id="étapes-préliminaires-3" class="section level2" number="20.1">
<h2>
<span class="header-section-number">20.1</span> Étapes préliminaires<a class="anchor" aria-label="anchor" href="#%C3%A9tapes-pr%C3%A9liminaires-3"><i class="fas fa-link"></i></a>
</h2>
<div id="importation-des-paquets-4" class="section level3 unnumbered">
<h3>Importation des paquets<a class="anchor" aria-label="anchor" href="#importation-des-paquets-4"><i class="fas fa-link"></i></a>
</h3>
<p>Ces lignes de code chargent les paquets nécessaires aux analyses. Dans ce guide, nous mettons l’accent sur <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, qui installe le paquet si nécessaire <em>puis</em> l’importe pour l’utiliser. Vous pouvez également charger les paquets installés avec <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de <strong>base</strong> R. Voir la page sur <a href="rbasics.html#rbasics">bases de R</a> pour plus d’informations sur les paquets R.</p>
<div class="sourceCode" id="cb1005"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">rio</span>,           <span class="co"># import des fichiers</span></span>
<span>  <span class="va">tidyverse</span>,     <span class="co"># gestion des données + graphiques (ggplot2)</span></span>
<span>  <span class="va">naniar</span>,        <span class="co"># bilan des données manquantes</span></span>
<span>  <span class="va">mice</span>           <span class="co"># imputation</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="importation-des-données-4" class="section level3 unnumbered">
<h3>Importation des données<a class="anchor" aria-label="anchor" href="#importation-des-donn%C3%A9es-4"><i class="fas fa-link"></i></a>
</h3>
<p>Nous importons un jeu de données de cas d’une épidémie d’ébola fictive. Pour reproduire les étapes, <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">cliquez pour télécharger la linelist “propre”</a> (as .rds file). Importez vos données avec la fonction <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> du paquet <strong>rio</strong> (elle accepte de nombreux types de fichiers comme .xlsx, .rds, .csv - voir la page <a href="import_export">Importation et exportation des données</a> pour plus de détails).</p>
<div class="sourceCode" id="cb1006"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># importer la linelist dans R</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Les cinquantes premières lignes sont affichées ci-dessous :</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-c4a0ce1f79177a42d942" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c4a0ce1f79177a42d942">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="conversion-des-données-manquantes-lors-de-limport" class="section level3 unnumbered">
<h3>Conversion des données manquantes lors de l’import<a class="anchor" aria-label="anchor" href="#conversion-des-donn%C3%A9es-manquantes-lors-de-limport"><i class="fas fa-link"></i></a>
</h3>
<p>Il faut être particulièrement attentif aux valeurs qui doivent être classifiées comme “manquantes” lors de l’import des données. Des données manquantes peuvent par exemple être indiquées par 99, 999, “Manquant”, un espace vide (” “) ou des cellules vides (”“). Vous pouvez les convertir en <code>NA</code> via la fonction d’importation des données.<br>
Pour plus de détails, consultez la page sur l’importation des <a href="missing_data.html#missing_data">Données manquantes</a>, car la syntaxe exacte varie selon le type de fichier.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="valeurs-manquantes-dans-r" class="section level2" number="20.2">
<h2>
<span class="header-section-number">20.2</span> Valeurs manquantes dans R<a class="anchor" aria-label="anchor" href="#valeurs-manquantes-dans-r"><i class="fas fa-link"></i></a>
</h2>
<p>Nous explorons ci-dessous les façons dont les données manquantes sont représentées et évaluées dans R.</p>
<div id="na" class="section level3 unnumbered">
<h3>
<code>NA</code><a class="anchor" aria-label="anchor" href="#na"><i class="fas fa-link"></i></a>
</h3>
<p>En R, les valeurs manquantes sont représentées par un mot réservé (spécial) : <code>NA</code> (pour <em>“Non available”</em>). Notez que ce mot est tapé <em>sans</em> guillemets, et ne doit pas être confondu avec une chaîne de caractères “NA” (également une parole des Beatles de la chanson <em>Hey Jude</em>).</p>
<p>Les données manquantes peuvent avoir été encodées de divers manières dans les données brutes, telles que “99”, “Manquant”, “Inconnu”, une valeur de caractère vide “” qui ressemble à un “blanc”, ou un espace simple ” “. Tenez-en compte et réfléchissez à l’opportunité de <a href="missing_data.html#missing_data">les convertir en <code>NA</code> pendant l’importation</a> ou pendant le nettoyage des données avec <code><a href="https://dplyr.tidyverse.org/reference/na_if.html">na_if()</a></code>.</p>
<p>A l’inverse, lors du nettoyage des données, il peut également être pertinent de convertir des <code>NA</code> en “Manquant” (ou autre) avec les fonctions <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code> ou <code><a href="https://forcats.tidyverse.org/reference/fct_explicit_na.html">fct_explicit_na()</a></code> dans le cas des facteurs.</p>
</div>
<div id="na-et-ses-dérivés" class="section level3 unnumbered">
<h3>
<code>NA</code> et ses dérivés<a class="anchor" aria-label="anchor" href="#na-et-ses-d%C3%A9riv%C3%A9s"><i class="fas fa-link"></i></a>
</h3>
<p>La plupart du temps, <code>NA</code> représente une valeur manquante et il n’y a pas besoin de se poser plus de questions que ça. Cependant, dans certaines circonstances, il peut y avoir besoin de <em>variations</em> de <code>NA</code> spécifiques à une classe d’objet (caractère, numérique, etc.). C’est rare, mais ça peut arriver.</p>
<p>Parmi ces cas rares, la création d’une nouvelle colonne avec la fonction <strong>dplyr</strong> <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> est le plus commun. Comme décrit dans la page <a href="cleaning_data.html#cleaning_data">Nettoyage des données et fonctions de base</a>, cette fonction évalue chaque ligne du dataframe, détermine si les lignes répondent à des critères logiques spécifiés (partie droite du code), et attribue la nouvelle valeur correcte (partie gauche du code). <em>Important : toutes les valeurs du côté droit doivent être de la même classe</em>.</p>
<div class="sourceCode" id="cb1007"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># Créer une nouvelle colonne "age_years" à partir de la colonne "age"</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span>  <span class="op">~</span> <span class="va">age</span>,    <span class="co"># si l'unité est années =&gt; garder la valeur originale</span></span>
<span>    <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>, <span class="co"># l'unité est en mois, diviser par 12</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span>      <span class="op">~</span> <span class="va">age</span>,    <span class="co"># si l'unité est manquante, supposer que l'age est en années</span></span>
<span>    <span class="cn">TRUE</span>                 <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span> <span class="co"># sinon, définir age comme valeur manquante</span></span></code></pre></div>
<p>Afin que toutes les valeurs spécifiées du côté droit des équations aient le même type, il faut utiliser des dérivés de <code>NA</code> avec un type connu. Si les autres valeurs de droite sont des chaines de caractères, on peut utiliser <code>NA_character_</code> ou envisager d’utiliser “Manquant” à la place. Si les valeurs sont toutes numériques, utiliser <code>NA_real_</code>. S’il s’agit de dates ou de valeurs logiques, on peut conserver <code>NA</code>.</p>
<ul>
<li>
<code>NA</code> - à utiliser pour les dates ou les booléens VRAI/FAUX<br>
</li>
<li>
<code>NA_character_</code> - à utiliser pour les chaines de caractères<br>
</li>
<li>
<code>NA_real_</code> - pour les valeurs numériques</li>
</ul>
<p>Encore une fois, il est peu probable que vous rencontriez ces variations, hors utilisation de <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> pour créer une nouvelle colonne. Consultez la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/NA.html">documentation R sur NA</a> pour plus d’informations.</p>
</div>
<div id="null" class="section level3 unnumbered">
<h3>
<code>NULL</code><a class="anchor" aria-label="anchor" href="#null"><i class="fas fa-link"></i></a>
</h3>
<p><code>NULL</code> est un autre mot réservée en R. C’est la représentation logique d’une déclaration qui n’est ni vraie ni fausse. Elle est retournée par des expressions ou des fonctions dont les valeurs sont indéfinies. En général, n’assignez pas NULL comme valeur, à moins d’écrire des fonctions ou peut-être une <a href="rbasics.html#shiny"><strong>shiny</strong> app</a> pour retourner <code>NULL</code> dans des scénarios spécifiques.</p>
<p>La nullité peut être évaluée avec <code><a href="https://rdrr.io/r/base/NULL.html">is.null()</a></code> et la conversion peut être faite avec <code><a href="https://rdrr.io/r/base/NULL.html">as.null()</a></code>.</p>
<p>Voir cet <a href="https://www.r-bloggers.com/2010/04/r-na-vs-null/">article de blog</a> sur la différence entre <code>NULL</code> et <code>NA</code>.</p>
</div>
<div id="nan" class="section level3 unnumbered">
<h3>
<code>NaN</code><a class="anchor" aria-label="anchor" href="#nan"><i class="fas fa-link"></i></a>
</h3>
<p>Les valeurs <em>impossibles</em> sont représentées par le mot spécial <code>NaN</code>. Par exemple, R renvoi <code>NaN</code> si vous lui demandez de diviser 0 par 0. <code>NaN</code> peut être évalué avec <code><a href="https://rdrr.io/r/base/is.finite.html">is.nan()</a></code>. Il existe également des fonctions complémentaires comme <code><a href="https://rdrr.io/r/base/is.finite.html">is.infinite()</a></code> et <code><a href="https://rdrr.io/r/base/is.finite.html">is.finite()</a></code>.</p>
</div>
<div id="inf" class="section level3 unnumbered">
<h3>
<code>Inf</code><a class="anchor" aria-label="anchor" href="#inf"><i class="fas fa-link"></i></a>
</h3>
<p><code>Inf</code> représente une valeur infinie, telle que l’on peut par exemple obtenir en divisant un nombre par zéro.</p>
</div>
<div id="exemples-1" class="section level3 unnumbered">
<h3>Exemples<a class="anchor" aria-label="anchor" href="#exemples-1"><i class="fas fa-link"></i></a>
</h3>
<p>Pour comprendre comment ce type de valeurs peuvent affecter vos analyses, imaginons que vous avez un vecteur <code>z</code> qui contient ces valeurs : <code>z &lt;- c(1, 22, NA, Inf, NaN, 5)</code>.</p>
<p>Si vous voulez utiliser la fonction <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code> sur la colonne pour trouver la valeur la plus élevée, vous pouvez utiliser le <code>na.rm = TRUE</code> pour omettre le <code>NA</code> du calcul. Mais cela n’enlèvera pas les <code>Inf</code> et <code>NaN</code>, ce qui fait que le résultat retourné sera <code>Inf</code>. Pour résoudre ce problème, vous pouvez utiliser les crochets <code>[ ]</code> et <code><a href="https://rdrr.io/r/base/is.finite.html">is.finite()</a></code> pour effectuer un sous-ensemble de sorte que seules les valeurs finies soient utilisées pour le calcul : <code>max(z[is.finite(z)])</code>.</p>
<div class="sourceCode" id="cb1008"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">22</span>, <span class="cn">NA</span>, <span class="cn">Inf</span>, <span class="cn">NaN</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>                           <span class="co"># retourne NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">z</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>                  <span class="co"># retourne Inf</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.finite</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>             <span class="co"># retourne 22</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="41%">
<col width="58%">
</colgroup>
<thead><tr class="header">
<th>Instruction R</th>
<th>Sortie</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>5 / 0</code></td>
<td><code>Inf</code></td>
</tr>
<tr class="even">
<td><code>0 / 0</code></td>
<td><code>NaN</code></td>
</tr>
<tr class="odd">
<td><code>5 / NA</code></td>
<td><code>NA</code></td>
</tr>
<tr class="even">
<td>
<code>5 / Inf |</code>0<code></code>NA - 5<code>|</code>NA<code></code>Inf / 5<code>|</code>Inf<code></code>class(NA)<code>| "logical"</code>class(NaN)<code>| "numeric"</code>class(Inf)<code>| "numeric"</code>class(NULL)`</td>
<td>“NULL”</td>
</tr>
</tbody>
</table></div>
<p>Un message d’avertissement que vous rencontrerez certainement est “NAs introduits par coercition”. Cela peut se produire si vous tentez d’effectuer une conversion illégale, par exemple en insérant une chaîne caractères dans un vecteur qui contient des valeurs numériques.</p>
<div class="sourceCode" id="cb1009"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"10"</span>, <span class="st">"20"</span>, <span class="st">"thirty"</span>, <span class="st">"40"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre><code>## [1] 10 20 NA 40</code></pre>
<p>Note : <code>NULL</code> est ignoré dans un vecteur.</p>
<div class="sourceCode" id="cb1012"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="cn">NA</span>, <span class="fl">10</span>, <span class="cn">NULL</span><span class="op">)</span>  <span class="co"># définit</span></span>
<span><span class="va">my_vector</span>                         <span class="co"># affiche</span></span></code></pre></div>
<pre><code>## [1] 25 NA 10</code></pre>
<p>Note : tenter de calculer la variance sur une valeur unique retourne également un <code>NA</code>.</p>
<div class="sourceCode" id="cb1014"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="fl">22</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="fonctions-utiles" class="section level2" number="20.3">
<h2>
<span class="header-section-number">20.3</span> Fonctions utiles<a class="anchor" aria-label="anchor" href="#fonctions-utiles"><i class="fas fa-link"></i></a>
</h2>
<p>Voici quelques fonctions utiles en <strong>base</strong> R pour détecter et gérer les valeurs manquantes.</p>
<div id="is.na-et-is.na" class="section level3 unnumbered">
<h3>
<code>is.na()</code> et <code>!is.na()</code><a class="anchor" aria-label="anchor" href="#is.na-et-is.na"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> permet d’identifier les valeurs manquantes. Pour identifier les valeurs non manquantes il suffit d’utiliser son opposé en ajoutant <code>!</code> devant l’instruction. Ces deux méthodes retournent une valeur logique (<code>TRUE</code> ou <code>FALSE</code>). Pour rappel, il est possible de sommer le vecteur résultant avec <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> pour compter le nombre de <code>TRUE</code>. Par exemple : <code>sum(is.na(linelist$date_outcome))</code>.</p>
<div class="sourceCode" id="cb1016"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">56</span>, <span class="cn">NA</span>, <span class="fl">5</span>, <span class="cn">NA</span>, <span class="fl">22</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">my_vector</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE  TRUE FALSE  TRUE FALSE</code></pre>
<div class="sourceCode" id="cb1018"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">my_vector</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE  TRUE FALSE  TRUE</code></pre>
<div class="sourceCode" id="cb1020"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">my_vector</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 2</code></pre>
</div>
<div id="na.omit" class="section level3 unnumbered">
<h3>
<code>na.omit()</code><a class="anchor" aria-label="anchor" href="#na.omit"><i class="fas fa-link"></i></a>
</h3>
<p>Appliquée à un dataframe, cette fonction de <strong>base</strong> R supprimera les lignes dont <em>toutes</em> les valeurs sont manquantes. Appliquée à un vecteur, elle supprimera les valeurs <code>NA</code> de ce vecteur. Par exemple :</p>
<div class="sourceCode" id="cb1022"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">my_vector</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1]  1  4 56  5 22
## attr(,"na.action")
## [1] 4 6
## attr(,"class")
## [1] "omit"</code></pre>
</div>
<div id="drop_na" class="section level3 unnumbered">
<h3>
<code>drop_na()</code><a class="anchor" aria-label="anchor" href="#drop_na"><i class="fas fa-link"></i></a>
</h3>
<p>Il s’agit d’une fonction de <strong>tidyr</strong> utile pour <a href="cleaning_data.html#cleaning_data">nettoyer des données dans un pipeline</a>. Si elle est exécutée sans argument, elle supprime également les lignes dont <em>toutes</em> les valeurs sont manquantes. Mais si des noms de colonnes sont spécifiés comme arguments, seules les lignes avec des valeurs manquantes dans ces colonnes seront supprimées.</p>
<p>Note : on peut utiliser la syntaxe “tidyselect” pour spécifier les colonnes.</p>
<div class="sourceCode" id="cb1024"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">date_onset</span>, <span class="va">age</span><span class="op">)</span> <span class="co"># omet les lignes contenant des valeurs manquantes dans une de ces colonnes au moins</span></span></code></pre></div>
</div>
<div id="na.rm-true" class="section level3 unnumbered">
<h3>
<code>na.rm = TRUE</code><a class="anchor" aria-label="anchor" href="#na.rm-true"><i class="fas fa-link"></i></a>
</h3>
<p>Lorsque vous exécutez une fonction mathématique telle que <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code>, <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> ou <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, la valeur retournée est <code>NA</code> si des valeurs <code>NA</code> sont présentes dans les données. Ce comportement par défaut est intentionnel, afin que vous soyez alerté si l’une de vos données est manquante.</p>
<p>Vous pouvez éviter cela en supprimant les valeurs manquantes du calcul. Pour ce faire, incluez l’argument <code>na.rm = TRUE</code> (le “rm” étant une abréviation de “remove”).</p>
<div class="sourceCode" id="cb1025"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">56</span>, <span class="cn">NA</span>, <span class="fl">5</span>, <span class="cn">NA</span>, <span class="fl">22</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">my_vector</span><span class="op">)</span>     </span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb1027"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">my_vector</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 17.6</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="identifier-les-valeurs-manquantes-dans-un-dataframe" class="section level2" number="20.4">
<h2>
<span class="header-section-number">20.4</span> Identifier les valeurs manquantes dans un dataframe<a class="anchor" aria-label="anchor" href="#identifier-les-valeurs-manquantes-dans-un-dataframe"><i class="fas fa-link"></i></a>
</h2>
<p>Le package <strong>naniar</strong> permet de détecter et de visualiser l’ampleur de la complétude des données (et donc de leur non-complétude) dans un tableau de données.</p>
<div class="sourceCode" id="cb1029"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># installer et charger le paquet</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">naniar</span><span class="op">)</span></span></code></pre></div>
<div id="quantifier-les-données-manquantes" class="section level3 unnumbered">
<h3>Quantifier les données manquantes<a class="anchor" aria-label="anchor" href="#quantifier-les-donn%C3%A9es-manquantes"><i class="fas fa-link"></i></a>
</h3>
<p>La fonction <code>pct_miss()</code> permet de calculer le pourcentage de toutes les valeurs manquantes. La fonction <code>n_miss()</code> renvoi le nombre de valeurs manquantes.</p>
<div class="sourceCode" id="cb1030"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pourcentage de données manquantes sur TOUTES les valeurs du dataframe</span></span>
<span><span class="fu">pct_miss</span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 6.688745</code></pre>
<p>Les deux fonctions ci-dessous renvoient le pourcentage de lignes dont une valeur est manquante ou qui sont entièrement complètes.</p>
<p>Note : <code>NA</code> signifie manquant, mais que `<code>""</code> ou <code>""</code> ne sont pas considérées comme des valeurs manquantes.</p>
<div class="sourceCode" id="cb1032"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pourcentage des lignes avec au moins une valeur manquante</span></span>
<span><span class="fu">pct_miss_case</span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span>   <span class="co"># utiliser n_miss() pour le nombre de lignes</span></span></code></pre></div>
<pre><code>## [1] 69.12364</code></pre>
<div class="sourceCode" id="cb1034"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pourcentage des lignes sans valeur manquante</span></span>
<span><span class="fu">pct_complete_case</span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span> <span class="co"># utiliser n_complete() pour le nombre</span></span></code></pre></div>
<pre><code>## [1] 30.87636</code></pre>
</div>
<div id="visualiser-les-données-manquantes" class="section level3 unnumbered">
<h3>Visualiser les données manquantes<a class="anchor" aria-label="anchor" href="#visualiser-les-donn%C3%A9es-manquantes"><i class="fas fa-link"></i></a>
</h3>
<p>La fonction <code>gg_miss_var()</code> renvoi le nombre (ou %) de valeurs manquantes dans chaque colonne. Quelques notes :</p>
<ul>
<li><p>Il est possible d’ajouter un nom de colonne (pas entre guillemets) à l’argument <code>facet =</code> pour voir le graphique par groupe.</p></li>
<li><p>Les nombres sont affichés par défaut. Utilisez <code>show_pct = TRUE</code> pour voir les pourcentages, .</p></li>
<li><p>Il est possible d’ajouter des étiquettes d’axe et de titre comme pour un <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> normal avec <code>+ labs(...)</code>.</p></li>
</ul>
<div class="sourceCode" id="cb1036"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gg_miss_var</span><span class="op">(</span><span class="va">linelist</span>, show_pct <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-772-1.png" width="672"></div>
<p>Ici, les données sont passées à la fonction à l’aide d’un pipe <code>%&gt;%</code>. L’argument <code>facet =</code> est utilisé pour séparer les données par outcome.</p>
<div class="sourceCode" id="cb1037"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">gg_miss_var</span><span class="op">(</span>show_pct <span class="op">=</span> <span class="cn">TRUE</span>, facet <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-773-1.png" width="672"></div>
<p>La fonction <code>vis_miss()</code> permet de visualiser le dataframe sous forme de carte thermique qui indique quelle valeur est manquante. Vous pouvez également <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> certaines colonnes du cadre de données et ne fournir que ces colonnes à la fonction.</p>
<div class="sourceCode" id="cb1038"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Carte thermique de la complétude des données à l'échelle du dataframe</span></span>
<span><span class="fu">vis_miss</span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-774-1.png" width="672"></div>
</div>
<div id="explorer-et-visualiser-les-relations-entre-données-manquantes" class="section level3 unnumbered">
<h3>Explorer et visualiser les relations entre données manquantes<a class="anchor" aria-label="anchor" href="#explorer-et-visualiser-les-relations-entre-donn%C3%A9es-manquantes"><i class="fas fa-link"></i></a>
</h3>
<p>Comment visualiser quelque chose qui n’existe pas ??? Par défaut, <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> n’affiche pas les points avec des valeurs manquantes dans les graphiques.</p>
<p>Le package <strong>naniar</strong> propose une solution via la fonction <code>geom_miss_point()</code>. Lors de la création d’un nuage de points à partir de deux variables, les paires de valeurs dont l’une est manquante sont montrés en fixant les valeurs manquante à 10% plus bas que la valeur minimale de la colonne, et en les colorant différemment.</p>
<p>Dans le nuage de points ci-dessous, les points rouges sont des enregistrements où la valeur d’une des deux colonne est présente mais où l’autre est manquante. Cela permet de visualiser la distribution des valeurs manquantes par rapport à celle des valeurs non manquantes.</p>
<div class="sourceCode" id="cb1039"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">linelist</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_years</span>, y <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>     </span>
<span>  <span class="fu">geom_miss_point</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-775-1.png" width="672"></div>
<p>Pour évaluer les données manquantes dans un dataframe en <em>stratifiant par une autre colonne</em>, on peut utiliser la fonction <code>gg_miss_fct()</code>, qui retourne une carte thermique du pourcentage de valeurs manquantes dans le dataframe <em>pour chaque catégorie d’une autre variable</em> :</p>
<div class="sourceCode" id="cb1040"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gg_miss_fct</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">age_cat5</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-776-1.png" width="672"></div>
<p>Cette fonction peut aussi être utilisée sur une colonne contenant des dates pour voir comment la complétude des données change au cours du temps :</p>
<div class="sourceCode" id="cb1041"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gg_miss_fct</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Removed 29 rows containing missing values (`geom_tile()`).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-777-1.png" width="672"></div>
</div>
<div id="colonnes-fantômes" class="section level3 unnumbered">
<h3>Colonnes “fantômes”<a class="anchor" aria-label="anchor" href="#colonnes-fant%C3%B4mes"><i class="fas fa-link"></i></a>
</h3>
<p><strong>naniar</strong> donne la possibilité de créer un jeu de données “fantôme” (“shadow matrix” en Anglais) pour aller plus loin dans l’étude de la distribution des données manquantes. Essentiellement, pour chaque colonne existante la fonction <code>bind_shadow()</code> crée une nouvelle colonne binaire contenant soit <code>NA</code>, soit <code>!NA</code> (pour “non <code>NA</code>”), et lie toutes ces nouvelles colonnes au jeu de données original avec l’appendice “_NA”. Cela double le nombre de colonnes du jeu de données :</p>
<div class="sourceCode" id="cb1043"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shadowed_linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">bind_shadow</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">shadowed_linelist</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "case_id"                 "generation"              "date_infection"         
##  [4] "date_onset"              "date_hospitalisation"    "date_outcome"           
##  [7] "outcome"                 "gender"                  "age"                    
## [10] "age_unit"                "age_years"               "age_cat"                
## [13] "age_cat5"                "hospital"                "lon"                    
## [16] "lat"                     "infector"                "source"                 
## [19] "wt_kg"                   "ht_cm"                   "ct_blood"               
## [22] "fever"                   "chills"                  "cough"                  
## [25] "aches"                   "vomit"                   "temp"                   
## [28] "time_admission"          "bmi"                     "days_onset_hosp"        
## [31] "case_id_NA"              "generation_NA"           "date_infection_NA"      
## [34] "date_onset_NA"           "date_hospitalisation_NA" "date_outcome_NA"        
## [37] "outcome_NA"              "gender_NA"               "age_NA"                 
## [40] "age_unit_NA"             "age_years_NA"            "age_cat_NA"             
## [43] "age_cat5_NA"             "hospital_NA"             "lon_NA"                 
## [46] "lat_NA"                  "infector_NA"             "source_NA"              
## [49] "wt_kg_NA"                "ht_cm_NA"                "ct_blood_NA"            
## [52] "fever_NA"                "chills_NA"               "cough_NA"               
## [55] "aches_NA"                "vomit_NA"                "temp_NA"                
## [58] "time_admission_NA"       "bmi_NA"                  "days_onset_hosp_NA"</code></pre>
<p>Ces colonnes “fantômes” peuvent être utilisées pour visualiser la proportion de valeurs manquantes dans une colonne en fonction d’une autre colonne.</p>
<p>Par exemple, le graphique ci-dessous montre la proportion de données manquantes dans la colonne <code>days_onset_hosp</code> (le nombre de jours entre l’apparition des symptômes et l’hospitalisation), en fonction de la <code>date_hospitalisation</code>. Ici on trace la densité de données manquantes et non manquantes (<code>color =</code>) en fonction de la date d’hospitalisation.</p>
<p>Ce type de visualisation fonctionne mieux si la variable tracée en sur l’axe des abscisses est numérique ou temporelle.</p>
<div class="sourceCode" id="cb1045"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">shadowed_linelist</span>,   <span class="co"># dataframe augmenté avec les colonnes fantômes</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_hospitalisation</span>, <span class="co"># colonne numérique ou date</span></span>
<span>                colour <span class="op">=</span> <span class="va">age_years_NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># colonne fantôme d'intérêt</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="op">)</span>                          <span class="co"># trace les courbes de densité</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-779-1.png" width="672"></div>
<p>Les colonnes fantômes peuvent aussi être utilisé comme stratification dans des statistiques descriptives :</p>
<div class="sourceCode" id="cb1046"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">bind_shadow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                <span class="co"># création des colonnes fantômes</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">date_outcome_NA</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>    <span class="co"># groupe par la colonne fantôme de date_outcome</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span></span>
<span>    .cols <span class="op">=</span> <span class="va">age_years</span>,             <span class="co"># variable d'intérêt à résumer</span></span>
<span>    .fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"mean"</span> <span class="op">=</span> <span class="va">mean</span>,     <span class="co"># statistiques</span></span>
<span>                <span class="st">"sd"</span>  <span class="op">=</span> <span class="va">sd</span>,</span>
<span>                <span class="st">"var"</span> <span class="op">=</span> <span class="va">var</span>,</span>
<span>                <span class="st">"min"</span> <span class="op">=</span> <span class="va">min</span>,</span>
<span>                <span class="st">"max"</span> <span class="op">=</span> <span class="va">max</span><span class="op">)</span>,  </span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>                 <span class="co"># autres arguments des fonctions statistiques</span></span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
##   date_outcome_NA age_years_mean age_years_sd age_years_var age_years_min age_years_max
##   &lt;fct&gt;                    &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
## 1 !NA                       16.0         12.6          158.             0            84
## 2 NA                        16.2         12.9          167.             0            69</code></pre>
<p><strong>naniar</strong> n’est pas le seul outil pour représenter la proportion de valeurs manquantes dans une colonne en fonction du temps. On peut aussi manuellement :</p>
<ol style="list-style-type: decimal">
<li><p>Agréger les données dans une unité de temps pertinente (jours, semaines, etc.), en résumant la proportion d’observations avec <code>NA</code> (et toute autre valeur d’intérêt).</p></li>
<li><p>Tracez la proportion de données manquantes comme une ligne en utilisant <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>.</p></li>
</ol>
<p>Dans l’exemple ci-dessous, nous ajoutons une nouvelle colonne pour la semaine à la linelist, regroupons les données par semaine, puis calculons le pourcentage des enregistrements de cette semaine où la valeur est manquante. (note : si vous voulez le % de 7 jours, le calcul sera légèrement différent).</p>
<div class="sourceCode" id="cb1048"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outcome_missing</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>   <span class="co"># crée colonne semaine</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>      <span class="co"># groupe les lignes par semaine</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>              <span class="co"># pour chaque semaine, résumme : </span></span>
<span>    n_obs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,          <span class="co"># nombre total d'observations</span></span>
<span>    outcome_missing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">|</span> <span class="va">outcome</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span>,  <span class="co"># nombre d'obs avec valeur manquante</span></span>
<span>    outcome_p_miss  <span class="op">=</span> <span class="va">outcome_missing</span> <span class="op">/</span> <span class="va">n_obs</span>,    <span class="co"># proportion d'obs avec valeur manquante</span></span>
<span>  </span>
<span>    outcome_dead    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,     <span class="co"># nb de morts</span></span>
<span>    outcome_p_dead  <span class="op">=</span> <span class="va">outcome_dead</span> <span class="op">/</span> <span class="va">n_obs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>             <span class="co"># prop morts</span></span>
<span>  </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">week</span>, names_to <span class="op">=</span> <span class="st">"statistic"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>    <span class="co"># pivote toutes les colonnes sauf la semaine en format long</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">statistic</span>, <span class="st">"_p_"</span><span class="op">)</span><span class="op">)</span>   <span class="co"># garde uniquement les proportions</span></span></code></pre></div>
<p>Ensuite, nous traçons la proportion de données manquantes par semaine, sous forme de ligne.<br>
Référez vous à la page <a href="ggplot_basics.html#ggplot_basics">bases de ggplot</a> si vous n’êtes pas familier avec le package <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb1049"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">outcome_missing</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span></span>
<span>      mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, </span>
<span>                    y <span class="op">=</span> <span class="va">value</span>, </span>
<span>                    group <span class="op">=</span> <span class="va">statistic</span>, </span>
<span>                    color <span class="op">=</span> <span class="va">statistic</span><span class="op">)</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Weekly outcomes"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Week"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Proportion of weekly records"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_color_discrete</a></span><span class="op">(</span></span>
<span>       name <span class="op">=</span> <span class="st">""</span>,</span>
<span>       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Died"</span>, <span class="st">"Missing outcome"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-782-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="utiliser-des-données-avec-des-valeurs-manquantes" class="section level2" number="20.5">
<h2>
<span class="header-section-number">20.5</span> Utiliser des données avec des valeurs manquantes<a class="anchor" aria-label="anchor" href="#utiliser-des-donn%C3%A9es-avec-des-valeurs-manquantes"><i class="fas fa-link"></i></a>
</h2>
<div id="filtrer-les-lignes-avec-valeurs-manquantes" class="section level3 unnumbered">
<h3>Filtrer les lignes avec valeurs manquantes<a class="anchor" aria-label="anchor" href="#filtrer-les-lignes-avec-valeurs-manquantes"><i class="fas fa-link"></i></a>
</h3>
<p>La fonction <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code> de <strong>dplyr</strong> permet de se débarrasser rapidement des lignes avec des valeurs manquantes.</p>
<p>La linelist originale contient <code>nrow(linelist)</code> lignes. La linelist sans lignes avec des valeurs manquantes contient moins de lignes :</p>
<div class="sourceCode" id="cb1050"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>     <span class="co"># filtre les lignes sans aucune valeur manquante</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 1818</code></pre>
<p>On peut choisir de ne se débarrasser des lignes avec des valeurs manquantes que dans certaines colonnes :</p>
<div class="sourceCode" id="cb1052"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># omet les lignes avec des valeurs manquantes dans date_onset</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 5632</code></pre>
<p>On peut passer plusieurs colonnes l’une après l’autre à la fonction, ou utiliser des <a href="cleaning_data.html#clean_tidyselect">fonctions utilitaires de “tidyselect”</a>:</p>
<div class="sourceCode" id="cb1054"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># omet lignes avec NA dans n'importe quelle colonne dont le nom contient "date"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 3029</code></pre>
<!-- ======================================================= -->
</div>
<div id="gérer-les-na-dans-ggplot" class="section level3 unnumbered">
<h3>Gérer les <code>NA</code> dans <code>ggplot()</code><a class="anchor" aria-label="anchor" href="#g%C3%A9rer-les-na-dans-ggplot"><i class="fas fa-link"></i></a>
</h3>
<p>Il est souvent judicieux de signaler le nombre de valeurs exclues d’un graphique au lecteur du graphique.</p>
<p>Dans <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, la fonction <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code>a un argument <code>caption =</code> qui ajoute un texte de légende sous le graphique. On peut utiliser <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> du package <strong>stringr</strong> pour concaténer valeurs et chaînes de caractères ensemble dans une phrase qui s’ajuste automatiquement aux données (voir exemple ci-dessous).</p>
<div class="sourceCode" id="cb1056"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">""</span>,</span>
<span>  y <span class="op">=</span> <span class="st">""</span>,</span>
<span>  x <span class="op">=</span> <span class="st">""</span>,</span>
<span>  caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span></span>
<span>  <span class="st">"n = {nrow(central_data)} du Central Hospital;</span></span>
<span><span class="st">  {nrow(central_data %&gt;% filter(is.na(date_onset)))} cas sans date de début des symptomes et non représentés"</span><span class="op">)</span><span class="op">)</span>  </span></code></pre></div>
<p>Notes :<br>
* l’utilisation de <code>\n</code> pour aller à la ligne.<br>
* si plusieurs colonnes contribuent à ce que des valeurs ne soient pas affichées (par exemple, l’âge ou le sexe si ceux-ci sont reflétés dans le graphique), il faut également filtrer sur ces colonnes pour calculer correctement le nombre de valeurs non affichées.
* on peut sauvegarder la chaîne de caractères en tant qu’objet dans des commandes antérieures à la commande <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, et simplement la référencer dans la <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code>.</p>
<!-- ======================================================= -->
</div>
<div id="na-dans-les-facteurs" class="section level3 unnumbered">
<h3>
<code>NA</code> dans les facteurs<a class="anchor" aria-label="anchor" href="#na-dans-les-facteurs"><i class="fas fa-link"></i></a>
</h3>
<p>Si votre colonne d’intérêt est un facteur, utilisez <code><a href="https://forcats.tidyverse.org/reference/fct_explicit_na.html">fct_explicit_na()</a></code> du package <strong>forcats</strong> pour convertir les valeurs <code>NA</code> en une chaîne de caractères (plus de détails dans la page <a href="factors.html#factors">Facteurs</a>. Par défaut, la nouvelle valeur est “(Missing)” mais cela peut être ajusté via l’argument <code>na_level =</code>.</p>
<div class="sourceCode" id="cb1057"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">forcats</span><span class="op">)</span>   <span class="co"># charge le package</span></span>
<span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_explicit_na.html">fct_explicit_na</a></span><span class="op">(</span><span class="va">gender</span>, na_level <span class="op">=</span> <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "f"       "m"       "Missing"</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="imputation" class="section level2" number="20.6">
<h2>
<span class="header-section-number">20.6</span> Imputation<a class="anchor" aria-label="anchor" href="#imputation"><i class="fas fa-link"></i></a>
</h2>
<p>Lors de certaines analyses de données, il est nécessaire de “combler les lacunes” et d’imputer les données manquantes. En effet, s’il est souvent possible d’analyser un jeu de données après en avoir supprimé toutes les valeurs manquantes, cela peut néanmoins poser des problèmes à plusieurs égards. Voici deux exemples :</p>
<ol style="list-style-type: decimal">
<li><p>Supprimer toutes les observations avec des valeurs manquantes, ou les variables avec beaucoup de données manquantes peut réduire considérablement la puissance et la capacité à effectuer certains types d’analyse. Par exemple, nous avons vu que seule une faible fraction des lignes de notre linelist ne comporte <em>aucune</em> donnée manquante. Si nous supprimions toutes les lignes contenant au moins une donnée manquante, nous perdrions beaucoup d’informations ! De plus, la plupart de nos variables comportent une certaine quantité de données manquantes - pour la plupart des analyses, il n’est probablement pas raisonnable de <em>toutes</em> les éliminer.</p></li>
<li><p>Selon la raison pour laquelle vos données sont manquantes, l’analyse des données non manquantes seules peut conduire à des biais et des résultats trompeurs. Par exemple, nous avons vu que de nombreux patients ont des données manquantes dans les colonnes concernant des symptômes importants, comme la fièvre ou la toux. Il est possible que cette information n’ait pas été enregistrée pour les personnes qui ne paraissaient pas sévèrement malades. Dans ce cas, si nous supprimions simplement ces observations, nous exclurions une partie des patients en meilleure santé de notre analyse, ce qui pourrait vraiment biaiser les résultats.</p></li>
</ol>
<p>In ne suffit pas seulement d’estimer la quantité de données manquantes, il est également capital de réfléchir à la <em>raison pour laquelle les données peuvent manquer</em>. Cela va guider vos choix quant à l’importance de l’imputation des données manquantes, ainsi que de la méthode d’imputation la plus appropriée à votre situation.</p>
<div id="types-de-données-manquantes" class="section level3 unnumbered">
<h3>Types de données manquantes<a class="anchor" aria-label="anchor" href="#types-de-donn%C3%A9es-manquantes"><i class="fas fa-link"></i></a>
</h3>
<p>Voici les trois grands types de données manquantes, qui correspondent à des mécanismes différents de non-réponse :</p>
<ol style="list-style-type: decimal">
<li><p><strong>Données manquantes de manière complètement aléatoire</strong> (MMCA) (on trouvera souvent l’acronyme anglais MCAR, pour “Missing Completely at Random”). Dans ce cas, il n’y a pas de relation entre la probabilité de manquer et les autres variables de vos données (ou avec des variables non mesurées). <strong>La probabilité d’être manquante est la même pour tous les cas</strong>. C’est une situation rare. Néanmoins, si vous avez de bonnes raisons de penser que vos données sont MMCA, l’analyse des données non manquantes (sans imputation) ne faussera pas les résultats (malgré une possible perte de puissance).</p></li>
<li><p><strong>Données manquantes aléatoirement</strong> (MA, ou MAR en Anglais pour “Missing at Random”. Ce nom est en fait un peu trompeur car MA signifie que les données sont manquantes de manière systématique et prévisible en fonction d’autres variables mesurées. Par exemple, dans notre cas, les docteurs auraient pu considérer que les patients présentant des frissons et des courbatures ont nécessairement de la fièvre, et n’ont pas pris leur température. Cela aboutit à des observations manquantes dans la colonne fièvre, aisément prévisibles grâce aux colonnes frissons et courbatures. Si c’est vrai, nous pourrions facilement prédire que chaque observation manquante avec des frissons et des courbatures a également de la fièvre et utiliser cette information pour imputer nos données manquantes. Dans la pratique, c’est souvent plus compliqué: si un patient présente à la fois des frissons et des courbatures, il est probable qu’il ait également de la fièvre, mais pas toujours. Les données MA sont prévisibles, mais la prédiction n’est jamais parfaite. Il s’agit d’un type très courant de données manquantes</p></li>
<li><p><strong>Données manquantes par omission prévisible</strong> (MOP) aussi appelées <strong>Données manquantes non aléatoirement</strong> (MNAR ou NMAR en Anglais, pour “Missing not at Random” ou “Not Missing at Random”). Dans ce cas, la probabilité qu’une valeur soit manquante n’est <em>PAS</em> systématique ou prévisible à l’aide des autres informations dont nous disposons, mais elle n’est pas non plus manquante au hasard. Les données manquent pour des raisons inconnues, sur lesquelles vous n’avez aucune information. La valeur de la variable manquante est liée à la raison pour laquelle elle est manquante. Par exemple, dans nos données, l’age du patient peut manquer parce que certains patients très âgés ne savent pas ou refusent de dire quel âge ils ont. Dans cette situation, les données manquantes sur l’âge sont liées à la valeur elle-même, ne sont donc pas aléatoires ni prévisibles sur la base des autres informations dont nous disposons. Ce mécanisme de non-réponse est <em>non-ignorable</em>, complexe et souvent, la meilleure façon d’y faire face est d’essayer de collecter plus de données ou d’informations sur la raison pour laquelle les données sont manquantes plutôt que de tenter de les imputer.</p></li>
</ol>
<p>En général, imputer des données MA est relativement simple, mais imputer des données MOP est complexe, difficile et souvent impossible. La plupart des méthodes d’imputation les plus répandues font l’hypothèse que les données sont de type MA.</p>
</div>
<div id="packages-utiles" class="section level3 unnumbered">
<h3>Packages utiles<a class="anchor" aria-label="anchor" href="#packages-utiles"><i class="fas fa-link"></i></a>
</h3>
<p>Voici un certain nombre de packages utiles pour l’imputation des données : <strong>Mmisc</strong>, <strong>missForest</strong> (qui utilise les forêts aléatoires pour imputer les données manquantes) et <strong>mice</strong> (Multivariate Imputation by Chained Equations). Dans cette section, nous nous focaliserons sur le paquet <strong>mice</strong>, qui met en œuvre diverses techniques. Le responsable du paquet <strong>mice</strong> a publié un <a href="https://stefvanbuuren.name/fimd/">livre détaillé accessible en ligne gratuitement</a> sur l’imputation des données manquantes.</p>
<p>Voici le code pour charger le paquetage <strong>mice</strong> :</p>
<div class="sourceCode" id="cb1059"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">mice</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="imputation-par-la-moyenne" class="section level3 unnumbered">
<h3>Imputation par la moyenne<a class="anchor" aria-label="anchor" href="#imputation-par-la-moyenne"><i class="fas fa-link"></i></a>
</h3>
<p>Parfois, dans le cas d’analyses simples ou s’il y a de bonnes raisons de penser que que les données sont de type MA, il est possible de simplement remplacer les valeurs manquantes d’une variable par la moyenne de cette variable. Par exemple, nous pourrions avoir de bonnes raisons de penser que les mesures de température manquantes dans nos données étaient MA ou normales. Voici le code permettant de créer une nouvelle variable qui remplace les valeurs de température manquantes par la valeur de température moyenne de notre ensemble de données.</p>
<p>Il faut rester prudent, car dans de nombreuses situations, le remplacement des données manquantes par la moyenne peut entraîner un biais.</p>
<div class="sourceCode" id="cb1060"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>temp_replace_na_with_mean <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">temp</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">temp</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>On peut procéder de la même manière pour remplacer des données catégoriques par une valeur spécifique. Dans nos données, imaginez que vous sachiez que toutes les observations pour lesquelles il manque une valeur de décharge (qui peut être “Décès” ou “Guéri”) sont en fait des personnes décédées (remarque : ce n’est pas réellement vrai pour cet ensemble de données).</p>
<div class="sourceCode" id="cb1061"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>outcome_replace_na_with_death <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="st">"Death"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="imputation-par-régression" class="section level3 unnumbered">
<h3>Imputation par régression<a class="anchor" aria-label="anchor" href="#imputation-par-r%C3%A9gression"><i class="fas fa-link"></i></a>
</h3>
<p>Une méthode un peu plus avancée consiste à utiliser un modèle statistique pour prédire les valeurs manquantes et les remplacer. Par exemple, on pourrait imaginer utiliser une régression linéaire simple avec l’état de la fièvre et l’age pour prédire la température lorsque celle-ci est manquante. Dans la vie réelle, il vaut mieux utiliser des modèles plus avancés qu’une approche aussi simple.</p>
<div class="sourceCode" id="cb1062"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_temperature_model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">temp</span> <span class="op">~</span> <span class="va">fever</span> <span class="op">+</span> <span class="va">age_years</span>, </span>
<span>                                   data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Nous utilisons un modèle linéaire simple avec la température comme variable réponse pour prédire les valeurs de température manquantes</span></span>
<span><span class="va">predictions_for_missing_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">simple_temperature_model_fit</span>,</span>
<span>                                         newdata <span class="op">=</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                                              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>On peut utiliser la même approche d’imputation par régression avec le package <strong>mice</strong> pour imputer les les observations de température manquantes :</p>
<div class="sourceCode" id="cb1063"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_dataset</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">fever</span>, <span class="va">age_years</span><span class="op">)</span>  </span>
<span></span>
<span><span class="va">temp_imputed</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="op">(</span><span class="va">model_dataset</span>,</span>
<span>                            method <span class="op">=</span> <span class="st">"norm.predict"</span>,</span>
<span>                            seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            m <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            print <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Number of logged events: 1</code></pre>
<div class="sourceCode" id="cb1065"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_imputed_values</span> <span class="op">&lt;-</span> <span class="va">temp_imputed</span><span class="op">$</span><span class="va">imp</span><span class="op">$</span><span class="va">temp</span></span></code></pre></div>
<p>Il est possible d’utiliser des modèles plus avancés que la régression linéaire simple pour prédire les valeurs manquantes à l’aide d’autres variables. Par exemple, le package <strong>missForest</strong> utilise les forêts aléatoires pour prédire les valeurs des données manquantes.</p>
<p>Quel que soit le modèle statistique utilisé pour modéliser les valeurs manquantes, il faut se rappeler que cette approche fonctionne bien avec des données MMCA, mais il faut être très prudent si vous pensez que vos données sont de type MA ou MOP.</p>
<p>La qualité de l’imputation dépend de la qualité du modèle de prédiction et même avec un très bon modèle, la variabilité de vos données imputées peut être sous-estimée.</p>
</div>
<div id="report-de-la-dernière-observation-et-baseline" class="section level3 unnumbered">
<h3>Report de la dernière observation et baseline<a class="anchor" aria-label="anchor" href="#report-de-la-derni%C3%A8re-observation-et-baseline"><i class="fas fa-link"></i></a>
</h3>
<p>Lorsque l’on a des données longitudinales ou des séries temporelles, il est parfois pertinent d’utiliser des méthodes d’imputations basées sur le report de la dernière valeur connue (LOCF, pour “Last Observation Carried Forward”) ou le report de la valeur “baseline” (BOCF pour “Baseline Observation Carried Forward”). Concrètement, il s’agit d’utiliser une valeur observée dans le passé et de l’utiliser comme remplacement des données manquantes. Dans le cas de l’imputation LOCF, si plusieurs valeurs sont manquantes à la suite, il faut remonter à la dernière observation non manquante pour ce patient.</p>
<p>La fonction <code><a href="https://tidyr.tidyverse.org/reference/fill.html">fill()</a></code> du package <strong>tidyr</strong> peut être utilisée pour l’imputation LOCF et BOCF (mais d’autres packages tels que <strong>HMISC</strong>, <strong>zoo</strong>, et <strong>data.table</strong> peuvent aussi être utilisés). Pour illustrer la syntaxe de <code><a href="https://tidyr.tidyverse.org/reference/fill.html">fill()</a></code>, nous allons créer un simple ensemble de données de séries temporelles contenant le nombre de cas d’une maladie pour chaque trimestre des années 2000 et 2001. Cependant, la valeur de l’année pour les trimestres postérieurs à Q1 est manquante et nous devrons donc les imputer. La jonction <code><a href="https://tidyr.tidyverse.org/reference/fill.html">fill()</a></code> est également démontrée dans la page <a href="pivoting_data">Restructurer les données</a>.</p>
<div class="sourceCode" id="cb1066"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Création d'un jeu de données</span></span>
<span><span class="va">disease</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">quarter</span>, <span class="op">~</span><span class="va">year</span>, <span class="op">~</span><span class="va">cases</span>,</span>
<span>  <span class="st">"Q1"</span>,    <span class="fl">2000</span>,    <span class="fl">66013</span>,</span>
<span>  <span class="st">"Q2"</span>,      <span class="cn">NA</span>,    <span class="fl">69182</span>,</span>
<span>  <span class="st">"Q3"</span>,      <span class="cn">NA</span>,    <span class="fl">53175</span>,</span>
<span>  <span class="st">"Q4"</span>,      <span class="cn">NA</span>,    <span class="fl">21001</span>,</span>
<span>  <span class="st">"Q1"</span>,    <span class="fl">2001</span>,    <span class="fl">46036</span>,</span>
<span>  <span class="st">"Q2"</span>,      <span class="cn">NA</span>,    <span class="fl">58842</span>,</span>
<span>  <span class="st">"Q3"</span>,      <span class="cn">NA</span>,    <span class="fl">44568</span>,</span>
<span>  <span class="st">"Q4"</span>,      <span class="cn">NA</span>,    <span class="fl">50197</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Imputation ds données manquantes pour l'année (vers le bas par défaut)</span></span>
<span><span class="va">disease</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/fill.html">fill</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
##   quarter  year cases
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 Q1       2000 66013
## 2 Q2       2000 69182
## 3 Q3       2000 53175
## 4 Q4       2000 21001
## 5 Q1       2001 46036
## 6 Q2       2001 58842
## 7 Q3       2001 44568
## 8 Q4       2001 50197</code></pre>
<p><strong>Note</strong> : il faut que les données soient correctement triées avant d’utiliser la fonction <code><a href="https://tidyr.tidyverse.org/reference/fill.html">fill()</a></code>! Par défaut, la fonction <code><a href="https://tidyr.tidyverse.org/reference/fill.html">fill()</a></code> remplit les données <em>vers le bas</em>, mais il est possible d’imputer des valeurs dans différentes directions à l’aide du paramètre <code>.direction</code>. Si nous créons un jeu de données similaire où la valeur de l’année est enregistrée uniquement à la fin de l’année et manquante pour les trimestres précédents :</p>
<div class="sourceCode" id="cb1068"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Création d'un jeu de données</span></span>
<span><span class="va">disease</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">quarter</span>, <span class="op">~</span><span class="va">year</span>, <span class="op">~</span><span class="va">cases</span>,</span>
<span>  <span class="st">"Q1"</span>,      <span class="cn">NA</span>,    <span class="fl">66013</span>,</span>
<span>  <span class="st">"Q2"</span>,      <span class="cn">NA</span>,    <span class="fl">69182</span>,</span>
<span>  <span class="st">"Q3"</span>,      <span class="cn">NA</span>,    <span class="fl">53175</span>,</span>
<span>  <span class="st">"Q4"</span>,    <span class="fl">2000</span>,    <span class="fl">21001</span>,</span>
<span>  <span class="st">"Q1"</span>,      <span class="cn">NA</span>,    <span class="fl">46036</span>,</span>
<span>  <span class="st">"Q2"</span>,      <span class="cn">NA</span>,    <span class="fl">58842</span>,</span>
<span>  <span class="st">"Q3"</span>,      <span class="cn">NA</span>,    <span class="fl">44568</span>,</span>
<span>  <span class="st">"Q4"</span>,    <span class="fl">2001</span>,    <span class="fl">50197</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Imputation des données de l'année "vers le haut"</span></span>
<span><span class="va">disease</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/fill.html">fill</a></span><span class="op">(</span><span class="va">year</span>, .direction <span class="op">=</span> <span class="st">"up"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
##   quarter  year cases
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 Q1       2000 66013
## 2 Q2       2000 69182
## 3 Q3       2000 53175
## 4 Q4       2000 21001
## 5 Q1       2001 46036
## 6 Q2       2001 58842
## 7 Q3       2001 44568
## 8 Q4       2001 50197</code></pre>
<p>Dans cet exemple, l’imputation avec les méthodes LOCF et BOCF sont clairement les solutions les plus adaptée. Néanmoins, dans des situations plus complexes, il peut être difficile de décider si ces méthodes sont appropriées ou non. Par exemple, vous pouvez avoir des valeurs de laboratoire manquantes pour un patient hospitalisé après le premier jour. Cela pourrait signifier que les valeurs de laboratoire n’ont pas changé… ou que le patient s’est rétabli et donc que ses valeurs seraient très différentes après le premier jour ! Utilisez ces méthodes avec prudence.</p>
</div>
<div id="imputation-multiple" class="section level3 unnumbered">
<h3>Imputation multiple<a class="anchor" aria-label="anchor" href="#imputation-multiple"><i class="fas fa-link"></i></a>
</h3>
<p>Nous n’avons pas la place ici de faire une explication détaillée de l’imputation multiple et de quand l’utiliser. Nous vous réferrons au <a href="https://stefvanbuuren.name/fimd/">livre (en ligne et gratuit)</a> écrit par l’auteur du paquet <strong>mice</strong> et ne présentons ici qu’une explication de base de la méthode :</p>
<p>L’imputation multiple consiste à créer plusieurs jeux de données dans lesquels les valeurs manquantes sont imputées à des valeurs de données “plausibles”. Dans chacun des jeux de données, chaque valeur imputée est tirée aléatoirement dans une distribution estimée (les données non manquantes restent, elles, intouchées), ce qui crée des jeux de données légèrement différents les uns des autres. La distribution utilisée d’où sont tirée les valeurs imputées vient ici encore d’un modèle statistique prédictif (<strong>mice</strong> propose de nombreuses options pour les méthodes de prédiction, notamment <em>Predictive Mean Matching</em>, <em>Régression logistique</em> et <em>Forêt aléatoire</em>), mais <strong>mice</strong> prend en charge de nombreux détails de la modélisation. Ensuite, l’analyse que vous aviez planifiée est effectuée sur chacun des jeux de données, et les paramètres estimés par les modèles sont ensuite poolés et leur variance estimée.</p>
<p>Cette méthode fonctionne très bien pour réduire le biais dans les configurations MMCA et MA et permet souvent d’obtenir des estimations plus précises de l’erreur standard.</p>
<p>Note : en fonction des données, on peut créer plus ou moins de jeux de données avec les données imputées. Le package <strong>mice</strong> fixe le nombre par défaut à 5.</p>
<p>Voici un exemple d’application de l’imputation multiple pour prédire la température dans notre jeu de données de liste linéaire, en utilisant l’age et la présence/absence de fièvre :</p>
<div class="sourceCode" id="cb1070"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># imputation des valurs manquantes pour notre jeu de données modèle, et création de 10 jeux de données imputés : </span></span>
<span><span class="va">multiple_imputation</span> <span class="op">=</span> <span class="fu">mice</span><span class="op">(</span></span>
<span>  <span class="va">model_dataset</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  m <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  print <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## Warning: Number of logged events: 1</code></pre>
<div class="sourceCode" id="cb1072"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">multiple_imputation</span>, </span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">temp</span> <span class="op">~</span> <span class="va">age_years</span> <span class="op">+</span> <span class="va">fever</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://amices.org/mice/reference/pool.html">pool</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##          term     estimate    std.error     statistic        df       p.value
## 1 (Intercept) 3.703143e+01 0.0270863456 1367.16240465  26.83673  1.583113e-66
## 2   age_years 3.867829e-05 0.0006090202    0.06350905 171.44363  9.494351e-01
## 3    feveryes 1.978044e+00 0.0193587115  102.17849544 176.51325 5.666771e-159</code></pre>
<p>Ici, nous avons utilisé la méthode d’imputation par défaut de <strong>mice</strong>, à savoir “Predictive Mean Matching”. Nous avons ensuite utilisé ces jeux de données imputées pour estimer séparément, puis mettre en commun les résultats de régressions linéaires simples sur chacun de ces ensembles de données.</p>
<p>Il existe de nombreux détails que nous avons survolés et de nombreux paramètres que vous pouvez ajuster pendant le processus d’imputation multiple en utilisant le package <strong>mice</strong>. Par exemple, vous n’aurez pas toujours des données numériques et vous devrez peut-être utiliser d’autres méthodes d’imputation (<strong>mice</strong> permet d’imputer de nombreux types de données, avec de nombreuses méthodes). Mais, pour une analyse plus robuste lorsque les données manquantes constituent un problème important, l’imputation multiple est une bonne solution qui ne demande pas toujours beaucoup plus de travail que l’analyse complète des cas.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="resources-5" class="section level2" number="20.7">
<h2>
<span class="header-section-number">20.7</span> Resources<a class="anchor" aria-label="anchor" href="#resources-5"><i class="fas fa-link"></i></a>
</h2>
<p>Vignette sur le <a href="https://cran.r-project.org/web/packages/naniar/vignettes/getting-started-w-naniar.html">package <strong>naniar</strong></a></p>
<p>Galerie de <a href="https://cran.r-project.org/web/packages/naniar/vignettes/naniar-visualisation.html">visualisation de données manquantes</a></p>
<p><a href="https://stefvanbuuren.name/fimd/">Livre gratuit</a> sur l’imputation multiple par l’auteur et le gestionnaire du package <strong>mice</strong></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="regression.html"><span class="header-section-number">19</span> Régression univariée et multivariable</a></div>
<div class="next"><a href="standardisation.html"><span class="header-section-number">21</span> Taux standardisés</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#missing_data"><span class="header-section-number">20</span> Données manquantes</a></li>
<li>
<a class="nav-link" href="#%C3%A9tapes-pr%C3%A9liminaires-3"><span class="header-section-number">20.1</span> Étapes préliminaires</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importation-des-paquets-4">Importation des paquets</a></li>
<li><a class="nav-link" href="#importation-des-donn%C3%A9es-4">Importation des données</a></li>
<li><a class="nav-link" href="#conversion-des-donn%C3%A9es-manquantes-lors-de-limport">Conversion des données manquantes lors de l’import</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#valeurs-manquantes-dans-r"><span class="header-section-number">20.2</span> Valeurs manquantes dans R</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#na">NA</a></li>
<li><a class="nav-link" href="#na-et-ses-d%C3%A9riv%C3%A9s">NA et ses dérivés</a></li>
<li><a class="nav-link" href="#null">NULL</a></li>
<li><a class="nav-link" href="#nan">NaN</a></li>
<li><a class="nav-link" href="#inf">Inf</a></li>
<li><a class="nav-link" href="#exemples-1">Exemples</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#fonctions-utiles"><span class="header-section-number">20.3</span> Fonctions utiles</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#is.na-et-is.na">is.na() et !is.na()</a></li>
<li><a class="nav-link" href="#na.omit">na.omit()</a></li>
<li><a class="nav-link" href="#drop_na">drop_na()</a></li>
<li><a class="nav-link" href="#na.rm-true">na.rm = TRUE</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#identifier-les-valeurs-manquantes-dans-un-dataframe"><span class="header-section-number">20.4</span> Identifier les valeurs manquantes dans un dataframe</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#quantifier-les-donn%C3%A9es-manquantes">Quantifier les données manquantes</a></li>
<li><a class="nav-link" href="#visualiser-les-donn%C3%A9es-manquantes">Visualiser les données manquantes</a></li>
<li><a class="nav-link" href="#explorer-et-visualiser-les-relations-entre-donn%C3%A9es-manquantes">Explorer et visualiser les relations entre données manquantes</a></li>
<li><a class="nav-link" href="#colonnes-fant%C3%B4mes">Colonnes “fantômes”</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#utiliser-des-donn%C3%A9es-avec-des-valeurs-manquantes"><span class="header-section-number">20.5</span> Utiliser des données avec des valeurs manquantes</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#filtrer-les-lignes-avec-valeurs-manquantes">Filtrer les lignes avec valeurs manquantes</a></li>
<li><a class="nav-link" href="#g%C3%A9rer-les-na-dans-ggplot">Gérer les NA dans ggplot()</a></li>
<li><a class="nav-link" href="#na-dans-les-facteurs">NA dans les facteurs</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#imputation"><span class="header-section-number">20.6</span> Imputation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#types-de-donn%C3%A9es-manquantes">Types de données manquantes</a></li>
<li><a class="nav-link" href="#packages-utiles">Packages utiles</a></li>
<li><a class="nav-link" href="#imputation-par-la-moyenne">Imputation par la moyenne</a></li>
<li><a class="nav-link" href="#imputation-par-r%C3%A9gression">Imputation par régression</a></li>
<li><a class="nav-link" href="#report-de-la-derni%C3%A8re-observation-et-baseline">Report de la dernière observation et baseline</a></li>
<li><a class="nav-link" href="#imputation-multiple">Imputation multiple</a></li>
</ul>
</li>
<li><a class="nav-link" href="#resources-5"><span class="header-section-number">20.7</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Le Epi R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-21.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
