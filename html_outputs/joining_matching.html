<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>14 Joindre des données | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="14 Joindre des données | The Epidemiologist R Handbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14 Joindre des données | The Epidemiologist R Handbook" />
  
  <meta name="twitter:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.2/transition.js"></script>
    <script src="libs/bs3compat-0.4.2/tabs.js"></script>
    <script src="libs/bs3compat-0.4.2/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.27/datatables.js"></script>
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
    <script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.9/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.1/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="joining_matching" class="section level1" number="14">
<h1><span class="header-section-number">14</span> Joindre des données</h1>
<p><img src="images/left-join.gif" width="50%" /></p>
<p><em>Ci-dessus : animation d’une jointure par la gauche (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">source de l’image</a>)</em></p>
<p>Ce chapitre décrit les méthodes permettant de joindre / fusionner / faire correspondre / lier / “merger” / unir / combiner des tableaux.</p>
<p>Lors de l’analyse de données épidémiologiques, il est rare que votre processus de nettoyage des données n’implique pas des sources de données multiples, et donc leur mise en relation.
Par exemple, vous aurez peut-être à joindre des données de laboratoire aux résultats cliniques des patients, ou des données de mobilité Google aux tendances des maladies infectieuses, ou même un jeu de données à un stade donné de l’analyse et une version transformée de lui-même.</p>
<p>Dans ce chapitre, nous allons :</p>
<ul>
<li>Réaliser des <em>jointures</em> de deux dataframes en faisant correspondre les lignes sur la base d’une clef primaire (dans une ou plusieurs colonnes).<br />
</li>
<li>Joindre des jeux de données sur la base de correspondances <em>probabilistes</em> (probables) entre les observations<br />
</li>
<li>Étendre un jeu de données en <em>concaténant</em> des lignes ou des colonnes d’un autre jeu de données.</li>
</ul>
<!-- ======================================================= -->
<div id="étapes-préliminaires-2" class="section level2" number="14.1">
<h2><span class="header-section-number">14.1</span> Étapes préliminaires</h2>
<div id="importation-des-paquets-3" class="section level3 unnumbered">
<h3>Importation des paquets</h3>
<p>Ces lignes de code chargent les paquets nécessaires aux analyses. Dans ce guide, nous mettons l’accent sur <code>p_load()</code> de <strong>pacman</strong>, qui installe le paquet si nécessaire <em>puis</em> l’importe pour l’utiliser. Vous pouvez également charger les paquets installés avec <code>library()</code> de <strong>base</strong> R. Voir la page sur <a href="rbasics.html#rbasics">bases de R</a> pour plus d’informations sur les paquets R.</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb667-1"><a href="joining_matching.html#cb667-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb667-2"><a href="joining_matching.html#cb667-2" aria-hidden="true" tabindex="-1"></a>  rio,            <span class="co"># import des fichiers</span></span>
<span id="cb667-3"><a href="joining_matching.html#cb667-3" aria-hidden="true" tabindex="-1"></a>  here,           <span class="co"># chemins d&#39;accès</span></span>
<span id="cb667-4"><a href="joining_matching.html#cb667-4" aria-hidden="true" tabindex="-1"></a>  tidyverse,      <span class="co"># gestion des données + graphiques (ggplot2)</span></span>
<span id="cb667-5"><a href="joining_matching.html#cb667-5" aria-hidden="true" tabindex="-1"></a>  RecordLinkage,  <span class="co"># correspondances probabilistes</span></span>
<span id="cb667-6"><a href="joining_matching.html#cb667-6" aria-hidden="true" tabindex="-1"></a>  fastLink        <span class="co"># correspondances probabilistes</span></span>
<span id="cb667-7"><a href="joining_matching.html#cb667-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="importation-des-données-2" class="section level3 unnumbered">
<h3>Importation des données</h3>
<p>Nous importons un jeu de données de cas d’une épidémie d’ébola fictive. Pour reproduire les étapes, <a href='https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds' class='download-button'>cliquez pour télécharger la linelist “propre”</a> (as .rds file). Importez vos données avec la fonction <code>import()</code> du paquet <strong>rio</strong> (elle accepte de nombreux types de fichiers comme .xlsx, .rds, .csv - voir la page <a href="import_export">Importation et exportation des données</a> pour plus de détails).</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="joining_matching.html#cb668-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importer la linelist dans R</span></span>
<span id="cb668-2"><a href="joining_matching.html#cb668-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist_cleaned.rds&quot;</span>)</span></code></pre></div>
<p>Les cinquantes premières lignes sont affichées ci-dessous :</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-64bb269b8a808ec3e815" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-64bb269b8a808ec3e815">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
</div>
<div id="jeux-de-données-simplifiés" class="section level3 unnumbered">
<h3>Jeux de données simplifiés</h3>
<p>Dans les exemples ci-dessous, nous utiliserons des jeux de données simplifiés pour mieux voir ce qui se passe :</p>
<ol style="list-style-type: decimal">
<li>Une version “miniature” de la linelist (liste des cas), contenant seulement les colonnes <code>case_id</code>, <code>date_onset</code>, et <code>hospital</code>, et seulement les 10 premières lignes.<br />
</li>
<li>Une table nommée <code>hosp_info</code>, qui contient des détails sur chaque hôpital.</li>
</ol>
<p>Dans la section sur l’appariement probabiliste, nous utiliserons deux petits ensembles de données différents. Le code pour créer ces jeux de données sera donné dans cette section.</p>
<div id="joins_llmini" class="section level4 unnumbered">
<h4>Linelist miniature</h4>
<p>Nous générons ici la linelist miniature des cas, qui contient seulement 10 lignes et seulement les colonnes <code>case_id</code>, <code>date_onset</code>, et <code>hospital</code>.</p>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb669-1"><a href="joining_matching.html#cb669-1" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>                 </span>
<span id="cb669-2"><a href="joining_matching.html#cb669-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_id, date_onset, hospital) <span class="sc">%&gt;%</span>   <span class="co"># sélectionne les colonnes</span></span>
<span id="cb669-3"><a href="joining_matching.html#cb669-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)                                    <span class="co"># garde les 10 premières lignes</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3fc612854b520631c692" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3fc612854b520631c692">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="joins_hosp_info" class="section level4 unnumbered">
<h4>Jeu de données des hôpitaux</h4>
<p>Le code ci-dessous permet de créer un jeu de données contenant des informations supplémentaires sur sept hôpitaux (la population desservie et le niveau de soins disponible). Notez que le nom “Hôpital militaire” appartient à deux hôpitaux différents, l’un de niveau primaire desservant 10000 résidents et l’autre de niveau secondaire desservant 50280 résidents.</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb670-1"><a href="joining_matching.html#cb670-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crée des informations sur les hôpitaux : </span></span>
<span id="cb670-2"><a href="joining_matching.html#cb670-2" aria-hidden="true" tabindex="-1"></a>hosp_info <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb670-3"><a href="joining_matching.html#cb670-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">hosp_name     =</span> <span class="fu">c</span>(<span class="st">&quot;central hospital&quot;</span>, <span class="st">&quot;military&quot;</span>, <span class="st">&quot;military&quot;</span>, </span>
<span id="cb670-4"><a href="joining_matching.html#cb670-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;port&quot;</span>, <span class="st">&quot;St. Mark&#39;s&quot;</span>, <span class="st">&quot;ignace&quot;</span>, <span class="st">&quot;sisters&quot;</span>),</span>
<span id="cb670-5"><a href="joining_matching.html#cb670-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">catchment_pop =</span> <span class="fu">c</span>(<span class="dv">1950280</span>, <span class="dv">40500</span>, <span class="dv">10000</span>, <span class="dv">50280</span>, </span>
<span id="cb670-6"><a href="joining_matching.html#cb670-6" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">12000</span>, <span class="dv">5000</span>, <span class="dv">4200</span>),</span>
<span id="cb670-7"><a href="joining_matching.html#cb670-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">level         =</span> <span class="fu">c</span>(<span class="st">&quot;Tertiary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Primary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>,</span>
<span id="cb670-8"><a href="joining_matching.html#cb670-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Primary&quot;</span>, <span class="st">&quot;Primary&quot;</span>)</span>
<span id="cb670-9"><a href="joining_matching.html#cb670-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Voici le tableau ainsi produit :</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7f97d805b747bed5fd2c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7f97d805b747bed5fd2c">{"x":{"filter":"none","vertical":false,"data":[["central hospital","military","military","port","St. Mark's","ignace","sisters"],[1950280,40500,10000,50280,12000,5000,4200],["Tertiary","Secondary","Primary","Secondary","Secondary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":7,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[7,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
</div>
</div>
<div id="nettoyage-préliminaire" class="section level3 unnumbered">
<h3>Nettoyage préliminaire</h3>
<p>Les jointures “traditionnelles” (<em>i.e.</em> non-probabilistes) sont sensibles à la casse et nécessitent des correspondances exactes entre les valeurs des colonnes utilisées comme clef/identifiant. Pour démontrer certaines des étapes de nettoyage que vous pourriez avoir besoin de faire avant de joindre vos données, nous allons commencer par nettoyer et aligner les dataframe <code>linelist_mini</code> et <code>hosp_info</code>.</p>
<p><strong>Identifier les différences</strong></p>
<p>Le nom de l’hôpital étant notre identifiant/clef commun aux deux jeux de données, nous avons besoin que les valeurs de la colonne <code>hosp_name</code> dans le tableau <code>hosp_info</code> correspondent aux valeurs de la colonne <code>hospital</code> dans le tableau <code>linelist_mini</code>.</p>
<p>Voici le dataframe <code>linelist_mini</code>, affiché avec la fonction <strong>base</strong> R <code>unique()</code> :</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="joining_matching.html#cb671-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(linelist_mini<span class="sc">$</span>hospital)</span></code></pre></div>
<pre><code>## [1] &quot;Other&quot;                                &quot;Missing&quot;                              &quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;
## [4] &quot;Port Hospital&quot;                        &quot;Military Hospital&quot;</code></pre>
<p>… et voici les valeurs dans le dataframe <code>hosp_info</code> :</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="joining_matching.html#cb673-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(hosp_info<span class="sc">$</span>hosp_name)</span></code></pre></div>
<pre><code>## [1] &quot;central hospital&quot; &quot;military&quot;         &quot;port&quot;             &quot;St. Mark&#39;s&quot;       &quot;ignace&quot;           &quot;sisters&quot;</code></pre>
<p>Il est clair que si certains hôpitaux sont présents dans les deux dataframes, leurs noms ne sont pas toujours orthographiés de la même manière.</p>
<p><strong>Aligner les valeurs</strong></p>
<p>Nettoyons les valeurs du jeu de données <code>hosp_info</code>. Comme expliqué dans le chapitre sur le <a href="cleaning_data.html#cleaning_data">Nettoyage de données et fonctions essentielles</a>, il est possible de recoder les valeurs à partir de critères logiques en utilisant la fonction <code>case_when()</code> de <strong>dplyr</strong>. Pour les quatre hôpitaux communs dans les deux dataframes, nous modifions les noms pour les aligner avec les noms dans le tableau <code>linelist_mini</code> (en ne touchant pas aux noms des autres hôpitaux grâce à l’argument <code>TRUE ~ hosp_name</code>).</p>
<p><span style="color: orange;"><strong><em>ATTENTION:</em></strong> Normalement on devrait créer une nouvelle colonne pour ce type de nettoyage (<code>hosp_name_clean</code> par exemple), mais pour mieux comprendre ce qui se passe lors des étapes suivantes, nous modifions directement la colonne contenant les données “brutes”</span></p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="joining_matching.html#cb675-1" aria-hidden="true" tabindex="-1"></a>hosp_info <span class="ot">&lt;-</span> hosp_info <span class="sc">%&gt;%</span> </span>
<span id="cb675-2"><a href="joining_matching.html#cb675-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb675-3"><a href="joining_matching.html#cb675-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">hosp_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb675-4"><a href="joining_matching.html#cb675-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># critère                          # nouvelles valeur</span></span>
<span id="cb675-5"><a href="joining_matching.html#cb675-5" aria-hidden="true" tabindex="-1"></a>      hosp_name <span class="sc">==</span> <span class="st">&quot;military&quot;</span>          <span class="sc">~</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb675-6"><a href="joining_matching.html#cb675-6" aria-hidden="true" tabindex="-1"></a>      hosp_name <span class="sc">==</span> <span class="st">&quot;port&quot;</span>              <span class="sc">~</span> <span class="st">&quot;Port Hospital&quot;</span>,</span>
<span id="cb675-7"><a href="joining_matching.html#cb675-7" aria-hidden="true" tabindex="-1"></a>      hosp_name <span class="sc">==</span> <span class="st">&quot;St. Mark&#39;s&quot;</span>        <span class="sc">~</span> <span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span>,</span>
<span id="cb675-8"><a href="joining_matching.html#cb675-8" aria-hidden="true" tabindex="-1"></a>      hosp_name <span class="sc">==</span> <span class="st">&quot;central hospital&quot;</span>  <span class="sc">~</span> <span class="st">&quot;Central Hospital&quot;</span>,</span>
<span id="cb675-9"><a href="joining_matching.html#cb675-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                             <span class="sc">~</span> hosp_name</span>
<span id="cb675-10"><a href="joining_matching.html#cb675-10" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb675-11"><a href="joining_matching.html#cb675-11" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>Les noms des hôpitaux qui apparaissent dans les deux bases de données sont désormais identiques. Il y a deux hôpitaux dans <code>hosp_info</code> qui ne sont pas présents dans <code>linelist_mini</code>, nous les traiterons plus tard, lors de la jointure.</p>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb676-1"><a href="joining_matching.html#cb676-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(hosp_info<span class="sc">$</span>hosp_name)</span></code></pre></div>
<pre><code>## [1] &quot;Central Hospital&quot;                     &quot;Military Hospital&quot;                    &quot;Port Hospital&quot;                       
## [4] &quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot; &quot;ignace&quot;                               &quot;sisters&quot;</code></pre>
<p>Avant une jointure, il est souvent rassurant de convertir une colonne tout en minuscules ou majuscules. Pour cela, on peut utiliser <code>mutate()</code> et une des colonnes de <strong>stringr</strong> (voir le chapitre <a href="character_strings.html#character_strings">sur les chaînes de caractères</a>):</p>
<p><code>str_to_upper()</code><br />
<code>str_to_lower()</code><br />
<code>str_to_title()</code></p>
<!-- ======================================================= -->
</div>
</div>
<div id="jointures-à-laide-de-dplyr" class="section level2" number="14.2">
<h2><span class="header-section-number">14.2</span> Jointures à l’aide de <strong>dplyr</strong></h2>
<p>Le package <strong>dplyr</strong> offre plusieurs fonctions qui permettent d’effectuer des jointures différentes. <strong>dplyr</strong> est inclus dans le paquet <strong>tidyverse</strong>.</p>
<p>Un grand merci à <a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">https://github.com/gadenbuie</a> pour les gifs informatifs !</p>
<!-- ======================================================= -->
<div id="syntaxe-générale" class="section level3 unnumbered">
<h3>Syntaxe générale</h3>
<p>Les fonctions de jointure peuvent s’utiliser seules pour unir deux dataframes et créer un nouveau dataframe, mais aussi au sein d’un enchaînement de commandes (pipe avec <code>%&gt;%</code>) pour fusionner un dataframe dans un autre à la volée.</p>
<p>Dans l’exemple ci-dessous, la fonction <code>left_join()</code> est utilisée de manière autonome pour créer un nouveau jeu de données (<code>joined_data</code>). Les arguments à l’entrée sont les dataframes à unir/fusionner/joindre (<code>df1</code> et <code>df2</code>). Le premier dataframe listé est le dataframe <em>de base</em>, et le deuxième dataframe listé est joint <em>à</em> celui-ci.</p>
<p>Le troisième argument <code>by =</code> précise quelle(s) colonne(s) sera utilisée pour faire la correspondance entre les lignes des deux dataframes (la clef). Si les noms de ces colonnes sont différents, fournissez-les dans un vecteur <code>c()</code> comme dans l’exemple ci-dessous, les identifiants communs sont dans la colonne <code>ID</code> dans <code>df1</code> et dans la colonne <code>identifier</code> dans <code>df2</code>.</p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="joining_matching.html#cb678-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Jointure basée sur les valeurs communes dans la colonne ID (df1) et la colonne &quot;identifier&quot; (df2)</span></span>
<span id="cb678-2"><a href="joining_matching.html#cb678-2" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df1, df2, </span>
<span id="cb678-3"><a href="joining_matching.html#cb678-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span> <span class="ot">=</span> <span class="st">&quot;identifier&quot;</span>))</span></code></pre></div>
<p>Si la ou les colonnes “clef” à le même nom dans les deux tableaux, alors leur nom peut juste être fourni directement, avec des guillemets :</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="joining_matching.html#cb679-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Jointure basée sur les valeurs communes dans la colonne ID présente dans df1 et df2</span></span>
<span id="cb679-2"><a href="joining_matching.html#cb679-2" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df1, df2, </span>
<span id="cb679-3"><a href="joining_matching.html#cb679-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">by =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<p>S’il y a besoin de plusieurs colonnes pour identifier de manière unique les observations (i.e. créer une clef primaire), on peut lister plusieurs colonnes dans un vecteur et le passer à <code>by</code>.
Dans cet exemple, les lignes des deux dataframes sont unies si les valeurs sont identiques dans les trois colonnes.</p>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb680-1"><a href="joining_matching.html#cb680-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Jointure basée sur le prénom, le nom de famille et l&#39;age : les lignes sont fusionnées si les valeurs sont alignées exactement</span></span>
<span id="cb680-2"><a href="joining_matching.html#cb680-2" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df1, df2, </span>
<span id="cb680-3"><a href="joining_matching.html#cb680-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>    <span class="ot">=</span> <span class="st">&quot;firstname&quot;</span>, </span>
<span id="cb680-4"><a href="joining_matching.html#cb680-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;surname&quot;</span> <span class="ot">=</span> <span class="st">&quot;lastname&quot;</span>, </span>
<span id="cb680-5"><a href="joining_matching.html#cb680-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;Age&quot;</span>     <span class="ot">=</span> <span class="st">&quot;age&quot;</span>))</span></code></pre></div>
<p>Les fonctions de jointure peuvent également être exécutées dans un enchaînement d’instructions (ou <em>pipe</em>). Cela modifiera le jeu de données qui est passée dans le pipe.</p>
<p>Dans l’exemple ci-dessous, <code>df1</code> est pipé, <code>df2</code> lui est joint, et <code>df1</code> est ainsi modifié et redéfini.</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="joining_matching.html#cb681-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> df1 <span class="sc">%&gt;%</span></span>
<span id="cb681-2"><a href="joining_matching.html#cb681-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date_onset <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-03-05&quot;</span>)) <span class="sc">%&gt;%</span>  <span class="co"># nettoyage divers</span></span>
<span id="cb681-3"><a href="joining_matching.html#cb681-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span> <span class="ot">=</span> <span class="st">&quot;identifier&quot;</span>))     <span class="co"># jointure de df2 à df1</span></span></code></pre></div>
<p><span style="color: orange;"><strong><em>ATTENTION:</em></strong> Les jointures respectent les majuscules/minuscules ! Il peut donc être utile de convertir les colonnes utilisées comme clefs en minuscules ou majuscules. Voir le chapitre <a href="character_strings.html#character_strings">sur les chaînes de caractères</a></span></p>
<!-- ======================================================= -->
</div>
<div id="jointures-à-gauche-et-droite" class="section level3 unnumbered">
<h3>Jointures à gauche et droite</h3>
<p><strong>Une jointure à gauche ou droite est une opération très couramment utilisée pour ajouter des informations à un dataframe</strong>, en particulier dans les analyses épidémiologiques. Les nouvelles informations sont ajoutées uniquement aux lignes qui existaient déjà dans le dataframe de “référence”.</p>
<p><em>En utilisant ces jointures, l’ordre d’écriture des dataframes dans la commande est important</em>.</p>
<ul>
<li>Dans une <em>jointure à gauche</em>, le <em>premier</em> dataframe écrit est utilisé comme “référence” à laquelle on adjoint les informations venant de l’autre table.<br />
</li>
<li>Dans une <em>jointure à droite</em>, le <em>second</em> dataframe est la référence à laquelle on rajoute les informations venant du premier dataframe.</li>
</ul>
<p>Plus précisement :<br />
* <strong>Toutes les lignes présentes dans le dataframe de référence sont conservées</strong>. Les informations contenues dans le dataframe secondaire sont adjointes au dataframe de référence <em>uniquement s’il existe une correspondance via la ou les colonnes d’identification/clefs</em>.</p>
<ul>
<li><p>Les lignes du dataframe secondaire qui ne correspondent pas sont abandonnées.</p></li>
<li><p>Si plusieurs lignes du dataframe utilisé comme référence correspondent à une ligne dans le dataframe secondaire (many-to-one), les informations du dataframe secondaire sont ajoutées à <em>chaque ligne du dataframe de référence correspondantes</em>.</p></li>
<li><p>Si une ligne du dataframe de référence correspond à plusieurs lignes dans le dataframe secondaire (one-to-many), <strong>toutes les combinaisons sont données</strong>, ce qui signifie que <em>de nouvelles lignes sont ajoutées au dataframe de référence !</em>.</p></li>
</ul>
<p>Exemples animés de jointures gauche et droite (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">source de l’image</a>)</p>
<p><img src="images/left-join.gif" width="50%" /><img src="images/right-join.gif" width="50%" /></p>
<p><strong>Exemple</strong></p>
<p>Voici le résultat d’un <code>left_join()</code> de <code>hosp_info</code> (dataframe secondaire, <a href="joining_matching.html#joins_hosp_info">voir ici</a>) <em>dans</em>/<em>vers</em> <code>linelist_mini</code> (dataframe de référence, <a href="joining_matching.html#joins_llmini">voir ici</a>). La <code>linelist_mini</code> originale a <code>nrow(linelist_mini)</code> lignes. La <code>linelist_mini</code> modifiée est affichée. On constate que :</p>
<ul>
<li><p>Deux nouvelles colonnes, <code>catchment_pop</code> et <code>level</code> ont été ajoutées sur le côté gauche de <code>linelist_mini</code>.</p></li>
<li><p>Toutes les lignes originales du dataframe de référence <code>linelist_mini</code> ont été conservées.</p></li>
<li><p>Toutes les lignes originales de <code>linelist_mini</code> pour “Military Hospital” ont été dupliquées car elles correspondaient à <em>deux</em> lignes dans le dataframe secondaire, et donc les deux combinaisons ont été retournées.</p></li>
<li><p>La colonne d’identifiant/clef de jointure du dataframe secondaire (<code>hosp_name</code>) a disparu car elle est redondante avec la colonne d’identifiant du dataframe de référence (<code>hospital</code>)</p></li>
<li><p>Lorsqu’une ligne du dataframe de gauche ne correspond à aucune du dataframe de droite (par exemple, lorsque <code>hospital</code> est “Autre” ou “Manquant”), les observations renvoyées dans les colonnes venant du dataframe de droite sont <code>NA</code>.</p></li>
<li><p>Les lignes du dataframe de droite qui ne correspondent pas au dataframe gauche (hôpitaux “sisters” et “ignace”) ont été abandonnées.</p></li>
</ul>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb682-1"><a href="joining_matching.html#cb682-1" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span> </span>
<span id="cb682-2"><a href="joining_matching.html#cb682-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in left_join(., hosp_info, by = c(hospital = &quot;hosp_name&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1a74e686baddb11c6843" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1a74e686baddb11c6843">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing"],[null,null,12000,50280,40500,10000,50280,null,null,null,null],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<div id="jointure-à-gauche-ou-jointure-à-droite" class="section level4 unnumbered">
<h4>Jointure à gauche ou jointure à droite ?</h4>
<p>Pour répondre à la question, il faut décider quel dataframe doit conserver toutes ses lignes, et l’utiliser comme dataframe de référence. Une <em>jonction à gauche</em> conserve toutes les lignes du premier dataframe écrit dans la commande, tandis qu’une <em>jonction à droite</em> conserve toutes les lignes du second dataframe.</p>
<p>Les deux instructions ci-dessous retournent le même résultat : 10 lignes de <code>hosp_info</code> jointes <em>dans</em> un dataframe <code>linelist_mini</code>, mais elles utilisent des jointures différentes. Le résultat est que l’ordre des colonnes sera différent selon que <code>hosp_info</code> arrive “par la droite” (dans la jointure à gauche) ou arrive “par la gauche” (dans la jointure à droite). L’ordre des lignes peut également changer en conséquence. Néanmoins ces deux conséquences peuvent être traitées ultérieurement, en utilisant <code>select()</code> pour réordonner les colonnes ou <code>arrange()</code> pour trier les lignes.</p>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb684-1"><a href="joining_matching.html#cb684-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On obtient le même jeu de données, mais avec l&#39;ordre des colonnes et des lignes différent</span></span>
<span id="cb684-2"><a href="joining_matching.html#cb684-2" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(linelist_mini, hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span>
<span id="cb684-3"><a href="joining_matching.html#cb684-3" aria-hidden="true" tabindex="-1"></a><span class="fu">right_join</span>(hosp_info, linelist_mini, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hosp_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;hospital&quot;</span>))</span></code></pre></div>
<p>Voici le résultat d’une fusion de <code>hosp_info</code> dans <code>linelist_mini</code> par une jointure à gauche (nouvelles colonnes ajoutées par la droite) :</p>
<pre><code>## Warning in left_join(linelist_mini, hosp_info, by = c(hospital = &quot;hosp_name&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3324243c8e1209e50075" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3324243c8e1209e50075">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing"],[null,null,12000,50280,40500,10000,50280,null,null,null,null],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Voici le résultat de la fusion de <code>hosp_info</code> dans <code>linelist_mini</code> par une jointure à droite (nouvelles colonnes ajoutées par la gauche) :</p>
<pre><code>## Warning in right_join(hosp_info, linelist_mini, by = c(hosp_name = &quot;hospital&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 4 of `x` matches multiple rows in `y`.
## ℹ Row 5 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f7d96d01000876b58838" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f7d96d01000876b58838">{"x":{"filter":"none","vertical":false,"data":[["Military Hospital","Military Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Other","Missing","Missing","Missing","Missing","Missing"],[40500,10000,50280,50280,12000,null,null,null,null,null,null],["Secondary","Primary","Secondary","Secondary","Secondary",null,null,null,null,null,null],["893f25","893f25","b8812a","be99c8","11f8ea","5fe599","8689b7","07e3e8","369449","f393b4","1389ca"],["2014-05-21","2014-05-21","2014-05-18","2014-05-22","2014-05-16","2014-05-13","2014-05-13","2014-05-27","2014-06-02","2014-06-05","2014-06-05"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Une autre chose à considérer est si la jointure est réalisée au sein d’une chaîne d’instructions pipées (<code>%&gt;%</code>). Si le dataframe transmis par le pipe doit être utilisé comme référence, utilisez une jointure à gauche pour lui adjoindre de nouvelles données.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="jointure-complète" class="section level3 unnumbered">
<h3>Jointure complète</h3>
<p><strong>La jointure complète est la plus <em>inclusive</em> des jointures</strong>, elle renvoie toutes les lignes des deux dataframes fusionnés.</p>
<p>Si des lignes ne sont présentes que dans l’un des dataframes fusionnés (<em>i.e</em> aucune correspondance n’est trouvée), elles seront inclues dans le dataframe final (qui s’allonge donc), avec des <code>NA</code> pour combler les vides.</p>
<p>Lorsque vous effectuez une jointure, <strong>surveillez attentivement le nombre de colonnes et de lignes pour vérifier le nombre de lignes des dataframes en entrée, et du dataframe fusionné</strong>. Cela vous permettra notamment de détecter des problèmes de correspondance dus à la sensibilité à la casse ou à des correspondances inexactes.</p>
<p>Le dataframe de référence utilisé comme base est celui qui est écrit en premier dans la commande. Dans une jointure complète, Lequel des deux dataframes est écrit en premier n’affecte que l’ordre des lignes, l’ordre des colonnes et le nom des colonnes clef retenues.</p>
<p><img src="images/full-join.gif" width="50%" /></p>
<p>Exemple animé d’une jointure complète (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">image source</a>)</p>
<p><strong>Exemple</strong></p>
<p>Voici la sortie d’une jointure complète du dataframe <code>hosp_info</code> (originellement <code>nrow(hosp_info)</code> lignes, <a href="joining_matching.html#joins_hosp_info">voir ici</a>) <em>avec</em> <code>linelist_mini</code> (originellement <code>nrow(linelist_mini)</code> lignes, <a href="joining_matching.html#joins_llmini">voir ici</a>). On constate que :</p>
<ul>
<li><p>Toutes les lignes du dataframe de référence sont conservées (<code>linelist_mini</code>).</p></li>
<li><p>Les lignes du second dataframe qui n’ont pas de correspondance avec le premier dataframe sont conservées (“ignace” et “sisters”), et les valeurs des colonnes apportées par le dataframe de référence, <code>case_id</code> et <code>onset</code>, sont complétées par des valeurs manquantes.</p></li>
<li><p>De même, les lignes du dataframe de référence qui ne correspondent pas à la ligne secondaire (“Autre” et “Manquant”) sont conservées, les colonnes secondaires <code>catchment_pop</code> et <code>level</code> étant remplies de valeurs manquantes.</p></li>
<li><p>Dans le cas d’une correspondance un-à-plusieurs ou plusieurs-à-un (par exemple, des lignes pour “Hôpital militaire”), toutes les combinaisons possibles sont retournées (ce qui allonge le dataframe final).</p></li>
<li><p>Seule la colonne d’identification du dataframe de référence est conservée (<code>hospital</code>).</p></li>
</ul>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="joining_matching.html#cb687-1" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span> </span>
<span id="cb687-2"><a href="joining_matching.html#cb687-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in full_join(., hosp_info, by = c(hospital = &quot;hosp_name&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-02499899ac97567ef943" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-02499899ac97567ef943">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca",null,null,null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05",null,null,null],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Central Hospital","ignace","sisters"],[null,null,12000,50280,40500,10000,50280,null,null,null,null,1950280,5000,4200],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null,"Tertiary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
</div>
<div id="jointure-interne" class="section level3 unnumbered">
<h3>Jointure interne</h3>
<p><strong>La jointure interne est la plus <em>restrictive</em> des jointures</strong> : elle renvoie uniquement les lignes avec des correspondances dans les deux dataframes.<br />
Le nombre de lignes dans le dataframe de référence peut ainsi <em>diminuer</em>. Le choix du dataframe à passer en premier à la fonction n’aura pas d’impact sur les lignes conservées, mais affectera l’ordre des colonnes, l’ordre des lignes et clefs d’identification retenues.</p>
<p><img src="images/inner-join.gif" width="50%" /></p>
<p>Exemple animé d’une jointure complète : (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">image source</a>)</p>
<p><strong>Exemple</strong></p>
<p>Voici la sortie d’un <code>inner_join()</code> de la <code>linelist_mini</code> (référence) avec <code>hosp_info</code> (secondaire). On constate que :</p>
<ul>
<li>Les lignes du dataframe de référence sans correspondance dans le second dataframe sont supprimées (lignes où <code>hospital</code> est “Missing” ou “Other”).<br />
</li>
<li>De même, les lignes du dataframe secondaires qui n’ont pas de correspondance dans le dataframe de référence (lignes où <code>hosp_name</code> est “sisters” ou “ignace”) sont supprimées.<br />
</li>
<li>Seule la colonne clef du dataframe de référence est conservée (<code>hospital</code>).</li>
</ul>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="joining_matching.html#cb689-1" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span> </span>
<span id="cb689-2"><a href="joining_matching.html#cb689-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(hosp_info, </span>
<span id="cb689-3"><a href="joining_matching.html#cb689-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in inner_join(., hosp_info, by = c(hospital = &quot;hosp_name&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8c5f7dea751508299400" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8c5f7dea751508299400">{"x":{"filter":"none","vertical":false,"data":[["11f8ea","b8812a","893f25","893f25","be99c8"],["2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22"],["St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital"],[12000,50280,40500,10000,50280],["Secondary","Secondary","Secondary","Primary","Secondary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
</div>
<div id="semi-jointure" class="section level3 unnumbered">
<h3>Semi jointure</h3>
<p>Les semi jointures sont des jointures dites “filtrantes”, qui utilisent la correspondance avec un second dataframe pour <em>filtrer le dataframe de référence</em>.</p>
<p><strong>La semi jointure garde toutes les observations du dataframe de référence qui ont une correspondance dans le dataframe secondaire</strong>. Mais les colonnes du dataframe secondaire ne sont pas ajoutées et les lignes du dataframe de référence ne sont pas dupliquées s’il y a des correspondances multiples.</p>
<p>Plus d’explications sur les semi-jointures <a href="https://towardsdatascience.com/level-up-with-semi-joins-in-r-a068426096e0">ici</a>.</p>
<p><img src="images/semi-join.gif" width="50%" /></p>
<p>Exemple animé d’une semi jointure (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">image source</a>)</p>
<p>Voici un exemple qui retourne les lignes du dataframe <code>hosp_info</code> qui ont une correspondance dans le dataframe <code>linelist_mini</code> en utilisant le nom de l’hôpital comme clé de jointure/identifiant.</p>
<div class="sourceCode" id="cb691"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb691-1"><a href="joining_matching.html#cb691-1" aria-hidden="true" tabindex="-1"></a>hosp_info <span class="sc">%&gt;%</span> </span>
<span id="cb691-2"><a href="joining_matching.html#cb691-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(linelist_mini, </span>
<span id="cb691-3"><a href="joining_matching.html#cb691-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hosp_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;hospital&quot;</span>))</span></code></pre></div>
<pre><code>##                              hosp_name catchment_pop     level
## 1                    Military Hospital         40500 Secondary
## 2                    Military Hospital         10000   Primary
## 3                        Port Hospital         50280 Secondary
## 4 St. Mark&#39;s Maternity Hospital (SMMH)         12000 Secondary</code></pre>
<!-- ======================================================= -->
</div>
<div id="anti-jointure-anti_join" class="section level3 unnumbered">
<h3>Anti-jointure <code>anti_join()</code></h3>
<p><strong>L’anti-jointure est une autre type de jointure filtrante, qui, à l’opposé du semi-join, ne renvoie que les lignes du dataframe de référence qui n’ont PAS de correspondance dans le dataframe secondaire.</strong></p>
<p>Plus de détails sur les jointures filtrantes <a href="https://towardsdatascience.com/level-up-with-semi-joins-in-r-a068426096e0">ici</a>.</p>
<p>Voici quelques cas d’usage de l’anti-jointure : identifier les observations non présentes dans un autre dataframe, identifier les typos qui compliquent une jointure (se focaliser sur les observations qui auraient du correspondre), examiner les observations qui ont été exclues d’une jointure etc.</p>
<p><strong>Comme pour les jointures à droite (<code>right_join()</code>) et à gauche (<code>left_join()</code>), l’ordre dans lequel sont passés les dataframe a de l’importance.</strong> Dans les joins filtrants, on ne renvoie que les lignes présentes dans le dataframe de référence (écrit en premier), comme on peut le voir dans l’animation ci-dessous (la ligne 4, violette, du dataframe secondaire n’est pas retournée, alors qu’elle ne matche avec aucune ligne du dataframe de référence).</p>
<p><img src="images/anti-join.gif" width="50%" /></p>
<p>Exemple animé d’une anti-jointure (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">image source</a>)</p>
<div id="exemple-simple-danti-jointure" class="section level4 unnumbered">
<h4>Exemple simple d’anti-jointure</h4>
<p>Un cas d’utilisation simple est de rechercher les hôpitaux dans le tableau <code>hosp_info</code> qui n’ont pas de cas présents dans le tableau <code>linelist_mini</code>.
Nous rentrons <code>hosp_info</code> en premier, comme dataframe de référence, puis <code>linelist_mini</code>, la seconde table à comparer pour trouver les hôpitaux qui n’y sont pas présents.</p>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb693-1"><a href="joining_matching.html#cb693-1" aria-hidden="true" tabindex="-1"></a>hosp_info <span class="sc">%&gt;%</span> </span>
<span id="cb693-2"><a href="joining_matching.html#cb693-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(linelist_mini, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hosp_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;hospital&quot;</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-db14eabf879ed40f0e12" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-db14eabf879ed40f0e12">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","ignace","sisters"],[1950280,5000,4200],["Tertiary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="exemple-danti-jointure-plus-complexe" class="section level4 unnumbered">
<h4>Exemple d’anti-jointure plus complexe</h4>
<p>Imaginons cette fois-ci que nous avons exécuté une jointure interne (<code>inner_join()</code>) entre les dataframes <code>linelist_mini</code> et <code>hosp_info</code>. Cette opération ne retourne qu’un sous-ensemble des lignes originales de <code>linelist_mini</code>, car certains hôpitaux ne sont pas présents dans <code>hosp_info</code>.</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="joining_matching.html#cb694-1" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span> </span>
<span id="cb694-2"><a href="joining_matching.html#cb694-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in inner_join(., hosp_info, by = c(hospital = &quot;hosp_name&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-64457a7c3741b887692b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-64457a7c3741b887692b">{"x":{"filter":"none","vertical":false,"data":[["11f8ea","b8812a","893f25","893f25","be99c8"],["2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22"],["St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital"],[12000,50280,40500,10000,50280],["Secondary","Secondary","Secondary","Primary","Secondary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Nous pouvons utiliser une anti jointure pour inspecter les éléments de <code>linelist_mini</code> qui ont été exclus lors de la jointure interne, avec les mêmes paramètres (<code>linelist_mini</code> comme dataframe de référence).</p>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="joining_matching.html#cb696-1" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span> </span>
<span id="cb696-2"><a href="joining_matching.html#cb696-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-60f37f6aee4c77b71871" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-60f37f6aee4c77b71871">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","Missing","Missing","Missing","Missing"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Pour voir les lignes d’<code>hosp_info</code> exclues lors de la jointure interne, nous pourrions aussi exécuter une anti-jointure en utilisant <code>hosp_info</code> comme table de référence.</p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="apparienement-probabiliste" class="section level2" number="14.3">
<h2><span class="header-section-number">14.3</span> Apparienement probabiliste</h2>
<p>Si l’on ne dispose pas d’un identifiant unique commun à tous les dataframes sur lequel se baser, il est possible d’utiliser un algorithme de correspondance probabiliste. Cet algorithme cherche des correspondances entre les observations sur la base de la <strong>similarité</strong> (par exemple, la distance entre les chaînes de caractères Jaro-Winkler ou la distance numérique). Nous illustrons ce concept ci-dessous à l’aide du paquet <strong>fastLink</strong>.</p>
<p><strong>Charger les paquets</strong></p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="joining_matching.html#cb697-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb697-2"><a href="joining_matching.html#cb697-2" aria-hidden="true" tabindex="-1"></a>  tidyverse,      <span class="co"># manipulation de données et visualisation</span></span>
<span id="cb697-3"><a href="joining_matching.html#cb697-3" aria-hidden="true" tabindex="-1"></a>  fastLink        <span class="co"># appariement d&#39;observations</span></span>
<span id="cb697-4"><a href="joining_matching.html#cb697-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Nous créons d’abord deux petits jeux de données d’exemple que nous utiliserons pour démontrer l’appariement/la correspondance probabiliste (<code>cases</code> et <code>test_results</code>) :</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="joining_matching.html#cb698-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Création des jeux de données</span></span>
<span id="cb698-2"><a href="joining_matching.html#cb698-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb698-3"><a href="joining_matching.html#cb698-3" aria-hidden="true" tabindex="-1"></a>cases <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb698-4"><a href="joining_matching.html#cb698-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>gender, <span class="sc">~</span>first,      <span class="sc">~</span>middle,     <span class="sc">~</span>last,        <span class="sc">~</span>yr,   <span class="sc">~</span>mon, <span class="sc">~</span>day, <span class="sc">~</span>district,</span>
<span id="cb698-5"><a href="joining_matching.html#cb698-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,     <span class="st">&quot;Amir&quot;</span>,      <span class="cn">NA</span>,          <span class="st">&quot;Khan&quot;</span>,       <span class="dv">1989</span>,  <span class="dv">11</span>,   <span class="dv">22</span>,   <span class="st">&quot;River&quot;</span>,</span>
<span id="cb698-6"><a href="joining_matching.html#cb698-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,     <span class="st">&quot;Anthony&quot;</span>,   <span class="st">&quot;B.&quot;</span>,        <span class="st">&quot;Smith&quot;</span>,      <span class="dv">1970</span>, <span class="dv">09</span>, <span class="dv">19</span>,      <span class="st">&quot;River&quot;</span>, </span>
<span id="cb698-7"><a href="joining_matching.html#cb698-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,     <span class="st">&quot;Marialisa&quot;</span>, <span class="st">&quot;Contreras&quot;</span>, <span class="st">&quot;Rodrigues&quot;</span>,  <span class="dv">1972</span>, <span class="dv">04</span>, <span class="dv">15</span>,      <span class="st">&quot;River&quot;</span>,</span>
<span id="cb698-8"><a href="joining_matching.html#cb698-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,     <span class="st">&quot;Elizabeth&quot;</span>, <span class="st">&quot;Casteel&quot;</span>,   <span class="st">&quot;Chase&quot;</span>,      <span class="dv">1954</span>, <span class="dv">03</span>, <span class="dv">03</span>,      <span class="st">&quot;City&quot;</span>,</span>
<span id="cb698-9"><a href="joining_matching.html#cb698-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,     <span class="st">&quot;Jose&quot;</span>,      <span class="st">&quot;Sanchez&quot;</span>,   <span class="st">&quot;Lopez&quot;</span>,      <span class="dv">1996</span>, <span class="dv">01</span>, <span class="dv">06</span>,      <span class="st">&quot;City&quot;</span>,</span>
<span id="cb698-10"><a href="joining_matching.html#cb698-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,     <span class="st">&quot;Cassidy&quot;</span>,   <span class="st">&quot;Jones&quot;</span>,      <span class="st">&quot;Davis&quot;</span>,     <span class="dv">1980</span>, <span class="dv">07</span>, <span class="dv">20</span>,      <span class="st">&quot;City&quot;</span>,</span>
<span id="cb698-11"><a href="joining_matching.html#cb698-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,     <span class="st">&quot;Michael&quot;</span>,   <span class="st">&quot;Murphy&quot;</span>,     <span class="st">&quot;O&#39;Calaghan&quot;</span>,<span class="dv">1969</span>, <span class="dv">04</span>, <span class="dv">12</span>,      <span class="st">&quot;Rural&quot;</span>, </span>
<span id="cb698-12"><a href="joining_matching.html#cb698-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,     <span class="st">&quot;Oliver&quot;</span>,    <span class="st">&quot;Laurent&quot;</span>,    <span class="st">&quot;De Bordow&quot;</span> , <span class="dv">1971</span>, <span class="dv">02</span>, <span class="dv">04</span>,     <span class="st">&quot;River&quot;</span>,</span>
<span id="cb698-13"><a href="joining_matching.html#cb698-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Blessing&quot;</span>,  <span class="cn">NA</span>,          <span class="st">&quot;Adebayo&quot;</span>,   <span class="dv">1955</span>,  <span class="dv">02</span>, <span class="dv">14</span>,     <span class="st">&quot;Rural&quot;</span></span>
<span id="cb698-14"><a href="joining_matching.html#cb698-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb698-15"><a href="joining_matching.html#cb698-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb698-16"><a href="joining_matching.html#cb698-16" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb698-17"><a href="joining_matching.html#cb698-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>gender,  <span class="sc">~</span>first,     <span class="sc">~</span>middle,     <span class="sc">~</span>last,          <span class="sc">~</span>yr, <span class="sc">~</span>mon, <span class="sc">~</span>day, <span class="sc">~</span>district, <span class="sc">~</span>result,</span>
<span id="cb698-18"><a href="joining_matching.html#cb698-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,      <span class="st">&quot;Amir&quot;</span>,     <span class="cn">NA</span>,          <span class="st">&quot;Khan&quot;</span>,         <span class="dv">1989</span>, <span class="dv">11</span>,   <span class="dv">22</span>,  <span class="st">&quot;River&quot;</span>, <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb698-19"><a href="joining_matching.html#cb698-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,      <span class="st">&quot;Tony&quot;</span>,   <span class="st">&quot;B&quot;</span>,         <span class="st">&quot;Smith&quot;</span>,          <span class="dv">1970</span>, <span class="dv">09</span>,   <span class="dv">19</span>,  <span class="st">&quot;River&quot;</span>, <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb698-20"><a href="joining_matching.html#cb698-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Maria&quot;</span>,    <span class="st">&quot;Contreras&quot;</span>, <span class="st">&quot;Rodriguez&quot;</span>,    <span class="dv">1972</span>, <span class="dv">04</span>,   <span class="dv">15</span>,  <span class="st">&quot;Cty&quot;</span>,   <span class="st">&quot;negative&quot;</span>,</span>
<span id="cb698-21"><a href="joining_matching.html#cb698-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Betty&quot;</span>,    <span class="st">&quot;Castel&quot;</span>,   <span class="st">&quot;Chase&quot;</span>,        <span class="dv">1954</span>,  <span class="dv">03</span>,   <span class="dv">30</span>,  <span class="st">&quot;City&quot;</span>,  <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb698-22"><a href="joining_matching.html#cb698-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Andrea&quot;</span>,   <span class="cn">NA</span>,          <span class="st">&quot;Kumaraswamy&quot;</span>,  <span class="dv">2001</span>, <span class="dv">01</span>,   <span class="dv">05</span>,  <span class="st">&quot;Rural&quot;</span>, <span class="st">&quot;positive&quot;</span>,      </span>
<span id="cb698-23"><a href="joining_matching.html#cb698-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Caroline&quot;</span>, <span class="cn">NA</span>,          <span class="st">&quot;Wang&quot;</span>,         <span class="dv">1988</span>, <span class="dv">12</span>,   <span class="dv">11</span>,  <span class="st">&quot;Rural&quot;</span>, <span class="st">&quot;negative&quot;</span>,</span>
<span id="cb698-24"><a href="joining_matching.html#cb698-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Trang&quot;</span>,    <span class="cn">NA</span>,          <span class="st">&quot;Nguyen&quot;</span>,       <span class="dv">1981</span>, <span class="dv">06</span>,   <span class="dv">10</span>,  <span class="st">&quot;Rural&quot;</span>, <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb698-25"><a href="joining_matching.html#cb698-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,      <span class="st">&quot;Olivier&quot;</span> , <span class="st">&quot;Laurent&quot;</span>,   <span class="st">&quot;De Bordeaux&quot;</span>,  <span class="cn">NA</span>,   <span class="cn">NA</span>,   <span class="cn">NA</span>,  <span class="st">&quot;River&quot;</span>, <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb698-26"><a href="joining_matching.html#cb698-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,      <span class="st">&quot;Mike&quot;</span>,     <span class="st">&quot;Murphy&quot;</span>,    <span class="st">&quot;O&#39;Callaghan&quot;</span>,  <span class="dv">1969</span>, <span class="dv">04</span>,   <span class="dv">12</span>,  <span class="st">&quot;Rural&quot;</span>, <span class="st">&quot;negative&quot;</span>,</span>
<span id="cb698-27"><a href="joining_matching.html#cb698-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Cassidy&quot;</span>,  <span class="st">&quot;Jones&quot;</span>,     <span class="st">&quot;Davis&quot;</span>,        <span class="dv">1980</span>, <span class="dv">07</span>,   <span class="dv">02</span>,  <span class="st">&quot;City&quot;</span>,  <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb698-28"><a href="joining_matching.html#cb698-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,      <span class="st">&quot;Mohammad&quot;</span>, <span class="cn">NA</span>,          <span class="st">&quot;Ali&quot;</span>,          <span class="dv">1942</span>, <span class="dv">01</span>,   <span class="dv">17</span>,  <span class="st">&quot;City&quot;</span>,  <span class="st">&quot;negative&quot;</span>,</span>
<span id="cb698-29"><a href="joining_matching.html#cb698-29" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span>,       <span class="st">&quot;Jose&quot;</span>,     <span class="st">&quot;Sanchez&quot;</span>,   <span class="st">&quot;Lopez&quot;</span>,        <span class="dv">1995</span>, <span class="dv">01</span>,   <span class="dv">06</span>,  <span class="st">&quot;City&quot;</span>,  <span class="st">&quot;negative&quot;</span>,</span>
<span id="cb698-30"><a href="joining_matching.html#cb698-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,      <span class="st">&quot;Abubakar&quot;</span>, <span class="cn">NA</span>,          <span class="st">&quot;Abullahi&quot;</span>,     <span class="dv">1960</span>, <span class="dv">01</span>,   <span class="dv">01</span>,  <span class="st">&quot;River&quot;</span>, <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb698-31"><a href="joining_matching.html#cb698-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Maria&quot;</span>,    <span class="st">&quot;Salinas&quot;</span>,   <span class="st">&quot;Contreras&quot;</span>,    <span class="dv">1955</span>, <span class="dv">03</span>,   <span class="dv">03</span>,  <span class="st">&quot;River&quot;</span>, <span class="st">&quot;positive&quot;</span></span>
<span id="cb698-32"><a href="joining_matching.html#cb698-32" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><strong>Le dataframe <code>cases</code> a 9 observations</strong> de patients attendant les résultats de leur test.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8da64c1b4ec56469d2d4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8da64c1b4ec56469d2d4">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><strong>Le dataframe <code>test_results</code></strong> a 14 observations et contient la colonne <code>result</code>, qui contient des informations que nous voudrions rapatrier dans le jeu de données <code>cases</code> en utilisant un algorithme probabiliste pour faire correspondre les observations.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-41372538a616b964b8dd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-41372538a616b964b8dd">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","F","F","F","M","M","F","M",null,"M","F"],["Amir","Tony","Maria","Betty","Andrea","Caroline","Trang","Olivier","Mike","Cassidy","Mohammad","Jose","Abubakar","Maria"],[null,"B","Contreras","Castel",null,null,null,"Laurent","Murphy","Jones",null,"Sanchez",null,"Salinas"],["Khan","Smith","Rodriguez","Chase","Kumaraswamy","Wang","Nguyen","De Bordeaux","O'Callaghan","Davis","Ali","Lopez","Abullahi","Contreras"],[1989,1970,1972,1954,2001,1988,1981,null,1969,1980,1942,1995,1960,1955],[11,9,4,3,1,12,6,null,4,7,1,1,1,3],[22,19,15,30,5,11,10,null,12,2,17,6,1,3],["River","River","Cty","City","Rural","Rural","Rural","River","Rural","City","City","City","River","River"],["positive","positive","negative","positive","positive","negative","positive","positive","negative","positive","negative","negative","positive","positive"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":14,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,14,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<div id="appariement-probabiliste" class="section level3 unnumbered">
<h3>Appariement probabiliste</h3>
<p>La fonction <code>fastLink()</code> du paquet <strong>fastLink</strong> peut être utilisée pour appliquer un algorithme probabiliste de correspondance. Voici quelques informations basiques, mais vous pouvez en savoir plus en tapant <code>?fastLink</code> dans la console.</p>
<ul>
<li>Définir les deux dataframes à comparer grâce aux arguments <code>dfA =</code> et <code>dfB =</code>.<br />
</li>
<li>Dans <code>varnames =</code>, indiquer les noms de toutes les colonnes à utiliser pour la comparaison. Ces colonnes doivent exister à la fois dans <code>dfA</code> et <code>dfB</code>.<br />
</li>
<li>Dans <code>stringdist.match =</code>, donner les colonnes sur lesquelles effectuer le calcul de la distance de similarité entre les chaînes de caractère (ce ou ces colonnes doivent être présentes dans <code>varnames</code>).<br />
</li>
<li>Dans <code>numeric.match =</code>, donner les colonnes sur lesquelles calculer une mesure de distance numérique (ce ou ces colonnes doivent être présentes dans <code>varnames</code>).<br />
</li>
<li>Les valeurs manquantes sont ignorées.<br />
</li>
<li>Par défaut, chaque ligne de l’un des deux dataframes est comparée à une ligne au maximum de l’autre dataframe. Si vous voulez voir toutes les correspondances évaluées, choisissez <code>dedupe.matches = FALSE</code>. La dé-duplication est faite en utilisant la technique de programmation linéaire de Winkler.</li>
</ul>
<p><em>Astuce : divisez une colonne de date en trois colonnes numériques distinctes en utilisant <code>day()</code>, <code>month()</code>, et <code>year()</code> du package <strong>lubridate</strong></em>.</p>
<p>Le seuil par défaut pour les correspondances est de 0.94 (<code>threshold.match =</code>) mais il peut être ajusté. Un seuil plus élevé peut produire plus de faux négatifs (des lignes qui ne correspondent pas alors qu’elles devraient correspondre) et un seuil plus bas peut produire plus de faux positifs.</p>
<p>Ci-dessous, les données sont comparées sur la base de la distance de similarité entre les chaînes de caractères dans les colonnes du nom et du district, et sur la base de la distance numérique pour l’année, le mois et le jour de naissance. Un seuil de correspondance de 95% de probabilité est fixé.</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="joining_matching.html#cb699-1" aria-hidden="true" tabindex="-1"></a>fl_output <span class="ot">&lt;-</span> fastLink<span class="sc">::</span><span class="fu">fastLink</span>(</span>
<span id="cb699-2"><a href="joining_matching.html#cb699-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dfA =</span> cases,</span>
<span id="cb699-3"><a href="joining_matching.html#cb699-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dfB =</span> results,</span>
<span id="cb699-4"><a href="joining_matching.html#cb699-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&quot;gender&quot;</span>, <span class="st">&quot;first&quot;</span>, <span class="st">&quot;middle&quot;</span>, <span class="st">&quot;last&quot;</span>, <span class="st">&quot;yr&quot;</span>, <span class="st">&quot;mon&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;district&quot;</span>),</span>
<span id="cb699-5"><a href="joining_matching.html#cb699-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringdist.match =</span> <span class="fu">c</span>(<span class="st">&quot;first&quot;</span>, <span class="st">&quot;middle&quot;</span>, <span class="st">&quot;last&quot;</span>, <span class="st">&quot;district&quot;</span>),</span>
<span id="cb699-6"><a href="joining_matching.html#cb699-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">numeric.match =</span> <span class="fu">c</span>(<span class="st">&quot;yr&quot;</span>, <span class="st">&quot;mon&quot;</span>, <span class="st">&quot;day&quot;</span>),</span>
<span id="cb699-7"><a href="joining_matching.html#cb699-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold.match =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>## 
## ==================== 
## fastLink(): Fast Probabilistic Record Linkage
## ==================== 
## 
## If you set return.all to FALSE, you will not be able to calculate a confusion table as a summary statistic.
## Calculating matches for each variable.
## Getting counts for parameter estimation.
##     Parallelizing calculation using OpenMP. 1 threads out of 8 are used.
## Running the EM algorithm.
## Getting the indices of estimated matches.
##     Parallelizing calculation using OpenMP. 1 threads out of 8 are used.
## Deduping the estimated matches.
## Getting the match patterns for each estimated match.</code></pre>
<p><strong>Vérification des correspondance</strong></p>
<p>L’objet <code>fl_output</code> contient la sortie de la fonction <code>fastLink()</code>. Cet objet est une liste (classe <code>list</code>) qui contient plusieurs dataframes détaillant les résultats de l’analyse des correspondances. Le dataframe <code>matches</code> contient les correspondances les plus probables entre <code>cases</code> et <code>results</code>. On peut y accéder avec la commande <code>fl_output$matches</code>. Ci-dessous, nous l’enregistrons sous le nom de <code>my_matches</code> pour faciliter son accès ultérieur.</p>
<p>Le dataframe <code>my_matches</code> contient deux colonnes contenant les numéros de lignes/indices (aussi appelés “rownames”) de <code>cases</code> (“inds.a”) et de <code>results</code> (“inds.b”), représentant les meilleures correspondances. Si un numéro de ligne d’un dataframe est manquant, alors aucune correspondance n’a été trouvée dans l’autre dataframe au seuil de correspondance spécifié.</p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="joining_matching.html#cb701-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print matches</span></span>
<span id="cb701-2"><a href="joining_matching.html#cb701-2" aria-hidden="true" tabindex="-1"></a>my_matches <span class="ot">&lt;-</span> fl_output<span class="sc">$</span>matches</span>
<span id="cb701-3"><a href="joining_matching.html#cb701-3" aria-hidden="true" tabindex="-1"></a>my_matches</span></code></pre></div>
<pre><code>##   inds.a inds.b
## 1      1      1
## 2      2      2
## 3      3      3
## 4      4      4
## 5      8      8
## 6      7      9
## 7      6     10
## 8      5     12</code></pre>
<p>On observe que :</p>
<ul>
<li>Les correspondances ont été trouvées malgré les légères différences dans l’orthographe des noms et les dates de naissance, c’est la beauté de ce type d’approche :
<ul>
<li>“Tony B. Smith” correspond à “Anthony B. Smith”.<br />
</li>
<li>“Maria Rodriguez” correspond à “Marialisa Rodrigues”.<br />
</li>
<li>“Betty Chase” correspond à “Elizabeth Chase”.<br />
</li>
<li>“Olivier Laurent De Bordeaux” correspond à “Oliver Laurent De Bordow” (date de naissance manquante ignorée).<br />
</li>
</ul></li>
<li>Une ligne de <code>cases</code> (pour “Blessing Adebayo”, ligne 9) n’avait pas de bonne correspondance dans <code>results</code>, elle n’est donc pas présente dans <code>my_matches</code>.</li>
</ul>
<p><strong>Jointure basée sur les correspondances probabilistes</strong>.</p>
<p>Pour utiliser ces correspondances afin de joindre les <code>results</code> aux <code>cases</code>, une stratégie consiste à :</p>
<ol style="list-style-type: decimal">
<li>Utiliser <code>left_join()</code> pour joindre <code>my_matches</code> à <code>cases</code> (en faisant correspondre les rownames dans <code>cases</code> à “inds.a” dans <code>my_matches</code>)<br />
</li>
<li>Utiliser ensuite un autre <code>left_join()</code> pour joindre <code>results</code> à <code>cases</code> (en faisant correspondre les “inds.b” nouvellement acquis dans <code>cases</code> aux noms de domaine dans <code>results</code>).</li>
</ol>
<p>Avant les jointures, nous devons nettoyer les trois dataframes :</p>
<ul>
<li>Les numéros de ligne (“rowname”) de <code>dfA</code> et <code>dfB</code> doivent être convertis en une colonne.<br />
</li>
<li>Les deux colonnes de <code>my_matches</code> sont converties en chaînes de caractères, donc elles peuvent être jointes aux caractères rownames.</li>
</ul>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="joining_matching.html#cb703-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Préparation des dataframes avant la jointure</span></span>
<span id="cb703-2"><a href="joining_matching.html#cb703-2" aria-hidden="true" tabindex="-1"></a><span class="do">#############################</span></span>
<span id="cb703-3"><a href="joining_matching.html#cb703-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-4"><a href="joining_matching.html#cb703-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Covertir les numéros de lignes en colonne</span></span>
<span id="cb703-5"><a href="joining_matching.html#cb703-5" aria-hidden="true" tabindex="-1"></a>cases_clean   <span class="ot">&lt;-</span> cases <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>()</span>
<span id="cb703-6"><a href="joining_matching.html#cb703-6" aria-hidden="true" tabindex="-1"></a>results_clean <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>()  </span>
<span id="cb703-7"><a href="joining_matching.html#cb703-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-8"><a href="joining_matching.html#cb703-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir toutes les colonnes du dataframe des correspondances en texte pour pouvoire les joindre aux numéros de ligne</span></span>
<span id="cb703-9"><a href="joining_matching.html#cb703-9" aria-hidden="true" tabindex="-1"></a>matches_clean <span class="ot">&lt;-</span> my_matches <span class="sc">%&gt;%</span></span>
<span id="cb703-10"><a href="joining_matching.html#cb703-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.character))</span>
<span id="cb703-11"><a href="joining_matching.html#cb703-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-12"><a href="joining_matching.html#cb703-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-13"><a href="joining_matching.html#cb703-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-14"><a href="joining_matching.html#cb703-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Joindre `clean_matches` à dfA, puis ajouer dfB</span></span>
<span id="cb703-15"><a href="joining_matching.html#cb703-15" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb703-16"><a href="joining_matching.html#cb703-16" aria-hidden="true" tabindex="-1"></a><span class="co"># la colonne &quot;inds.b&quot; est ajoutée à dfA</span></span>
<span id="cb703-17"><a href="joining_matching.html#cb703-17" aria-hidden="true" tabindex="-1"></a>complete <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cases_clean, matches_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;rowname&quot;</span> <span class="ot">=</span> <span class="st">&quot;inds.a&quot;</span>))</span>
<span id="cb703-18"><a href="joining_matching.html#cb703-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-19"><a href="joining_matching.html#cb703-19" aria-hidden="true" tabindex="-1"></a><span class="co"># les colonnes de dfB sont rappatriées </span></span>
<span id="cb703-20"><a href="joining_matching.html#cb703-20" aria-hidden="true" tabindex="-1"></a>complete <span class="ot">&lt;-</span> <span class="fu">left_join</span>(complete, results_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;inds.b&quot;</span> <span class="ot">=</span> <span class="st">&quot;rowname&quot;</span>))</span></code></pre></div>
<p>Le dataframe <code>complete</code> ainsi crée contient <em>toutes</em> les colonnes de <code>cases</code> et de <code>results</code>. Beaucoup d’entre elles se retrouvent ajoutées avec les suffixes “.x” et “.y”, parce que les noms des colonnes seraient dupliqués sinon.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cb7a6d9a03d66b2b433c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cb7a6d9a03d66b2b433c">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"],["1","2","3","4","12","10","9","8",null],["M","M","F","F",null,"F","M","M",null],["Amir","Tony","Maria","Betty","Jose","Cassidy","Mike","Olivier",null],[null,"B","Contreras","Castel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodriguez","Chase","Lopez","Davis","O'Callaghan","De Bordeaux",null],[1989,1970,1972,1954,1995,1980,1969,null,null],[11,9,4,3,1,7,4,null,null],[22,19,15,30,6,2,12,null,null],["River","River","Cty","City","City","City","Rural","River",null],["positive","positive","negative","positive","negative","positive","negative","positive",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>rowname<\/th>\n      <th>gender.x<\/th>\n      <th>first.x<\/th>\n      <th>middle.x<\/th>\n      <th>last.x<\/th>\n      <th>yr.x<\/th>\n      <th>mon.x<\/th>\n      <th>day.x<\/th>\n      <th>district.x<\/th>\n      <th>inds.b<\/th>\n      <th>gender.y<\/th>\n      <th>first.y<\/th>\n      <th>middle.y<\/th>\n      <th>last.y<\/th>\n      <th>yr.y<\/th>\n      <th>mon.y<\/th>\n      <th>day.y<\/th>\n      <th>district.y<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7,14,15,16]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Pour obtenir seulement les 9 observations “originales” dans <code>cases</code> avec la ou les nouvelles colonnes de <code>results</code>, utiliser <code>select()</code> sur <code>results</code> avant les jointures, de sorte que e dataframe ne contienne que les rownames et les colonnes que vous voulez ajouter à <code>cases</code> (par exemple la colonne <code>result</code>).</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="joining_matching.html#cb704-1" aria-hidden="true" tabindex="-1"></a>cases_clean <span class="ot">&lt;-</span> cases <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>()</span>
<span id="cb704-2"><a href="joining_matching.html#cb704-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb704-3"><a href="joining_matching.html#cb704-3" aria-hidden="true" tabindex="-1"></a>results_clean <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span></span>
<span id="cb704-4"><a href="joining_matching.html#cb704-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb704-5"><a href="joining_matching.html#cb704-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rowname, result)    <span class="co"># Sélectionner certaines colonnes</span></span>
<span id="cb704-6"><a href="joining_matching.html#cb704-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb704-7"><a href="joining_matching.html#cb704-7" aria-hidden="true" tabindex="-1"></a>matches_clean <span class="ot">&lt;-</span> my_matches <span class="sc">%&gt;%</span></span>
<span id="cb704-8"><a href="joining_matching.html#cb704-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.character))</span>
<span id="cb704-9"><a href="joining_matching.html#cb704-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb704-10"><a href="joining_matching.html#cb704-10" aria-hidden="true" tabindex="-1"></a><span class="co"># jointure</span></span>
<span id="cb704-11"><a href="joining_matching.html#cb704-11" aria-hidden="true" tabindex="-1"></a>complete <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cases_clean, matches_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;rowname&quot;</span> <span class="ot">=</span> <span class="st">&quot;inds.a&quot;</span>))</span>
<span id="cb704-12"><a href="joining_matching.html#cb704-12" aria-hidden="true" tabindex="-1"></a>complete <span class="ot">&lt;-</span> <span class="fu">left_join</span>(complete, results_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;inds.b&quot;</span> <span class="ot">=</span> <span class="st">&quot;rowname&quot;</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-eb8e9e01010bb8936f87" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-eb8e9e01010bb8936f87">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"],["1","2","3","4","12","10","9","8",null],["positive","positive","negative","positive","negative","positive","negative","positive",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>rowname<\/th>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>inds.b<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Si vous voulez ne garder que les lignes qui avec des correspondances dans l’un ou l’autre des des dataframe, vous pouvez utiliser les codes ci-dessous :</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="joining_matching.html#cb705-1" aria-hidden="true" tabindex="-1"></a>cases_matched <span class="ot">&lt;-</span> cases[my_matches<span class="sc">$</span>inds.a,]  <span class="co"># Lignes de  `cases` qui matchent une ligne dans &#39;results&#39;</span></span>
<span id="cb705-2"><a href="joining_matching.html#cb705-2" aria-hidden="true" tabindex="-1"></a>results_matched <span class="ot">&lt;-</span> results[my_matches<span class="sc">$</span>inds.b,]  <span class="co"># Lignes de &#39;results qui matchent une ligne dans `cases`</span></span></code></pre></div>
<p>Ou pour ne voir que les lignes <strong>sans correspondances</strong> :</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb706-1"><a href="joining_matching.html#cb706-1" aria-hidden="true" tabindex="-1"></a>cases_not_matched <span class="ot">&lt;-</span> cases[<span class="sc">!</span><span class="fu">rownames</span>(cases) <span class="sc">%in%</span> my_matches<span class="sc">$</span>inds.a,]  <span class="co"># Lignes dans `cases` sans matchs dans `results`</span></span>
<span id="cb706-2"><a href="joining_matching.html#cb706-2" aria-hidden="true" tabindex="-1"></a>results_not_matched <span class="ot">&lt;-</span> results[<span class="sc">!</span><span class="fu">rownames</span>(results) <span class="sc">%in%</span> my_matches<span class="sc">$</span>inds.b,]  <span class="co"># Lignes dans  `results` sans matchs dans `cases`</span></span></code></pre></div>
</div>
<div id="déduplication-probabiliste" class="section level3 unnumbered">
<h3>Déduplication probabiliste</h3>
<p>La correspondance probabiliste peut également être utilisée pour dé-dupliquer un jeu de données. Voir la page sur la dé-duplication pour d’autres méthodes de dé-duplication.</p>
<p>Ici, nous modifions le tableau <code>cases</code>, en ajoutant des lignes supplémentaires qui peuvent être des doublons de lignes existantes, et l’appelons <code>cases_dup</code>; voir “Tony” avec “Anthony”, et “Marialisa Rodrigues” avec “Maria Rodriguez”.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e615544f3c230acdc92d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e615544f3c230acdc92d">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing","Tony","Maria"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null,"B.","Contreras"],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo","Smith","Rodriguez"],[1989,1970,1972,1954,1996,1980,1969,1971,1955,1970,1972],[11,9,4,3,1,7,4,2,2,9,4],[22,19,15,3,6,20,12,4,14,19,15],["River","River","River","City","City","City","Rural","River","Rural","River","River"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":[4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>On peut désormais utiliser la fonction <code>fastLink()</code> comme précédemment, mais en comparant le jeu de données <code>cases_dup</code> à lui-même. Lorsque les dataframes fournis en argument sont identiques, la fonction suppose que vous voulez dé-dupliquer.</p>
<p>Notez que nous ne spécifions pas <code>stringdist.match =</code> ou <code>numeric.match =</code> comme nous le faisions précédemment.</p>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="joining_matching.html#cb707-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Utiliser fastLink sur le même jeu de données</span></span>
<span id="cb707-2"><a href="joining_matching.html#cb707-2" aria-hidden="true" tabindex="-1"></a>dedupe_output <span class="ot">&lt;-</span> <span class="fu">fastLink</span>(</span>
<span id="cb707-3"><a href="joining_matching.html#cb707-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dfA =</span> cases_dup,</span>
<span id="cb707-4"><a href="joining_matching.html#cb707-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dfB =</span> cases_dup,</span>
<span id="cb707-5"><a href="joining_matching.html#cb707-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&quot;gender&quot;</span>, <span class="st">&quot;first&quot;</span>, <span class="st">&quot;middle&quot;</span>, <span class="st">&quot;last&quot;</span>, <span class="st">&quot;yr&quot;</span>, <span class="st">&quot;mon&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;district&quot;</span>)</span>
<span id="cb707-6"><a href="joining_matching.html#cb707-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## 
## ==================== 
## fastLink(): Fast Probabilistic Record Linkage
## ==================== 
## 
## If you set return.all to FALSE, you will not be able to calculate a confusion table as a summary statistic.
## dfA and dfB are identical, assuming deduplication of a single data set.
## Setting return.all to FALSE.
## 
## Calculating matches for each variable.
## Getting counts for parameter estimation.
##     Parallelizing calculation using OpenMP. 1 threads out of 8 are used.
## Running the EM algorithm.
## Getting the indices of estimated matches.
##     Parallelizing calculation using OpenMP. 1 threads out of 8 are used.
## Calculating the posterior for each pair of matched observations.
## Getting the match patterns for each estimated match.</code></pre>
<p>La fonction <code>getMatches()</code> permet d’examiner la sortie de <code>fastLink</code> pour rechercher les doublons potentiels.
Il faut fournir le dataframe d’origine à <code>dfA =</code> <em>et</em> <code>dfB =</code>, ainsi que la sortie de <code>fastLink()</code> à <code>fl.out =</code>.</p>
<p>Note : <code>fl.out</code> doit nécessairement être de la classe <code>fastLink.dedupe</code>, ou en d’autres termes, le résultat de <code>fastLink()</code>.</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="joining_matching.html#cb709-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Executer getMatches()</span></span>
<span id="cb709-2"><a href="joining_matching.html#cb709-2" aria-hidden="true" tabindex="-1"></a>cases_dedupe <span class="ot">&lt;-</span> <span class="fu">getMatches</span>(</span>
<span id="cb709-3"><a href="joining_matching.html#cb709-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dfA =</span> cases_dup,</span>
<span id="cb709-4"><a href="joining_matching.html#cb709-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dfB =</span> cases_dup,</span>
<span id="cb709-5"><a href="joining_matching.html#cb709-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fl.out =</span> dedupe_output)</span></code></pre></div>
<p>La colonne la plus à droite indique les identifiants des doublons. Ici les deux dernières lignes sont identifiées comme étant des doublons probables des lignes 2 et 3.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-85677134c263697b8c2b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-85677134c263697b8c2b">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing","Tony","Maria"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null,"B.","Contreras"],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo","Smith","Rodriguez"],[1989,1970,1972,1954,1996,1980,1969,1971,1955,1970,1972],[11,9,4,3,1,7,4,2,2,9,4],[22,19,15,3,6,20,12,4,14,19,15],["River","River","River","City","City","City","Rural","River","Rural","River","River"],[1,2,3,4,5,6,7,8,9,2,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>dedupe.ids<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":[4,5,6,8]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Pour obtenir les numéros de ligne des lignes qui sont potentiellement des doublons, il suffit de compter le nombre de lignes par valeur unique dans la colonne <code>dedupe.ids</code>, puis de filtrer pour ne garder que celles qui ont plus d’une ligne. Dans ce cas, nous obtenons laisse les lignes 2 et 3.</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb710-1"><a href="joining_matching.html#cb710-1" aria-hidden="true" tabindex="-1"></a>cases_dedupe <span class="sc">%&gt;%</span> </span>
<span id="cb710-2"><a href="joining_matching.html#cb710-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(dedupe.ids) <span class="sc">%&gt;%</span> </span>
<span id="cb710-3"><a href="joining_matching.html#cb710-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##   dedupe.ids n
## 1          2 2
## 2          3 2</code></pre>
<p>Pour inspecter les doublons, on peut utiliser le numéro de ligne pour obtenir la ligne complète :</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb712-1"><a href="joining_matching.html#cb712-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher la ligne 2 et ses duplicats probables</span></span>
<span id="cb712-2"><a href="joining_matching.html#cb712-2" aria-hidden="true" tabindex="-1"></a>cases_dedupe[cases_dedupe<span class="sc">$</span>dedupe.ids <span class="sc">==</span> <span class="dv">2</span>,]   </span></code></pre></div>
<pre><code>##    gender   first middle  last   yr mon day district dedupe.ids
## 2       M Anthony     B. Smith 1970   9  19    River          2
## 10      M    Tony     B. Smith 1970   9  19    River          2</code></pre>
</div>
</div>
<div id="assembler-et-aligner-des-dataframes" class="section level2" number="14.4">
<h2><span class="header-section-number">14.4</span> Assembler et aligner des dataframes</h2>
<p>Une autre manière de combiner deux dataframes consiste à les assembler/concaténer/coller/aligner. On peut également considérer cette méthode comme un ajout de lignes ou de colonnes.</p>
<p>Cette section explique également comment “aligner” l’ordre des lignes d’un dataframe sur celui d’un autre dataframe. Ce sujet est abordé ci-dessous dans la section consacrée à la liaison des colonnes.</p>
<div id="assembler-verticallement" class="section level3 unnumbered">
<h3>Assembler verticallement</h3>
<p>La fonction <code>bind_rows()</code> de <strong>dplyr</strong> permet de coller les lignes d’un dataframe à la suite d’un autre dataframe (verticalement, donc). Elle est très inclusive : toute colonne présente dans l’un ou l’autre des dataframes sera incluse dans la sortie.</p>
<p>Quelques notes :</p>
<ul>
<li><p>Contrairement à la version <strong>base</strong> de R <code>row.bind()</code>, <strong>dplyr</strong>’s <code>bind_rows()</code> n’exige pas que l’ordre des colonnes soit le même dans les deux dataframes à assembler. Du moment que les noms des colonnes sont orthographiés de manière identique, la fonction les alignera correctement.</p></li>
<li><p>Il est possible de fournir une chaîne de caractères à l’argument <code>.id =</code> pour produire une nouvelle colonne qui servira à identifier de quel dataframe chaque ligne provient à l’origine.</p></li>
<li><p>Il est possible d’utiliser <code>bind_rows()</code> sur une liste de dataframes possédant la même structure pour les combiner en un seul. Vous trouverez un exemple de cette action dans la page <a href="iteration.html#iteration">Itération, boucles et listes</a> qui importe plusieurs linelists avec le paquet <strong>purrr</strong>.</p></li>
</ul>
<p>Un exemple classique d’assemblage de dataframes est d’ajouter une ligne “total” à un tableau descriptif créé avec la fonction <code>summarise()</code> de <strong>dplyr</strong>. Ci-dessous, nous créons un tableau des nombres de cas et des valeurs médianes de CT par hôpital et y ajoutons une ligne de total.</p>
<p>La fonction <code>summarise()</code> est utilisée sur des données groupées par hôpital pour retourner un dataframe récapitulatif par hôpital. Malheureusement, elle ne produit pas automatiquement une ligne de “totaux”, donc nous devons la rajouter nous même. Nous l’obtenons en résumant <em>à nouveau</em> ces données, mais sans grouper par hôpital. Cela produit un deuxième dataframe d’une seule ligne, que nous concaténons ensuite au premier pour obtenir le tableau final.</p>
<p>Vous trouverez d’autres exemples de ce type dans les pages <a href="descriptive_tables.html#descriptive_tables">Tableaux descriptifs</a> et <a href="#presentation_tables">Tableaux de présentation</a>.</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb714-1"><a href="joining_matching.html#cb714-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer la table de base</span></span>
<span id="cb714-2"><a href="joining_matching.html#cb714-2" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb714-3"><a href="joining_matching.html#cb714-3" aria-hidden="true" tabindex="-1"></a>hosp_summary <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb714-4"><a href="joining_matching.html#cb714-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span>      <span class="co"># grouper les données par hôpital</span></span>
<span id="cb714-5"><a href="joining_matching.html#cb714-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(                  <span class="co"># Créer résumé :</span></span>
<span id="cb714-6"><a href="joining_matching.html#cb714-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cases =</span> <span class="fu">n</span>(),               <span class="co"># NNombre de lignes par hôpital</span></span>
<span id="cb714-7"><a href="joining_matching.html#cb714-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ct_value_med =</span> <span class="fu">median</span>(ct_blood, <span class="at">na.rm=</span>T))     <span class="co"># Médiane du CT par hôpital</span></span></code></pre></div>
<p>Voici à quoi ressemble <code>hosp_summary</code> :</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-64c08074a73f5f7a26c1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-64c08074a73f5f7a26c1">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[454,896,1469,885,1762,422],[22,21,21,22,22,22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Maintenant nous créons un dataframe d’une seule ligne contenant les statistiques pour tous les hôpitaux (données <em>non groupées</em>) :</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="joining_matching.html#cb715-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer la ligne de totaux</span></span>
<span id="cb715-2"><a href="joining_matching.html#cb715-2" aria-hidden="true" tabindex="-1"></a><span class="do">###############</span></span>
<span id="cb715-3"><a href="joining_matching.html#cb715-3" aria-hidden="true" tabindex="-1"></a>totals <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb715-4"><a href="joining_matching.html#cb715-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb715-5"><a href="joining_matching.html#cb715-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cases =</span> <span class="fu">n</span>(),                               <span class="co"># Nb lignes dataframe entier</span></span>
<span id="cb715-6"><a href="joining_matching.html#cb715-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ct_value_med =</span> <span class="fu">median</span>(ct_blood, <span class="at">na.rm=</span>T))  <span class="co"># Médiane du CT</span></span></code></pre></div>
<p>Ci-dessous, le dataframe <code>totals</code>. Remarquez qu’il n’y a que deux colonnes alors que <code>hosp_summary</code> en contenant trois. Ce n’est pas un problème.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-45874600fe0adaa0c762" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-45874600fe0adaa0c762">{"x":{"filter":"none","vertical":false,"data":[[5888],[22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1]}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Nous utilisons à présent <code>bind_rows()</code> pour assembler les deux dataframes :</p>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb716-1"><a href="joining_matching.html#cb716-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combiner les deux dataframes ensemble</span></span>
<span id="cb716-2"><a href="joining_matching.html#cb716-2" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(hosp_summary, totals)</span></code></pre></div>
<p>Pour le résultat ci-dessous. Dans la dernière ligne, une valeur vide <code>NA</code> a été automatiquement insérée dans la colonne <code>hospital</code>, qui n’était pas dans <code>hosp_summary</code>. Comme expliqué dans la page <a href="#presentation_tables">Tableaux de présentation</a>, il est possible de “remplir” cette cellule avec “Total” en utilisant <code>replace_na()</code>.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-77ad2ef7fc421975cf55" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-77ad2ef7fc421975cf55">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null],[454,896,1469,885,1762,422,5888],[22,21,21,22,22,22,22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="assembler-des-colonnes-latéralement" class="section level3 unnumbered">
<h3>Assembler des colonnes latéralement</h3>
<p>De manière assez similaire, il existe une fonction <code>bind_cols()</code> dans <strong>dplyr</strong> qui combine deux dataframes latéralement. <strong>En revanche, contrairement aux jointures, les lignes sont alignées les unes aux autres par position</strong> : la ligne X du dataframe 1 sera alignée à la ligne X du dataframe 2.</p>
<p>Par exemple, nous allons assembler plusieurs tableaux récapitulatifs. Nous montrerons au passage comment réarranger l’ordre des lignes d’un dataframe pour qu’il corresponde à l’ordre dans un autre dataframe, à l’aide de la fonction <code>match()</code>.</p>
<p>Ici, nous définissons <code>case_info</code> comme un dataframe récapitulatif des cas de la liste linéaire, par hôpital, avec le nombre de cas et le nombre de décès.</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="joining_matching.html#cb717-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Information sur les cas </span></span>
<span id="cb717-2"><a href="joining_matching.html#cb717-2" aria-hidden="true" tabindex="-1"></a>case_info <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb717-3"><a href="joining_matching.html#cb717-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb717-4"><a href="joining_matching.html#cb717-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb717-5"><a href="joining_matching.html#cb717-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cases =</span> <span class="fu">n</span>(),</span>
<span id="cb717-6"><a href="joining_matching.html#cb717-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">deaths =</span> <span class="fu">sum</span>(outcome <span class="sc">==</span> <span class="st">&quot;Death&quot;</span>, <span class="at">na.rm=</span>T)</span>
<span id="cb717-7"><a href="joining_matching.html#cb717-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4770fe7dc761567d09c3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4770fe7dc761567d09c3">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[454,896,1469,885,1762,422],[193,399,611,395,785,199]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Nous définissons également <code>contact_fu</code>, un autre dataframe contenant des informations sur le pourcentage de contacts exposés ayant fait l’objet d’une enquête et d’un “suivi”, toujours par hôpital.</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb718-1"><a href="joining_matching.html#cb718-1" aria-hidden="true" tabindex="-1"></a>contact_fu <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb718-2"><a href="joining_matching.html#cb718-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">hospital =</span> <span class="fu">c</span>(<span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span>, <span class="st">&quot;Military Hospital&quot;</span>, <span class="st">&quot;Missing&quot;</span>, <span class="st">&quot;Central Hospital&quot;</span>, <span class="st">&quot;Port Hospital&quot;</span>, <span class="st">&quot;Other&quot;</span>),</span>
<span id="cb718-3"><a href="joining_matching.html#cb718-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">investigated =</span> <span class="fu">c</span>(<span class="st">&quot;80%&quot;</span>, <span class="st">&quot;82%&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;78%&quot;</span>, <span class="st">&quot;64%&quot;</span>, <span class="st">&quot;55%&quot;</span>),</span>
<span id="cb718-4"><a href="joining_matching.html#cb718-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">per_fu =</span> <span class="fu">c</span>(<span class="st">&quot;60%&quot;</span>, <span class="st">&quot;25%&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;20%&quot;</span>, <span class="st">&quot;75%&quot;</span>, <span class="st">&quot;80%&quot;</span>)</span>
<span id="cb718-5"><a href="joining_matching.html#cb718-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-15388d51a8d431ba06ce" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-15388d51a8d431ba06ce">{"x":{"filter":"none","vertical":false,"data":[["St. Mark's Maternity Hospital (SMMH)","Military Hospital","Missing","Central Hospital","Port Hospital","Other"],["80%","82%",null,"78%","64%","55%"],["60%","25%",null,"20%","75%","80%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>investigated<\/th>\n      <th>per_fu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Notez que les hôpitaux sont les mêmes, mais dans un ordre différent dans les deux dataframes. La solution la plus simple serait d’utiliser un <code>left_join()</code> sur la colonne <code>hospital</code>, mais il est aussi possible d’utiliser <code>bind_cols()</code> avec une étape supplémentaire.</p>
<div id="utiliser-match-pour-homogénéiser-lordre-des-lignes" class="section level4 unnumbered">
<h4>Utiliser <code>match()</code> pour homogénéiser l’ordre des lignes</h4>
<p>Comme l’ordre des lignes est différent, un simple <code>bind_cols()</code> entraînerait une mauvaise correspondance des données. Pour résoudre ce problème, nous pouvons utiliser la fonction <code>match()</code> de <strong>base</strong> R pour aligner les lignes d’un dataframes dans le même ordre que dans un autre. Pour cette approche, nous supposons qu’il n’y a pas de doublons dans les dataframes.</p>
<p>Lorsque nous utilisons <code>match()</code>, la syntaxe est <code>match(vecteur/colonne dans l'ordre désiré, colonne de dataframe à ordonner)</code>, où le premier argument est l’ordre souhaité (soit un vecteur autonome, soit une colonne d’un dataframe), et le second argument est la colonne du dataframe qui sera réordonnée. La sortie de <code>match()</code> est un vecteur de nombres représentant l’ordre correct des positions. Vous pouvez en savoir plus avec <code>?match</code>.</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="joining_matching.html#cb719-1" aria-hidden="true" tabindex="-1"></a><span class="fu">match</span>(case_info<span class="sc">$</span>hospital, contact_fu<span class="sc">$</span>hospital)</span></code></pre></div>
<pre><code>## [1] 4 2 3 6 5 1</code></pre>
<p>On peut utiliser ce vecteur numérique pour réorganiser le dataframe : placez-le entre des crochets <code>[ ]</code> <em>avant la virgule</em>. Pour en savoir plus sur la syntaxe des crochets pour séléctionner les lignes et/ou colonnes d’un dataframe en <strong>base</strong> R, consultez la page <a href="rbasics.html#rbasics">Bases de R</a>. La commande ci-dessous crée un nouveau dataframe, défini comme l’ancien dataframe dans lequel les lignes sont ordonnées selon le tableau numérique ci-dessus.</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb721-1"><a href="joining_matching.html#cb721-1" aria-hidden="true" tabindex="-1"></a>contact_fu_aligned <span class="ot">&lt;-</span> contact_fu[<span class="fu">match</span>(case_info<span class="sc">$</span>hospital, contact_fu<span class="sc">$</span>hospital),]</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b14fc9ddee240d5d7341" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b14fc9ddee240d5d7341">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],["78%","82%",null,"55%","64%","80%"],["20%","25%",null,"80%","75%","60%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>investigated<\/th>\n      <th>per_fu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Maintenant nous pouvons lier les colonnes du dataframe ensemble, avec l’ordre correct des lignes respecté. Notez que certaines colonnes sont dupliquées et devront être nettoyées avec <code>rename()</code>. Pour en savoir plus sur <code>bind_rows()</code>, rendez-vous <a href="https://dplyr.tidyverse.org/reference/bind.html">ici</a>.</p>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="joining_matching.html#cb722-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(case_info, contact_fu)</span></code></pre></div>
<pre><code>## New names:
## • `hospital` -&gt; `hospital...1`
## • `hospital` -&gt; `hospital...4`</code></pre>
<pre><code>## # A tibble: 6 × 6
##   hospital...1                         cases deaths hospital...4                         investigated per_fu
##   &lt;chr&gt;                                &lt;int&gt;  &lt;int&gt; &lt;chr&gt;                                &lt;chr&gt;        &lt;chr&gt; 
## 1 Central Hospital                       454    193 St. Mark&#39;s Maternity Hospital (SMMH) 80%          60%   
## 2 Military Hospital                      896    399 Military Hospital                    82%          25%   
## 3 Missing                               1469    611 Missing                              &lt;NA&gt;         &lt;NA&gt;  
## 4 Other                                  885    395 Central Hospital                     78%          20%   
## 5 Port Hospital                         1762    785 Port Hospital                        64%          75%   
## 6 St. Mark&#39;s Maternity Hospital (SMMH)   422    199 Other                                55%          80%</code></pre>
<p>Une alternative <strong>base</strong> R à <code>bind_cols</code> est <code>cbind()</code>, qui effectue la même opération.</p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="resources-3" class="section level2" number="14.5">
<h2><span class="header-section-number">14.5</span> Resources</h2>
<p>La <a href="https://dplyr.tidyverse.org/reference/join.html">page du tidyverse sur les jointures</a></p>
<p>Le <a href="https://r4ds.had.co.nz/relational-data.html">chapitre sur les données relationelles dans R for Data Science</a></p>
<p>La <a href="https://dplyr.tidyverse.org/reference/bind.html">page de dplyr sur bind</a> on binding</p>
<p>Une vignette sur<a href="https://github.com/kosukeimai/fastLink">fastLink</a> sur la page Github du paquet</p>
<p>Publication décrivant la méthodologie de <a href="https://imai.fas.harvard.edu/research/files/linkage.pdf">fastLink</a></p>
<p>Publication décrivant le paquet<a href="https://journal.r-project.org/archive/2010/RJ-2010-017/RJ-2010-017.pdf">RecordLinkage</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
