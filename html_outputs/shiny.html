<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>42 Tableaux de bord avec Shiny | Le Epi R Handbook</title>
<meta name="author" content="the handbook team">
<meta name="description" content="Les tableaux de bord sont souvent une excellente méthode de partager les résultats d’analyses avec d’autres personnes. Produire un tableau de bord avec shiny nécessite une connaissance...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="42 Tableaux de bord avec Shiny | Le Epi R Handbook">
<meta property="og:type" content="book">
<meta property="og:description" content="Les tableaux de bord sont souvent une excellente méthode de partager les résultats d’analyses avec d’autres personnes. Produire un tableau de bord avec shiny nécessite une connaissance...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="42 Tableaux de bord avec Shiny | Le Epi R Handbook">
<meta name="twitter:description" content="Les tableaux de bord sont souvent une excellente méthode de partager les résultats d’analyses avec d’autres personnes. Produire un tableau de bord avec shiny nécessite une connaissance...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.28/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.10/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Le Epi R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">About this book</li>
<li><a class="" href="editorial_notes.html"><span class="header-section-number">1</span> Notes techniques et choix éditoriaux</a></li>
<li><a class="" href="download_book_data.html"><span class="header-section-number">2</span> Télécharger le manuel et les données</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="rbasics.html"><span class="header-section-number">3</span> R - les bases</a></li>
<li><a class="" href="transition_to_r.html"><span class="header-section-number">4</span> Transition vers R</a></li>
<li><a class="" href="suggested_packages.html"><span class="header-section-number">5</span> Paquets conseillés</a></li>
<li><a class="" href="r_projects.html"><span class="header-section-number">6</span> Projets R</a></li>
<li><a class="" href="import_export.html"><span class="header-section-number">7</span> Importer et exporter des données</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning_data.html"><span class="header-section-number">8</span> Nettoyage de données et fonctions essentielles</a></li>
<li><a class="" href="working_dates.html"><span class="header-section-number">9</span> Manipuler les dates</a></li>
<li><a class="" href="character_strings.html"><span class="header-section-number">10</span> Caractères et chaînes de caractères</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Facteurs</a></li>
<li><a class="" href="pivoting_data.html"><span class="header-section-number">12</span> Restructurer les données</a></li>
<li><a class="" href="grouping_data.html"><span class="header-section-number">13</span> Travailler sur des données groupées</a></li>
<li><a class="" href="joining_matching.html"><span class="header-section-number">14</span> Joindre des données</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> De-duplication</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Itération, boucles et listes</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive_tables.html"><span class="header-section-number">17</span> Tableaux descriptifs</a></li>
<li><a class="" href="stats_test.html"><span class="header-section-number">18</span> Tests statistiques simples</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Régression univariée et multivariable</a></li>
<li><a class="" href="missing_data.html"><span class="header-section-number">20</span> Données manquantes</a></li>
<li><a class="" href="standardisation.html"><span class="header-section-number">21</span> Taux standardisés</a></li>
<li><a class="" href="moving_average.html"><span class="header-section-number">22</span> Moyennes mobiles</a></li>
<li><a class="" href="time_series.html"><span class="header-section-number">23</span> Série temporelle et détection des épidémies</a></li>
<li><a class="" href="contact_tracing.html"><span class="header-section-number">24</span> Suivi des contacts</a></li>
<li><a class="" href="survey_analysis.html"><span class="header-section-number">25</span> Analyse d’enquête</a></li>
<li><a class="" href="survival_analysis.html"><span class="header-section-number">26</span> Analyse de survie</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">27</span> GIS basics</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="tables_presentation.html"><span class="header-section-number">28</span> Présenter avec des tables</a></li>
<li><a class="" href="ggplot_basics.html"><span class="header-section-number">29</span> Les bases de ggplot</a></li>
<li><a class="" href="ggplot_tips.html"><span class="header-section-number">30</span> Trucs et Astuces avec ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">31</span> Courbes épidémiques</a></li>
<li><a class="" href="age_pyramid.html"><span class="header-section-number">32</span> Pyramides démographiques et échelles de Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">33</span> Graphiques thermiques</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">34</span> Diagrammes et schémas</a></li>
<li><a class="" href="combination_analysis.html"><span class="header-section-number">35</span> Analyse des combinaisons</a></li>
<li><a class="" href="transmission_chains.html"><span class="header-section-number">36</span> Chaînes de transmission</a></li>
<li><a class="" href="phylogenetic_trees.html"><span class="header-section-number">37</span> Les arbres phylogénétiques</a></li>
<li><a class="" href="interactive_plots.html"><span class="header-section-number">38</span> Graphiques interactifs</a></li>
<li class="book-part">Reports and dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">39</span> Production de rapports avec R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">40</span> Organisation des rapports de routine</a></li>
<li><a class="" href="dashboards.html"><span class="header-section-number">41</span> Tableaux de bord avec R Markdown</a></li>
<li><a class="active" href="shiny.html"><span class="header-section-number">42</span> Tableaux de bord avec Shiny</a></li>
<li class="book-part">Miscellaneous</li>
<li><a class="" href="writing_functions.html"><span class="header-section-number">43</span> Fonctions d’écriture</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">44</span> Interactions avec les répertoires</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">45</span> Contrôle de version et collaboration avec Git et Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">46</span> Erreurs fréquentes</a></li>
<li><a class="" href="help.html"><span class="header-section-number">47</span> Obtenir de l’aide</a></li>
<li><a class="" href="network_drives.html"><span class="header-section-number">48</span> R sur les lecteurs réseau</a></li>
<li><a class="" href="data_table.html"><span class="header-section-number">49</span> Tableau de données</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="shiny" class="section level1" number="42">
<h1>
<span class="header-section-number">42</span> Tableaux de bord avec Shiny<a class="anchor" aria-label="anchor" href="#shiny"><i class="fas fa-link"></i></a>
</h1>
<p>Les tableaux de bord sont souvent une excellente méthode de partager les résultats d’analyses avec d’autres personnes. Produire un tableau de bord avec <strong>shiny</strong> nécessite une connaissance relativement avancée du langage R, mais vous offrez la personnalisation des tableaux et des possibilités incroyables.</p>
<!-- L'un des plus grands inconvénients de `R` est sa facilité d'utilisation pour les personnes qui sont nouvelles ou qui n'ont aucune expérience des langages de programmation. Bien que ces compétences soient très précieuses, la plupart des gens trouveront que cela représente un obstacle au partage des analyses, en particulier dans les environnements multidisciplinaires. Maintenir une installation `R` demande un certain travail, et tout le monde ne sera pas à l'aise pour exécuter du code partagé, même s'il est bien documenté et facile à lire. Ceci est *surtout* vrai lorsque les utilisateurs doivent modifier les paramètres du code!  -->
<!-- Les tableaux de bord basés sur R sont également avantageux en ce qu'ils centralisent la façon dont le code est exécuté - lorsque le même code est exécuté sur différentes machines, souvent les gens devront faire face à différents chemins de fichiers, différentes versions de R, et différentes installations de packages. Pour cette raison, les tableaux de bord sont un excellent moyen de partager du code avec d'autres personnes de manière facile ! -->
<p>Il est recommandé qu’une personne apprenant les tableaux de bord avec <strong>shiny</strong> ait une bonne connaissance de la transformation et de la visualisation des données, et soit à l’aise pour déboguer du code et écrire des fonctions. Le travail avec les tableaux de bord n’est pas intuitif au début et est parfois difficile à comprendre, mais il s’agit d’une excellente compétence à apprendre qui devient beaucoup plus facile avec la pratique !</p>
<p>Cette page donne un bref aperçu de la façon de créer des tableaux de bord avec <strong>shiny</strong> et ses extensions.
Pour une méthode alternative de création de tableaux de bord qui est plus rapide, plus facile, mais peut-être moins personnalisable, voir la page sur <strong>flextable</strong> (<a href="rmarkdown.html#rmarkdown">Rapports avec R Markdown</a>).</p>
<div id="préparation-26" class="section level2" number="42.1">
<h2>
<span class="header-section-number">42.1</span> Préparation<a class="anchor" aria-label="anchor" href="#pr%C3%A9paration-26"><i class="fas fa-link"></i></a>
</h2>
<div id="chargement-des-packages-2" class="section level3 unnumbered">
<h3>Chargement des packages<a class="anchor" aria-label="anchor" href="#chargement-des-packages-2"><i class="fas fa-link"></i></a>
</h3>
<p>Dans ce manuel, nous mettons l’accent sur <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, qui installe le package si nécessaire <em>et</em> le charge pour l’utiliser. Vous pouvez aussi charger les packages installés avec <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de <strong>base</strong> R. Voir la page sur <a href="rbasics.html#rbasics">bases de R</a> pour plus d’informations sur les packages R.</p>
<p>Nous commençons par installer le package R <strong>shiny</strong> :</p>
<div class="sourceCode" id="cb1806"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="st">"shiny"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="importer-des-données-9" class="section level3 unnumbered">
<h3>Importer des données<a class="anchor" aria-label="anchor" href="#importer-des-donn%C3%A9es-9"><i class="fas fa-link"></i></a>
</h3>
<p>Si vous souhaitez suivre cette page, consultez la section du <a href="download_book_data.html#download_book_data">manuel pour le téléchargement des données</a>. Il y a des liens pour télécharger les scripts R et les fichiers de données qui produisent l’application Shiny finale.</p>
<p>Si vous essayez de reconstruire l’application à l’aide de ces fichiers, veuillez tenir compte de la structure des dossiers du projet R qui est créée au cours de la démonstration (par exemple, des dossiers pour “data” et pour “funcs”).</p>
<!-- ======================================================= -->
</div>
</div>
<div id="la-structure-dune-application-shiny" class="section level2" number="42.2">
<h2>
<span class="header-section-number">42.2</span> La structure d’une application shiny<a class="anchor" aria-label="anchor" href="#la-structure-dune-application-shiny"><i class="fas fa-link"></i></a>
</h2>
<div id="structures-de-fichiers-de-base" class="section level3 unnumbered">
<h3>Structures de fichiers de base<a class="anchor" aria-label="anchor" href="#structures-de-fichiers-de-base"><i class="fas fa-link"></i></a>
</h3>
<p>Pour comprendre <code>shiny</code>, nous devons d’abord comprendre comment fonctionne la structure des fichiers d’une application ! Nous devrions créer un tout nouveau répertoire avant de commencer. Cela peut être rendu plus facile en choisissant <em>New project</em> dans <em>Rstudio</em>, et en choisissant <em>Shiny Web Application</em>. Cela créera la structure de base d’une application shiny pour vous.</p>
<p>En ouvrant ce projet, vous remarquerez qu’il y a déjà un fichier <code>.R</code> appelé <em>app.R</em>. Il est <em>essentiel</em> que nous ayons une des deux structures de fichiers de base :</p>
<ol style="list-style-type: decimal">
<li>Un seul fichier appelé <em>app.R</em>, <em>ou</em>
</li>
<li>Deux fichiers, l’un appelé <em>ui.R</em> et l’autre <em>server.R</em>
</li>
</ol>
<p>Dans cette page, nous utiliserons la première approche qui consiste à avoir un seul fichier appelé <em>app.R</em>. Voici un exemple de script :</p>
<div class="sourceCode" id="cb1807"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># exemple de un script app.R</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="co"># titre de l'application </span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"My app"</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># Sidebar avec le widget slider input </span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"input_1"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="co"># afficher le graphique</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"my_plot"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Définir la logique du serveur requise pour dessiner un histogramme</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>     </span>
<span>     <span class="va">plot_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>          <span class="fu">plot_func</span><span class="op">(</span>param <span class="op">=</span> <span class="va">input_1</span><span class="op">)</span></span>
<span>     <span class="op">}</span><span class="op">)</span></span>
<span>     </span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">my_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>       <span class="fu">plot_1</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># Executer application </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span>ui <span class="op">=</span> <span class="va">ui</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p>Si vous ouvrez ce fichier, vous remarquerez que deux objets sont définis, un appelé <code>ui</code> et l’autre appelé <code>server</code>. Ces objets <em>doivent</em> être définis dans <em>toutes</em> les applications shiny et sont essentiels à la structure de l’application elle-même ! En fait, la seule différence entre les deux structures de fichiers décrites ci-dessus est que dans la structure 1, <code>ui</code> et <code>server</code> sont définis dans un seul fichier, alors que dans la structure 2, ils sont définis dans des fichiers séparés. Note : nous pouvons aussi (et nous devrions si nous avons une application plus grande) avoir d’autres fichiers .R dans notre structure que nous pouvons sourcer avec <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> dans notre application.</p>
</div>
<div id="le-serveur-et-linterface-utilisateur" class="section level3 unnumbered">
<h3>Le serveur et l’interface utilisateur<a class="anchor" aria-label="anchor" href="#le-serveur-et-linterface-utilisateur"><i class="fas fa-link"></i></a>
</h3>
<p>Nous devons maintenant comprendre ce que les objets <code>server</code> et <code>ui</code> font réellement. <em>Pour faire simple, ce sont deux objets qui interagissent l’un avec l’autre à chaque fois que l’utilisateur interagit avec l’application shiny.</em></p>
<p>L’élément UI d’une shiny app est, à la base, le code R qui crée une interface HTML. Cela signifie que tout ce qui est <em>affiché</em> dans l’interface utilisateur d’une application. Cela inclut généralement :</p>
<ul>
<li>Les “widgets”, par exemples les menus déroulants, cases à cocher, curseurs, etc. avec lesquels l’utilisateur peut interagir.</li>
<li>Graphiques, tableaux, etc; toutes sorties générées par le code R.</li>
<li>Les aspects de navigation d’une application, par exemples les onglets, volets, etc.</li>
<li>Texte générique, liens hypertextes, etc.</li>
<li>Éléments HTML et CSS (abordés plus tard)</li>
</ul>
<p>La chose la plus importante à comprendre au sujet de l’interface utilisateur est qu’elle <em>reçoit des entrées</em> de l’utilisateur et <em>affiche des sorties</em> du serveur. Aucun code <em>actif</em> n’est exécuté dans l’interface utilisateur <em>à tout moment</em>. Tous les changements vus dans l’interface utilisateur sont transmis au serveur (plus ou moins). Nous devons donc effectuer tous nos tracés, téléchargements, etc. dans le serveur.</p>
<p>Le serveur de l’application shiny est l’endroit où tout le code est exécuté une fois que l’application démarre. La façon dont cela fonctionne est un peu complique. Le serveur va effectivement <em>réagir</em> à l’interface utilisateur et exécuter des bout de code en réponse. Si les choses changent dans le serveur, elles seront transmises à l’interface utilisateur, où les changements seront visibles. Il est important de noter que le code dans le serveur sera exécuté <em>non consécutivement</em> (ou il est préférable d’y penser de cette façon). En gros, chaque fois qu’une entrée de l’interface utilisateur affecte un bout de code dans le serveur, celui-ci s’exécutera automatiquement, et la sortie sera produite et affichée.</p>
<p>Tout cela semble probablement très abstrait pour l’instant, nous allons donc travailler avec quelques exemples pour avoir une idée claire de la façon dont cela fonctionne réellement.</p>
</div>
<div id="avant-de-commencer-à-construire-une-application" class="section level3 unnumbered">
<h3>Avant de commencer à construire une application<a class="anchor" aria-label="anchor" href="#avant-de-commencer-%C3%A0-construire-une-application"><i class="fas fa-link"></i></a>
</h3>
<p>Avant de commencer à construire une application, il est extrêmement utile de savoir <em>ce que</em> vous voulez construire. Puisque votre interface utilisateur sera écrite en code, vous ne pouvez pas vraiment visualiser ce que vous construisez, sauf si vous visez quelque chose de spécifique. Pour cette raison, il est extrêmement utile de regarder de nombreux exemples d’applications shinys pour avoir une idée de ce que vous pouvez faire. Encore mieux, si vous pouvez regarder le code source derrière ces applications ! Voici quelques bonnes ressources pour cela :</p>
<ul>
<li>La <a href="https://shiny.rstudio.com/gallery/">galerie d’applications Rstudio</a>
</li>
</ul>
<p>Une fois que vous avez une idée de ce qui est possible, il est également utile de dessiner ce à quoi vous voulez que votre application ressemble. Vous pouvez faire un dessin soit sur du papier ou dans un logiciel de dessin (PowerPoint, MS paint, etc.). Il est utile de commencer simplement pour votre première application ! Il n’y a certainment pas d’honte à utiliser le code d’une belle application que vous trouvez en ligne comme modèle pour votre travail. C’est beaucoup plus facile que construire quelque chose à partir de zéro !</p>
</div>
</div>
<div id="construire-une-interface-utilisateur" class="section level2" number="42.3">
<h2>
<span class="header-section-number">42.3</span> Construire une interface utilisateur<a class="anchor" aria-label="anchor" href="#construire-une-interface-utilisateur"><i class="fas fa-link"></i></a>
</h2>
<p>Lorsque nous construisons notre application, il est plus facile de travailler d’abord sur l’interface utilisateur afin de voir ce que nous faisons, et de ne pas risquer que l’application échoue à cause d’erreurs de serveur. Comme mentionné précédemment, il est souvent bon d’utiliser un modèle pour travailler sur l’interface utilisateur. Il y a un certain nombre de modèles standards qui peuvent être utilisés avec shiny et qui sont disponibles dans le package de base shiny, mais il est intéressant de noter qu’il y a aussi un certain nombre d’extensions du package comme <code>shinydashboard</code>. Nous allons utiliser un exemple de la base shiny pour commencer.</p>
<p>Une interface utilisateur shiny est généralement définie comme une série de fonctions imbriquées, dans l’ordre suivant:</p>
<ol style="list-style-type: decimal">
<li>Une fonction définissant la mise en page générale (la plus basique est <code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage()</a></code>, mais d’autres sont disponibles)</li>
<li>Des panneaux à l’intérieur de la mise en page tels que:
<ul>
<li>une barre latérale (<code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel()</a></code>)</li>
<li>un panneau “principal” (<code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel()</a></code>)</li>
<li>un onglet (<code><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel()</a></code>)</li>
<li>une “colonne” générique (<code><a href="https://rdrr.io/pkg/shiny/man/column.html">column()</a></code>)</li>
</ul>
</li>
<li>Widgets et sorties : ils peuvent conférer des entrées au serveur (widgets) ou des sorties du serveur (outputs)
<ul>
<li>Les widgets sont généralement appelés <code>xxxInput()</code>, par exemple <code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput()</a></code>.</li>
<li>Les sorties sont généralement appelées <code>xxxOutput()</code>, par exemple <code><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput()</a></code>.</li>
</ul>
</li>
</ol>
<p>Il est important de préciser que ces éléments ne peuvent pas être visualisés facilement de manière abstraite. Il est donc préférable de regarder un exemple ! Considérons la création d’une application de base qui visualise nos données de denombrement des equipemnts de lutte contre le paludisme par district. Ces données comportent un grand nombre de paramètres différents, et il serait formidable que l’utilisateur final puisse appliquer des filtres pour voir les données par groupe d’âge/district comme il l’entend ! Nous pouvons utiliser une mise en page shiny très simple pour commencer, la mise en page de la barre latérale. Il s’agit d’une mise en page où les widgets sont placés dans une barre latérale sur la gauche, et le graphique est placé sur la droite.</p>
<p>Elaborons notre application: nous pouvons commencer par un sélecteur qui nous permet de choisir le district où nous voulons visualiser les données, et un autre qui nous permet de visualiser le groupe d’âge qui nous intéresse. Nous allons utiliser ces filtres pour afficher une épicurve qui reflète ces paramètres. Pour cela, nous avons besoin de:</p>
<ol style="list-style-type: decimal">
<li>Deux menus déroulants qui nous permettent de choisir le district que nous voulons et le groupe d’âge qui nous intéresse.</li>
<li>Une zone où nous pouvons montrer notre épicurve obtenue.</li>
</ol>
<p>Cela pourrait ressembler à quelque chose comme ceci:</p>
<div class="sourceCode" id="cb1808"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"Malaria facility visualisation app"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>         <span class="co"># sélectionneur pour le district</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_district"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Select district"</span>,</span>
<span>              choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"All"</span>,</span>
<span>                   <span class="st">"Spring"</span>,</span>
<span>                   <span class="st">"Bolo"</span>,</span>
<span>                   <span class="st">"Dingo"</span>,</span>
<span>                   <span class="st">"Barnard"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selected <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>              multiple <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># sélecteur pour le groupe d'âge</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_agegroup"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Sélectionnez le groupe d'âge"</span>,</span>
<span>              choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"All ages"</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>,</span>
<span>                   <span class="st">"0-4 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>,</span>
<span>                   <span class="st">"5-14 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_5-14"</span>,</span>
<span>                   <span class="st">"15+ yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_15"</span></span>
<span>              <span class="op">)</span>, </span>
<span>              selected <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>              multiple <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span>    <span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="co"># epicurve va ici</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"malaria_epicurve"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Lorsque app.R est exécuté avec le code d’interface utilisateur ci-dessus (sans code actif dans la partie <code>server</code> de app.R) le mise en page apparaît comme ceci. Notez qu’il n’y aura pas de tracé s’il n’y a pas de serveur pour conduire à ce resultat, mais nos entrées fonctionnent !</p>
<div class="inline-figure"><img src="images/shiny/simple_UI_view.png" width="100%" height="100%"></div>
<p>C’est une bonne occasion de discuter les fonctionnement des widgets. Notez que chaque widget accepte un <code>inputId</code>, un <code>label</code>, et une série d’autres options qui sont spécifiques au type de widget. Ce <code>inputId</code> est extrêmement important ! Ce sont les IDs qui sont utilisés pour passer les informations de l’IU au serveur. Pour cette raison, ils <em>doivent être uniques</em>. Vous devriez faire un effort pour les nommer de manière sensée et spécifique à ce avec quoi ils interagissent dans le cas de grandes applications.</p>
<p>Vous devez lire attentivement la documentation pour obtenir tous les détails sur ce que font chacun de ces widgets. Les widgets transmettront des types de données spécifiques au serveur en fonction du type de widget, et cela doit être bien compris. Par exemple, <code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput()</a></code> transmettra un type de caractère au serveur :</p>
<ul>
<li>Si nous sélectionnons <em>Spring</em> pour le premier widget ici, il transmettra l’objet caractère <code>"Spring"</code> au serveur.</li>
<li>Si nous sélectionnons deux éléments dans le menu déroulant, ils seront transmis sous forme de vecteur de caractères (par exemple, <code>c("Spring", "Bolo")</code>).</li>
</ul>
<p>D’autres widgets transmettront différents types d’objets au serveur ! Par exemple</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/shiny/man/numericInput.html">numericInput()</a></code> passera un objet de type numérique au serveur.</li>
<li>
<code><a href="https://rdrr.io/pkg/shiny/man/checkboxInput.html">checkboxInput()</a></code> transmettra un objet de type logique au serveur (<code>TRUE</code> ou <code>FALSE</code>).</li>
</ul>
<p>Il est également intéressant de noter le <em>vecteur nommé</em> que nous avons utilisé pour les données d’âge ici. Pour de nombreux widgets, l’utilisation d’un vecteur nommé comme choix affichera les <em>noms</em> du vecteur comme choix d’affichage, mais passera la <em>valeur</em> sélectionnée du vecteur au serveur. Par exemple, ici quelqu’un peut sélectionner “15+” dans le menu déroulant, et l’interface utilisateur transmettra <code>"malaria_rdt_15"</code> au serveur - qui se trouve être le nom de la colonne qui nous intéresse !</p>
<p>Il y a beaucoup de widgets que vous pouvez utiliser dans votre application. Les widgets vous permettent également de télécharger des fichiers dans votre application, et de télécharger des sorties. Il existe également d’excellentes examples de shiny qui vous donnent accès à plus de widgets que le shiny de base. Le package <strong>shinyWidgets</strong> en est un excellent exemple. Pour voir quelques exemples, vous pouvez consulter les liens suivants :</p>
<ul>
<li><a href="https://shiny.rstudio.com/gallery/widget-gallery.html">galerie de widgets de la base shiny</a></li>
<li><a href="https://github.com/dreamRs/shinyWidgets">galerie de widgets shinyWidgets</a></li>
</ul>
</div>
<div id="chargement-des-données-dans-notre-application" class="section level2" number="42.4">
<h2>
<span class="header-section-number">42.4</span> Chargement des données dans notre application<a class="anchor" aria-label="anchor" href="#chargement-des-donn%C3%A9es-dans-notre-application"><i class="fas fa-link"></i></a>
</h2>
<p>L’étape suivante dans le développement de notre application consiste à mettre en place le serveur et à le faire fonctionner. Pour ce faire, nous devons charger des données dans notre application, et déterminer tous les calculs que nous allons effectuer. Une application shiny n’est pas facile à déboguer, car on ne sait pas toujours d’où viennent les erreurs. Il est donc idéal de faire fonctionner tout le code de traitement et de visualisation des données avant de commencer à créer le serveur lui-même.</p>
<p>Ainsi, étant donné que nous voulons créer une application qui affiche des courbes épi qui changent en fonction de l’entrée de l’utilisateur, nous devons réfléchir au code dont nous aurions besoin pour l’exécuter dans un script R normal. Nous devrons :</p>
<ol style="list-style-type: decimal">
<li>Charger nos packages</li>
<li>Charger nos données</li>
<li>Transformer nos données</li>
<li>Développer une <em>fonction</em> pour visualiser nos données en fonction des entrées de l’utilisateur.</li>
</ol>
<p>Cette liste est assez simple, et ne devrait pas être trop difficile à réaliser. Il est maintenant important de réfléchir aux parties de ce processus qui doivent <em>être faites une seule fois</em> et à celles qui doivent <em>être exécutées en réponse aux entrées de l’utilisateur</em>. En effet, les applications shiny exécutent généralement du code avant de s’exécuter, ce qui n’est fait qu’une seule fois. La performance de notre application sera améliorée si une grande partie de notre code peut être déplacée dans cette section. Pour cet exemple, nous n’avons besoin de charger nos données/packages et d’effectuer des transformations de base qu’une seule fois, nous pouvons donc placer ce code <em>hors du serveur</em>. Cela signifie que la seule chose dont nous aurons besoin dans le serveur est le code pour visualiser nos données. Développons d’abord tous ces composants dans un script. Cependant, puisque nous visualisons nos données à l’aide d’une fonction, nous pouvons également placer le code <em>pour la fonction</em> en dehors du serveur afin que notre fonction soit dans l’environnement lorsque l’application s’exécute !</p>
<p>Commençons par charger nos données. Puisque nous travaillons avec un nouveau projet, et que nous voulons le rendre propre, nous pouvons créer un nouveau répertoire appelé data, et y ajouter nos données sur le paludisme. Nous pouvons exécuter ce code ci-dessous dans un script de test que nous supprimerons éventuellement lorsque nous aurons nettoyé la structure de notre application.</p>
<div class="sourceCode" id="cb1809"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="st">"tidyverse"</span>, <span class="st">"lubridate"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read data</span></span>
<span><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"malaria_facility_count_data.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">malaria_data</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3,038 × 10
##    location_name data_date  submitted_date Province District `malaria_rdt_0-4`
##    &lt;chr&gt;         &lt;date&gt;     &lt;date&gt;         &lt;chr&gt;    &lt;chr&gt;                &lt;int&gt;
##  1 Facility 1    2020-08-11 2020-08-12     North    Spring                  11
##  2 Facility 2    2020-08-11 2020-08-12     North    Bolo                    11
##  3 Facility 3    2020-08-11 2020-08-12     North    Dingo                    8
##  4 Facility 4    2020-08-11 2020-08-12     North    Bolo                    16
##  5 Facility 5    2020-08-11 2020-08-12     North    Bolo                     9
##  6 Facility 6    2020-08-11 2020-08-12     North    Dingo                    3
##  7 Facility 6    2020-08-10 2020-08-12     North    Dingo                    4
##  8 Facility 5    2020-08-10 2020-08-12     North    Bolo                    15
##  9 Facility 5    2020-08-09 2020-08-12     North    Bolo                    11
## 10 Facility 5    2020-08-08 2020-08-12     North    Bolo                    19
## # ℹ 3,028 more rows
## # ℹ 4 more variables: `malaria_rdt_5-14` &lt;int&gt;, malaria_rdt_15 &lt;int&gt;,
## #   malaria_tot &lt;int&gt;, newid &lt;int&gt;</code></pre>
<p>Il sera plus facile de travailler avec ces données si nous utilisons des données ordonnées standards, nous devons donc également les transformer en un format de données plus long, où le groupe d’âge est une colonne, et les cas une autre colonne. Nous pouvons le faire facilement en utilisant ce que nous avons appris dans la page <a href="pivoting_data.html#pivoting_data">Pivoter les données</a>.</p>
<div class="sourceCode" id="cb1811"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="va">malaria_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">newid</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"malaria_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"age_group"</span>, values_to <span class="op">=</span> <span class="st">"cases_reported"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">malaria_data</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 12,152 × 7
##    location_name data_date  submitted_date Province District age_group    cases_reported
##    &lt;chr&gt;         &lt;date&gt;     &lt;date&gt;         &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;                 &lt;int&gt;
##  1 Facility 1    2020-08-11 2020-08-12     North    Spring   malaria_rdt…             11
##  2 Facility 1    2020-08-11 2020-08-12     North    Spring   malaria_rdt…             12
##  3 Facility 1    2020-08-11 2020-08-12     North    Spring   malaria_rdt…             23
##  4 Facility 1    2020-08-11 2020-08-12     North    Spring   malaria_tot              46
##  5 Facility 2    2020-08-11 2020-08-12     North    Bolo     malaria_rdt…             11
##  6 Facility 2    2020-08-11 2020-08-12     North    Bolo     malaria_rdt…             10
##  7 Facility 2    2020-08-11 2020-08-12     North    Bolo     malaria_rdt…              5
##  8 Facility 2    2020-08-11 2020-08-12     North    Bolo     malaria_tot              26
##  9 Facility 3    2020-08-11 2020-08-12     North    Dingo    malaria_rdt…              8
## 10 Facility 3    2020-08-11 2020-08-12     North    Dingo    malaria_rdt…              5
## # ℹ 12,142 more rows</code></pre>
<p>Et avec cela, nous avons fini de préparer nos données ! Cela raye les points 1, 2 et 3 de notre liste de choses à développer pour notre “script R de test”. La dernière tâche, et la plus difficile, sera de construire une fonction pour produire une épicurve basée sur des paramètres définis par l’utilisateur. Comme nous l’avons mentionné précédemment, il est <em>hautement recommandé</em> à toute personne apprenant shiny de regarder d’abord la section sur la programmation fonctionnelle (<a href="writing_functions.html#writing_functions">Écrire les fonctions</a>) pour comprendre comment cela fonctionne !</p>
<p>Lorsque nous définissons notre fonction, il peut être difficile de penser aux paramètres que nous voulons inclure. Dans le cadre de la programmation fonctionnelle avec shiny, chaque paramètre pertinent est généralement associé à un widget, ce qui facilite la réflexion ! Par exemple, dans notre application actuelle, nous voulons être en mesure de filtrer par district, et avoir un widget pour cela, donc nous pouvons ajouter un paramètre de district pour refléter cela. Nous n’avons <em>pas</em> de fonctionnalité d’application pour filtrer par établissement (pour l’instant), donc nous n’avons pas besoin de l’ajouter comme paramètre. Commençons par créer une fonction avec trois paramètres :</p>
<ol style="list-style-type: decimal">
<li>L’ensemble de données de base</li>
<li>Le district de choix</li>
<li>Le groupe d’âge choisi</li>
</ol>
<div class="sourceCode" id="cb1813"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_epicurve</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">district</span> <span class="op">=</span> <span class="st">"All"</span>, <span class="va">agegroup</span> <span class="op">=</span> <span class="st">"malaria_tot"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"All"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">district</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">district</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">plot_title_district</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{paste0(district, collapse = ', ')} districts"</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">plot_title_district</span> <span class="op">&lt;-</span> <span class="st">"all districts"</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># s'il n'y a pas de données restantes, retourne NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op">==</span> <span class="va">agegroup</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># s'il n'y a pas de données restantes, retourne NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">agegroup</span> <span class="op">==</span> <span class="st">"malaria_tot"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">agegroup_title</span> <span class="op">&lt;-</span> <span class="st">"All ages"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">agegroup_title</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{str_remove(agegroup, 'malaria_rdt')} years"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">cases_reported</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"number of cases"</span>,</span>
<span>      title <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Malaria cases - {plot_title_district}"</span><span class="op">)</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="va">agegroup_title</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Nous n’entrerons pas dans les détails de cette fonction, car elle est relativement simple dans son fonctionnement. Une chose à noter cependant, c’est que nous gérons les erreurs en retournant <code>NULL</code> alors qu’elle devrait entrainer une erreur. En effet, si le serveur shiny produit un objet <code>NULL</code> au lieu d’un objet plot, rien ne sera affiché dans l’interface utilisateur ! C’est important, car sinon les erreurs vont souvent provoquer l’arrêt du fonctionnement de votre application.</p>
<p>Une autre chose à noter est l’utilisation de l’opérateur <code>%in%</code> lors de l’évaluation de l’entrée <code>district</code>. Comme mentionné ci-dessus, cela pourrait arriver comme un vecteur de caractères avec plusieurs valeurs, donc l’utilisation de <code>%in%</code> est plus flexible que disons, <code>==</code>.</p>
<p>Testons notre fonction !</p>
<div class="sourceCode" id="cb1814"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="st">"Bolo"</span>, agegroup <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1415-1.png" width="672"></div>
<p>Maintenant que notre fonction fonctionne, nous devons comprendre comment tout cela va s’intégrer dans notre shiny application. Nous avons déjà mentionné le concept de <em>startup code</em>, mais voyons comment l’intégrer dans la structure de notre application. Il y a deux façons de le faire !</p>
<ol style="list-style-type: decimal">
<li>Placer ce code dans votre fichier <em>app.R</em> au début du script (au-dessus de l’interface utilisateur), ou bien<br>
</li>
<li>Créer un nouveau fichier dans le répertoire de votre application appelé <em>global.R</em>, et placer le code de démarrage dans ce fichier.</li>
</ol>
<p>Il convient de noter à ce stade qu’il est généralement plus facile, en particulier pour les applications plus importantes, d’utiliser la deuxième structure de fichiers, car elle vous permet de séparer votre structure de fichiers d’une manière simple. Développons maintenant complètement ce script global.R. Voici à quoi il pourrait ressembler :</p>
<div class="sourceCode" id="cb1815"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># global.R script</span></span>
<span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="st">"tidyverse"</span>, <span class="st">"lubridate"</span>, <span class="st">"shiny"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># lire les données</span></span>
<span><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"malaria_facility_count_data.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># données nettoyées et  pivotées en longueur</span></span>
<span></span>
<span><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="va">malaria_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">newid</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"malaria_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"age_group"</span>, values_to <span class="op">=</span> <span class="st">"cases_reported"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># definir la fonction pour la representation graphique</span></span>
<span><span class="va">plot_epicurve</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">district</span> <span class="op">=</span> <span class="st">"All"</span>, <span class="va">agegroup</span> <span class="op">=</span> <span class="st">"malaria_tot"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># creer le titre du graphe</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"All"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">district</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>            </span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">district</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">plot_title_district</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{paste0(district, collapse = ', ')} districts"</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">plot_title_district</span> <span class="op">&lt;-</span> <span class="st">"all districts"</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># s'il n'y a pas de données restantes, retourne NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># filtrer par groupe d'âge</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op">==</span> <span class="va">agegroup</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># s'il n'y a pas de données restantes, retourne NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">agegroup</span> <span class="op">==</span> <span class="st">"malaria_tot"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">agegroup_title</span> <span class="op">&lt;-</span> <span class="st">"All ages"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">agegroup_title</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{str_remove(agegroup, 'malaria_rdt')} years"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">cases_reported</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"number of cases"</span>,</span>
<span>      title <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Malaria cases - {plot_title_district}"</span><span class="op">)</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="va">agegroup_title</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Facile ! Une des grandes caractéristiques de shiny est qu’il comprend à quoi servent les fichiers nommés <em>app.R</em>, <em>server.R</em>, <em>ui.R</em> et <em>global.R</em>, il n’y a donc pas besoin de les connecter entre eux par un quelconque code. Ainsi, il suffit d’avoir ce code dans <em>global.R</em> dans le répertoire pour qu’il s’exécute avant que nous démarrions notre application.</p>
<p>Nous devons également noter que l’organisation de notre application serait améliorée si nous déplacions la fonction de traçage dans son propre fichier - cela sera particulièrement utile lorsque les applications deviendront plus grandes. Pour ce faire, nous pourrions créer un autre répertoire appelé <em>funcs</em>, et y placer cette fonction dans un fichier appelé <em>plot_epicurve.R</em>. Nous pourrions ensuite lire cette fonction via la commande suivante dans <em>global.R</em>.</p>
<div class="sourceCode" id="cb1816"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"funcs"</span>, <span class="st">"plot_epicurve.R"</span><span class="op">)</span>, local <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Notez que vous devriez <em>toujours</em> spécifier <code>local = TRUE</code> dans les applications shiny, car cela affectera le sourcing quand/si l’application est publiée sur un serveur.</p>
</div>
<div id="développer-un-serveur-dapplications" class="section level2" number="42.5">
<h2>
<span class="header-section-number">42.5</span> Développer un serveur d’applications<a class="anchor" aria-label="anchor" href="#d%C3%A9velopper-un-serveur-dapplications"><i class="fas fa-link"></i></a>
</h2>
<p>Maintenant que nous avons la plupart de notre code, il nous reste à développer notre serveur. Il s’agit de la dernière pièce de notre application, et c’est probablement la plus difficile à comprendre. Le serveur est une grande fonction R, mais il est utile de le considérer comme une série de petites fonctions, ou de tâches que l’application peut exécuter. Il est important de comprendre que ces fonctions ne sont pas exécutées dans un ordre linéaire. Il existe un ordre, mais il n’est pas nécessaire de le comprendre lorsqu’on débute avec Shiny. À un niveau très basique, ces tâches ou fonctions s’activent lorsqu’un changement dans les entrées de l’utilisateur les affecte, <em>à moins que le développeur ne les ait configurées pour qu’elles se comportent différemment</em>. Encore une fois, tout cela est assez abstrait, mais passons d’abord en revue les trois types <em>d’objets</em> shiny de base</p>
<ol style="list-style-type: decimal">
<li><p>Les sources réactives - c’est un autre terme pour les entrées de l’utilisateur. Le serveur shiny a accès aux sorties de l’interface utilisateur par le biais des widgets que nous avons programmés. Chaque fois que les valeurs de ces derniers sont modifiées, elles sont transmises au serveur.</p></li>
<li><p>Conducteurs réactifs - ce sont des objets qui existent <em>seulement</em> à l’intérieur du shiny server. Nous n’en avons pas vraiment besoin pour les applications simples, mais ils produisent des objets qui ne peuvent être vus qu’à l’intérieur du serveur, et utilisés dans d’autres opérations. Ils dépendent généralement de sources réactives.</p></li>
<li><p>Les points de terminaison - ce sont les sorties qui sont transmises du serveur à l’interface utilisateur. Dans notre exemple, il s’agit de la courbe épi que nous produisons.</p></li>
</ol>
<p>Avec ceci en tête, construisons notre serveur étape par étape. Nous montrons à nouveau le code de l’interface utilisateur à titre de référence :</p>
<div class="sourceCode" id="cb1817"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"Malaria facility visualisation app"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>         <span class="co"># sélectionneur pour le district</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_district"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Sélectionnez le district"</span>,</span>
<span>              choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"All"</span>,</span>
<span>                   <span class="st">"Spring"</span>,</span>
<span>                   <span class="st">"Bolo"</span>,</span>
<span>                   <span class="st">"Dingo"</span>,</span>
<span>                   <span class="st">"Barnard"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selected <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>              multiple <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># sélectionnez le groupe d'âge</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_agegroup"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Sélectionnez le groupe d'âge"</span>,</span>
<span>              choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"All ages"</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>,</span>
<span>                   <span class="st">"0-4 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>,</span>
<span>                   <span class="st">"5-14 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_5-14"</span>,</span>
<span>                   <span class="st">"15+ yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_15"</span></span>
<span>              <span class="op">)</span>, </span>
<span>              selected <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>              multiple <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span>    <span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="co"># epicurve va ici</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"malaria_epicurve"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>De ce code UI nous avons :</p>
<ul>
<li>Deux entrées :
<ul>
<li>Sélecteur de district (avec un inputId de <code>select_district</code>)</li>
<li>Un sélecteur de groupe d’âge (avec un inputId de <code>select_agegroup</code>)</li>
</ul>
</li>
<li>Une sortie :
<ul>
<li>L’épicurve (avec un outputId de <code>malaria_epicurve</code>)</li>
</ul>
</li>
</ul>
<p>Comme indiqué précédemment, ces noms uniques que nous avons attribués à nos entrées et sorties sont cruciaux. Ils <em>doivent être uniques</em> et sont utilisés pour transmettre des informations entre l’interface utilisateur et le serveur. Dans notre serveur, nous accédons à nos entrées via la syntaxe <code>input$inputID</code> et les sorties sont transmises à l’interface utilisateur via la syntaxe <code>output$output_name</code> Voyons un exemple, car encore une fois, c’est difficile à comprendre autrement !</p>
<div class="sourceCode" id="cb1818"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">malaria_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span></span>
<span>    <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Le serveur pour une application simple comme celle-ci est en fait assez simple ! Vous remarquerez que le serveur est une fonction avec trois paramètres - <code>input</code>, <code>output</code>, et <code>session</code> - ce n’est pas très important à comprendre pour le moment, mais il est important de s’en tenir à cette configuration ! Dans notre serveur, nous n’avons qu’une seule tâche - elle rend un graphique basé sur la fonction que nous avons créée plus tôt, et les entrées du serveur. Remarquez que les noms des objets d’entrée et de sortie correspondent exactement à ceux de l’interface utilisateur.</p>
<p>Pour comprendre les bases de la façon dont le serveur réagit aux entrées de l’utilisateur, vous devez noter que la sortie saura (grâce au package sous-jacent) quand les entrées changent, et réexécutera cette fonction pour créer un graphique à chaque fois qu’elles changent. Notez que nous utilisons également la fonction <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot()</a></code> ici - c’est l’une des fonctions d’une famille de classes spécifiques qui passent ces objets à une sortie ui. Il existe un certain nombre de fonctions qui se comportent de manière similaire, mais vous devez vous assurer que la fonction utilisée correspond à la classe de l’objet que vous transmettez à l’interface utilisateur ! Par exemple :</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText()</a></code> - envoie du texte à l’interface utilisateur</li>
<li>
<code>renderDataTable</code> - envoie une table interactive à l’interface utilisateur.</li>
</ul>
<p>Rappelez-vous que ces <em>fonctions</em> doivent également correspondre à la fonction de sortie utilisée dans l’interface utilisateur - ainsi, <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot()</a></code> est associé à <code><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput()</a></code>, et <code><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText()</a></code> est associé à <code><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">textOutput()</a></code>.</p>
<p>Nous avons enfin créé une application fonctionnelle ! Nous pouvons l’exécuter en appuyant sur le bouton Run App en haut à droite de la fenêtre du script dans Rstudio. Notez que vous pouvez choisir de lancer votre application dans votre navigateur par défaut (plutôt que dans Rstudio), ce qui reflétera plus fidèlement ce à quoi l’application ressemblera pour les autres utilisateurs.</p>
<div class="inline-figure"><img src="images/shiny/app_simple_view.gif" width="100%" height="100%"></div>
<p>Il est amusant de noter que dans la console R, l’application est “à l’écoute” ! On parle de réactivité !</p>
<div class="inline-figure"><img src="images/shiny/listening.png" width="195"></div>
<!-- À FAIRE: *AJOUTER QUELQUE CHOSE LORS DU TÉLÉCHARGEMENT D'UN FICHIER ZIP DE L'APPLICATION?*  -->
</div>
<div id="ajout-de-fonctionnalités-supplémentaires" class="section level2" number="42.6">
<h2>
<span class="header-section-number">42.6</span> Ajout de fonctionnalités supplémentaires<a class="anchor" aria-label="anchor" href="#ajout-de-fonctionnalit%C3%A9s-suppl%C3%A9mentaires"><i class="fas fa-link"></i></a>
</h2>
<p>À ce stade, nous avons enfin une application qui fonctionne, mais nous avons très peu de fonctionnalités. De plus, nous n’avons pas encore touché à la surface de ce que shiny peut faire, il y a donc encore beaucoup à apprendre ! Continuons à développer notre application existante en ajoutant quelques fonctionnalités supplémentaires. Voici quelques éléments qu’il serait bon d’ajouter :</p>
<ol style="list-style-type: decimal">
<li>Un texte explicatif</li>
<li>Un bouton de téléchargement pour notre parcelle - cela permettrait à l’utilisateur d’obtenir une version de haute qualité de l’image qu’il génère dans l’application.</li>
<li>Un sélecteur pour des equipements particuliers</li>
<li>Une autre page de tableau de bord - elle pourrait afficher un tableau de nos données.</li>
</ol>
<p>Cela fait beaucoup de choses à ajouter, mais nous pouvons l’utiliser pour en apprendre davantage sur un tas de prouesses différentes en cours. Il y a tant à apprendre sur shiny (il peut être <em>très</em> avancé, mais il est à espérer qu’une fois que les utilisateurs ont une meilleure idée de la façon de l’utiliser, ils peuvent devenir plus à l’aise en utilisant des sources d’apprentissage externes aussi).</p>
<div id="ajouter-du-texte-statique" class="section level3 unnumbered">
<h3>Ajouter du texte statique<a class="anchor" aria-label="anchor" href="#ajouter-du-texte-statique"><i class="fas fa-link"></i></a>
</h3>
<p>Parlons d’abord de l’ajout de texte statique à notre application shiny. L’ajout de texte à notre application est extrêmement facile, une fois que vous en avez une connaissance de base. Puisque le texte statique ne change pas dans l’application shiny (si vous voulez qu’il change, vous pouvez utiliser les fonctions de <em>rendu de texte</em> dans le serveur ! Nous n’allons pas entrer dans les détails, mais vous pouvez ajouter un certain nombre d’éléments différents à votre interface utilisateur (et même des éléments personnalisés) en interfaçant R avec <em>HTML</em> et <em>css</em>.</p>
<p>HTML et css sont des langages qui sont explicitement impliqués dans la conception de l’interface utilisateur. Nous n’avons pas besoin de trop les comprendre, mais <em>HTML</em> crée des objets dans l’IU (comme une boîte de texte, ou un tableau), et <em>css</em> est généralement utilisé pour changer le style et l’esthétique de ces objets. Shiny a accès à un large éventail de <em>balises HTML</em> - celles-ci sont présentes pour les objets qui se comportent d’une manière spécifique, comme les en-têtes, les paragraphes de texte, les sauts de ligne, les tableaux, etc. Nous pouvons utiliser certains de ces exemples comme ceci :</p>
<ul>
<li>
<p><code><a href="https://rstudio.github.io/htmltools/reference/builder.html">h1()</a></code> - il s’agit d’une balise <em>header</em>, qui rendra le texte inclus automatiquement plus grand, et changera les valeurs par défaut en ce qui concerne la police, la couleur, etc (selon le thème général de votre application). Vous pouvez accéder à des sous-titres <em>plus petits et plus petits</em> avec <code><a href="https://rstudio.github.io/htmltools/reference/builder.html">h2()</a></code> jusqu’à <code><a href="https://rstudio.github.io/htmltools/reference/builder.html">h6()</a></code> également. L’utilisation ressemble à :</p>
<ul>
<li><code>h1("mon en-tête - section 1")</code></li>
</ul>
</li>
<li>
<p><code><a href="https://rstudio.github.io/htmltools/reference/builder.html">p()</a></code> - il s’agit d’une balise <em>paragraphe</em>, qui rendra le texte inclus similaire à un texte dans un corps de texte. Ce texte sera automatiquement enveloppé, et sera d’une taille relativement petite (les pieds de page pourraient être plus petits par exemple.) Pensez-y comme le corps de texte d’un document Word. L’utilisation ressemble à :</p>
<ul>
<li><code>p("Ceci est un corps de texte plus large où j'explique la fonction de mon application")</code></li>
</ul>
</li>
<li><p><code>tags$b()</code> et <code>tags$i()</code> - elles sont utilisées pour créer des <code>tags$b()</code> en gras et des <code>tags$i()</code> en italique avec le texte inclus !</p></li>
<li><p><code>tags$ul()</code>, <code>tags$ol()</code> et <code>tags$li()</code> - ce sont des balises utilisées pour créer des <em>listes</em>. Elles sont toutes utilisées dans la syntaxe ci-dessous, et permettent à l’utilisateur de créer une liste ordonnée (<code>tags$ol()</code>, c’est-à-dire numérotée) ou non ordonnée (<code>tags$ul()</code>, c’est-à-dire à puces). <code>tags$li()</code> est utilisé pour désigner les éléments de la liste, quel que soit le type de liste utilisé. par exemple :</p></li>
</ul>
<div class="sourceCode" id="cb1819"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tags</span><span class="op">$</span><span class="fu">ol</span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Item 1"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Item 2"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Item 3"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li><p><code><a href="https://rstudio.github.io/htmltools/reference/builder.html">br()</a></code> et <code><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr()</a></code> - ces balises créent respectivement des <em>sauts de ligne</em> et des <em>lignes horizontales</em> (avec un saut de ligne). Utilisez-les pour séparer les sections de votre application et de votre texte ! Il n’est pas nécessaire de passer des éléments à ces balises (les parenthèses peuvent rester vides).</p></li>
<li><p><code><a href="https://rstudio.github.io/htmltools/reference/builder.html">div()</a></code> - c’est une balise <em>générique</em> qui peut <em>contenir n’importe quoi</em>, et peut être <em>nommée n’importe comment</em>. Une fois que vous aurez progressé dans la conception de l’IU, vous pourrez les utiliser pour compartimenter votre IU, donner des styles spécifiques à certaines sections et créer des interactions entre le serveur et les éléments de l’IU. Nous n’entrerons pas dans les détails, mais il vaut la peine de les connaître !</p></li>
</ul>
<p>Notez que chacun de ces objets peut être accédé par <code>tags$...</code> ou pour certains, juste la fonction. Ce sont effectivement des synonymes, mais il peut être utile d’utiliser le style <code>tags$...</code> si vous préférez être plus explicite et ne pas écraser les fonctions accidentellement. Ceci n’est en aucun cas une liste exhaustive des balises disponibles. Il existe une liste complète de toutes les balises disponibles dans shiny <a href="https://shiny.rstudio.com/articles/tag-glossary.html">ici</a> et encore plus peuvent être utilisées en insérant du HTML directement dans votre interface !</p>
<p>Si vous vous sentez confiant, vous pouvez également ajouter des <em>éléments de style css</em> à vos balises HTML avec l’argument <code>style</code> dans chacune d’entre elles. Nous n’allons pas entrer dans les détails de ce fonctionnement, mais une astuce pour tester les changements esthétiques d’une interface utilisateur est d’utiliser le mode inspecteur HTML dans chrome (de votre shiny application que vous exécutez dans le navigateur), et de modifier le style des objets vous-même !</p>
<p>Ajoutons du texte à notre application</p>
<div class="sourceCode" id="cb1820"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"Malaria facility visualisation app"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>         <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h4</a></span><span class="op">(</span><span class="st">"Options"</span><span class="op">)</span>,</span>
<span>         <span class="co"># sélectionneur pour le district</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_district"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Select district"</span>,</span>
<span>              choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"All"</span>,</span>
<span>                   <span class="st">"Spring"</span>,</span>
<span>                   <span class="st">"Bolo"</span>,</span>
<span>                   <span class="st">"Dingo"</span>,</span>
<span>                   <span class="st">"Barnard"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selected <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>              multiple <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># sélecteur pour le groupe d'âge</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_agegroup"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Select age group"</span>,</span>
<span>              choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"All ages"</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>,</span>
<span>                   <span class="st">"0-4 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>,</span>
<span>                   <span class="st">"5-14 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_5-14"</span>,</span>
<span>                   <span class="st">"15+ yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_15"</span></span>
<span>              <span class="op">)</span>, </span>
<span>              selected <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>              multiple <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span>,</span>
<span>    <span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="co"># epicurve va ici</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"malaria_epicurve"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"Welcome to the malaria facility visualisation app! To use this app, manipulate the widgets on the side to change the epidemic curve according to your preferences! To download a high quality image of the plot you've created, you can also download it with the download button. To see the raw data, use the raw data tab for an interactive form of the table. The data dictionary is as follows:"</span><span class="op">)</span>,</span>
<span>    <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"location_name"</span><span class="op">)</span>, <span class="st">" - the facility that the data were collected at"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"data_date"</span><span class="op">)</span>, <span class="st">" - the date the data were collected at"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"submitted_daate"</span><span class="op">)</span>, <span class="st">" - the date the data were submitted at"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"Province"</span><span class="op">)</span>, <span class="st">" - the province the data were collected at (all 'North' for this dataset)"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"District"</span><span class="op">)</span>, <span class="st">" - the district the data were collected at"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"age_group"</span><span class="op">)</span>, <span class="st">" - the age group the data were collected for (0-5, 5-14, 15+, and all ages)"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"cases_reported"</span><span class="op">)</span>, <span class="st">" - the number of cases reported for the facility/age group on the given date"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="images/shiny/app_text_view.png" width="435"></div>
</div>
<div id="ajouter-un-lien" class="section level3 unnumbered">
<h3>Ajouter un lien<a class="anchor" aria-label="anchor" href="#ajouter-un-lien"><i class="fas fa-link"></i></a>
</h3>
<p>Pour ajouter un lien à un site Web, utilisez <code>tags$a()</code> avec le lien et le texte à afficher comme indiqué ci-dessous. Pour avoir un paragraphe autonome, mettez-le dans <code><a href="https://rstudio.github.io/htmltools/reference/builder.html">p()</a></code>. Pour que seuls quelques mots d’une phrase soient liés, divisez la phrase en plusieurs parties et utilisez <code>tags$a()</code> pour la partie hyperliée. Pour que le lien s’ouvre dans une <em>nouvelle</em> fenêtre du navigateur, ajoutez <code>target = "_blank"</code> comme argument.</p>
<div class="sourceCode" id="cb1821"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tags</span><span class="op">$</span><span class="fu">a</span><span class="op">(</span>href <span class="op">=</span> <span class="st">"www.epiRhandbook.com"</span>, <span class="st">"Visit our website!"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="ajout-dun-bouton-de-téléchargement" class="section level3 unnumbered">
<h3>Ajout d’un bouton de téléchargement<a class="anchor" aria-label="anchor" href="#ajout-dun-bouton-de-t%C3%A9l%C3%A9chargement"><i class="fas fa-link"></i></a>
</h3>
<p>Passons à la deuxième des trois fonctions. Un bouton de téléchargement est une chose assez courante à ajouter à une application et est assez facile à réaliser. Nous devons ajouter un autre Widget à notre interface, et nous devons ajouter une autre sortie à notre serveur pour l’attacher. Nous pouvons également introduire des <em>conducteurs réactifs</em> dans cet exemple !</p>
<p>Mettons d’abord à jour notre interface utilisateur - c’est facile car shiny est livré avec un widget appelé <code><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html">downloadButton()</a></code> - donnons-lui un inputId et un label.</p>
<div class="sourceCode" id="cb1822"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"Malaria facility visualisation app"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>         <span class="co"># sélectionneur pour le district</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_district"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Select district"</span>,</span>
<span>              choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"All"</span>,</span>
<span>                   <span class="st">"Spring"</span>,</span>
<span>                   <span class="st">"Bolo"</span>,</span>
<span>                   <span class="st">"Dingo"</span>,</span>
<span>                   <span class="st">"Barnard"</span></span>
<span>              <span class="op">)</span>,</span>
<span>              selected <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>              multiple <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># sélecteur pour le groupe d'âge</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_agegroup"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Select age group"</span>,</span>
<span>              choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"All ages"</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>,</span>
<span>                   <span class="st">"0-4 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>,</span>
<span>                   <span class="st">"5-14 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_5-14"</span>,</span>
<span>                   <span class="st">"15+ yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_15"</span></span>
<span>              <span class="op">)</span>, </span>
<span>              selected <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>              multiple <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># ligne horizontale</span></span>
<span>         <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html">downloadButton</a></span><span class="op">(</span></span>
<span>           outputId <span class="op">=</span> <span class="st">"download_epicurve"</span>,</span>
<span>           label <span class="op">=</span> <span class="st">"Download plot"</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span>    <span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="co"># epicurve va ici</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"malaria_epicurve"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"Welcome to the malaria facility visualisation app! To use this app, manipulate the widgets on the side to change the epidemic curve according to your preferences! To download a high quality image of the plot you've created, you can also download it with the download button. To see the raw data, use the raw data tab for an interactive form of the table. The data dictionary is as follows:"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"location_name"</span><span class="op">)</span>, <span class="st">" - the facility that the data were collected at"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"data_date"</span><span class="op">)</span>, <span class="st">" - the date the data were collected at"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"submitted_daate"</span><span class="op">)</span>, <span class="st">" - the date the data were submitted at"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"Province"</span><span class="op">)</span>, <span class="st">" - the province the data were collected at (all 'North' for this dataset)"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"District"</span><span class="op">)</span>, <span class="st">" - the district the data were collected at"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"age_group"</span><span class="op">)</span>, <span class="st">" - the age group the data were collected for (0-5, 5-14, 15+, and all ages)"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"cases_reported"</span><span class="op">)</span>, <span class="st">" - the number of cases reported for the facility/age group on the given date"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      </span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Notez que nous avons également ajouté une balise <code><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr()</a></code> - celle-ci ajoute une ligne horizontale séparant nos widgets de contrôle de nos widgets de téléchargement. C’est une autre des balises HTML dont nous avons parlé précédemment.</p>
<p>Maintenant que notre interface utilisateur est prête, nous devons ajouter le composant serveur. Les téléchargements sont effectués dans le serveur avec la fonction <code><a href="https://rdrr.io/pkg/shiny/man/downloadHandler.html">downloadHandler()</a></code>. Comme pour notre plot, nous devons l’attacher à une sortie qui a le même inputId que le bouton de téléchargement. Cette fonction prend deux arguments - <code>filename</code> et <code>content</code> - ce sont tous deux des fonctions. Comme vous pouvez le deviner, <code>filename</code> est utilisé pour spécifier le nom du fichier à télécharger, et <code>content</code> est utilisé pour spécifier ce qui doit être téléchargé. <code>content</code> contient une fonction que vous utiliserez pour sauvegarder des données localement - donc si vous téléchargez un fichier csv, vous pourrez utiliser <code><a href="https://rdrr.io/pkg/rio/man/export.html">rio::export()</a></code>. Comme nous téléchargeons un graphique, nous utiliserons <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggplot2::ggsave()</a></code>. Voyons comment nous allons programmer ceci (nous ne l’ajouterons pas encore au serveur).</p>
<div class="sourceCode" id="cb1823"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">malaria_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span></span>
<span>    <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">download_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadHandler.html">downloadHandler</a></span><span class="op">(</span></span>
<span>    filename <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"malaria_epicurve_{input$select_district}.png"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    </span>
<span>    content <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">file</span>, </span>
<span>             <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span><span class="op">)</span>,</span>
<span>             width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Notez que la fonction <code>content</code> prend toujours un argument <code>file</code>, que nous mettons là où le nom du fichier de sortie est spécifié. Vous pouvez également remarquer que nous répétons du code ici - nous utilisons notre fonction <code>plot_epicurve()</code> deux fois dans ce serveur, une fois pour le téléchargement et une fois pour l’image affichée dans l’application. Bien que cela n’affecte pas massivement les performances, cela signifie que le code pour générer ce tracé devra être exécuté lorsque l’utilisateur change les widgets spécifiant le district et le groupe d’âge, <em>et</em> à nouveau lorsque vous voulez télécharger le tracé. Dans les grandes applications, les décisions sous-optimales comme celle-ci ralentiront de plus en plus les choses, il est donc bon d’apprendre comment rendre notre application plus efficace dans ce sens. Ce qui serait plus logique, c’est d’avoir un moyen d’exécuter le code epicurve lorsque les districts/groupes d’âge sont modifiés, <em>et de laisser ce code être utilisé par</em> les fonctions renderPlot() et downloadHandler(). C’est là que les conducteurs réactifs entrent en jeu !</p>
<p>Les conducteurs réactifs sont des objets qui sont créés dans le serveur shiny de manière <em>réactive</em>, mais qui ne sont pas édités - ils peuvent simplement être utilisés par d’autres parties du serveur. Il existe un certain nombre de types différents de <em>conducteurs réactifs</em>, mais nous allons passer en revue les deux principaux.</p>
<p>1.<code><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive()</a></code> - c’est le conducteur réactif le plus basique - il réagira à chaque fois que les entrées utilisées à l’intérieur changeront (comme nos widgets de district/groupe d’âge).<br>
2. <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">eventReactive()</a></code> - ce conducteur réactif fonctionne de la même manière que <code><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive()</a></code>, sauf que l’utilisateur peut spécifier les entrées qui le font réexécuter. Ceci est utile si votre conducteur réactif prend beaucoup de temps à traiter, mais ceci sera expliqué plus tard.</p>
<p>Regardons les deux exemples :</p>
<div class="sourceCode" id="cb1824"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">malaria_plot_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># ne s'exécute que lorsque le sélecteur de district change !</span></span>
<span><span class="va">malaria_plot_er</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">eventReactive</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Lorsque nous utilisons la configuration <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">eventReactive()</a></code>, nous pouvons spécifier quelles entrées provoquent l’exécution de ce morceau de code - ce n’est pas très utile pour nous pour le moment, donc nous pouvons le laisser pour l’instant. Notez que vous pouvez inclure plusieurs entrées avec <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>.</p>
<p>Voyons comment nous pouvons intégrer cela dans notre code serveur :</p>
<div class="sourceCode" id="cb1825"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">malaria_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">malaria_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span></span>
<span>    <span class="fu">malaria_plot</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">download_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadHandler.html">downloadHandler</a></span><span class="op">(</span></span>
<span>    </span>
<span>    filename <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"malaria_epicurve_{input$select_district}.png"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    </span>
<span>    content <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">file</span>, </span>
<span>             <span class="fu">malaria_plot</span><span class="op">(</span><span class="op">)</span>,</span>
<span>             width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Vous pouvez voir que nous faisons simplement appel à la sortie de notre réactif que nous avons défini dans nos fonctions de téléchargement et de rendu de tracé. Une chose à noter qui fait souvent trébucher les gens est que vous devez utiliser les sorties des réactifs comme s’il s’agissait de fonctions - vous devez donc <em>ajouter des parenthèses vides à la fin de celles-ci</em> (par exemple, <code>malaria_plot()</code> est correct, et <code>malaria_plot</code> ne l’est pas). Maintenant que nous avons ajouté cette solution, notre application est un peu plus ordonnée, plus rapide et plus facile à modifier puisque tout le code qui exécute la fonction epicurve se trouve à un seul endroit.</p>
<div class="inline-figure"><img src="images/shiny/download_button_view.png" width="457"></div>
</div>
<div id="ajout-dun-sélecteur-dequipements" class="section level3 unnumbered">
<h3>Ajout d’un sélecteur d’equipements<a class="anchor" aria-label="anchor" href="#ajout-dun-s%C3%A9lecteur-dequipements"><i class="fas fa-link"></i></a>
</h3>
<p>Passons à la fonctionnalité suivante : un sélecteur d’equipements spécifiques. Nous allons implémenter un autre paramètre dans notre fonction afin de pouvoir le passer comme argument dans notre code. Voyons d’abord ce qu’il en est - il fonctionne sur les mêmes principes que les autres paramètres que nous avons mis en place. Mettons à jour et testons notre fonction.</p>
<div class="sourceCode" id="cb1826"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_epicurve</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">district</span> <span class="op">=</span> <span class="st">"All"</span>, <span class="va">agegroup</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>, <span class="va">facility</span> <span class="op">=</span> <span class="st">"All"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"All"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">district</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">district</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">plot_title_district</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{paste0(district, collapse = ', ')} districts"</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">plot_title_district</span> <span class="op">&lt;-</span> <span class="st">"all districts"</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span></span>
<span>  <span class="co"># si il n ya pas de données restantes, retourner NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op">==</span> <span class="va">agegroup</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span></span>
<span>  <span class="co"># si il n ya pas de données restantes, retourner NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">agegroup</span> <span class="op">==</span> <span class="st">"malaria_tot"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">agegroup_title</span> <span class="op">&lt;-</span> <span class="st">"All ages"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">agegroup_title</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{str_remove(agegroup, 'malaria_rdt')} years"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"All"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">facility</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">location_name</span> <span class="op">==</span> <span class="va">facility</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">plot_title_facility</span> <span class="op">&lt;-</span> <span class="va">facility</span></span>
<span>    </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">plot_title_facility</span> <span class="op">&lt;-</span> <span class="st">"all facilities"</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># s'il n'y a pas de données restantes, retourne NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">cases_reported</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"number of cases"</span>,</span>
<span>      title <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Malaria cases - {plot_title_district}; {plot_title_facility}"</span><span class="op">)</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="va">agegroup_title</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Testons ca:</p>
<div class="sourceCode" id="cb1827"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="st">"Spring"</span>, agegroup <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>, facility <span class="op">=</span> <span class="st">"Facility 1"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1432-1.png" width="672"></div>
<p>Avec tous les equipements présentes dans nos données, il n’est pas très clair quels equipements correspondent à quels districts - et l’utilisateur final ne le saura pas non plus. Cela pourrait rendre l’utilisation de l’application assez peu intuitive. Pour cette raison, nous devrions faire en sorte que les options des equipements dans l’interface utilisateur changent dynamiquement lorsque l’utilisateur change de district - de sorte que l’une filtre l’autre ! Puisque nous utilisons un grand nombre de variables dans les options, nous pourrions également vouloir générer certaines de nos options pour l’interface utilisateur dans notre fichier <em>global.R</em> <em>à partir des données</em>. Par exemple, nous pouvons ajouter ce morceau de code à <em>global.R</em> après avoir lu nos données :</p>
<div class="sourceCode" id="cb1828"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_districts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">malaria_data</span><span class="op">$</span><span class="va">District</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># base de données des noms de lieux par district</span></span>
<span><span class="va">facility_list</span> <span class="op">&lt;-</span> <span class="va">malaria_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">location_name</span>, <span class="va">District</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Let’s look at them:</p>
<div class="sourceCode" id="cb1829"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_districts</span></span></code></pre></div>
<pre><code>## [1] "All"     "Spring"  "Bolo"    "Dingo"   "Barnard"</code></pre>
<div class="sourceCode" id="cb1831"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">facility_list</span></span></code></pre></div>
<pre><code>## # A tibble: 65 × 2
##    location_name District
##    &lt;chr&gt;         &lt;chr&gt;   
##  1 Facility 1    Spring  
##  2 Facility 10   Bolo    
##  3 Facility 11   Spring  
##  4 Facility 12   Dingo   
##  5 Facility 13   Bolo    
##  6 Facility 14   Dingo   
##  7 Facility 15   Barnard 
##  8 Facility 16   Barnard 
##  9 Facility 17   Barnard 
## 10 Facility 18   Bolo    
## # ℹ 55 more rows</code></pre>
<p>Nous pouvons passer ces nouvelles variables à l’interface utilisateur sans aucun problème, puisqu’elles sont globalement visibles à la fois par le serveur et l’interface utilisateur ! Mettons à jour notre interface utilisateur :</p>
<div class="sourceCode" id="cb1833"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"Malaria facility visualisation app"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>         <span class="co"># selecteur pour district</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_district"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Select dsitrict"</span>,</span>
<span>              choices <span class="op">=</span> <span class="va">all_districts</span>,</span>
<span>              selected <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>              multiple <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># selecteur pour age group</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>              inputId <span class="op">=</span> <span class="st">"select_agegroup"</span>,</span>
<span>              label <span class="op">=</span> <span class="st">"Select age group"</span>,</span>
<span>              choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                   <span class="st">"All ages"</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>,</span>
<span>                   <span class="st">"0-4 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>,</span>
<span>                   <span class="st">"5-14 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_5-14"</span>,</span>
<span>                   <span class="st">"15+ yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_15"</span></span>
<span>              <span class="op">)</span>, </span>
<span>              selected <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>              multiple <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>         <span class="op">)</span>,</span>
<span>         <span class="co"># selecteur poiur facility</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>           inputId <span class="op">=</span> <span class="st">"select_facility"</span>,</span>
<span>           label <span class="op">=</span> <span class="st">"Select Facility"</span>,</span>
<span>           choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="va">facility_list</span><span class="op">$</span><span class="va">location_name</span><span class="op">)</span>,</span>
<span>           selected <span class="op">=</span> <span class="st">"All"</span></span>
<span>         <span class="op">)</span>,</span>
<span>         </span>
<span>         <span class="co"># ligne horizontale</span></span>
<span>         <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html">downloadButton</a></span><span class="op">(</span></span>
<span>           outputId <span class="op">=</span> <span class="st">"download_epicurve"</span>,</span>
<span>           label <span class="op">=</span> <span class="st">"Download plot"</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span>    <span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="co"># epicurve va ici</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"malaria_epicurve"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"Welcome to the malaria facility visualisation app! To use this app, manipulate the widgets on the side to change the epidemic curve according to your preferences! To download a high quality image of the plot you've created, you can also download it with the download button. To see the raw data, use the raw data tab for an interactive form of the table. The data dictionary is as follows:"</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"location_name"</span><span class="op">)</span>, <span class="st">" - the facility that the data were collected at"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"data_date"</span><span class="op">)</span>, <span class="st">" - the date the data were collected at"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"submitted_daate"</span><span class="op">)</span>, <span class="st">" - the date the data were submitted at"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"Province"</span><span class="op">)</span>, <span class="st">" - the province the data were collected at (all 'North' for this dataset)"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"District"</span><span class="op">)</span>, <span class="st">" - the district the data were collected at"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"age_group"</span><span class="op">)</span>, <span class="st">" - the age group the data were collected for (0-5, 5-14, 15+, and all ages)"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"cases_reported"</span><span class="op">)</span>, <span class="st">" - the number of cases reported for the facility/age group on the given date"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      </span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Remarquez comment nous passons maintenant des variables pour nos choix au lieu de les coder en dur dans l’interface utilisateur ! Cela pourrait également rendre notre code plus compact ! Enfin, nous devrons mettre à jour le serveur. Il sera facile de mettre à jour notre fonction pour incorporer notre nouvelle entrée (nous devons juste la passer comme argument à notre nouveau paramètre), mais nous devons nous rappeler que nous voulons aussi que l’interface utilisateur soit mise à jour dynamiquement lorsque l’utilisateur change le district sélectionné. Il est important de comprendre ici que nous <em>pouvons modifier les paramètres et le comportement des widgets</em> pendant l’exécution de l’application, mais que cela doit être fait <em>dans le serveur</em>. Nous devons comprendre une nouvelle façon d’envoyer des données au serveur pour apprendre à le faire.</p>
<p>Les fonctions dont nous avons besoin pour comprendre comment faire cela sont connues sous le nom de fonctions <em>observatrices</em>, et sont similaires aux fonctions <em>réactives</em> dans leur comportement. Elles présentent toutefois une différence essentielle :</p>
<ul>
<li>Les fonctions réactives n’affectent pas directement les sorties et produisent des objets qui peuvent être vus à d’autres endroits du serveur.</li>
<li>Les fonctions d’observation <em>peuvent</em> affecter les sorties du serveur, mais le font via des effets secondaires d’autres fonctions. (Elles peuvent aussi faire d’autres choses, mais c’est leur principale fonction en pratique).</li>
</ul>
<p>Comme pour les fonctions réactives, il existe deux types de fonctions d’observation, qui sont divisées par la même logique que les fonctions réactives :</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe()</a></code> - cette fonction s’exécute à chaque fois que les entrées qu’elle contient changent.</li>
<li>
<code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code> - cette fonction s’exécute lorsqu’une entrée <em>spécifiée par l’utilisateur</em> change.</li>
</ol>
<p>Nous devons également comprendre les fonctions fournies par Shiny qui mettent à jour les widgets. Elles sont assez simples à exécuter - elles prennent d’abord l’objet <code>session</code> de la fonction serveur (il n’est pas nécessaire de le comprendre pour l’instant), puis le <code>inputId</code> de la fonction à modifier. Nous passons ensuite de nouvelles versions de tous les paramètres qui sont déjà pris par <code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput()</a></code> - ceux-ci seront automatiquement mis à jour dans le widget.</p>
<p>Regardons un exemple isolé de la façon dont nous pourrions utiliser ceci dans notre serveur. Lorsque l’utilisateur change de district, nous voulons filtrer notre tableau d’installations par district, et mettre à jour les choix pour <em>seulement refléter ceux qui sont disponibles dans ce district</em> (et une option pour toutes les installations).</p>
<div class="sourceCode" id="cb1834"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">select_district</span> <span class="op">==</span> <span class="st">"All"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="va">facility_list</span><span class="op">$</span><span class="va">location_name</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="va">facility_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">location_name</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="va">new_choices</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateSelectInput.html">updateSelectInput</a></span><span class="op">(</span><span class="va">session</span>, inputId <span class="op">=</span> <span class="st">"select_facility"</span>,</span>
<span>                    choices <span class="op">=</span> <span class="va">new_choices</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Et voilà ! nous pouvons l’ajouter dans notre serveur, et ce comportement fonctionnera désormais. Voici à quoi devrait ressembler notre nouveau serveur :</p>
<div class="sourceCode" id="cb1835"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">malaria_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span>, facility <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_facility</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">select_district</span> <span class="op">==</span> <span class="st">"All"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="va">facility_list</span><span class="op">$</span><span class="va">location_name</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="va">facility_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">location_name</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="va">new_choices</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateSelectInput.html">updateSelectInput</a></span><span class="op">(</span><span class="va">session</span>, inputId <span class="op">=</span> <span class="st">"select_facility"</span>,</span>
<span>                      choices <span class="op">=</span> <span class="va">new_choices</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">malaria_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span></span>
<span>    <span class="fu">malaria_plot</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">download_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadHandler.html">downloadHandler</a></span><span class="op">(</span></span>
<span>    </span>
<span>    filename <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"malaria_epicurve_{input$select_district}.png"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    </span>
<span>    content <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">file</span>, </span>
<span>             <span class="fu">malaria_plot</span><span class="op">(</span><span class="op">)</span>,</span>
<span>             width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="inline-figure"><img src="images/shiny/app_menu_view.gif" width="100%"></div>
</div>
<div id="ajout-dun-autre-onglet-avec-une-table" class="section level3 unnumbered">
<h3>Ajout d’un autre onglet avec une table<a class="anchor" aria-label="anchor" href="#ajout-dun-autre-onglet-avec-une-table"><i class="fas fa-link"></i></a>
</h3>
<p>Nous allons maintenant passer au dernier composant que nous voulons ajouter à notre application. Nous voulons séparer notre interface utilisateur en deux onglets, dont l’un comportera un tableau interactif où l’utilisateur pourra voir les données avec lesquelles il réalise la courbe épidémique. Pour ce faire, nous pouvons utiliser les éléments d’interface intégrés qui sont fournis avec Shiny pour les onglets. À un niveau de base, nous pouvons enfermer la plupart de notre panneau principal dans cette structure générale :</p>
<div class="sourceCode" id="cb1836"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ... le reste de l'ui</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabsetPanel.html">tabsetPanel</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"tabs"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>      <span class="st">"Epidemic Curves"</span>,</span>
<span>      <span class="va">...</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>      <span class="st">"Data"</span>,</span>
<span>      <span class="va">...</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Appliquons cela à notre interface utilisateur. Nous voudrons également utiliser le package <strong>DT</strong> ici - c’est un excellent package pour créer des tableaux interactifs à partir de données préexistantes. Nous pouvons voir qu’il est utilisé pour <code>DT::datatableOutput()</code> dans cet exemple.</p>
<div class="sourceCode" id="cb1837"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span>     </span>
<span>     <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"Malaria facility visualisation app"</span><span class="op">)</span>,</span>
<span>     </span>
<span>     <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span>          </span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>               <span class="co"># sélectionneur pour le district</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>                    inputId <span class="op">=</span> <span class="st">"select_district"</span>,</span>
<span>                    label <span class="op">=</span> <span class="st">"Select district"</span>,</span>
<span>                    choices <span class="op">=</span> <span class="va">all_districts</span>,</span>
<span>                    selected <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>                    multiple <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>               <span class="op">)</span>,</span>
<span>               <span class="co"># selector for age group</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>                    inputId <span class="op">=</span> <span class="st">"select_agegroup"</span>,</span>
<span>                    label <span class="op">=</span> <span class="st">"Select age group"</span>,</span>
<span>                    choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                         <span class="st">"All ages"</span> <span class="op">=</span> <span class="st">"malaria_tot"</span>,</span>
<span>                         <span class="st">"0-4 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_0-4"</span>,</span>
<span>                         <span class="st">"5-14 yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_5-14"</span>,</span>
<span>                         <span class="st">"15+ yrs"</span> <span class="op">=</span> <span class="st">"malaria_rdt_15"</span></span>
<span>                    <span class="op">)</span>, </span>
<span>                    selected <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>                    multiple <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>               <span class="op">)</span>,</span>
<span>               <span class="co"># selector for facility</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>                    inputId <span class="op">=</span> <span class="st">"select_facility"</span>,</span>
<span>                    label <span class="op">=</span> <span class="st">"Select Facility"</span>,</span>
<span>                    choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="va">facility_list</span><span class="op">$</span><span class="va">location_name</span><span class="op">)</span>,</span>
<span>                    selected <span class="op">=</span> <span class="st">"All"</span></span>
<span>               <span class="op">)</span>,</span>
<span>               </span>
<span>               <span class="co"># horizontal line</span></span>
<span>               <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html">downloadButton</a></span><span class="op">(</span></span>
<span>                    outputId <span class="op">=</span> <span class="st">"download_epicurve"</span>,</span>
<span>                    label <span class="op">=</span> <span class="st">"Download plot"</span></span>
<span>               <span class="op">)</span></span>
<span>               </span>
<span>          <span class="op">)</span>,</span>
<span>          </span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabsetPanel.html">tabsetPanel</a></span><span class="op">(</span></span>
<span>                    type <span class="op">=</span> <span class="st">"tabs"</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>                         <span class="st">"Epidemic Curves"</span>,</span>
<span>                         <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"malaria_epicurve"</span><span class="op">)</span></span>
<span>                    <span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>                         <span class="st">"Data"</span>,</span>
<span>                         <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">dataTableOutput</a></span><span class="op">(</span><span class="st">"raw_data"</span><span class="op">)</span></span>
<span>                    <span class="op">)</span></span>
<span>               <span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"Welcome to the malaria facility visualisation app! To use this app, manipulate the widgets on the side to change the epidemic curve according to your preferences! To download a high quality image of the plot you've created, you can also download it with the download button. To see the raw data, use the raw data tab for an interactive form of the table. The data dictionary is as follows:"</span><span class="op">)</span>,</span>
<span>               <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"location_name"</span><span class="op">)</span>, <span class="st">" - the facility that the data were collected at"</span><span class="op">)</span>,</span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"data_date"</span><span class="op">)</span>, <span class="st">" - the date the data were collected at"</span><span class="op">)</span>,</span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"submitted_daate"</span><span class="op">)</span>, <span class="st">" - the date the data were submitted at"</span><span class="op">)</span>,</span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"Province"</span><span class="op">)</span>, <span class="st">" - the province the data were collected at (all 'North' for this dataset)"</span><span class="op">)</span>,</span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"District"</span><span class="op">)</span>, <span class="st">" - the district the data were collected at"</span><span class="op">)</span>,</span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"age_group"</span><span class="op">)</span>, <span class="st">" - the age group the data were collected for (0-5, 5-14, 15+, and all ages)"</span><span class="op">)</span>,</span>
<span>                    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">b</span><span class="op">(</span><span class="st">"cases_reported"</span><span class="op">)</span>, <span class="st">" - the number of cases reported for the facility/age group on the given date"</span><span class="op">)</span></span>
<span>               <span class="op">)</span></span>
<span>               </span>
<span>               </span>
<span>          <span class="op">)</span></span>
<span>     <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Maintenant notre application est organisée en onglets ! Faisons également les modifications nécessaires sur le serveur. Puisque nous n’avons pas besoin de manipuler notre jeu de données avant de le rendre, c’est en fait très simple - nous rendons simplement le jeu de données malaria_data via DT::renderDT() à l’interface utilisateur !</p>
<div class="sourceCode" id="cb1838"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">malaria_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">plot_epicurve</span><span class="op">(</span><span class="va">malaria_data</span>, district <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span>, agegroup <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_agegroup</span>, facility <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">select_facility</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">select_district</span> <span class="op">==</span> <span class="st">"All"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="va">facility_list</span><span class="op">$</span><span class="va">location_name</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="va">facility_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">District</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">select_district</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">location_name</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">new_choices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="va">new_choices</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateSelectInput.html">updateSelectInput</a></span><span class="op">(</span><span class="va">session</span>, inputId <span class="op">=</span> <span class="st">"select_facility"</span>,</span>
<span>                      choices <span class="op">=</span> <span class="va">new_choices</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">malaria_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span></span>
<span>    <span class="fu">malaria_plot</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">download_epicurve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadHandler.html">downloadHandler</a></span><span class="op">(</span></span>
<span>    </span>
<span>    filename <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"malaria_epicurve_{input$select_district}.png"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    </span>
<span>    content <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">file</span>, </span>
<span>             <span class="fu">malaria_plot</span><span class="op">(</span><span class="op">)</span>,</span>
<span>             width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># rendre le tableau de données à ui</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">raw_data</span> <span class="op">&lt;-</span> <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">renderDT</a></span><span class="op">(</span></span>
<span>    <span class="va">malaria_data</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="inline-figure"><img src="images/shiny/app_table_view.gif" width="100%"></div>
</div>
</div>
<div id="partager-les-applications-shiny" class="section level2" number="42.7">
<h2>
<span class="header-section-number">42.7</span> Partager les applications shiny<a class="anchor" aria-label="anchor" href="#partager-les-applications-shiny"><i class="fas fa-link"></i></a>
</h2>
<p>Maintenant que vous avez développé votre application, vous voulez probablement la partager avec d’autres - c’est le principal avantage de shiny après tout ! Nous pouvons le faire en partageant le code directement, ou nous pouvons le publier sur un serveur. Si nous partageons le code, d’autres personnes pourront voir ce que vous avez fait et s’en inspirer, mais cela annulera l’un des principaux avantages de shiny - <em>il peut éliminer le besoin pour les utilisateurs finaux de maintenir une installation R</em>. Pour cette raison, si vous partagez votre application avec des utilisateurs qui ne sont pas à l’aise avec R, il est beaucoup plus facile de partager une application qui a été publiée sur un serveur.</p>
<p>Si vous préférez partager le code, vous pouvez créer un fichier .zip de l’application ou, mieux encore, <em>publier votre application sur github et ajouter des collaborateurs</em>.</p>
<p>Cependant, si nous publions l’application en ligne, nous devons faire un peu plus de travail. En fin de compte, nous voulons que votre application soit accessible via une URL Web afin que d’autres puissent y accéder rapidement et facilement. Malheureusement, pour publier votre application sur un serveur, vous devez avoir accès à un serveur sur lequel la publier ! Il existe un certain nombre d’options d’hébergement à cet égard :</p>
<ul>
<li><p><em>shinyapps.io</em> : c’est l’endroit le plus facile pour publier des applications shinys, car il nécessite le moins de travail de configuration possible et offre des licences gratuites, mais limitées.</p></li>
<li><p><em>RStudio Connect</em> : il s’agit d’une version beaucoup plus puissante d’un serveur R, qui peut effectuer de nombreuses opérations, y compris la publication de shiny apps. Elle est cependant plus difficile à utiliser et moins recommandée pour les utilisateurs débutants.</p></li>
</ul>
<p>Pour les besoins de ce document, nous utiliserons <em>shinyapps.io</em>, car il est plus facile pour les premiers utilisateurs. Vous pouvez créer un compte gratuit ici pour commencer - il y a également différents plans de prix pour les licesnses de serveur si nécessaire. Plus vous prévoyez d’avoir d’utilisateurs, plus votre plan tarifaire devra être cher, alors tenez-en compte. Si vous cherchez à créer quelque chose à l’usage d’un petit groupe d’individus, une licence gratuite peut convenir parfaitement, mais une application destinée au public peut nécessiter plus de licences.</p>
<p>Tout d’abord, nous devons nous assurer que notre application est adaptée à la publication sur un serveur. Dans votre application, vous devez redémarrer votre session R et vous assurer qu’elle fonctionne sans exécuter de code supplémentaire. C’est important, car une application qui nécessite le chargement de packages ou la lecture de données non définis dans le code de votre application ne fonctionnera pas sur un serveur. Notez également que vous ne pouvez pas avoir de chemins de fichiers <em>explicites</em> dans votre application - ceux-ci seront invalides dans le paramétrage du serveur - l’utilisation du package <code>here</code> résout très bien ce problème. Enfin, si vous lisez des données à partir d’une source qui nécessite une authentification de l’utilisateur, comme les serveurs de votre organisation, cela ne fonctionnera généralement pas sur un serveur. Vous devrez vous mettre en relation avec votre service informatique pour savoir comment mettre le serveur shiny sur la whitelist.</p>
<p><em>Création d’un compte</em></p>
<p>Une fois que vous avez votre compte, vous pouvez naviguer vers la page des jetons sous <em>Accounts</em>. Ici, vous devriez ajouter un nouveau jeton - il sera utilisé pour déployer votre application.</p>
<p>A partir de là, vous devez noter que l’url de votre compte reflétera le nom de votre application - donc si votre application s’appelle <em>mon_app</em>, l’url sera ajouté comme <em>xxx.io/mon_app/</em>. Choisissez judicieusement le nom de votre application ! Maintenant que vous êtes prêt, cliquez sur deploy - si vous réussissez, votre application sera lancée sur l’url que vous avez choisi !</p>
<p><em>Quelque chose sur la création d’applications dans des documents ?</em></p>
</div>
<div id="lecture-complémentaire" class="section level2" number="42.8">
<h2>
<span class="header-section-number">42.8</span> Lecture complémentaire<a class="anchor" aria-label="anchor" href="#lecture-compl%C3%A9mentaire"><i class="fas fa-link"></i></a>
</h2>
<p>Jusqu’à présent, nous avons couvert beaucoup d’aspects de shiny, et nous avons à peine effleuré la surface de ce qui est offert pour shiny. Bien que ce guide serve d’introduction, il y a beaucoup plus à apprendre pour comprendre pleinement shiny. Vous devriez commencer à créer des applications et ajouter progressivement de plus en plus de fonctionnalités.</p>
</div>
<div id="packages-dextension-recommandés" class="section level2" number="42.9">
<h2>
<span class="header-section-number">42.9</span> packages d’extension recommandés<a class="anchor" aria-label="anchor" href="#packages-dextension-recommand%C3%A9s"><i class="fas fa-link"></i></a>
</h2>
<p>Ce qui suit représente une sélection d’extensions de haute qualité pour shiny qui peuvent vous aider à obtenir beaucoup plus de shiny. Sans ordre particulier :</p>
<ul>
<li><p><strong>shinyWidgets</strong> - ce package vous donne beaucoup plus de widgets qui peuvent être utilisés dans votre application. Lancez <code>shinyWidgets::shinyWidgetsGallery()</code> pour voir une sélection des widgets disponibles avec ce package. Voir des exemples <a href="https://github.com/dreamRs/shinyWidgets">ici</a></p></li>
<li><p><strong>shinyjs</strong> - c’est un excellent package qui donne à l’utilisateur la possibilité d’étendre considérablement l’utilité de shiny via une série de javascript. Les applications de ce package vont de très simples à très avancées, mais vous voudrez peut-être l’utiliser d’abord pour manipuler l’interface utilisateur de manière simple, comme cacher/afficher des éléments, ou activer/désactiver des boutons. En savoir plus <a href="https://deanattali.com/shinyjs/basic">ici</a></p></li>
<li><p><strong>shinydashboard</strong> - ce package étend massivement l’interface utilisateur disponible qui peut être utilisée dans shiny, en particulier en permettant à l’utilisateur de créer un tableau de bord complexe avec une variété de mises en page complexes. Voir plus <a href="https://rstudio.github.io/shinydashboard/">ici</a></p></li>
<li><p><strong>shinydashboardPlus</strong> - Obtenez encore plus de fonctionnalités du framework <strong>shinydashboard</strong> ! En savoir plus <a href="https://rinterface.github.io/shinydashboardPlus/articles/shinydashboardPlus.html">ici</a></p></li>
<li><p><strong>shinythemes</strong> - changez le thème css par défaut de votre application shiny avec une large gamme de modèles prédéfinis ! En savoir plus <a href="https://rstudio.github.io/shinythemes/">ici</a></p></li>
</ul>
<p>Il existe également un certain nombre de packages qui peuvent être utilisés pour créer des sorties interactives compatibles avec shiny.</p>
<ul>
<li><p><strong>DT</strong> est semi-incorporé dans base-shiny, mais fournit un grand ensemble de fonctions pour créer des tableaux interactifs.</p></li>
<li><p><strong>plotly</strong> est un package pour créer des graphiques interactifs que l’utilisateur peut manipuler dans l’application. Vous pouvez également convertir vos graphiques en versions interactives via <code><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">plotly::ggplotly()</a></code> ! Comme alternatives, <strong>dygraphs</strong> et <strong>highcharter</strong> sont également excellents.</p></li>
</ul>
</div>
<div id="ressources-recommandées" class="section level2" number="42.10">
<h2>
<span class="header-section-number">42.10</span> Ressources recommandées<a class="anchor" aria-label="anchor" href="#ressources-recommand%C3%A9es"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="dashboards.html"><span class="header-section-number">41</span> Tableaux de bord avec R Markdown</a></div>
<div class="next"><a href="writing_functions.html"><span class="header-section-number">43</span> Fonctions d’écriture</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#shiny"><span class="header-section-number">42</span> Tableaux de bord avec Shiny</a></li>
<li>
<a class="nav-link" href="#pr%C3%A9paration-26"><span class="header-section-number">42.1</span> Préparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#chargement-des-packages-2">Chargement des packages</a></li>
<li><a class="nav-link" href="#importer-des-donn%C3%A9es-9">Importer des données</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#la-structure-dune-application-shiny"><span class="header-section-number">42.2</span> La structure d’une application shiny</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#structures-de-fichiers-de-base">Structures de fichiers de base</a></li>
<li><a class="nav-link" href="#le-serveur-et-linterface-utilisateur">Le serveur et l’interface utilisateur</a></li>
<li><a class="nav-link" href="#avant-de-commencer-%C3%A0-construire-une-application">Avant de commencer à construire une application</a></li>
</ul>
</li>
<li><a class="nav-link" href="#construire-une-interface-utilisateur"><span class="header-section-number">42.3</span> Construire une interface utilisateur</a></li>
<li><a class="nav-link" href="#chargement-des-donn%C3%A9es-dans-notre-application"><span class="header-section-number">42.4</span> Chargement des données dans notre application</a></li>
<li><a class="nav-link" href="#d%C3%A9velopper-un-serveur-dapplications"><span class="header-section-number">42.5</span> Développer un serveur d’applications</a></li>
<li>
<a class="nav-link" href="#ajout-de-fonctionnalit%C3%A9s-suppl%C3%A9mentaires"><span class="header-section-number">42.6</span> Ajout de fonctionnalités supplémentaires</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ajouter-du-texte-statique">Ajouter du texte statique</a></li>
<li><a class="nav-link" href="#ajouter-un-lien">Ajouter un lien</a></li>
<li><a class="nav-link" href="#ajout-dun-bouton-de-t%C3%A9l%C3%A9chargement">Ajout d’un bouton de téléchargement</a></li>
<li><a class="nav-link" href="#ajout-dun-s%C3%A9lecteur-dequipements">Ajout d’un sélecteur d’equipements</a></li>
<li><a class="nav-link" href="#ajout-dun-autre-onglet-avec-une-table">Ajout d’un autre onglet avec une table</a></li>
</ul>
</li>
<li><a class="nav-link" href="#partager-les-applications-shiny"><span class="header-section-number">42.7</span> Partager les applications shiny</a></li>
<li><a class="nav-link" href="#lecture-compl%C3%A9mentaire"><span class="header-section-number">42.8</span> Lecture complémentaire</a></li>
<li><a class="nav-link" href="#packages-dextension-recommand%C3%A9s"><span class="header-section-number">42.9</span> packages d’extension recommandés</a></li>
<li><a class="nav-link" href="#ressources-recommand%C3%A9es"><span class="header-section-number">42.10</span> Ressources recommandées</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Le Epi R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-21.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
