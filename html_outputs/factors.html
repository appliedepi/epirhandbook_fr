<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>11 Facteurs | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="11 Facteurs | The Epidemiologist R Handbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Facteurs | The Epidemiologist R Handbook" />
  
  <meta name="twitter:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.2/transition.js"></script>
    <script src="libs/bs3compat-0.4.2/tabs.js"></script>
    <script src="libs/bs3compat-0.4.2/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.27/datatables.js"></script>
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
    <script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.9/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.1/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="factors" class="section level1" number="11">
<h1><span class="header-section-number">11</span> Facteurs</h1>
<p><img src="images/Factors_1500x500.png" width="100%" /></p>
<p>En R, les <em>facteurs</em> sont une classe de données qui permettent de créer des catégories ordonnées avec un ensemble fixe de valeurs acceptables.</p>
<p>En règle générale, vous convertissez une colonne de la classe caractères ou numérique en un facteur si vous souhaitez définir un ordre intrinsèque aux valeurs (“<em>niveaux</em>”) afin qu’elles puissent être affichées de manière non alphabétique dans les graphiques et les tableaux. Une autre utilisation courante des facteurs consiste à normaliser les légendes des graphiques afin qu’elles ne fluctuent pas si certaines valeurs sont temporairement absentes des données.</p>
<p>Cette page présente l’utilisation des fonctions du package <strong>forcats</strong> (un nom court pour “<strong>For</strong> <strong>cat</strong>egorical variables”) et de certaines fonctions R <strong>base</strong>. Nous abordons également l’utilisation de <strong>lubridate</strong> et <strong>aweek</strong> pour les cas de facteurs spéciaux liés aux semaines épidémiologiques.</p>
<p>Une liste complète des fonctions du pacakge <strong>forcats</strong> est disponible en ligne <a href="https://forcats.tidyverse.org/reference/index.html">ici</a>. Nous présentons ci-dessous quelques-unes des fonctions les plus courantes.</p>
<!-- ======================================================= -->
<div id="preparation-1" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> Preparation</h2>
<div id="chargement-des-paquets" class="section level3 unnumbered">
<h3>Chargement des paquets</h3>
<p>Ce morceau de code montre le chargement des packages nécessaires aux analyses. Dans ce manuel, nous mettons l’accent sur <code>p_load()</code> de <strong>pacman</strong>, qui installe le package si nécessaire <em>et</em> le charge pour l’utiliser. Vous pouvez également charger les packages installés avec <code>library()</code> de <strong>base</strong> R. Voir la page sur <a href="rbasics.html#rbasics">R basics</a> pour plus d’informations sur les packages R.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="factors.html#cb541-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb541-2"><a href="factors.html#cb541-2" aria-hidden="true" tabindex="-1"></a>  rio,           <span class="co"># importer/exporter</span></span>
<span id="cb541-3"><a href="factors.html#cb541-3" aria-hidden="true" tabindex="-1"></a>  here,          <span class="co"># chemin des fichiers</span></span>
<span id="cb541-4"><a href="factors.html#cb541-4" aria-hidden="true" tabindex="-1"></a>  lubridate,     <span class="co"># travailler avec les dates</span></span>
<span id="cb541-5"><a href="factors.html#cb541-5" aria-hidden="true" tabindex="-1"></a>  forcats,       <span class="co"># facteurs</span></span>
<span id="cb541-6"><a href="factors.html#cb541-6" aria-hidden="true" tabindex="-1"></a>  aweek,         <span class="co"># creer epiweeks avec les niveaux des facteurs</span></span>
<span id="cb541-7"><a href="factors.html#cb541-7" aria-hidden="true" tabindex="-1"></a>  janitor,       <span class="co"># tableau</span></span>
<span id="cb541-8"><a href="factors.html#cb541-8" aria-hidden="true" tabindex="-1"></a>  tidyverse      <span class="co"># données management et visualisation</span></span>
<span id="cb541-9"><a href="factors.html#cb541-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="importer-données" class="section level3 unnumbered">
<h3>Importer données</h3>
<p>Nous importons le jeu de données des cas d’une épidémie d’Ebola simulée. Si vous voulez suivre, , <a href='https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds' class='download-button'>cliquer pour telecharger le jeu de données “nettoyé” linelist</a> (as .rds file). Importez vos données avec la fonction <code>import()</code> du package <strong>rio</strong> (elle accepte de nombreux types de fichiers comme .xlsx, .rds, .csv - voir la page <a href="import_export.html#import_export">Importation et exportation</a> pour plus de détails).</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="factors.html#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importer ton jeu de donnée</span></span>
<span id="cb542-2"><a href="factors.html#cb542-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist_cleaned.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="fct_newcat" class="section level3 unnumbered">
<h3>Nouveau variable qualitative</h3>
<p>Pour la démonstration dans cette page, nous utiliserons un scénario commun - la création d’une nouvelle variable catégorielle.</p>
<p>Notez que si vous convertissez une colonne numérique en facteur de classe, vous ne serez pas en mesure de calculer des statistiques numériques sur celle-ci.</p>
<div id="creation-de-colonnes" class="section level4 unnumbered">
<h4>Creation de colonnes</h4>
<p>Nous utilisons la colonne existante <code>days_onset_hosp</code> (jours entre l’apparition des symptômes et l’admission à l’hôpital) et créons une nouvelle colonne <code>delay_cat</code> en classant chaque ligne dans l’une de plusieurs catégories. Nous faisons cela avec la fonction <strong>dplyr</strong> <code>case_when()</code>, qui applique séquentiellement des critères logiques (côté droit) à chaque ligne et renvoie la valeur correspondante côté gauche pour la nouvelle colonne <code>delay_cat</code>. Vous trouverez plus d’informations sur la fonction <code>case_when()</code> dans <a href="cleaning_data.html#cleaning_data">Nettoyage des données et des fonctions de base</a>.</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="factors.html#cb543-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb543-2"><a href="factors.html#cb543-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb543-3"><a href="factors.html#cb543-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># critere                                 # nouveau valeur si vrai</span></span>
<span id="cb543-4"><a href="factors.html#cb543-4" aria-hidden="true" tabindex="-1"></a>    days_onset_hosp <span class="sc">&lt;</span> <span class="dv">2</span>                        <span class="sc">~</span> <span class="st">&quot;&lt;2 days&quot;</span>,</span>
<span id="cb543-5"><a href="factors.html#cb543-5" aria-hidden="true" tabindex="-1"></a>    days_onset_hosp <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> days_onset_hosp <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">&quot;2-5 days&quot;</span>,</span>
<span id="cb543-6"><a href="factors.html#cb543-6" aria-hidden="true" tabindex="-1"></a>    days_onset_hosp <span class="sc">&gt;=</span> <span class="dv">5</span>                       <span class="sc">~</span> <span class="st">&quot;&gt;5 days&quot;</span>,</span>
<span id="cb543-7"><a href="factors.html#cb543-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(days_onset_hosp)                     <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb543-8"><a href="factors.html#cb543-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                                       <span class="sc">~</span> <span class="st">&quot;Check me&quot;</span>))  </span></code></pre></div>
</div>
<div id="ordre-des-valeurs-par-defaut" class="section level4 unnumbered">
<h4>Ordre des valeurs par defaut</h4>
<p>Telle que créée avec <code>case_when()</code>, la nouvelle colonne <code>delay_cat</code> est une colonne catégorielle de la classe Character - <em>pas</em> encore un facteur. Ainsi, dans un tableau de fréquence, nous voyons que les valeurs uniques apparaissent dans un ordre alphanumérique par défaut - un ordre qui n’a pas beaucoup de sens intuitif :</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="factors.html#cb544-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>delay_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  &lt;2 days  &gt;5 days 2-5 days     &lt;NA&gt; 
##     2990      602     2040      256</code></pre>
<p>De même, si nous réalisons un diagramme à barres, les valeurs apparaissent également dans cet ordre sur l’axe des x (voir la page sur <a href="ggplot_basics.html#ggplot_basics">les bases de ggplot</a> pour en savoir plus sur <strong>ggplot2</strong> - le package de visualisation le plus courant dans R).</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="factors.html#cb546-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb546-2"><a href="factors.html#cb546-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> delay_cat))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-369-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="convertir-en-facteur" class="section level2" number="11.2">
<h2><span class="header-section-number">11.2</span> Convertir en facteur</h2>
<p>Pour convertir une colonne de caractères ou de chiffres en facteur de classe, vous pouvez utiliser n’importe quelle fonction du package <strong>forcats</strong> (plusieurs sont détaillées <a href="factors.html#fct_adjust">ci-dessous</a>). Elles convertiront en facteur de classe et effectueront ou permettront un certain ordre des niveaux - par exemple, l’utilisation de <code>fct_relevel()</code> vous permet de spécifier manuellement l’ordre des niveaux. La fonction <code>as_factor()</code> convertit simplement la classe sans autres capacités.</p>
<p>La fonction R <strong>base</strong> <code>factor()</code> convertit une colonne en facteur et vous permet de spécifier manuellement l’ordre des niveaux, comme un vecteur de caractères à son argument <code>levels =</code>.</p>
<p>Ci-dessous, nous utilisons <code>mutate()</code> et <code>fct_relevel()</code> pour convertir la colonne <code>delay_cat</code> de la classe caractère à la classe facteur. La colonne <code>delay_cat</code> est créée dans la section <a href="factors.html#fct_newcat">Préparation</a> ci-dessus.</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="factors.html#cb547-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb547-2"><a href="factors.html#cb547-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_relevel</span>(delay_cat))</span></code></pre></div>
<p><em>Les “valeurs” uniques de cette colonne sont maintenant considérées comme des “niveaux” du facteur.</em>
Les niveaux ont un <em>ordre</em>, qui peut être affiché avec la fonction <strong>base</strong> R <code>levels()</code>, ou alternativement visualisé dans un tableau de comptage via <code>table()</code> de <strong>base</strong> R ou <code>tabyl()</code> de <strong>janitor</strong>. Par défaut, l’ordre des niveaux sera alpha-numérique, comme auparavant. Notez que <code>NA</code> n’est pas un niveau de facteur.</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="factors.html#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(linelist<span class="sc">$</span>delay_cat)</span></code></pre></div>
<pre><code>## [1] &quot;&lt;2 days&quot;  &quot;&gt;5 days&quot;  &quot;2-5 days&quot;</code></pre>
<p>La fonction <code>fct_relevel()</code> a l’utilité supplémentaire de vous permettre de spécifier manuellement l’ordre des niveaux. Il suffit d’écrire les valeurs des niveaux dans l’ordre, entre guillemets, séparés par des virgules, comme indiqué ci-dessous. Notez que l’orthographe doit correspondre exactement aux valeurs. Si vous voulez créer des niveaux qui n’existent pas dans les données, utilisez plutôt <a href="factors.html#fct_add"><code>fct_expand()</code></a>).</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="factors.html#cb550-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb550-2"><a href="factors.html#cb550-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_relevel</span>(delay_cat, <span class="st">&quot;&lt;2 days&quot;</span>, <span class="st">&quot;2-5 days&quot;</span>, <span class="st">&quot;&gt;5 days&quot;</span>))</span></code></pre></div>
<p>Nous pouvons maintenant voir que les niveaux sont ordonnés, comme spécifié dans la commande précédente, dans un ordre raisonnable.</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="factors.html#cb551-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(linelist<span class="sc">$</span>delay_cat)</span></code></pre></div>
<pre><code>## [1] &quot;&lt;2 days&quot;  &quot;2-5 days&quot; &quot;&gt;5 days&quot;</code></pre>
<p>Maintenant, l’ordre de l’intrigue a aussi un sens plus intuitif.</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="factors.html#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb553-2"><a href="factors.html#cb553-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> delay_cat))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-374-1.png" width="672" /></p>
</div>
<div id="ajouter-ou-enlever-des-niveaux" class="section level2" number="11.3">
<h2><span class="header-section-number">11.3</span> Ajouter ou enlever des niveaux</h2>
<div id="fct_add" class="section level3 unnumbered">
<h3>Ajouter</h3>
<p>Si vous devez ajouter des niveaux à un facteur, vous pouvez le faire avec <code>fct_expand()</code>. Il suffit d’écrire le nom de la colonne suivi des nouveaux niveaux (séparés par des virgules). En tabulant les valeurs, nous pouvons voir les nouveaux niveaux et le nombre de zéros. Vous pouvez utiliser <code>table()</code> de <strong>base</strong> R, ou <code>tabyl()</code> de <strong>janitor</strong> :</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="factors.html#cb554-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb554-2"><a href="factors.html#cb554-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_expand</span>(delay_cat, <span class="st">&quot;Not admitted to hospital&quot;</span>, <span class="st">&quot;Transfer to other jurisdiction&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb554-3"><a href="factors.html#cb554-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(delay_cat)   <span class="co"># afficher le tableau</span></span></code></pre></div>
<pre><code>##                       delay_cat    n    percent valid_percent
##                         &lt;2 days 2990 0.50781250     0.5308949
##                        2-5 days 2040 0.34646739     0.3622159
##                         &gt;5 days  602 0.10224185     0.1068892
##        Not admitted to hospital    0 0.00000000     0.0000000
##  Transfer to other jurisdiction    0 0.00000000     0.0000000
##                            &lt;NA&gt;  256 0.04347826            NA</code></pre>
<p>Note : il existe une fonction spéciale <strong>forcats</strong> pour ajouter facilement les valeurs manquantes (<code>NA</code>) comme niveau. Voir la section sur les <a href="factors.html#fct_missing">Valeurs manquantes</a> ci-dessous.</p>
</div>
<div id="enlever" class="section level3 unnumbered">
<h3>Enlever</h3>
<p>Si vous utilisez <code>fct_drop()</code>, les niveaux “inutilisés” avec des comptes nuls seront supprimés de l’ensemble des niveaux. Les niveaux que nous avons ajoutés ci-dessus (“Non admis à l’hôpital”) existent en tant que niveau mais aucune ligne n’a réellement ces valeurs. Ils seront donc supprimés en appliquant <code>fct_drop()</code> à notre colonne de facteurs :</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="factors.html#cb556-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb556-2"><a href="factors.html#cb556-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_drop</span>(delay_cat)) <span class="sc">%&gt;%</span> </span>
<span id="cb556-3"><a href="factors.html#cb556-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(delay_cat)</span></code></pre></div>
<pre><code>##  delay_cat    n    percent valid_percent
##    &lt;2 days 2990 0.50781250     0.5308949
##   2-5 days 2040 0.34646739     0.3622159
##    &gt;5 days  602 0.10224185     0.1068892
##       &lt;NA&gt;  256 0.04347826            NA</code></pre>
</div>
</div>
<div id="fct_adjust" class="section level2" number="11.4">
<h2><span class="header-section-number">11.4</span> Ajuster l’ordre des niveaux</h2>
<p>Le package <strong>forcats</strong> offre des fonctions utiles pour ajuster facilement l’ordre des niveaux d’un facteur (après qu’une colonne ait été définie comme facteur de classe) :</p>
<p>Ces fonctions peuvent être appliquées à une colonne de facteurs dans deux contextes :</p>
<ol style="list-style-type: decimal">
<li>A la colonne dans le dataframe, comme d’habitude, afin que la transformation soit disponible pour toute utilisation ultérieure des données.<br />
</li>
<li><em>À l’intérieur d’un graphique</em>, de sorte que la modification soit appliquée uniquement à l’intérieur du graphique.</li>
</ol>
<div id="manuellement" class="section level3 unnumbered">
<h3>Manuellement</h3>
<p>Cette fonction est utilisée pour ordonner manuellement les niveaux des facteurs. Si elle est utilisée sur une colonne sans facteur, la colonne sera d’abord convertie en facteur de classe.</p>
<p>Entre les parenthèses, fournissez d’abord le nom de la colonne de facteur, puis fournissez soit :</p>
<ul>
<li>Tous les niveaux dans l’ordre désiré (comme un vecteur de caractères <code>c()</code>), ou bien<br />
</li>
<li>Un niveau et son placement corrigé en utilisant l’argument <code>after =</code>.</li>
</ul>
<p>Voici un exemple de redéfinition de la colonne <code>delay_cat</code> (qui est déjà de la classe Factor) et de spécification de tous les niveaux dans l’ordre souhaité.</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="factors.html#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-define level order</span></span>
<span id="cb558-2"><a href="factors.html#cb558-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb558-3"><a href="factors.html#cb558-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_relevel</span>(delay_cat, <span class="fu">c</span>(<span class="st">&quot;&lt;2 days&quot;</span>, <span class="st">&quot;2-5 days&quot;</span>, <span class="st">&quot;&gt;5 days&quot;</span>)))</span></code></pre></div>
<p>Si vous voulez seulement déplacer un niveau, vous pouvez le spécifier à <code>fct_relevel()</code> seul et donner un nombre à l’argument <code>after =</code> pour indiquer où dans l’ordre il doit être. Par exemple, la commande ci-dessous déplace “&lt;2 jours” en deuxième position :</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="factors.html#cb559-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-define level order</span></span>
<span id="cb559-2"><a href="factors.html#cb559-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb559-3"><a href="factors.html#cb559-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_relevel</span>(delay_cat, <span class="st">&quot;&lt;2 days&quot;</span>, <span class="at">after =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb559-4"><a href="factors.html#cb559-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(delay_cat)</span></code></pre></div>
</div>
<div id="dans-un-graphe" class="section level3 unnumbered">
<h3>Dans un graphe</h3>
<p>Les commandes <strong>forcats</strong> peuvent être utilisées pour définir l’ordre des niveaux dans le dataframe, ou seulement dans un graphique. En utilisant la commande pour “envelopper” le nom de la colonne <em>dans</em> la commande de traçage <code>ggplot()</code>, vous pouvez inverser/niveler/etc. la transformation ne s’appliquera que dans ce tracé.</p>
<p>Ci-dessous, deux tracés sont créés avec <code>ggplot()</code> (voir la page <a href="ggplot_basics.html#ggplot_basics">les bases de ggplot</a>). Dans le premier, la colonne <code>delay_cat</code> est mise en correspondance avec l’axe des x du graphique, avec son ordre de niveau par défaut comme dans les données <code>linelist</code>. Dans le second exemple, elle est enveloppée dans <code>fct_relevel()</code> et l’ordre est modifié dans le graphe.</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="factors.html#cb560-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordre alphanumerique par defaut - pas d&#39;ajustement dans ggplot</span></span>
<span id="cb560-2"><a href="factors.html#cb560-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb560-3"><a href="factors.html#cb560-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> delay_cat))</span>
<span id="cb560-4"><a href="factors.html#cb560-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb560-5"><a href="factors.html#cb560-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordonner des niveaux de facteurs dans ggplot</span></span>
<span id="cb560-6"><a href="factors.html#cb560-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb560-7"><a href="factors.html#cb560-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_relevel</span>(delay_cat, <span class="fu">c</span>(<span class="st">&quot;&lt;2 days&quot;</span>, <span class="st">&quot;2-5 days&quot;</span>, <span class="st">&quot;&gt;5 days&quot;</span>))))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-380-1.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-380-2.png" width="50%" /></p>
<p>Notez que le titre par défaut de l’axe des x est maintenant assez compliqué - vous pouvez changer ce titre avec l’argument <strong>ggplot2</strong> <code>labs()</code>.</p>
</div>
<div id="inverser" class="section level3 unnumbered">
<h3>Inverser</h3>
<p>Il est assez fréquent que vous vouliez inverser l’ordre des niveaux. Enveloppez simplement le facteur avec <code>fct_rev()</code>.</p>
<p>Notez que si vous voulez inverser <em>seulement</em> la légende du graphique mais pas les niveaux réels du facteur, vous pouvez le faire avec <code>guides()</code> (voir la page <a href="ggplot_tips.html#ggplot_tips">Astuces avec ggplot</a>)).</p>
</div>
<div id="par-fréquence" class="section level3 unnumbered">
<h3>Par fréquence</h3>
<p>Pour ordonner par fréquence que la valeur apparaît dans les données, utilisez <code>fct_infreq()</code>. Toute valeur manquante (<code>NA</code>) sera automatiquement incluse à la fin, à moins qu’elle ne soit convertie en un niveau explicite (voir <a href="factors.html#fct_missing">cette section</a>). Vous pouvez inverser l’ordre en enveloppant davantage avec <code>fct_rev()</code>.</p>
<p>Cette fonction peut être utilisée dans un <code>ggplot()</code>, comme indiqué ci-dessous.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="factors.html#cb561-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ordered by frequency</span></span>
<span id="cb561-2"><a href="factors.html#cb561-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_infreq</span>(delay_cat)))<span class="sc">+</span></span>
<span id="cb561-3"><a href="factors.html#cb561-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb561-4"><a href="factors.html#cb561-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Delay onset to admission (days)&quot;</span>,</span>
<span id="cb561-5"><a href="factors.html#cb561-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Ordered by frequency&quot;</span>)</span>
<span id="cb561-6"><a href="factors.html#cb561-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-7"><a href="factors.html#cb561-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fréquence inversée</span></span>
<span id="cb561-8"><a href="factors.html#cb561-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_rev</span>(<span class="fu">fct_infreq</span>(delay_cat))))<span class="sc">+</span></span>
<span id="cb561-9"><a href="factors.html#cb561-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb561-10"><a href="factors.html#cb561-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Delay onset to admission (days)&quot;</span>,</span>
<span id="cb561-11"><a href="factors.html#cb561-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Reverse of order by frequency&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-381-1.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-381-2.png" width="50%" /></p>
</div>
<div id="par-apparence" class="section level3 unnumbered">
<h3>Par apparence</h3>
<p>Utilisez <code>fct_inorder()</code> pour définir l’ordre des niveaux afin de correspondre à l’ordre d’apparition dans les données, en commençant par la première ligne. Cela peut être utile si vous avez d’abord soigneusement <code>arrange()</code> les données dans le cadre de données, et ensuite l’utiliser pour définir l’ordre des facteurs.</p>
</div>
<div id="par-la-statistique-sommaire-dune-autre-colonne" class="section level3 unnumbered">
<h3>Par la statistique sommaire d’une autre colonne</h3>
<p>Vous pouvez utiliser <code>fct_reorder()</code> pour ordonner les niveaux d’une colonne <em>par une statistique sommaire d’une autre colonne</em>. Visuellement, cela peut donner des graphiques agréables où les barres/points montent ou descendent régulièrement sur le graphique.</p>
<p>Dans les exemples ci-dessous, l’axe des x est <code>delay_cat</code>, et l’axe des y est la colonne numérique <code>ct_blood</code> (valeur du seuil de cycle). Les box plots montrent la distribution des valeurs CT par groupe <code>delay_cat</code>. Nous voulons ordonner les box plots dans l’ordre croissant de la valeur médiane du groupe.</p>
<p>Dans le premier exemple ci-dessous, l’ordre par défaut alpha-numérique est utilisé. Vous pouvez voir que les hauteurs des box plots sont mélangées et ne sont pas dans un ordre particulier. Dans le deuxième exemple, la colonne <code>delay_cat</code> (mappée sur l’axe des x) a été enveloppée dans <code>fct_reorder()</code>, la colonne <code>ct_blood</code> est donnée comme deuxième argument, et “median” est donné comme troisième argument (vous pourriez aussi utiliser “max”, “mean”, “min”, etc). Ainsi, l’ordre des niveaux de <code>delay_cat</code> reflètera maintenant les valeurs médianes croissantes de la valeur médiane de CT de chaque groupe <code>delay_cat</code>. Ceci est reflété dans le deuxième graphique - les box plots ont été réarrangés pour être ascendants. Notez comment <code>NA</code> (manquant) apparaîtra à la fin, à moins d’être converti en un niveau explicite.</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="factors.html#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplots ordonnés par les niveaux des facteurs initiaux</span></span>
<span id="cb562-2"><a href="factors.html#cb562-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb562-3"><a href="factors.html#cb562-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb562-4"><a href="factors.html#cb562-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> delay_cat,</span>
<span id="cb562-5"><a href="factors.html#cb562-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> ct_blood, </span>
<span id="cb562-6"><a href="factors.html#cb562-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> delay_cat))<span class="sc">+</span></span>
<span id="cb562-7"><a href="factors.html#cb562-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Délai d&#39;apparition à l&#39;admission (jours)&quot;</span>,</span>
<span id="cb562-8"><a href="factors.html#cb562-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Classé par niveaux alphanumériques originaux&quot;</span>)<span class="sc">+</span></span>
<span id="cb562-9"><a href="factors.html#cb562-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb562-10"><a href="factors.html#cb562-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb562-11"><a href="factors.html#cb562-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb562-12"><a href="factors.html#cb562-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb562-13"><a href="factors.html#cb562-13" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplots ordonner par la mediane des valeurs de CT </span></span>
<span id="cb562-14"><a href="factors.html#cb562-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb562-15"><a href="factors.html#cb562-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb562-16"><a href="factors.html#cb562-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(delay_cat, ct_blood, <span class="st">&quot;median&quot;</span>),</span>
<span id="cb562-17"><a href="factors.html#cb562-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> ct_blood,</span>
<span id="cb562-18"><a href="factors.html#cb562-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> delay_cat))<span class="sc">+</span></span>
<span id="cb562-19"><a href="factors.html#cb562-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Délai d&#39;apparition à l&#39;admission (jours)&quot;</span>,</span>
<span id="cb562-20"><a href="factors.html#cb562-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Classé par valeur médiane de CT dans par groupe&quot;</span> )<span class="sc">+</span></span>
<span id="cb562-21"><a href="factors.html#cb562-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb562-22"><a href="factors.html#cb562-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-382-1.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-382-2.png" width="50%" /></p>
<p>Notez que dans l’exemple ci-dessus, aucune étape n’est nécessaire avant l’appel à <code>ggplot()</code> - le regroupement et les calculs sont tous effectués en interne par la commande ggplot.</p>
</div>
<div id="par-la-valeur-end" class="section level3 unnumbered">
<h3>Par la valeur “end”</h3>
<p>Utilisez <code>fct_reorder2()</code> pour des tracés de lignes groupées. Il ordonne les niveaux (et donc le <em>légende</em>) pour s’aligner avec l’ordre vertical des lignes à la “fin” du tracé. Techniquement parlant, il “ordonne par les valeurs y associées aux plus grandes valeurs x”.</p>
<p>Par exemple, si vous avez des lignes montrant le nombre de cas par hôpital au fil du temps, vous pouvez appliquer <code>fct_reorder2()</code> à l’argument <code>color =</code> dans <code>aes()</code>, de sorte que l’ordre vertical des hôpitaux apparaissant dans la légende s’aligne sur l’ordre des lignes à l’extrémité du tracé. Pour en savoir plus, consultez la <a href="https://forcats.tidyverse.org/reference/fct_reorder.html">documentation en ligne</a>.</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="factors.html#cb563-1" aria-hidden="true" tabindex="-1"></a>epidemic_data <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>         <span class="co"># commencer avec linelist  </span></span>
<span id="cb563-2"><a href="factors.html#cb563-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(date_onset <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;2014-09-21&quot;</span>)) <span class="sc">%&gt;%</span>    <span class="co"># point de coupure  la date, pour une meilleur visualisation</span></span>
<span id="cb563-3"><a href="factors.html#cb563-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(                                            <span class="co"># obtenir le nombre de cas par semaine et par hôpital</span></span>
<span id="cb563-4"><a href="factors.html#cb563-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">epiweek =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(date_onset, <span class="st">&quot;week&quot;</span>),  </span>
<span id="cb563-5"><a href="factors.html#cb563-5" aria-hidden="true" tabindex="-1"></a>      hospital                                            </span>
<span id="cb563-6"><a href="factors.html#cb563-6" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb563-7"><a href="factors.html#cb563-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb563-8"><a href="factors.html#cb563-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> epidemic_data)<span class="sc">+</span>                       <span class="co"># debut pour representaton graphique</span></span>
<span id="cb563-9"><a href="factors.html#cb563-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(                                        <span class="co"># faire des lignes</span></span>
<span id="cb563-10"><a href="factors.html#cb563-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb563-11"><a href="factors.html#cb563-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> epiweek,                                  <span class="co"># l&#39;axe x est epiweek</span></span>
<span id="cb563-12"><a href="factors.html#cb563-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> n,                                        <span class="co"># l&#39;axe y est le nombre de cas par semaine</span></span>
<span id="cb563-13"><a href="factors.html#cb563-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="fu">fct_reorder2</span>(hospital, epiweek, n)))<span class="sc">+</span> <span class="co"># données regroupées et colorées par hôpital, avec un ordre des facteurs par hauteur à la fin du graphique</span></span>
<span id="cb563-14"><a href="factors.html#cb563-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Niveaux des facteurs (et affichage de la légende) par hauteur de ligne à la fin du grahpique&quot;</span>,</span>
<span id="cb563-15"><a href="factors.html#cb563-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Hôpital&quot;</span>)                          <span class="co"># changer le titre de la legende</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-383-1.png" width="672" /></p>
</div>
</div>
<div id="fct_missing" class="section level2" number="11.5">
<h2><span class="header-section-number">11.5</span> Valeurs manquantes</h2>
<p>Si vous avez des valeurs <code>NA</code> dans votre colonne de facteurs, vous pouvez facilement les convertir en un niveau nommé tel que “Missing” avec <code>fct_explicit_na()</code>. Les valeurs <code>NA</code> sont converties en “(Missing)” à la fin de l’ordre des niveaux par défaut. Vous pouvez ajuster le nom du niveau avec l’argument <code>na_level =</code>.</p>
<p>Ci-dessous, cette opération est effectuée sur la colonne <code>delay_cat</code> et un tableau est imprimé avec <code>tabyl()</code> avec <code>NA</code> converti en “Missing delay”.</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="factors.html#cb564-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb564-2"><a href="factors.html#cb564-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_explicit_na</span>(delay_cat, <span class="at">na_level =</span> <span class="st">&quot;Missing delay&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb564-3"><a href="factors.html#cb564-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(delay_cat)</span></code></pre></div>
<pre><code>##      delay_cat    n    percent
##       2-5 days 2040 0.34646739
##        &lt;2 days 2990 0.50781250
##        &gt;5 days  602 0.10224185
##  Missing delay  256 0.04347826</code></pre>
<div id="combiner-les-niveaux" class="section level3" number="11.5.1">
<h3><span class="header-section-number">11.5.1</span> Combiner les niveaux</h3>
</div>
<div id="manuellement-1" class="section level3 unnumbered">
<h3>Manuellement</h3>
<p>Vous pouvez ajuster l’affichage des niveaux manuellement avec <code>fct_recode()</code>. C’est comme la fonction <strong>dplyr</strong> <code>recode()</code> (voir <a href="cleaning_data.html#cleaning_data">Nettoyage des données et fonctions de base</a>), mais elle permet la création de nouveaux niveaux de facteurs. Si vous utilisez le simple <code>recode()</code> sur un facteur, les nouvelles valeurs recodées seront rejetées à moins qu’elles n’aient déjà été définies comme des niveaux admissibles.</p>
<p>Cet outil peut aussi être utilisé pour “combiner” des niveaux, en assignant à plusieurs niveaux la même valeur re-codée. Veillez simplement à ne pas perdre d’informations ! Pensez à effectuer ces étapes de combinaison dans une nouvelle colonne (sans écraser la colonne existante).</p>
<p><code>fct_recode()</code> a une syntaxe différente de celle de <code>recode()</code>. <code>recode()</code> utilise <code>OLD = NEW</code>, alors que <code>fct_recode()</code> utilise <code>NEW = OLD</code>.</p>
<p>Les niveaux actuels de <code>delay_cat</code> sont :</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="factors.html#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(linelist<span class="sc">$</span>delay_cat)</span></code></pre></div>
<pre><code>## [1] &quot;&lt;2 days&quot;  &quot;2-5 days&quot; &quot;&gt;5 days&quot;</code></pre>
<p>Les nouveaux niveaux sont créés à l’aide de la syntaxe <code>fct_recode(colonne, "nouveau" = "ancien", "nouveau" = "ancien", "nouveau" = "ancien")</code> et imprimés :</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="factors.html#cb568-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb568-2"><a href="factors.html#cb568-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_recode</span>(</span>
<span id="cb568-3"><a href="factors.html#cb568-3" aria-hidden="true" tabindex="-1"></a>    delay_cat,</span>
<span id="cb568-4"><a href="factors.html#cb568-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Less than 2 days&quot;</span> <span class="ot">=</span> <span class="st">&quot;&lt;2 days&quot;</span>,</span>
<span id="cb568-5"><a href="factors.html#cb568-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2 to 5 days&quot;</span>      <span class="ot">=</span> <span class="st">&quot;2-5 days&quot;</span>,</span>
<span id="cb568-6"><a href="factors.html#cb568-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;More than 5 days&quot;</span> <span class="ot">=</span> <span class="st">&quot;&gt;5 days&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb568-7"><a href="factors.html#cb568-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(delay_cat)</span></code></pre></div>
<pre><code>##         delay_cat    n    percent valid_percent
##  Less than 2 days 2990 0.50781250     0.5308949
##       2 to 5 days 2040 0.34646739     0.3622159
##  More than 5 days  602 0.10224185     0.1068892
##              &lt;NA&gt;  256 0.04347826            NA</code></pre>
<p>Ici, ils sont combinés manuellement avec <code>fct_recode()</code>. Notez qu’aucune erreur n’est soulevée lors de la création d’un nouveau niveau “Moins de 5 jours”.</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="factors.html#cb570-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb570-2"><a href="factors.html#cb570-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_recode</span>(</span>
<span id="cb570-3"><a href="factors.html#cb570-3" aria-hidden="true" tabindex="-1"></a>    delay_cat,</span>
<span id="cb570-4"><a href="factors.html#cb570-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Less than 5 days&quot;</span> <span class="ot">=</span> <span class="st">&quot;&lt;2 days&quot;</span>,</span>
<span id="cb570-5"><a href="factors.html#cb570-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Less than 5 days&quot;</span> <span class="ot">=</span> <span class="st">&quot;2-5 days&quot;</span>,</span>
<span id="cb570-6"><a href="factors.html#cb570-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;More than 5 days&quot;</span> <span class="ot">=</span> <span class="st">&quot;&gt;5 days&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb570-7"><a href="factors.html#cb570-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(delay_cat)</span></code></pre></div>
<pre><code>##         delay_cat    n    percent valid_percent
##  Less than 5 days 5030 0.85427989     0.8931108
##  More than 5 days  602 0.10224185     0.1068892
##              &lt;NA&gt;  256 0.04347826            NA</code></pre>
</div>
<div id="réduire-en-autre" class="section level3 unnumbered">
<h3>Réduire en “Autre”</h3>
<p>Vous pouvez utiliser <code>fct_other()</code> pour assigner manuellement des niveaux de facteurs à un niveau “Autre”. Ci-dessous, tous les niveaux de la colonne <code>hospital</code>, à part “Port Hospital” et “Central Hospital”, sont combinés dans “Other”. Vous pouvez fournir un vecteur pour soit <code>maintenir =</code>, soit <code>drop =</code>. Vous pouvez modifier l’affichage du niveau “Autre” avec <code>other_level =</code>.</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="factors.html#cb572-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>    </span>
<span id="cb572-2"><a href="factors.html#cb572-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">fct_other</span>(                      <span class="co"># ajuster niveaux</span></span>
<span id="cb572-3"><a href="factors.html#cb572-3" aria-hidden="true" tabindex="-1"></a>    hospital,</span>
<span id="cb572-4"><a href="factors.html#cb572-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">keep =</span> <span class="fu">c</span>(<span class="st">&quot;Port Hospital&quot;</span>, <span class="st">&quot;Central Hospital&quot;</span>),  <span class="co"># garder  ceux ci separer</span></span>
<span id="cb572-5"><a href="factors.html#cb572-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">other_level =</span> <span class="st">&quot;Other Hospital&quot;</span>)) <span class="sc">%&gt;%</span>            <span class="co"># Considerer tout autre niveau comme  &quot;Other Hospital&quot;</span></span>
<span id="cb572-6"><a href="factors.html#cb572-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(hospital)                                   <span class="co"># afficher tableau</span></span></code></pre></div>
<pre><code>##          hospital    n    percent
##  Central Hospital  454 0.07710598
##     Port Hospital 1762 0.29925272
##    Other Hospital 3672 0.62364130</code></pre>
</div>
<div id="réduire-par-fréquence" class="section level3 unnumbered">
<h3>Réduire par fréquence</h3>
<p>Vous pouvez combiner automatiquement les niveaux de facteurs les moins fréquents en utilisant <code>fct_lump()</code>.</p>
<p>Pour “regrouper” plusieurs niveaux à basse fréquence dans un groupe “Autre”, faites l’une des choses suivantes :</p>
<ul>
<li>Définissez <code>n =</code> comme le nombre de groupes que vous voulez garder. Les n niveaux les plus fréquents seront conservés, et tous les autres seront regroupés dans “Autres”.<br />
</li>
<li>Définissez <code>prop =</code> comme étant la proportion de fréquence seuil pour les niveaux au-dessus desquels vous voulez garder. Toutes les autres valeurs seront regroupées dans “Autres”.</li>
</ul>
<p>Vous pouvez modifier l’affichage du niveau “Autre” avec <code>other_level =</code>. Ci-dessous, tous les hôpitaux sauf les deux les plus fréquents sont combinés dans “Autre hôpital”.</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="factors.html#cb574-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>    </span>
<span id="cb574-2"><a href="factors.html#cb574-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">fct_lump</span>(                      <span class="co"># ajuster niveaux</span></span>
<span id="cb574-3"><a href="factors.html#cb574-3" aria-hidden="true" tabindex="-1"></a>    hospital,</span>
<span id="cb574-4"><a href="factors.html#cb574-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">2</span>,                                          <span class="co"># garder les  2 premiers  niveaux</span></span>
<span id="cb574-5"><a href="factors.html#cb574-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">other_level =</span> <span class="st">&quot;Other Hospital&quot;</span>)) <span class="sc">%&gt;%</span>            <span class="co">#  Considerer tout autre niveau comme  &quot;Other Hospital&quot;</span></span>
<span id="cb574-6"><a href="factors.html#cb574-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(hospital)                                   <span class="co"># afficher tableau</span></span></code></pre></div>
<pre><code>##        hospital    n   percent
##         Missing 1469 0.2494905
##   Port Hospital 1762 0.2992527
##  Other Hospital 2657 0.4512568</code></pre>
<p>, avertir
## Afficher tous les niveaux</p>
<p>L’un des avantages de l’utilisation des facteurs est de standardiser l’apparence des légendes et des tableaux des graphiques, quelles que soient les valeurs réellement présentes dans un ensemble de données.</p>
<p>Si vous préparez de nombreuses figures (par exemple, pour plusieurs juridictions), vous voudrez que les légendes et les tableaux apparaissent de manière identique, même si les niveaux de complétion ou de composition des données varient.</p>
</div>
<div id="dans-les-graphiques" class="section level3 unnumbered">
<h3>Dans les graphiques</h3>
<p>Dans une figure <code>ggplot()</code>, ajoutez simplement l’argument <code>drop = FALSE</code> dans la fonction <code>scale_xxxx()</code> concernée. Tous les niveaux de facteurs seront affichés, qu’ils soient présents ou non dans les données. Si les niveaux de vos colonnes de facteurs sont affichés en utilisant <code>fill =</code>, alors dans scale_fill_discrete() vous incluez <code>drop = FALSE</code>, comme indiqué ci-dessous. Si vos niveaux sont affichés avec <code>x =</code> (sur l’axe des x) <code>color =</code> ou <code>size =</code>, vous devez le fournir à <code>scale_color_discrete()</code> ou <code>scale_size_discrete()</code> en conséquence.</p>
<p>Cet exemple est un diagramme à barres empilées de la catégorie d’âge, par hôpital. L’ajout de <code>scale_fill_discrete(drop = FALSE)</code> garantit que tous les groupes d’âge apparaissent dans la légende, même s’ils ne sont pas présents dans les données.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="factors.html#cb576-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb576-2"><a href="factors.html#cb576-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> hospital, <span class="at">fill =</span> age_cat)) <span class="sc">+</span></span>
<span id="cb576-3"><a href="factors.html#cb576-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>)<span class="sc">+</span>                        <span class="co"># montrer tous les groupes d&#39;âge dans la légende, même ceux qui ne sont pas présents</span></span>
<span id="cb576-4"><a href="factors.html#cb576-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb576-5"><a href="factors.html#cb576-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Tous les groupes d&#39;âge apparaissent dans la légende, même s&#39;ils ne sont pas présents dans les données&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-391-1.png" width="672" /></p>
</div>
<div id="dans-les-tableaux" class="section level3 unnumbered">
<h3>Dans les tableaux</h3>
<p>Tant le <strong>base</strong> R <code>table()</code> que <code>tabyl()</code> de <strong>janitor</strong> montreront tous les niveaux de facteurs (même les niveaux non utilisés).</p>
<p>Si vous utilisez <code>count()</code> ou <code>summarise()</code> de <strong>dplyr</strong> pour faire une table, ajoutez l’argument <code>.drop = FALSE</code> pour inclure les comptes pour tous les niveaux de facteurs, même ceux qui ne sont pas utilisés.</p>
<p>Pour en savoir plus, consultez la page <a href="descriptive_tables.html#descriptive_tables">Descriptive tables</a>, ou la <a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">documentation scale_discrete</a>, ou la <a href="https://dplyr.tidyverse.org/reference/count.html">documentation count()</a>. Vous pouvez voir un autre exemple à la page <a href="contact_tracing.html#contact_tracing">Suivi des contacts</a>.</p>
</div>
</div>
<div id="epiweeks" class="section level2" number="11.6">
<h2><span class="header-section-number">11.6</span> Epiweeks</h2>
<p>Veuillez consulter la discussion approfondie sur la création de semaines épidémiologiques à la page <a href="grouping_data.html#grouping_data">Regroupement des données</a>.<br />
Veuillez également consulter la page <a href="working_dates.html#working_dates">Travailler avec des dates</a> pour obtenir des conseils sur la façon de créer et de formater des semaines épidémiologiques.</p>
<div id="semaines-épidémiologiques-dans-un-graphique" class="section level3 unnumbered">
<h3>Semaines épidémiologiques dans un graphique</h3>
<p>Si votre objectif est de créer des semaines épidémiologiques à afficher dans un graphique, vous pouvez le faire simplement avec la fonction <code>floor_date()</code> de <strong>lubridate</strong>, comme expliqué dans la page <a href="grouping_data.html#grouping_data">Regroupement de données</a>. Les valeurs retournées seront de la classe Date avec le format AAAA-MM-JJ. Si vous utilisez cette colonne dans un graphique, les dates seront naturellement ordonnées correctement, et vous n’aurez pas à vous soucier des niveaux ou de la conversion en classe Facteur. Voir l’histogramme <code>ggplot()</code> des dates d’apparition ci-dessous.</p>
<p>Dans cette approche, vous pouvez ajuster l’affichage des dates sur un axe avec <code>scale_x_date()</code>. Voir la page sur les <a href="epicurves.html#epicurves">Courbes épidémiques</a> pour plus d’informations. Vous pouvez spécifier un format d’affichage “strptime” à l’argument <code>date_labels =</code> de <code>scale_x_date()</code>. Ces formats utilisent des caractères de remplacement “%” et sont traités dans la page <a href="working_dates.html#working_dates">Manipuler les dates</a>. Utilisez “%Y” pour représenter une année à 4 chiffres, et “%W” ou “%U” pour représenter le numéro de la semaine (semaines du lundi ou du dimanche respectivement).</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="factors.html#cb577-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb577-2"><a href="factors.html#cb577-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">epiweek_date =</span> <span class="fu">floor_date</span>(date_onset, <span class="st">&quot;week&quot;</span>)) <span class="sc">%&gt;%</span>  <span class="co"># créer une colonne semaine</span></span>
<span id="cb577-3"><a href="factors.html#cb577-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span>                                                  <span class="co"># commencer ggplot</span></span>
<span id="cb577-4"><a href="factors.html#cb577-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> epiweek_date))<span class="sc">+</span>           <span class="co"># histogramme de la date d&#39;apparition</span></span>
<span id="cb577-5"><a href="factors.html#cb577-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">&quot;%Y-W%W&quot;</span>)                       <span class="co"># ajuster la répartition des dates pour qu&#39;elle soit YYYY-WWw</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-392-1.png" width="672" /></p>
</div>
<div id="epiweeks-dans-les-données" class="section level3 unnumbered">
<h3>Epiweeks dans les données</h3>
<p>Cependant, si le but de la factorisation n’est <em>pas</em> de tracer, vous pouvez l’aborder de deux façons :</p>
<ol style="list-style-type: decimal">
<li><ol style="list-style-type: decimal">
<li><em>Pour un contrôle précis de l’affichage</em>, convertissez la colonne <strong>lubridée</strong> des épihebdomadaires (AAAA-MM-JJ) au format d’affichage souhaité (AAAA-WWW) <em>dans le cadre de données lui-même</em>, puis convertissez-la en classe Factor.</li>
</ol></li>
</ol>
<p>Tout d’abord, utilisez <code>format()</code> de <strong>base</strong> R pour convertir l’affichage de la date de YYYY-MM-DD en YYYY-Www (voir la page <a href="working_dates.html#working_dates">Manipuler les dates</a>). Dans ce processus, la classe sera convertie en caractère. Ensuite, convertissez le caractère en classe Factor avec <code>factor()</code>.</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="factors.html#cb578-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb578-2"><a href="factors.html#cb578-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">epiweek_date =</span> <span class="fu">floor_date</span>(date_onset, <span class="st">&quot;week&quot;</span>),       <span class="co"># creer epiweeks (YYYY-MM-DD)</span></span>
<span id="cb578-3"><a href="factors.html#cb578-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">epiweek_formatted =</span> <span class="fu">format</span>(epiweek_date, <span class="st">&quot;%Y-W%W&quot;</span>),  <span class="co"># Convertir pour afficher (YYYY-WWw)</span></span>
<span id="cb578-4"><a href="factors.html#cb578-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">epiweek_formatted =</span> <span class="fu">factor</span>(epiweek_formatted))       <span class="co"># Convertir un facteur</span></span>
<span id="cb578-5"><a href="factors.html#cb578-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb578-6"><a href="factors.html#cb578-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les niveaux</span></span>
<span id="cb578-7"><a href="factors.html#cb578-7" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(linelist<span class="sc">$</span>epiweek_formatted)</span></code></pre></div>
<pre><code>##  [1] &quot;2014-W13&quot; &quot;2014-W14&quot; &quot;2014-W15&quot; &quot;2014-W16&quot; &quot;2014-W17&quot; &quot;2014-W18&quot; &quot;2014-W19&quot; &quot;2014-W20&quot; &quot;2014-W21&quot; &quot;2014-W22&quot; &quot;2014-W23&quot; &quot;2014-W24&quot;
## [13] &quot;2014-W25&quot; &quot;2014-W26&quot; &quot;2014-W27&quot; &quot;2014-W28&quot; &quot;2014-W29&quot; &quot;2014-W30&quot; &quot;2014-W31&quot; &quot;2014-W32&quot; &quot;2014-W33&quot; &quot;2014-W34&quot; &quot;2014-W35&quot; &quot;2014-W36&quot;
## [25] &quot;2014-W37&quot; &quot;2014-W38&quot; &quot;2014-W39&quot; &quot;2014-W40&quot; &quot;2014-W41&quot; &quot;2014-W42&quot; &quot;2014-W43&quot; &quot;2014-W44&quot; &quot;2014-W45&quot; &quot;2014-W46&quot; &quot;2014-W47&quot; &quot;2014-W48&quot;
## [37] &quot;2014-W49&quot; &quot;2014-W50&quot; &quot;2014-W51&quot; &quot;2015-W00&quot; &quot;2015-W01&quot; &quot;2015-W02&quot; &quot;2015-W03&quot; &quot;2015-W04&quot; &quot;2015-W05&quot; &quot;2015-W06&quot; &quot;2015-W07&quot; &quot;2015-W08&quot;
## [49] &quot;2015-W09&quot; &quot;2015-W10&quot; &quot;2015-W11&quot; &quot;2015-W12&quot; &quot;2015-W13&quot; &quot;2015-W14&quot; &quot;2015-W15&quot; &quot;2015-W16&quot;</code></pre>
<p><span style="color: red;"><strong><em>DANGERS:</em></strong> Si vous placez les semaines avant les années (“Www-YYYY”) (“%W-%Y”), l’ordre par défaut des niveaux alphanumériques sera incorrect (par exemple, 01-2015 sera avant 35-2014). Vous pourriez avoir besoin d’ajuster manuellement l’ordre, ce qui serait un processus long et difficile..</span></p>
<ol start="2" style="list-style-type: decimal">
<li><em>Pour un affichage rapide par défaut</em>, utilisez le package <strong>aweek</strong> et sa fonction <code>date2week()</code>. Vous pouvez définir le jour <code>week_start =</code>, et si vous définissez <code>factor = TRUE</code> alors la colonne de sortie est un facteur ordonné. En prime, le facteur inclut des niveaux pour <em>toutes</em> les semaines possibles dans l’intervalle - même s’il n’y a pas de cas cette semaine-là.</li>
</ol>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="factors.html#cb580-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb580-2"><a href="factors.html#cb580-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">epiweek =</span> <span class="fu">date2week</span>(date_onset, <span class="at">week_start =</span> <span class="st">&quot;Monday&quot;</span>, <span class="at">factor =</span> <span class="cn">TRUE</span>))</span>
<span id="cb580-3"><a href="factors.html#cb580-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb580-4"><a href="factors.html#cb580-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(df<span class="sc">$</span>epiweek)</span></code></pre></div>
<p>Voir la page <a href="working_dates.html#working_dates">Manipuler les dates</a> pour plus d’informations sur <strong>aweek</strong>. Il propose également la fonction inverse <code>week2date()</code>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="ressources-3" class="section level2" number="11.7">
<h2><span class="header-section-number">11.7</span> Ressources</h2>
<p>R for Data Science page on <a href="https://r4ds.had.co.nz/factors.html">factors</a><br />
<a href="https://cran.r-project.org/web/packages/aweek/vignettes/introduction.html">aweek package vignette</a></p>

<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
