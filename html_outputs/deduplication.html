<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>15 De-duplication | Le Epi R Handbook</title>
<meta name="author" content="the handbook team">
<meta name="description" content="Cette page couvre les techniques de déduplication ci-dessous : Identifier et supprimer les lignes dupliquées Utiliser la fonction “slice” pour garder seulement certaines lignes (par exemple, min...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="15 De-duplication | Le Epi R Handbook">
<meta property="og:type" content="book">
<meta property="og:description" content="Cette page couvre les techniques de déduplication ci-dessous : Identifier et supprimer les lignes dupliquées Utiliser la fonction “slice” pour garder seulement certaines lignes (par exemple, min...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="15 De-duplication | Le Epi R Handbook">
<meta name="twitter:description" content="Cette page couvre les techniques de déduplication ci-dessous : Identifier et supprimer les lignes dupliquées Utiliser la fonction “slice” pour garder seulement certaines lignes (par exemple, min...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.28/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.10/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Le Epi R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">About this book</li>
<li><a class="" href="editorial_notes.html"><span class="header-section-number">1</span> Notes techniques et choix éditoriaux</a></li>
<li><a class="" href="download_book_data.html"><span class="header-section-number">2</span> Télécharger le manuel et les données</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="rbasics.html"><span class="header-section-number">3</span> R - les bases</a></li>
<li><a class="" href="transition_to_r.html"><span class="header-section-number">4</span> Transition vers R</a></li>
<li><a class="" href="suggested_packages.html"><span class="header-section-number">5</span> Paquets conseillés</a></li>
<li><a class="" href="r_projects.html"><span class="header-section-number">6</span> Projets R</a></li>
<li><a class="" href="import_export.html"><span class="header-section-number">7</span> Importer et exporter des données</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning_data.html"><span class="header-section-number">8</span> Nettoyage de données et fonctions essentielles</a></li>
<li><a class="" href="working_dates.html"><span class="header-section-number">9</span> Manipuler les dates</a></li>
<li><a class="" href="character_strings.html"><span class="header-section-number">10</span> Caractères et chaînes de caractères</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Facteurs</a></li>
<li><a class="" href="pivoting_data.html"><span class="header-section-number">12</span> Restructurer les données</a></li>
<li><a class="" href="grouping_data.html"><span class="header-section-number">13</span> Travailler sur des données groupées</a></li>
<li><a class="" href="joining_matching.html"><span class="header-section-number">14</span> Joindre des données</a></li>
<li><a class="active" href="deduplication.html"><span class="header-section-number">15</span> De-duplication</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Itération, boucles et listes</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive_tables.html"><span class="header-section-number">17</span> Tableaux descriptifs</a></li>
<li><a class="" href="stats_test.html"><span class="header-section-number">18</span> Tests statistiques simples</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Régression univariée et multivariable</a></li>
<li><a class="" href="missing_data.html"><span class="header-section-number">20</span> Données manquantes</a></li>
<li><a class="" href="standardisation.html"><span class="header-section-number">21</span> Taux standardisés</a></li>
<li><a class="" href="moving_average.html"><span class="header-section-number">22</span> Moyennes mobiles</a></li>
<li><a class="" href="time_series.html"><span class="header-section-number">23</span> Série temporelle et détection des épidémies</a></li>
<li><a class="" href="epidemic_models.html"><span class="header-section-number">24</span> Modélisation des épidémies</a></li>
<li><a class="" href="contact_tracing.html"><span class="header-section-number">25</span> Suivi des contacts</a></li>
<li><a class="" href="survey_analysis.html"><span class="header-section-number">26</span> Analyse d’enquête</a></li>
<li><a class="" href="survival_analysis.html"><span class="header-section-number">27</span> Analyse de survie</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS basics</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="tables_presentation.html"><span class="header-section-number">29</span> Présenter avec des tables</a></li>
<li><a class="" href="ggplot_basics.html"><span class="header-section-number">30</span> Les bases de ggplot</a></li>
<li><a class="" href="ggplot_tips.html"><span class="header-section-number">31</span> Trucs et Astuces avec ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> Courbes épidémiques</a></li>
<li><a class="" href="age_pyramid.html"><span class="header-section-number">33</span> Pyramides démographiques et échelles de Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> Graphiques thermiques</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> Diagrammes et schémas</a></li>
<li><a class="" href="combination_analysis.html"><span class="header-section-number">36</span> Analyse des combinaisons</a></li>
<li><a class="" href="transmission_chains.html"><span class="header-section-number">37</span> Chaînes de transmission</a></li>
<li><a class="" href="phylogenetic_trees.html"><span class="header-section-number">38</span> Les arbres phylogénétiques</a></li>
<li><a class="" href="interactive_plots.html"><span class="header-section-number">39</span> Graphiques interactifs</a></li>
<li class="book-part">Reports and dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> Production de rapports avec R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> Organisation des rapports de routine</a></li>
<li><a class="" href="dashboards.html"><span class="header-section-number">42</span> Tableaux de bord avec R Markdown</a></li>
<li><a class="" href="shiny.html"><span class="header-section-number">43</span> Tableaux de bord avec Shiny</a></li>
<li class="book-part">Miscellaneous</li>
<li><a class="" href="writing_functions.html"><span class="header-section-number">44</span> Fonctions d’écriture</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> Interactions avec les répertoires</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Contrôle de version et collaboration avec Git et Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> Erreurs fréquentes</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> Obtenir de l’aide</a></li>
<li><a class="" href="network_drives.html"><span class="header-section-number">49</span> R sur les lecteurs réseau</a></li>
<li><a class="" href="data_table.html"><span class="header-section-number">50</span> Tableau de données</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="deduplication" class="section level1" number="15">
<h1>
<span class="header-section-number">15</span> De-duplication<a class="anchor" aria-label="anchor" href="#deduplication"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/deduplication.png" width="50%"></div>
<p>Cette page couvre les techniques de déduplication ci-dessous :</p>
<ol style="list-style-type: decimal">
<li>Identifier et supprimer les lignes dupliquées<br>
</li>
<li>Utiliser la fonction “slice” pour garder seulement certaines lignes (par exemple, min ou max) de chaque groupe de lignes.<br>
</li>
<li>“Rolling-up”, ou combinaison des valeurs de plusieurs lignes en une seule ligne.</li>
</ol>
<!-- ======================================================= --><div id="préparation" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> Préparation<a class="anchor" aria-label="anchor" href="#pr%C3%A9paration"><i class="fas fa-link"></i></a>
</h2>
<div id="importation-des-packages" class="section level3 unnumbered">
<h3>Importation des packages<a class="anchor" aria-label="anchor" href="#importation-des-packages"><i class="fas fa-link"></i></a>
</h3>
<p>Ces lignes de code importe les packages necessaire pour l’analyse. Dans ce guide, nous mettons l’accent sur <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, qui installe le package si nécessaire <em>puis</em> l’importe pour l’utiliser. Vous pouvez également charger les packages installés avec <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de <strong>base</strong> R. Voir la page sur <a href="rbasics.html#rbasics">bases de R</a> pour plus d’informations sur les packages en R.</p>
<div class="sourceCode" id="cb722"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">tidyverse</span>,   <span class="co"># fonctions de déduplication, de regroupement et de slicing</span></span>
<span>  <span class="va">janitor</span>,     <span class="co"># fonction de gestion des doublons </span></span>
<span>  <span class="va">stringr</span><span class="op">)</span>     <span class="co"># pour la recherche des caractères, peut être utilisé ensembler les valeurs</span></span></code></pre></div>
</div>
<div id="importer-les-données" class="section level3 unnumbered">
<h3>Importer les données<a class="anchor" aria-label="anchor" href="#importer-les-donn%C3%A9es"><i class="fas fa-link"></i></a>
</h3>
<p>Pour la démonstration, nous allons utiliser un ensemble de données exemplaire qui a été créé avec le code R ci-dessous.</p>
<p>Les données sont des enregistrements des appels téléphoniques sur le COVID-19, y compris les appels avec des contacts et des cas. Les colonnes comprennent <code>recordID</code> (généré par ordinateur), <code>personID</code>, <code>name</code>, <code>date</code> de la rencontre, <code>time</code> de la rencontre, le <code>purpose</code> de la rencontre (soit pour un interview en tant que cas ou en tant que contact), et <code>symptoms_ever</code> (si la personne dans cette appel a déclaré avoir <em>jamais</em> eu des symptômes).</p>
<p>Voici le code pour créer la base de données <code>obs</code> :</p>
<div class="sourceCode" id="cb723"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  recordID  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">11</span>,<span class="fl">12</span>,<span class="fl">13</span>,<span class="fl">14</span>,<span class="fl">15</span>,<span class="fl">16</span>,<span class="fl">17</span>,<span class="fl">18</span><span class="op">)</span>,</span>
<span>  personID  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">8</span><span class="op">)</span>,</span>
<span>  name      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"adam"</span>, <span class="st">"adam"</span>, <span class="st">"amrish"</span>, <span class="st">"amrish"</span>, <span class="st">"mariah"</span>, <span class="st">"amrish"</span>, <span class="st">"nikhil"</span>, <span class="st">"brian"</span>, <span class="st">"smita"</span>, <span class="st">"raquel"</span>, <span class="st">"amrish"</span>,</span>
<span>                <span class="st">"adam"</span>, <span class="st">"mariah"</span>, <span class="st">"mariah"</span>, <span class="st">"nikhil"</span>, <span class="st">"brian"</span>, <span class="st">"brian"</span>, <span class="st">"raquel"</span>, <span class="st">"natalie"</span><span class="op">)</span>,</span>
<span>  date      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1/1/2020"</span>, <span class="st">"1/1/2020"</span>, <span class="st">"2/1/2020"</span>, <span class="st">"2/1/2020"</span>, <span class="st">"5/1/2020"</span>, <span class="st">"5/1/2020"</span>, <span class="st">"5/1/2020"</span>, <span class="st">"5/1/2020"</span>, <span class="st">"5/1/2020"</span>,<span class="st">"5/1/2020"</span>, <span class="st">"2/1/2020"</span>,</span>
<span>                <span class="st">"5/1/2020"</span>, <span class="st">"6/1/2020"</span>, <span class="st">"6/1/2020"</span>, <span class="st">"6/1/2020"</span>, <span class="st">"6/1/2020"</span>, <span class="st">"7/1/2020"</span>, <span class="st">"7/1/2020"</span>, <span class="st">"7/1/2020"</span><span class="op">)</span>,</span>
<span>  time      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"09:00"</span>, <span class="st">"09:00"</span>, <span class="st">"14:20"</span>, <span class="st">"14:20"</span>, <span class="st">"12:00"</span>, <span class="st">"16:10"</span>, <span class="st">"13:01"</span>, <span class="st">"15:20"</span>, <span class="st">"14:20"</span>, <span class="st">"12:30"</span>, <span class="st">"10:24"</span>,</span>
<span>                <span class="st">"09:40"</span>, <span class="st">"07:25"</span>, <span class="st">"08:32"</span>, <span class="st">"15:36"</span>, <span class="st">"15:31"</span>, <span class="st">"07:59"</span>, <span class="st">"11:13"</span>, <span class="st">"17:12"</span><span class="op">)</span>,</span>
<span>  encounter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,</span>
<span>                <span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>  purpose   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"case"</span>, <span class="st">"case"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>,</span>
<span>                <span class="st">"case"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"contact"</span>, <span class="st">"case"</span>, <span class="st">"contact"</span>, <span class="st">"case"</span><span class="op">)</span>,</span>
<span>  symptoms_ever <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="cn">NA</span>, <span class="st">"Yes"</span>,</span>
<span>                    <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>,<span class="st">"No"</span>, <span class="st">"No"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">date</span>, format <span class="op">=</span> <span class="st">"%d/%m/%Y"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div id="dedup_data" class="section level4 unnumbered">
<h4>Voici le tableau de données<a class="anchor" aria-label="anchor" href="#dedup_data"><i class="fas fa-link"></i></a>
</h4>
<p>Utilisez les boîtes de filtre au-dessous pour examiner les rencontres pour chaque personne.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-dbff2659cd532d89bfc7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-dbff2659cd532d89bfc7">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"18\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"8\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1577836800000\" data-max=\"1578355200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[[1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],[1,1,2,2,3,2,4,5,6,7,2,1,3,3,4,5,5,7,8],["adam","adam","amrish","amrish","mariah","amrish","nikhil","brian","smita","raquel","amrish","adam","mariah","mariah","nikhil","brian","brian","raquel","natalie"],["2020-01-01","2020-01-01","2020-01-02","2020-01-02","2020-01-05","2020-01-05","2020-01-05","2020-01-05","2020-01-05","2020-01-05","2020-01-02","2020-01-05","2020-01-06","2020-01-06","2020-01-06","2020-01-06","2020-01-07","2020-01-07","2020-01-07"],["09:00","09:00","14:20","14:20","12:00","16:10","13:01","15:20","14:20","12:30","10:24","09:40","07:25","08:32","15:36","15:31","07:59","11:13","17:12"],[1,1,1,1,1,3,1,1,1,1,2,2,2,3,2,2,3,2,1],["contact","contact","contact","contact","case","case","contact","contact","contact","contact","contact","case","contact","contact","contact","contact","case","contact","case"],[null,null,"No","No","No","Yes","Yes","No","Yes",null,"Yes","No","No","No","Yes","Yes","No","No","No"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":19,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[10,19,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Quelques éléments à noter lors de l’examen des données :</p>
<ul>
<li>Les deux premiers enregistrements sont des doublons complets à 100%, y compris le <code>recordID</code> ( cela doit être un problème informatique !).<br>
</li>
<li>Les deux secondes lignes sont des doublons, dans toutes les colonnes, sauf pour le <code>recordID</code>.<br>
</li>
<li>Plusieurs personnes ont été contactées plusieurs fois par téléphone, à des dates et horaires différents, et en tant que contacts et/ou cas.<br>
</li>
<li>A chaque rencontre, il a été demandé à la personne si elle avait <strong>jamais</strong> eu des symptômes, et certaines de ces informations sont manquantes.</li>
</ul>
<p>Et voici un résumé de ces personnes et la raison de leurs rencontres, en utilisant <code>tabyl()</code> de <strong>janitor</strong> :</p>
<div class="sourceCode" id="cb724"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tabyl</span><span class="op">(</span><span class="va">name</span>, <span class="va">purpose</span><span class="op">)</span></span></code></pre></div>
<pre><code>##     name case contact
##     adam    1       2
##   amrish    1       3
##    brian    1       2
##   mariah    1       2
##  natalie    1       0
##   nikhil    0       2
##   raquel    0       2
##    smita    0       1</code></pre>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="deduplication-1" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> Deduplication<a class="anchor" aria-label="anchor" href="#deduplication-1"><i class="fas fa-link"></i></a>
</h2>
<p>Cette section décrit comment examiner et supprimer les doublons dans un tableau de données. Elle montre également comment traiter les éléments dupliqués dans un vecteur.</p>
<!-- ======================================================= -->
<div id="examiner-les-lignes-dupliquées" class="section level3 unnumbered">
<h3>Examiner les lignes dupliquées<a class="anchor" aria-label="anchor" href="#examiner-les-lignes-dupliqu%C3%A9es"><i class="fas fa-link"></i></a>
</h3>
<p>Pour rapidement examiner les lignes qui ont été dupliquées, vous pouvez utiliser <code>get_dupes()</code> du package <strong>janitor</strong>. <em>Par défaut</em>, toutes les colonnes sont prises en compte lors de l’évaluation des duplications - les lignes retournées par la fonction sont des doublons à 100% en considérant les valeurs de <em>toutes</em> les colonnes.</p>
<p>Dans le tableau de données <code>obs</code>, les deux premières lignes sont <em>100% dupliquées</em> - elles ont la même valeur dans chaque colonne (y compris la colonne <code>recordID</code>, qui est <em>supposée</em> être unique - cela doit être un problème informatique). Le tableau de données obtenu inclut automatiquement une nouvelle colonne <code>dupe_count</code> sur le côté droit, montrant le nombre de lignes avec cette combinaison de valeurs en double.</p>
<div class="sourceCode" id="cb726"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 100% duplicates across all columns</span></span>
<span><span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/get_dupes.html">get_dupes</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-bdd5ceac86283d89b03f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-bdd5ceac86283d89b03f">{"x":{"filter":"none","vertical":false,"data":[[1,1],[1,1],["adam","adam"],["2020-01-01","2020-01-01"],["09:00","09:00"],[1,1],["contact","contact"],[null,null],[2,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n      <th>dupe_count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":19,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5,8]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,19,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Voir les <a href="deduplication.html#dedup_data">données originales</a></p>
<p>Cependant, si nous décidons d’ignorer le <code>recordID</code>, les 3e et 4e lignes sont également des doublons entre eux. C’est-à-dire qu’elles ont les mêmes valeurs dans toutes les colonnes <em>sauf</em> pour <code>recordID</code>. Vous pouvez spécifier des colonnes spécifiques à ignorer dans la fonction en utilisant le symbole moins <code>-</code>.</p>
<div class="sourceCode" id="cb727"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Duplications lorsque la colonne recordID est exclue. </span></span>
<span><span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/get_dupes.html">get_dupes</a></span><span class="op">(</span><span class="op">-</span><span class="va">recordID</span><span class="op">)</span>         <span class="co"># si multiples colonnes, les inclure dans c()</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-c2e8ae60f5f8eca1a2a6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c2e8ae60f5f8eca1a2a6">{"x":{"filter":"none","vertical":false,"data":[[1,1,2,2],["adam","adam","amrish","amrish"],["2020-01-01","2020-01-01","2020-01-02","2020-01-02"],["09:00","09:00","14:20","14:20"],[1,1,1,1],["contact","contact","contact","contact"],[null,null,"No","No"],[2,2,2,2],[1,1,2,3]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n      <th>dupe_count<\/th>\n      <th>recordID<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":19,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,4,7,8]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,19,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Vous pouvez également spécifier les colonnes à considérer. Ci-dessous, seules les lignes qui ont les mêmes valeurs dans les colonnes <code>name</code> et <code>purpose</code> sont retournées. Notez comment “amrish” a maintenant un <code>dupe_count</code> égal à 3 pour correspondre à ses trois rencontres “contact”.</p>
<p>*Défiler vers la gauche pour plus de lignes**</p>
<div class="sourceCode" id="cb728"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># duplications basées sur les colonnes name et purpose uniquement</span></span>
<span><span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/get_dupes.html">get_dupes</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">purpose</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a2de5e90614c5d997998" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a2de5e90614c5d997998">{"x":{"filter":"none","vertical":false,"data":[["amrish","amrish","amrish","adam","adam","brian","brian","mariah","mariah","nikhil","nikhil","raquel","raquel"],["contact","contact","contact","contact","contact","contact","contact","contact","contact","contact","contact","contact","contact"],[3,3,3,2,2,2,2,2,2,2,2,2,2],[2,3,10,1,1,7,15,12,13,6,14,9,17],[2,2,2,1,1,5,5,3,3,4,4,7,7],["2020-01-02","2020-01-02","2020-01-02","2020-01-01","2020-01-01","2020-01-05","2020-01-06","2020-01-06","2020-01-06","2020-01-05","2020-01-06","2020-01-05","2020-01-07"],["14:20","14:20","10:24","09:00","09:00","15:20","15:31","07:25","08:32","13:01","15:36","12:30","11:13"],[1,1,2,1,1,1,2,2,3,1,2,1,2],["No","No","Yes",null,null,"No","Yes","No","No","Yes","Yes",null,"No"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>name<\/th>\n      <th>purpose<\/th>\n      <th>dupe_count<\/th>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":7,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4,7]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[7,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Voir les <a href="deduplication.html#dedup_data">données originales</a></p>
<p>Voir <code>?get_dupes</code> pour plus de details, ou consulter ceci <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#explore-records-with-duplicated-values-for-specific-combinations-of-variables-with-get_dupes">référence en ligne</a></p>
<!-- ======================================================= -->
</div>
<div id="garder-seulement-les-lignes-uniques" class="section level3 unnumbered">
<h3>Garder seulement les lignes uniques<a class="anchor" aria-label="anchor" href="#garder-seulement-les-lignes-uniques"><i class="fas fa-link"></i></a>
</h3>
<p>Pour garder que les lignes uniques d’un tableau de données, utilisez <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> de <strong>dplyr</strong> (comme démontré dans la page <a href="cleaning_data.html#cleaning_data">CNettoyage de données et fonctions essentielles</a>). Les lignes qui sont dupliquées sont enlevées de sorte que seule la première ligne est retenue. Par défaut, la première ligne correspond au plus grand <code>rownumber</code> (ordre des lignes de haut en bas). Seules les lignes uniques sont retenues.</p>
<p>Dans l’exemple ci-dessous, nous utilisons <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> tel que la colonne <code>recordID</code> est exclue - ainsi <strong>deux lignes dupliquées sont enlevées</strong>. La première ligne (pour “adam”) était dupliquée à 100% et a été enlevée. Par ailleurs, la troisième ligne (pour “amrish”) était dupliquée dans chaque colonne <em>sauf</em> <code>recordID</code> (qui n’est pas considéré) donc a été supprimée. Le tableau de données <code>obs</code> est maintenant <code>nrow(obs)-2</code>, et non <code>nrow(obs)</code> lignes).</p>
<p><em>Défilez vers la gauche pour voir le tableau de données complet</em></p>
<div class="sourceCode" id="cb729"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ajouté à une chaîne de pipes (par exemple, nettoyage de données)</span></span>
<span><span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="op">-</span><span class="va">recordID</span><span class="op">)</span>, <span class="co"># réduit le tableau de données à seulement des lignes uniques (retient la première ligne de toute duplication)</span></span>
<span>           .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># si en dehors des pipes, inclure les données comme premier argument  </span></span>
<span><span class="co"># distinct(obs)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-bb23751b55f945e3315a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-bb23751b55f945e3315a">{"x":{"filter":"none","vertical":false,"data":[[1,2,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],[1,2,3,2,4,5,6,7,2,1,3,3,4,5,5,7,8],["adam","amrish","mariah","amrish","nikhil","brian","smita","raquel","amrish","adam","mariah","mariah","nikhil","brian","brian","raquel","natalie"],["2020-01-01","2020-01-02","2020-01-05","2020-01-05","2020-01-05","2020-01-05","2020-01-05","2020-01-05","2020-01-02","2020-01-05","2020-01-06","2020-01-06","2020-01-06","2020-01-06","2020-01-07","2020-01-07","2020-01-07"],["09:00","14:20","12:00","16:10","13:01","15:20","14:20","12:30","10:24","09:40","07:25","08:32","15:36","15:31","07:59","11:13","17:12"],[1,1,1,3,1,1,1,1,2,2,2,3,2,2,3,2,1],["contact","contact","case","case","contact","contact","contact","contact","contact","case","contact","contact","contact","contact","case","contact","case"],[null,"No","No","Yes","Yes","No","Yes",null,"Yes","No","No","No","Yes","Yes","No","No","No"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":6,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Si vous utilisez <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> sur des données groupées, la fonction s’appliquera à chaque groupe. </span></p>
<p><strong>Déduplication basée sur des colonnes spécifiques</strong></p>
<p>Vous pouvez également spécifier des colonnes qui seront la base de la déduplication. Ainsi, la déduplication ne s’applique qu’aux lignes qui sont des duplications dans les colonnes spécifiées. A moins que vous ne définissiez <code>.keep_all = TRUE</code>, toutes les colonnes non mentionnées seront ignorées.</p>
<p>Dans l’exemple ci-dessous, la déduplication ne s’applique qu’aux lignes qui ont des valeurs identiques pour les colonnes <code>name</code> et <code>purpose</code>. Ainsi, “brian” a seulement 2 lignes au lieu de 3 - son <em>premier</em> “contact” et son unique “case”. Pour ajuster afin que la <em>dernière</em> rencontre de brian pour chaque “purpose” soit retenue, voir l’onglet “Slicing within groups”.</p>
<p><em>Défilez vers la gauche pour voir le tableau de données complet</em></p>
<div class="sourceCode" id="cb730"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ajouté à une chaîne de pipes (par exemple, nettoyage de données)</span></span>
<span><span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">purpose</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># garder les lignes uniques par 'name' et par 'purpose', retient toutes les colonnes</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span>                                  <span class="co"># arranger pour faciliter la visualisation</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1c47e6d80b2d4a523b1d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1c47e6d80b2d4a523b1d">{"x":{"filter":"none","vertical":false,"data":[[1,11,2,5,7,16,4,12,18,6,9,8],[1,1,2,2,5,5,3,3,8,4,7,6],["adam","adam","amrish","amrish","brian","brian","mariah","mariah","natalie","nikhil","raquel","smita"],["2020-01-01","2020-01-05","2020-01-02","2020-01-05","2020-01-05","2020-01-07","2020-01-05","2020-01-06","2020-01-07","2020-01-05","2020-01-05","2020-01-05"],["09:00","09:40","14:20","16:10","15:20","07:59","12:00","07:25","17:12","13:01","12:30","14:20"],[1,2,1,3,1,3,1,2,1,1,1,1],["contact","case","contact","case","contact","case","case","contact","case","contact","contact","contact"],[null,"No","No","Yes","No","No","No","No","No","Yes",null,"Yes"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":6,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Voir <a href="deduplication.html#dedup_data">données originales</a>.</p>
<!-- ======================================================= -->
</div>
<div id="dédupliquer-les-éléments-dun-vecteur" class="section level3 unnumbered">
<h3>Dédupliquer les éléments d’un vecteur<a class="anchor" aria-label="anchor" href="#d%C3%A9dupliquer-les-%C3%A9l%C3%A9ments-dun-vecteur"><i class="fas fa-link"></i></a>
</h3>
<p>La fonction <code><a href="https://rdrr.io/r/base/duplicated.html">duplicated()</a></code> de <strong>base</strong> R va évaluer un vecteur (colonne) et renvoie un vecteur logique de même longueur (TRUE/FALSE). La première fois qu’une valeur apparaît, elle renvoie FALSE (pas de duplication), et les fois suivantes, elle renvoie VRAI. Notez que <code>NA</code> est traité de la même façon que toute autre valeur.</p>
<div class="sourceCode" id="cb731"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE</code></pre>
<p>Pour ne retourner que les éléments dupliqués, vous pouvez utiliser des parenthèses pour sous-titrer le vecteur original :</p>
<div class="sourceCode" id="cb733"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code>## [1]  1 NA  4  4  1  2</code></pre>
<p>Pour ne renvoyer que les éléments uniques, utilisez <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code> de <strong>base</strong> R. Pour supprimer les <code>NA</code> de la sortie, mettez <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> dans <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code>.</p>
<div class="sourceCode" id="cb735"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>           <span class="co"># alternativement, utilisez x[!duplicated(x)]</span></span></code></pre></div>
<pre><code>## [1]  1  2 NA  4  5</code></pre>
<div class="sourceCode" id="cb737"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>  <span class="co"># supprimez les NA </span></span></code></pre></div>
<pre><code>## [1] 1 2 4 5</code></pre>
<!-- ======================================================= -->
</div>
<div id="utilisant-base-r" class="section level3 unnumbered">
<h3>Utilisant <strong>base</strong> R<a class="anchor" aria-label="anchor" href="#utilisant-base-r"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Pour retourner les lignes dupliquées</strong></p>
<p>Dans <strong>base</strong> R, vous pouvez également voir quelles lignes sont dupliquées à 100% dans un tableau de données <code>df</code> avec la commande <code>duplicated(df)</code> ( retourne un vecteur logique des lignes).</p>
<p>Ainsi, vous pouvez également utiliser le sous-groupe de base <code>[ ]</code> sur le tableau de données pour voir les lignes <em>dupliquées</em> avec <code>df[duplicated(df),]</code> (n’oubliez pas la virgule, qui signifie que vous voulez voir toutes les colonnes !)</p>
<p><strong>Pour retourner les lignes uniques</strong></p>
<p>Voir les notes ci-dessus. Pour voir les lignes <em>uniques</em>, ajoutez le négateur logique <code>!</code> devant la fonction <code><a href="https://rdrr.io/r/base/duplicated.html">duplicated()</a></code> :<br><code>df[!duplicated(df),]</code></p>
<p><strong>Pour retourner les lignes qui sont des duplications de certaines colonnes seulement</strong>.</p>
<p>Sous-ensembler le <code>df</code> qui se trouve *dans la parenthèse de <code><a href="https://rdrr.io/r/base/duplicated.html">duplicated()</a></code>, afin que cette fonction ne traite que certaines colonnes du <code>df</code>.</p>
<p>Pour spécifier les colonnes, fournissez les numéros ou les noms des colonnes après une virgule (rappelez-vous, tout ceci est <em>dans</em> la fonction <code><a href="https://rdrr.io/r/base/duplicated.html">duplicated()</a></code>).</p>
<p>Assurez-vous de garder la virgule <code>,</code> <em>à l’extérieur</em> après la fonction <code><a href="https://rdrr.io/r/base/duplicated.html">duplicated()</a></code> également !</p>
<p>Par exemple, pour évaluer seulement les colonnes 2 à 5 pour les doublons : <code>df[!duplicated(df[, 2:5]),]``   Pour évaluer seulement les colonnes</code>name<code>et</code>purpose<code>pour les doublons :</code>df[!duplicated(df[, c(“name”, “purpose)]),]`</p>
<!-- ======================================================= -->
</div>
</div>
<div id="slicing" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> Slicing<a class="anchor" aria-label="anchor" href="#slicing"><i class="fas fa-link"></i></a>
</h2>
<p>Pour “slice” un tableau de données pour pouvoir appliquer un filtre sur les lignes par numéro/position de ligne. Cette fonction devient particulièrement utile si vous avez plusieurs lignes par groupe fonctionnel (par exemple, par “person”) et que vous ne voulez retenir qu’une ou quelques-unes d’entre elles.</p>
<p>La fonction de base <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> accepte des numéros et retourne les lignes dans ces positions. Si les numéros fournis sont positifs, seuls ceux-ci sont retournés. S’ils sont négatifs, ces lignes ne sont <em>pas</em> retournées. Les nombres doivent être soit tous positifs, soit tous négatifs.</p>
<div class="sourceCode" id="cb739"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>  <span class="co"># retourne la 4e ligne</span></span></code></pre></div>
<pre><code>##   recordID personID   name       date  time encounter purpose symptoms_ever
## 1        3        2 amrish 2020-01-02 14:20         1 contact            No</code></pre>
<div class="sourceCode" id="cb741"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>  <span class="co"># retourne les lignes 2 et 4</span></span></code></pre></div>
<pre><code>##   recordID personID   name       date  time encounter purpose symptoms_ever
## 1        1        1   adam 2020-01-01 09:00         1 contact          &lt;NA&gt;
## 2        3        2 amrish 2020-01-02 14:20         1 contact            No</code></pre>
<div class="sourceCode" id="cb743"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#obs %&gt;% slice(c(2:4))  # retourne les lignes 2 à 4</span></span></code></pre></div>
<p>Voir <a href="deduplication.html#dedup_data">données originales</a>.</p>
<p>Il existe plusieurs variations : Celles-ci doivent être fournies avec une colonne et le nombre de lignes à retourner (à <code>n =</code>).</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code> et <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> ne gardent que la ou les lignes avec la ou les valeurs minimales ou maximales de la colonne spécifiée. Cela permet également de retourner le “min” et le “max” de facteurs ordonnés.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head()</a></code> et <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_tail()</a></code> - Retient que la ou les <em>premières</em> ou <em>dernières</em> lignes.<br>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample()</a></code> - ne retenir qu’un échantillon aléatoire des lignes.</li>
</ul>
<div class="sourceCode" id="cb744"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">encounter</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="co"># Retourne les lignes avec le plus grand nombre de "encounter" </span></span></code></pre></div>
<pre><code>##   recordID personID   name       date  time encounter purpose symptoms_ever
## 1        5        2 amrish 2020-01-05 16:10         3    case           Yes
## 2       13        3 mariah 2020-01-06 08:32         3 contact            No
## 3       16        5  brian 2020-01-07 07:59         3    case            No</code></pre>
<p>Utilisez les arguments <code>n =</code> ou <code>prop =</code> pour spécifier le nombre ou la proportion de lignes à retenir. Si vous n’utilisez pas la fonction dans un pipe, fournissez d’abord l’argument data (par exemple, <code>slice(data, n = 2)</code>). Voir <code><a href="https://dplyr.tidyverse.org/reference/slice.html">?slice</a></code> pour plus d’informations.</p>
<p>Autres arguments :</p>
<p><code>.order_by =</code> utilisé dans <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code> et <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> ceci est une colonne à ordonner par avant de “slice”.<br><code>with_ties =</code> TRUE par défaut, ce qui signifie que les liens sont retenus.<br><code>.preserve =</code> FALSE par défaut. Si TRUE, alors la structure de regroupement est recalculée après le slicing.<br><code>weight_by =</code> Optionnel, colonne numérique pour pondérer par ( un plus grand chiffre est plus probable d’être échantillonné).<br>
Aussi, <code>replace =</code> pour savoir si l’échantillonnage est fait avec/sans remplacement.</p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> En utilisant <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> et <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code>, assurez-vous de spécifier/d’écrire <code>n =</code> (e.g. <code>n = 2</code>, pas seulement <code>2</code>). Sinon, vous risquez d’obtenir une erreur: <code>Error:</code>…<code>is not empty.</code> </span></p>
<p><span style="color: black;"><strong><em>NOTE:</em></strong> Vous pouvez rencontrer la fonction <a href="https://dplyr.tidyverse.org/reference/top_n.html"><code>top_n()</code></a>, qui a été remplacées par les fonctions <code>slice</code>.</span></p>
<!-- ======================================================= -->
<div id="slice-avec-les-groupes" class="section level3 unnumbered">
<h3>Slice avec les groupes<a class="anchor" aria-label="anchor" href="#slice-avec-les-groupes"><i class="fas fa-link"></i></a>
</h3>
<p>Les fonctions <code>slice_*()</code> peuvent être très utiles si elles sont appliquées à un tableau de données groupées, puisque l’opération de slice est effectuée sur chaque groupe séparément. Utilisez la <strong>fonction</strong> <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> en conjonction avec <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> pour regrouper les données et prendre une tranche de chaque groupe.</p>
<p>Ceci est utile pour la déduplication si vous avez plusieurs lignes par personne mais que vous ne voulez retenir qu’une seule d’entre elles. Vous utilisez d’abord <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> avec des colonnes clés qui sont les mêmes pour chaque personne, puis vous utilisez une fonction slice sur une colonne qui sera différente parmi les lignes groupées.</p>
<p>Dans l’exemple ci-dessous, pour ne garder que la <em>dernière</em> rencontre <em>par personne</em>, nous regroupons les lignes par <code>name</code> et ensuite nous utilisons <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> avec <code>n = 1</code> sur la colonne <code>date</code>. Mais attention ! Pour appliquer une fonction comme <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> sur des dates, la colonne date doit être de la classe Date.</p>
<p>Par défaut, les “liens” (par exemple la même date dans ce scénario) sont retenus, et nous aurions toujours plusieurs lignes pour certaines personnes (par exemple adam). Pour éviter cela, nous mettons <code>with_ties = FALSE</code>. Nous ne récupérons qu’une seule ligne par personne.</p>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> Si utilisant <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>, specifier <code>.by_group = TRUE</code> pour que les données soient organisées dans chaque groupe.</span></p>
<p><span style="color : red ;"><strong><em>DANGER:</em></strong> Si <code>with_ties = FALSE</code>, la première ligne d’une même égalité est conservée. Cela peut être déceptive. Voyez comment pour Mariah, elle a deux rencontres à sa dernière date (6 Jan) et la première (la plus ancienne) a été gardée. Il est probable que nous voulions garder la dernière rencontre de ce jour-là. Voyez comment ” séparer ” ces liens dans l’exemple suivant. </span></p>
<div class="sourceCode" id="cb746"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>       <span class="co"># regroupe les lignes par 'name'</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">date</span>,          <span class="co"># retenir une ligne par groupe avec la valeur maximale de la date </span></span>
<span>            n <span class="op">=</span> <span class="fl">1</span>,         <span class="co"># ne retenir que la ligne la plus élevée </span></span>
<span>            with_ties <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co"># s'il y a une égalité (de date), prenez le premier ligne</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0a3be7aff3a753f0c1e7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0a3be7aff3a753f0c1e7">{"x":{"filter":"none","vertical":false,"data":[[11,5,16,12,18,14,17,8],[1,2,5,3,8,4,7,6],["adam","amrish","brian","mariah","natalie","nikhil","raquel","smita"],["2020-01-05","2020-01-05","2020-01-07","2020-01-06","2020-01-07","2020-01-06","2020-01-07","2020-01-05"],["09:40","16:10","07:59","07:25","17:12","15:36","11:13","14:20"],[2,3,3,2,1,2,2,1],["case","case","case","contact","case","contact","contact","contact"],["No","Yes","No","No","No","Yes","No","Yes"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Ci-dessus, par exemple, nous pouvons voir que seule la ligne d’Amrish du 5 janvier a été retenue, et que seule la ligne de Brian du 7 janvier a été retenue. Voir les <a href="deduplication.html#dedup_data">données originales</a>.</p>
<p><strong>Séparation des égalités</strong></p>
<p>Multiples lignes de slice peuvent être exécutées pour ” séparer les égalités”. Dans ce cas, si une personne a plusieurs rencontres à leur dernière <em>date</em>, la rencontre avec la dernière <em>heure</em> est retenue (<code><a href="https://lubridate.tidyverse.org/reference/hms.html">lubridate::hm()</a></code> est utilisé pour convertir les heures des caractères en une classe de temps triable).<br>
Notez comment maintenant, la seule ligne conservée pour “Mariah” le 6 janvier est la rencontre 3 de 08:32, et non la rencontre 2 de 07:25.</p>
<div class="sourceCode" id="cb747"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Exemple de multiple lignes de slice exécutées pour " séparer les égalités"</span></span>
<span><span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># PREMIEREMENT - slice par la dernière date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">date</span>, n <span class="op">=</span> <span class="fl">1</span>, with_ties <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># DEUXIÈMEMENT - s'il y a une égalité, sélectionner la ligne avec l'heure la plus tardive ; égalité interdite</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/hms.html">hm</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">1</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4e4912f42436d316155d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4e4912f42436d316155d">{"x":{"filter":"none","vertical":false,"data":[[11,5,16,13,18,14,17,8],[1,2,5,3,8,4,7,6],["adam","amrish","brian","mariah","natalie","nikhil","raquel","smita"],["2020-01-05","2020-01-05","2020-01-07","2020-01-06","2020-01-07","2020-01-06","2020-01-07","2020-01-05"],["09:40","16:10","07:59","08:32","17:12","15:36","11:13","14:20"],[2,3,3,3,1,2,2,1],["case","case","case","contact","case","contact","contact","contact"],["No","Yes","No","No","No","Yes","No","Yes"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p><em>Dans l’exemple ci-dessus, il aurait également été possible de slice par le numéro de <code>encounter</code>, mais nous avons montré le slice sur <code>date</code> et <code>time</code> pour illustration.</em></p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Pour utiliser <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> ou <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code> sur une colonne e de “caractères”, mutez-la en une classe de facteurs <em>ordonnée</em> !</span>.</p>
<p>Voir <a href="deduplication.html#dedup_data">données originales</a>.</p>
<!-- ======================================================= -->
</div>
<div id="retenir-tous-les-lignes-mais-les-marquer" class="section level3 unnumbered">
<h3>Retenir tous les lignes mais les marquer<a class="anchor" aria-label="anchor" href="#retenir-tous-les-lignes-mais-les-marquer"><i class="fas fa-link"></i></a>
</h3>
<p>Si vous voulez retenir tous les evenements mais n’en marquer que certains pour l’analyse, envisagez une approche en deux étapes en utilisant un numéro unique de recordID/encounter :</p>
<ol style="list-style-type: decimal">
<li>Reduire/slice le tableau de données original pour n’avoir que les lignes à analyser. Sauvegardez/retenir ce tableau de données réduit.<br>
</li>
<li>Dans le tableau de données original, marquez les lignes avec <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code>, selon que leur identifiant unique d’enregistrement (recordID dans cet exemple) est présent ou non dans le tableau de données réduit.</li>
</ol>
<div class="sourceCode" id="cb748"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Definir les lignes de tableau de données à retenir pour l'analyse</span></span>
<span><span class="va">obs_keep</span> <span class="op">&lt;-</span> <span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">encounter</span>, n <span class="op">=</span> <span class="fl">1</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># ne garder que la dernière rencontre par personne</span></span>
<span></span>
<span></span>
<span><span class="co"># 2. Marquer le tableau de données original</span></span>
<span><span class="va">obs_marked</span> <span class="op">&lt;-</span> <span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span>  <span class="co"># Créer une nouvelle colonne dup_record</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dup_record <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="co"># si record est dans le tableau de données obs_keep</span></span>
<span>    <span class="va">recordID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">obs_keep</span><span class="op">$</span><span class="va">recordID</span> <span class="op">~</span> <span class="st">"For analysis"</span>, </span>
<span>    </span>
<span>    <span class="co">#tout le reste est marqué comme "Ignore" pour l'analyse</span></span>
<span>    <span class="cn">TRUE</span>                            <span class="op">~</span> <span class="st">"Ignore"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># imprimer</span></span>
<span><span class="va">obs_marked</span></span></code></pre></div>
<pre><code>##    recordID personID    name       date  time encounter purpose symptoms_ever
## 1         1        1    adam 2020-01-01 09:00         1 contact          &lt;NA&gt;
## 2         1        1    adam 2020-01-01 09:00         1 contact          &lt;NA&gt;
## 3         2        2  amrish 2020-01-02 14:20         1 contact            No
## 4         3        2  amrish 2020-01-02 14:20         1 contact            No
## 5         4        3  mariah 2020-01-05 12:00         1    case            No
## 6         5        2  amrish 2020-01-05 16:10         3    case           Yes
## 7         6        4  nikhil 2020-01-05 13:01         1 contact           Yes
## 8         7        5   brian 2020-01-05 15:20         1 contact            No
## 9         8        6   smita 2020-01-05 14:20         1 contact           Yes
## 10        9        7  raquel 2020-01-05 12:30         1 contact          &lt;NA&gt;
## 11       10        2  amrish 2020-01-02 10:24         2 contact           Yes
## 12       11        1    adam 2020-01-05 09:40         2    case            No
## 13       12        3  mariah 2020-01-06 07:25         2 contact            No
## 14       13        3  mariah 2020-01-06 08:32         3 contact            No
## 15       14        4  nikhil 2020-01-06 15:36         2 contact           Yes
## 16       15        5   brian 2020-01-06 15:31         2 contact           Yes
## 17       16        5   brian 2020-01-07 07:59         3    case            No
## 18       17        7  raquel 2020-01-07 11:13         2 contact            No
## 19       18        8 natalie 2020-01-07 17:12         1    case            No
##      dup_record
## 1        Ignore
## 2        Ignore
## 3        Ignore
## 4        Ignore
## 5        Ignore
## 6  For analysis
## 7        Ignore
## 8        Ignore
## 9  For analysis
## 10       Ignore
## 11       Ignore
## 12 For analysis
## 13       Ignore
## 14 For analysis
## 15 For analysis
## 16       Ignore
## 17 For analysis
## 18 For analysis
## 19 For analysis</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0e7afe3853e49acd4467" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0e7afe3853e49acd4467">{"x":{"filter":"none","vertical":false,"data":[[1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],[1,1,2,2,3,2,4,5,6,7,2,1,3,3,4,5,5,7,8],["adam","adam","amrish","amrish","mariah","amrish","nikhil","brian","smita","raquel","amrish","adam","mariah","mariah","nikhil","brian","brian","raquel","natalie"],["2020-01-01","2020-01-01","2020-01-02","2020-01-02","2020-01-05","2020-01-05","2020-01-05","2020-01-05","2020-01-05","2020-01-05","2020-01-02","2020-01-05","2020-01-06","2020-01-06","2020-01-06","2020-01-06","2020-01-07","2020-01-07","2020-01-07"],["09:00","09:00","14:20","14:20","12:00","16:10","13:01","15:20","14:20","12:30","10:24","09:40","07:25","08:32","15:36","15:31","07:59","11:13","17:12"],[1,1,1,1,1,3,1,1,1,1,2,2,2,3,2,2,3,2,1],["contact","contact","contact","contact","case","case","contact","contact","contact","contact","contact","case","contact","contact","contact","contact","case","contact","case"],[null,null,"No","No","No","Yes","Yes","No","Yes",null,"Yes","No","No","No","Yes","Yes","No","No","No"],["Ignore","Ignore","Ignore","Ignore","Ignore","For analysis","Ignore","Ignore","For analysis","Ignore","Ignore","For analysis","Ignore","For analysis","For analysis","Ignore","For analysis","For analysis","For analysis"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n      <th>dup_record<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Voir <a href="deduplication.html#dedup_data">données originales</a>.</p>
<!-- ======================================================= -->
</div>
<div id="calcul-de-la-complétude-des-lignes" class="section level3 unnumbered">
<h3>Calcul de la complétude des lignes<a class="anchor" aria-label="anchor" href="#calcul-de-la-compl%C3%A9tude-des-lignes"><i class="fas fa-link"></i></a>
</h3>
<p>Créez une colonne qui contient une métrique pour la complétude des lignes (pas de valeurs manquantes). Cela peut être utile pour décider des lignes à prioriser par rapport aux autres lors de la déduplication.</p>
<p>Dans cet exemple, les colonnes “clés” sur lesquelles vous voulez mesurer la complétude sont sauvegardées dans un vecteur de noms de colonnes.</p>
<p>Ensuite, la nouvelle colonne <code>key_completeness</code> est créée avec <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. La nouvelle valeur dans chaque ligne est définie comme une fraction calculée : le nombre de valeurs non manquantes dans cette ligne parmi les colonnes clés, divisé par le nombre de colonnes clés.</p>
<p>Cela fait appel à la fonction <code><a href="https://rdrr.io/r/base/colSums.html">rowSums()</a></code> de <strong>base</strong> R. On utilise également <code>.</code>, qui, dans le cadre d’un pipe, fait référence au tableau de données à ce point du pipe (dans ce cas, il est sous-ensemble avec les crochets <code>[]</code>).</p>
<p><em>Défiler vers la droite pour voir plus de lignes.</em></p>
<div class="sourceCode" id="cb750"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># créer une colonne "complétude des variables clés".</span></span>
<span><span class="co"># il s'agit de la *proportion* des colonnes désignées comme "key_cols" qui ont des valeurs non manquantes.</span></span>
<span></span>
<span><span class="va">key_cols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"personID"</span>, <span class="st">"name"</span>, <span class="st">"symptoms_ever"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>key_completeness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span>,<span class="va">key_cols</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">key_cols</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0c621013a7c97678525f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0c621013a7c97678525f">{"x":{"filter":"none","vertical":false,"data":[[1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],[1,1,2,2,3,2,4,5,6,7,2,1,3,3,4,5,5,7,8],["adam","adam","amrish","amrish","mariah","amrish","nikhil","brian","smita","raquel","amrish","adam","mariah","mariah","nikhil","brian","brian","raquel","natalie"],["2020-01-01","2020-01-01","2020-01-02","2020-01-02","2020-01-05","2020-01-05","2020-01-05","2020-01-05","2020-01-05","2020-01-05","2020-01-02","2020-01-05","2020-01-06","2020-01-06","2020-01-06","2020-01-06","2020-01-07","2020-01-07","2020-01-07"],["09:00","09:00","14:20","14:20","12:00","16:10","13:01","15:20","14:20","12:30","10:24","09:40","07:25","08:32","15:36","15:31","07:59","11:13","17:12"],[1,1,1,1,1,3,1,1,1,1,2,2,2,3,2,2,3,2,1],["contact","contact","contact","contact","case","case","contact","contact","contact","contact","contact","case","contact","contact","contact","contact","case","contact","case"],[null,null,"No","No","No","Yes","Yes","No","Yes",null,"Yes","No","No","No","Yes","Yes","No","No","No"],[0.666666666666667,0.666666666666667,1,1,1,1,1,1,1,0.666666666666667,1,1,1,1,1,1,1,1,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>recordID<\/th>\n      <th>personID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n      <th>key_completeness<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,5,8]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Voir <a href="deduplication.html#dedup_data">données originales</a>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="str_rollup" class="section level2" number="15.4">
<h2>
<span class="header-section-number">15.4</span> Réunir les valeurs de plusieurs lignes<a class="anchor" aria-label="anchor" href="#str_rollup"><i class="fas fa-link"></i></a>
</h2>
<p>Cette section décrit :</p>
<ol style="list-style-type: decimal">
<li>Comment “réunir” les valeurs de plusieurs lignes en une seule ligne, avec quelques variations.<br>
</li>
<li>Une fois les valeurs sont “réunit”, comment remplacer/prioriser les valeurs dans chaque cellule.</li>
</ol>
<p>Cet onglet utilise le jeu de données d’exemple de l’onglet Préparation.</p>
<!-- ======================================================= -->
<div id="réunir-les-valeurs-en-une-seule-ligne" class="section level3 unnumbered">
<h3>Réunir les valeurs en une seule ligne<a class="anchor" aria-label="anchor" href="#r%C3%A9unir-les-valeurs-en-une-seule-ligne"><i class="fas fa-link"></i></a>
</h3>
<p>L’exemple de code ci-dessous utilise <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> et <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> pour regrouper les lignes par personne, puis rassembler toutes les valeurs uniques dans les lignes groupées. Ainsi, vous obtenez un résumé de ligne par personne. Quelques notes :<br>
* Un suffixe est ajouté à toutes les nouvelles colonnes (“_roll” dans cet exemple).<br>
* Si vous ne voulez afficher que les valeurs uniques par cellule, enveloppez le <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> avec <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code>.<br>
* <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> supprime les valeurs <code>NA</code>, mais si cela n’est pas souhaité, il peut être supprimé <code>paste0(.x)</code> …</p>
<div class="sourceCode" id="cb751"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Réunir les valeurs en une seule ligne par groupe (par "personID") </span></span>
<span><span class="va">cases_rolled</span> <span class="op">&lt;-</span> <span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># créer des groupes par nom</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">personID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># ordonner les lignes à l'intérieur de chaque groupe (par exemple par date)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">date</span>, .by_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># Pour chaque colonne, rassemblez toutes les valeurs des lignes groupées, en les séparant par " ;".</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,                           <span class="co"># appliquer à toutes les colonnes</span></span>
<span>           <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"; "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># on définit une fonction qui combine les valeurs non-NA </span></span></code></pre></div>
<p>Le résultat est une ligne par groupe (<code>ID</code>), avec des entrées classées par date et assemblées. <em>Défiler vers la gauche pour voir plus de lignes</em></p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3825033c2653a82d69ee" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3825033c2653a82d69ee">{"x":{"filter":"none","vertical":false,"data":[[1,2,3,4,5,6,7,8],["1; 1; 11","2; 3; 10; 5","4; 12; 13","6; 14","7; 15; 16","8","9; 17","18"],["adam; adam; adam","amrish; amrish; amrish; amrish","mariah; mariah; mariah","nikhil; nikhil","brian; brian; brian","smita","raquel; raquel","natalie"],["2020-01-01; 2020-01-01; 2020-01-05","2020-01-02; 2020-01-02; 2020-01-02; 2020-01-05","2020-01-05; 2020-01-06; 2020-01-06","2020-01-05; 2020-01-06","2020-01-05; 2020-01-06; 2020-01-07","2020-01-05","2020-01-05; 2020-01-07","2020-01-07"],["09:00; 09:00; 09:40","14:20; 14:20; 10:24; 16:10","12:00; 07:25; 08:32","13:01; 15:36","15:20; 15:31; 07:59","14:20","12:30; 11:13","17:12"],["1; 1; 2","1; 1; 2; 3","1; 2; 3","1; 2","1; 2; 3","1","1; 2","1"],["contact; contact; case","contact; contact; contact; case","case; contact; contact","contact; contact","contact; contact; case","contact","contact; contact","case"],["No","No; No; Yes; Yes","No; No; No","Yes; Yes","No; Yes; No","Yes","No","No"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>personID<\/th>\n      <th>recordID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Voir <a href="deduplication.html#dedup_data">données originales</a>.</p>
<p><strong>Cette variation ne présente que des valeurs uniques:</strong></p>
<div class="sourceCode" id="cb752"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cette variation ne présente que des valeurs uniques </span></span>
<span><span class="va">cases_rolled</span> <span class="op">&lt;-</span> <span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">personID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">date</span>, .by_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,                                   <span class="co"># appliquer à toutes les colonnes</span></span>
<span>           <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"; "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># on définit une fonction qui combine les valeurs non-NA </span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-88e3b3094093a17f57fb" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-88e3b3094093a17f57fb">{"x":{"filter":"none","vertical":false,"data":[[1,2,3,4,5,6,7,8],["1; 11","2; 3; 10; 5","4; 12; 13","6; 14","7; 15; 16","8","9; 17","18"],["adam","amrish","mariah","nikhil","brian","smita","raquel","natalie"],["2020-01-01; 2020-01-05","2020-01-02; 2020-01-05","2020-01-05; 2020-01-06","2020-01-05; 2020-01-06","2020-01-05; 2020-01-06; 2020-01-07","2020-01-05","2020-01-05; 2020-01-07","2020-01-07"],["09:00; 09:40","14:20; 10:24; 16:10","12:00; 07:25; 08:32","13:01; 15:36","15:20; 15:31; 07:59","14:20","12:30; 11:13","17:12"],["1; 2","1; 2; 3","1; 2; 3","1; 2","1; 2; 3","1","1; 2","1"],["contact; case","contact; case","case; contact","contact","contact; case","contact","contact","case"],["No","No; Yes","No","Yes","No; Yes","Yes","No","No"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>personID<\/th>\n      <th>recordID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p><strong>Cette variation ajoute un suffixe à chaque colonne.</strong><br>
Dans ce cas, “_roll” pour signifier qu’elle a été roulée :</p>
<div class="sourceCode" id="cb753"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cette variation ajoute un suffixe à chaque colonne</span></span>
<span><span class="va">cases_rolled</span> <span class="op">&lt;-</span> <span class="va">obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">personID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">date</span>, .by_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,                </span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>roll <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"; "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># _roll est ajouté aux noms des colonnes</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-54cff4f1836aa5cf9f5d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-54cff4f1836aa5cf9f5d">{"x":{"filter":"none","vertical":false,"data":[[1,2,3,4,5,6,7,8],["1; 1; 11","2; 3; 10; 5","4; 12; 13","6; 14","7; 15; 16","8","9; 17","18"],["adam; adam; adam","amrish; amrish; amrish; amrish","mariah; mariah; mariah","nikhil; nikhil","brian; brian; brian","smita","raquel; raquel","natalie"],["2020-01-01; 2020-01-01; 2020-01-05","2020-01-02; 2020-01-02; 2020-01-02; 2020-01-05","2020-01-05; 2020-01-06; 2020-01-06","2020-01-05; 2020-01-06","2020-01-05; 2020-01-06; 2020-01-07","2020-01-05","2020-01-05; 2020-01-07","2020-01-07"],["09:00; 09:00; 09:40","14:20; 14:20; 10:24; 16:10","12:00; 07:25; 08:32","13:01; 15:36","15:20; 15:31; 07:59","14:20","12:30; 11:13","17:12"],["1; 1; 2","1; 1; 2; 3","1; 2; 3","1; 2","1; 2; 3","1","1; 2","1"],["contact; contact; case","contact; contact; contact; case","case; contact; contact","contact; contact","contact; contact; case","contact","contact; contact","case"],["No","No; No; Yes; Yes","No; No; No","Yes; Yes","No; Yes; No","Yes","No","No"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>personID<\/th>\n      <th>recordID_roll<\/th>\n      <th>name_roll<\/th>\n      <th>date_roll<\/th>\n      <th>time_roll<\/th>\n      <th>encounter_roll<\/th>\n      <th>purpose_roll<\/th>\n      <th>symptoms_ever_roll<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="remplacer-les-valeurshiérarchie" class="section level3 unnumbered">
<h3>Remplacer les valeurs/hiérarchie<a class="anchor" aria-label="anchor" href="#remplacer-les-valeurshi%C3%A9rarchie"><i class="fas fa-link"></i></a>
</h3>
<p>Si vous voulez ensuite évaluer toutes les valeurs reunit, et ne garder qu’une valeur spécifique (par exemple la “meilleure” ou la “valeur maximale”), vous pouvez utiliser <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> sur les colonnes souhaitées, pour implémenter <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code>, qui utilise <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> du package <strong>stringr</strong> pour rechercher séquentiellement des séquences de caractères et remplacer le contenu de la cellule.</p>
<div class="sourceCode" id="cb754"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CLEAN CASES</span></span>
<span><span class="co">#############</span></span>
<span><span class="va">cases_clean</span> <span class="op">&lt;-</span> <span class="va">cases_rolled</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="co"># nettoie les variables Yes-No-Unknown : remplace le texte par la valeur "la plus élevée" présente dans la séquence des caracteres</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"symptoms_ever"</span><span class="op">)</span><span class="op">)</span>,                     <span class="co"># fonctionne sur les colonnes spécifiées (Y/N/U)</span></span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mod <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>                                 <span class="co"># ajoute le suffixe "_mod" aux nouvelles cols ; implémente case_when() </span></span>
<span>               </span>
<span>               <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"Yes"</span><span class="op">)</span>       <span class="op">~</span> <span class="st">"Yes"</span>,                 <span class="co"># si "Yes" est détecté, alors la valeur de la cellule est convertie en Yes</span></span>
<span>               <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"No"</span><span class="op">)</span>        <span class="op">~</span> <span class="st">"No"</span>,                  <span class="co"># # alors, si "No" est détecté, la valeur de la cellule est convertie en No</span></span>
<span>               <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"Unknown"</span><span class="op">)</span>   <span class="op">~</span> <span class="st">"Unknown"</span>,             <span class="co"># alors, si "Unknown" est détecté, la valeur de la cellule est convertie en Unknown </span></span>
<span>               <span class="cn">TRUE</span>                        <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,   <span class="co"># alors, si quelque chose d'autre est retenu comme tel</span></span>
<span>      .keep <span class="op">=</span> <span class="st">"unused"</span><span class="op">)</span>                                             <span class="co"># anciennes colonnes enlevées, ne laissant que des colonnes _mod</span></span></code></pre></div>
<p>Maintenant vous pouvez voir dans la colonne <code>symptoms_ever</code> que si la personne a JAMAIS dit “Oui” aux symptômes, alors seul “Oui” est affiché.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9ba7da7b3284da318016" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9ba7da7b3284da318016">{"x":{"filter":"none","vertical":false,"data":[[1,2,3,4,5,6,7,8],["1; 11","2; 3; 10; 5","4; 12; 13","6; 14","7; 15; 16","8","9; 17","18"],["adam","amrish","mariah","nikhil","brian","smita","raquel","natalie"],["2020-01-01; 2020-01-05","2020-01-02; 2020-01-05","2020-01-05; 2020-01-06","2020-01-05; 2020-01-06","2020-01-05; 2020-01-06; 2020-01-07","2020-01-05","2020-01-05; 2020-01-07","2020-01-07"],["09:00; 09:40","14:20; 10:24; 16:10","12:00; 07:25; 08:32","13:01; 15:36","15:20; 15:31; 07:59","14:20","12:30; 11:13","17:12"],["1; 2","1; 2; 3","1; 2; 3","1; 2","1; 2; 3","1","1; 2","1"],["contact; case","contact; case","case; contact","contact","contact; case","contact","contact","case"],["No","Yes","No","Yes","Yes","Yes","No","No"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>personID<\/th>\n      <th>recordID<\/th>\n      <th>name<\/th>\n      <th>date<\/th>\n      <th>time<\/th>\n      <th>encounter<\/th>\n      <th>purpose<\/th>\n      <th>symptoms_ever_mod<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>Voir <a href="deduplication.html#dedup_data">données originales</a>.</p>
</div>
</div>
<div id="déduplication-probabiliste-1" class="section level2" number="15.5">
<h2>
<span class="header-section-number">15.5</span> Déduplication probabiliste<a class="anchor" aria-label="anchor" href="#d%C3%A9duplication-probabiliste-1"><i class="fas fa-link"></i></a>
</h2>
<p>Parfois, vous souhaitez identifier les doublons “probables” en vous basant sur la similarité (par exemple, la sequence des caractères “distance”) entre plusieurs colonnes telles que le nom, l’âge, le sexe, la date de naissance, etc. Vous pouvez appliquer un algorithme de correspondance probabiliste pour identifier les doublons probables.</p>
<p>Voir la page <a href="joining_matching.html#joining_matching">Joindre des données</a> pour une explication de cette méthode. La section sur l’Appariement Probabiliste contient un exemple d’application de ces algorithmes pour comparer un tableau de données à <em>soi-même</em>, effectuant ainsi une déduplication probabiliste.</p>
<!-- ======================================================= -->
</div>
<div id="ressources-4" class="section level2" number="15.6">
<h2>
<span class="header-section-number">15.6</span> Ressources<a class="anchor" aria-label="anchor" href="#ressources-4"><i class="fas fa-link"></i></a>
</h2>
<p>La plupart des informations contenues dans cette page sont adaptées de ces ressources et des vignettes en ligne :</p>
<p><a href="https://www.datanovia.com/en/lessons/identify-and-remove-duplicate-data-in-r/">datanovia</a></p>
<p><a href="https://dplyr.tidyverse.org/reference/slice.html">dplyr tidyverse reference</a></p>
<p><a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#explore-records-with-duplicated-values-for-specific-combinations-of-variables-with-get_dupes">cran janitor vignette</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="joining_matching.html"><span class="header-section-number">14</span> Joindre des données</a></div>
<div class="next"><a href="iteration.html"><span class="header-section-number">16</span> Itération, boucles et listes</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#deduplication"><span class="header-section-number">15</span> De-duplication</a></li>
<li>
<a class="nav-link" href="#pr%C3%A9paration"><span class="header-section-number">15.1</span> Préparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importation-des-packages">Importation des packages</a></li>
<li><a class="nav-link" href="#importer-les-donn%C3%A9es">Importer les données</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#deduplication-1"><span class="header-section-number">15.2</span> Deduplication</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#examiner-les-lignes-dupliqu%C3%A9es">Examiner les lignes dupliquées</a></li>
<li><a class="nav-link" href="#garder-seulement-les-lignes-uniques">Garder seulement les lignes uniques</a></li>
<li><a class="nav-link" href="#d%C3%A9dupliquer-les-%C3%A9l%C3%A9ments-dun-vecteur">Dédupliquer les éléments d’un vecteur</a></li>
<li><a class="nav-link" href="#utilisant-base-r">Utilisant base R</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#slicing"><span class="header-section-number">15.3</span> Slicing</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#slice-avec-les-groupes">Slice avec les groupes</a></li>
<li><a class="nav-link" href="#retenir-tous-les-lignes-mais-les-marquer">Retenir tous les lignes mais les marquer</a></li>
<li><a class="nav-link" href="#calcul-de-la-compl%C3%A9tude-des-lignes">Calcul de la complétude des lignes</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#str_rollup"><span class="header-section-number">15.4</span> Réunir les valeurs de plusieurs lignes</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#r%C3%A9unir-les-valeurs-en-une-seule-ligne">Réunir les valeurs en une seule ligne</a></li>
<li><a class="nav-link" href="#remplacer-les-valeurshi%C3%A9rarchie">Remplacer les valeurs/hiérarchie</a></li>
</ul>
</li>
<li><a class="nav-link" href="#d%C3%A9duplication-probabiliste-1"><span class="header-section-number">15.5</span> Déduplication probabiliste</a></li>
<li><a class="nav-link" href="#ressources-4"><span class="header-section-number">15.6</span> Ressources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Le Epi R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-21.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
