<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>35 Graphiques thermiques | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="35 Graphiques thermiques | The Epidemiologist R Handbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="35 Graphiques thermiques | The Epidemiologist R Handbook" />
  
  <meta name="twitter:description" content="The Epi R Handbook est un manuel de référence sur l’utilisation de R en épidémiologie appliquée et santé publique." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.2/transition.js"></script>
    <script src="libs/bs3compat-0.4.2/tabs.js"></script>
    <script src="libs/bs3compat-0.4.2/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.27/datatables.js"></script>
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
    <script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.9/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.1/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="heatmaps" class="section level1" number="35">
<h1><span class="header-section-number">35</span> Graphiques thermiques</h1>
<p>Les diagrammes de chaleur, également connus sous le nom de “cartes de chaleur” ou “tuiles de chaleur”, peuvent être des visualisations utiles lorsqu’on essaie d’afficher 3 variables (axe des x, axe des y et remplissage). Nous présentons ci-dessous deux exemples :</p>
<ul>
<li>Une matrice visuelle des événements de transmission par âge (“qui a infecté qui”).<br />
</li>
<li>Le suivi des métriques de déclaration dans de nombreux établissements/juridictions au fil du temps.</li>
</ul>
<p><img src="images/transmission_matrix.png" width="50%" /><img src="images/heat_tile.png" width="50%" /></p>
<!-- ======================================================= -->
<div id="préparation-19" class="section level2" number="35.1">
<h2><span class="header-section-number">35.1</span> Préparation</h2>
<div id="chargement-des-paquets-8" class="section level3 unnumbered">
<h3>Chargement des paquets</h3>
<p>Ce morceau de code montre le chargement des paquets nécessaires aux analyses. Dans ce manuel, nous mettons l’accent sur <code>p_load()</code> de <strong>pacman</strong>, qui installe le paquet si nécessaire <em>et</em> le charge pour l’utiliser. Vous pouvez également charger les paquets installés avec <code>library()</code> de <strong>base</strong> R. Voir la page sur <a href="#id_%20rbasics">bases de R</a> pour plus d’informations sur les paquets R.</p>
<div class="sourceCode" id="cb1660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1660-1"><a href="heatmaps.html#cb1660-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1660-2"><a href="heatmaps.html#cb1660-2" aria-hidden="true" tabindex="-1"></a>  tidyverse, <span class="co"># manipulation et visualisation de données</span></span>
<span id="cb1660-3"><a href="heatmaps.html#cb1660-3" aria-hidden="true" tabindex="-1"></a>  rio, <span class="co"># importation de données </span></span>
<span id="cb1660-4"><a href="heatmaps.html#cb1660-4" aria-hidden="true" tabindex="-1"></a>  lubridate <span class="co"># travail avec les dates</span></span>
<span id="cb1660-5"><a href="heatmaps.html#cb1660-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><strong>Ensembles de données</strong></p>
<p>Cette page utilise la liste de cas d’une épidémie simulée pour la section de la matrice de transmission, et un jeu de données séparé du nombre quotidien de cas de paludisme par établissement pour la section du suivi des mesures. Ils sont chargés et nettoyés dans leurs sections individuelles.</p>
</div>
</div>
<div id="matrice-de-transmission" class="section level2" number="35.2">
<h2><span class="header-section-number">35.2</span> Matrice de transmission</h2>
<p>Les tuiles thermiques peuvent être utiles pour visualiser les matrices. Un exemple est d’afficher “qui a infecté qui” dans une épidémie. Cela suppose que vous disposiez d’informations sur les événements de transmission.</p>
<p>Notez que la page <a href="contact_tracing.html#contact_tracing">Recherche des contacts</a> contient un autre exemple de création d’une matrice de contacts en tuiles thermiques, à l’aide d’un ensemble de données différent (peut-être plus simple) où les âges des cas et leurs sources sont soigneusement alignés sur la même ligne du cadre de données. Ces mêmes données sont utilisées pour réaliser une carte de <em>densité</em> dans la page <a href="ggplot_tips.html#ggplot_tips">Astuces de ggplot</a>. L’exemple ci-dessous part d’une liste de cas et implique donc une manipulation considérable des données avant d’obtenir un cadre de données traçable. Il existe donc de nombreux scénarios parmi lesquels choisir…</p>
<p>Nous commençons à partir de la liste de cas d’une épidémie d’Ebola simulée. Si vous souhaitez nous suivre, <a href='https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds' class='download-button'>cliquez pour télécharger la linelist “propre”</a> (en tant que fichier .rds). Importez vos données avec la fonction <code>import()</code> du paquet <strong>rio</strong> (elle accepte de nombreux types de fichiers comme .xlsx, .rds, .csv - voir la page <a href="import_export.html#import_export">Importation et exportation</a> pour plus de détails).</p>
<p>Les 50 premières lignes de la liste de lignes sont présentées ci-dessous à titre de démonstration :</p>
<div class="sourceCode" id="cb1661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1661-1"><a href="heatmaps.html#cb1661-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist_cleaned.rds&quot;</span>)</span></code></pre></div>
<p>Dans cette linelist :</p>
<ul>
<li>Il y a une ligne par cas, identifié par <code>case_id</code>.<br />
</li>
<li>Il y a une colonne ultérieure <code>infector</code> qui contient le <code>case_id</code> de l’<em>infector</em>, qui est aussi un cas dans la linelist</li>
</ul>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e4a1fbf8888cd0a1531c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e4a1fbf8888cd0a1531c">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<div id="préparation-des-données" class="section level3 unnumbered">
<h3>Préparation des données</h3>
<p><strong>Objectif</strong> : Nous devons obtenir un cadre de données de type “long” qui contient une ligne par route de transmission âge-âge possible, avec une colonne numérique contenant la proportion de cette ligne de tous les événements de transmission observés dans la liste de lignes.</p>
<p>Il faudra plusieurs étapes de manipulation des données pour y parvenir :</p>
<div id="créer-un-cadre-de-données-pour-les-cas" class="section level4 unnumbered">
<h4>Créer un cadre de données pour les cas</h4>
<p>Pour commencer, nous créons un cadre de données des cas, de leurs âges, et de leurs infecteurs - nous appelons ce cadre de données <code>case_ages</code>. Les 50 premières lignes sont affichées ci-dessous.</p>
<div class="sourceCode" id="cb1662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1662-1"><a href="heatmaps.html#cb1662-1" aria-hidden="true" tabindex="-1"></a>case_ages <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb1662-2"><a href="heatmaps.html#cb1662-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_id, infector, age_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb1662-3"><a href="heatmaps.html#cb1662-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;case_age_cat&quot;</span> <span class="ot">=</span> <span class="st">&quot;age_cat&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-27010a14bca05e4bd869" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-27010a14bca05e4bd869">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>infector<\/th>\n      <th>case_age_cat<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="création-dun-cadre-de-données-dinfecteurs" class="section level4 unnumbered">
<h4>Création d’un cadre de données d’infecteurs</h4>
<p>Ensuite, nous créons un cadre de données des infecteurs - pour l’instant, il est constitué d’une seule colonne. Il s’agit des identifiants des infecteurs de la liste de diffusion. Tous les cas n’ont pas un infecteur connu, nous supprimons donc les valeurs manquantes. Les 50 premières lignes sont affichées ci-dessous.</p>
<div class="sourceCode" id="cb1663"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1663-1"><a href="heatmaps.html#cb1663-1" aria-hidden="true" tabindex="-1"></a>infectors <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb1663-2"><a href="heatmaps.html#cb1663-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(infector) <span class="sc">%&gt;%</span> </span>
<span id="cb1663-3"><a href="heatmaps.html#cb1663-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(infector)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b79b6a5c2478e75d2888" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b79b6a5c2478e75d2888">{"x":{"filter":"none","vertical":false,"data":[["f547d6","f90f5f","11f8ea","aec8ec","893f25","133ee7","996f3a","133ee7","37a6f6","9f6884","4802b1","a75c7f","8e104d","ab634e","b799eb","5d9e4d","a15e13","ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277","d6584f","312ecf","52ea64","cfd79c","d145b7","174288","53608c","3b096b","f5c142","d05405","700448","a2e5cc","7fd086","4e08f2","3789ee","c2595d","b7641e","ce4ec6","09f7ab","4b501e","006775","1f8797","2b36fa","068c6a","535760"]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>infector<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Ensuite, nous utilisons des jointures pour obtenir l’âge des infecteurs. Ce n’est pas simple, car dans la <code>linelist</code>, les âges des infecteurs ne sont pas listés en tant que tels. Nous obtenons ce résultat en joignant le cas <code>linelist</code> aux infecteurs. Nous commençons par les infecteurs, et <code>left_join()</code> (ajoutons) la case <code>linelist</code> de sorte que la colonne <code>infector</code> id du cadre de données “baseline” de gauche rejoint la colonne <code>case_id</code> du cadre de données <code>linelist</code> de droite.</p>
<p>Ainsi, les données de l’enregistrement du cas de l’infecteur dans la linelist (y compris l’âge) sont ajoutées à la ligne de l’infecteur. Les 50 premières lignes sont affichées ci-dessous.</p>
<div class="sourceCode" id="cb1664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1664-1"><a href="heatmaps.html#cb1664-1" aria-hidden="true" tabindex="-1"></a>infector_ages <span class="ot">&lt;-</span> infectors <span class="sc">%&gt;%</span> <span class="co"># commence par infectors</span></span>
<span id="cb1664-2"><a href="heatmaps.html#cb1664-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>( <span class="co"># ajoute les données de la linelist à chaque infecteur  </span></span>
<span id="cb1664-3"><a href="heatmaps.html#cb1664-3" aria-hidden="true" tabindex="-1"></a>    linelist,</span>
<span id="cb1664-4"><a href="heatmaps.html#cb1664-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;infector&quot;</span> <span class="ot">=</span> <span class="st">&quot;case_id&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># faire correspondre l&#39;infector à ses informations en tant que cas</span></span>
<span id="cb1664-5"><a href="heatmaps.html#cb1664-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(infector, age_cat) <span class="sc">%&gt;%</span> <span class="co"># ne conserve que les colonnes d&#39;intérêt</span></span>
<span id="cb1664-6"><a href="heatmaps.html#cb1664-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;infector_age_cat&quot;</span> <span class="ot">=</span> <span class="st">&quot;age_cat&quot;</span>) <span class="co"># renommer pour plus de clarté</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d95cdf118dcb81528059" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d95cdf118dcb81528059">{"x":{"filter":"none","vertical":false,"data":[["f547d6","f90f5f","11f8ea","aec8ec","893f25","133ee7","996f3a","133ee7","37a6f6","9f6884","4802b1","a75c7f","8e104d","ab634e","b799eb","5d9e4d","a15e13","ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277","d6584f","312ecf","52ea64","cfd79c","d145b7","174288","53608c","3b096b","f5c142","d05405","700448","a2e5cc","7fd086","4e08f2","3789ee","c2595d","b7641e","ce4ec6","09f7ab","4b501e","006775","1f8797","2b36fa","068c6a","535760"],["15-19",null,"50-69",null,"0-4","20-29",null,"20-29",null,"15-19",null,null,"10-14",null,"10-14",null,null,null,null,"50-69",null,null,null,null,null,"5-9",null,"10-14","10-14","0-4","20-29",null,null,"20-29",null,"5-9",null,"10-14",null,"20-29","10-14","5-9","0-4",null,null,null,"5-9","15-19",null,null]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>infector<\/th>\n      <th>infector_age_cat<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Ensuite, nous combinons les cas et leurs âges avec les infecteurs et leurs âges. Chacun de ces cadres de données possède la colonne <code>infector</code>, elle est donc utilisée pour la jointure. Les premières lignes sont affichées ci-dessous :</p>
<div class="sourceCode" id="cb1665"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1665-1"><a href="heatmaps.html#cb1665-1" aria-hidden="true" tabindex="-1"></a>ages_complete <span class="ot">&lt;-</span> case_ages <span class="sc">%&gt;%</span>  </span>
<span id="cb1665-2"><a href="heatmaps.html#cb1665-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb1665-3"><a href="heatmaps.html#cb1665-3" aria-hidden="true" tabindex="-1"></a>    infector_ages,</span>
<span id="cb1665-4"><a href="heatmaps.html#cb1665-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;infector&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># chacun a la colonne infector</span></span>
<span id="cb1665-5"><a href="heatmaps.html#cb1665-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="co"># supprime les lignes avec des données manquantes</span></span></code></pre></div>
<pre><code>## Warning in left_join(., infector_ages, by = &quot;infector&quot;): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 1 of `x` matches multiple rows in `y`.
## ℹ Row 6 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8d50652cac2b6ec9cc9f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8d50652cac2b6ec9cc9f">{"x":{"filter":"none","vertical":false,"data":[["5fe599","5fe599","5fe599","893f25","893f25","893f25","893f25","893f25","07e3e8","369449","369449","57a565","57a565","2eaa9a","ddddee","bc2adf","bc2adf","8ebf6e","f5c142","062638","c76676","c76676","c76676","baacc1","497372","c71dcd","c71dcd","422831","2b36fa","2b36fa","2b36fa","4ade58","9f0c37","f97626","7d99f2","7d99f2","babc2d","d5f3c0","d5f3c0","8b4b24","bd5a25","564652","564652","890de4","890de4","890de4","890de4","cc71ea","cc71ea","3c0ca7"],["f547d6","f547d6","f547d6","11f8ea","11f8ea","11f8ea","11f8ea","11f8ea","893f25","133ee7","133ee7","133ee7","133ee7","9f6884","8e104d","b799eb","b799eb","567136","d6584f","52ea64","cfd79c","cfd79c","cfd79c","d145b7","174288","f5c142","f5c142","700448","7fd086","7fd086","7fd086","3789ee","c2595d","b7641e","ce4ec6","ce4ec6","1f8797","2b36fa","2b36fa","108b95","5b2dd9","92e129","92e129","9a9a84","9a9a84","9a9a84","9a9a84","68623f","68623f","088b66"],["0-4","0-4","0-4","0-4","0-4","0-4","0-4","0-4","15-19","0-4","0-4","30-49","30-49","5-9","10-14","20-29","20-29","10-14","20-29","10-14","10-14","10-14","10-14","0-4","10-14","20-29","20-29","10-14","15-19","15-19","15-19","30-49","10-14","5-9","5-9","5-9","20-29","5-9","5-9","15-19","20-29","15-19","15-19","30-49","30-49","30-49","30-49","30-49","30-49","5-9"],["15-19","15-19","15-19","50-69","50-69","50-69","50-69","50-69","0-4","20-29","20-29","20-29","20-29","15-19","10-14","10-14","10-14","50-69","5-9","10-14","10-14","10-14","10-14","0-4","20-29","20-29","20-29","5-9","10-14","10-14","10-14","20-29","10-14","5-9","0-4","0-4","5-9","15-19","15-19","15-19","30-49","10-14","10-14","70+","70+","70+","70+","30-49","30-49","30-49"]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>infector<\/th>\n      <th>case_age_cat<\/th>\n      <th>infector_age_cat<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Ci-dessous, un simple tableau croisé des chiffres entre les groupes d’âge des cas et des infecteurs. Des étiquettes ont été ajoutées pour plus de clarté.</p>
<div class="sourceCode" id="cb1667"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1667-1"><a href="heatmaps.html#cb1667-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">cases =</span> ages_complete<span class="sc">$</span>case_age_cat,</span>
<span id="cb1667-2"><a href="heatmaps.html#cb1667-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">infectors =</span> ages_complete<span class="sc">$</span>infector_age_cat)</span></code></pre></div>
<pre><code>##        infectors
## cases   0-4 5-9 10-14 15-19 20-29 30-49 50-69 70+
##   0-4   105 156   105   114   143   117    13   0
##   5-9   102 132   110   102   117    96    12   5
##   10-14 104 109    91    79   120    80    12   4
##   15-19  85 105    82    39    75    69     7   5
##   20-29 101 127   109    80   143   107    22   4
##   30-49  72  97    56    54    98    61     4   5
##   50-69   5   6    15     9     7     5     2   0
##   70+     1   0     2     0     0     0     0   0</code></pre>
<p>Nous pouvons convertir ce tableau en un cadre de données avec <code>data.frame()</code> de <strong>base</strong> R, qui le convertit aussi automatiquement au format “long”, ce qui est souhaité pour le <code>ggplot()</code>. Les premières lignes sont présentées ci-dessous.</p>
<div class="sourceCode" id="cb1669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1669-1"><a href="heatmaps.html#cb1669-1" aria-hidden="true" tabindex="-1"></a>long_counts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">table</span>(</span>
<span id="cb1669-2"><a href="heatmaps.html#cb1669-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">cas =</span> ages_complete<span class="sc">$</span>case_age_cat,</span>
<span id="cb1669-3"><a href="heatmaps.html#cb1669-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">infectors =</span> ages_complete<span class="sc">$</span>infector_age_cat))</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cf1dbca85e13eadb2d22" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cf1dbca85e13eadb2d22">{"x":{"filter":"none","vertical":false,"data":[["0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9"],["0-4","0-4","0-4","0-4","0-4","0-4","0-4","0-4","5-9","5-9","5-9","5-9","5-9","5-9","5-9","5-9","10-14","10-14","10-14","10-14","10-14","10-14","10-14","10-14","15-19","15-19","15-19","15-19","15-19","15-19","15-19","15-19","20-29","20-29","20-29","20-29","20-29","20-29","20-29","20-29","30-49","30-49","30-49","30-49","30-49","30-49","30-49","30-49","50-69","50-69"],[105,102,104,85,101,72,5,1,156,132,109,105,127,97,6,0,105,110,91,82,109,56,15,2,114,102,79,39,80,54,9,0,143,117,120,75,143,98,7,0,117,96,80,69,107,61,5,0,13,12]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>cas<\/th>\n      <th>infectors<\/th>\n      <th>Freq<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Maintenant, nous faisons la même chose, mais nous appliquons <code>prop.table()</code> de <strong>base</strong> R au tableau pour qu’au lieu de compter, nous obtenions des proportions du total. Les 50 premières lignes sont affichées ci-dessous.</p>
<div class="sourceCode" id="cb1670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1670-1"><a href="heatmaps.html#cb1670-1" aria-hidden="true" tabindex="-1"></a>long_prop <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(</span>
<span id="cb1670-2"><a href="heatmaps.html#cb1670-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">cases =</span> ages_complete<span class="sc">$</span>case_age_cat,</span>
<span id="cb1670-3"><a href="heatmaps.html#cb1670-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">infectors =</span> ages_complete<span class="sc">$</span>infector_age_cat)))</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7b16c87fde3f8dcab85a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7b16c87fde3f8dcab85a">{"x":{"filter":"none","vertical":false,"data":[["0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9"],["0-4","0-4","0-4","0-4","0-4","0-4","0-4","0-4","5-9","5-9","5-9","5-9","5-9","5-9","5-9","5-9","10-14","10-14","10-14","10-14","10-14","10-14","10-14","10-14","15-19","15-19","15-19","15-19","15-19","15-19","15-19","15-19","20-29","20-29","20-29","20-29","20-29","20-29","20-29","20-29","30-49","30-49","30-49","30-49","30-49","30-49","30-49","30-49","50-69","50-69"],[0.0284784377542718,0.0276647681041497,0.0282072145375644,0.0230539734201248,0.0273935448874424,0.0195280716029292,0.00135611608353675,0.00027122321670735,0.0423108218063466,0.0358014646053702,0.0295633306211012,0.0284784377542718,0.0344453485218335,0.026308652020613,0.0016273393002441,0,0.0284784377542718,0.0298345538378085,0.0246813127203689,0.0222403037700027,0.0295633306211012,0.0151885001356116,0.00406834825061025,0.0005424464334147,0.0309194467046379,0.0276647681041497,0.0214266341198807,0.0105777054515867,0.021697857336588,0.0146460537021969,0.00244100895036615,0,0.0387849199891511,0.03173311635476,0.032546786004882,0.0203417412530513,0.0387849199891511,0.0265798752373203,0.00189856251695145,0,0.03173311635476,0.0260374288039056,0.021697857336588,0.0187144019528072,0.0290208841876865,0.0165446162191484,0.00135611608353675,0,0.00352590181719555,0.0032546786004882]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>cases<\/th>\n      <th>infectors<\/th>\n      <th>Freq<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="créer-un-diagramme-de-chaleur" class="section level3 unnumbered">
<h3>Créer un diagramme de chaleur</h3>
<p>Maintenant, nous pouvons enfin créer le graphique de chaleur avec le paquet <strong>ggplot2</strong>, en utilisant la fonction <code>geom_tile()</code>. Consultez la page <a href="ggplot_tips.html#ggplot_tips">Astuces de ggplot</a> pour en savoir plus sur les échelles de couleur et de remplissage, en particulier la fonction <code>scale_fill_gradient()</code>.</p>
<ul>
<li>Dans l’esthétique <code>aes()</code> de <code>geom_tile()</code>, définissez x et y comme l’âge du cas et l’âge de l’infecteur.<br />
</li>
<li>De plus, dans <code>aes()</code>, mettez l’argument <code>fill =</code> dans la colonne <code>Freq</code> - c’est la valeur qui sera convertie en une couleur de tuile.<br />
</li>
<li>Définissez une couleur d’échelle avec <code>scale_fill_gradient()</code> - vous pouvez spécifier les couleurs hautes et basses.
<ul>
<li>Notez que <code>scale_color_gradient()</code> est différent ! Dans ce cas, vous voulez le remplissage<br />
</li>
</ul></li>
<li>Comme la couleur est faite via “fill”, vous pouvez utiliser l’argument <code>fill =</code> dans <code>labs()</code> pour changer le titre de la légende.</li>
</ul>
<div class="sourceCode" id="cb1671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1671-1"><a href="heatmaps.html#cb1671-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> long_prop)<span class="sc">+</span> <span class="co"># utilise des données longues, avec des proportions comme Freq</span></span>
<span id="cb1671-2"><a href="heatmaps.html#cb1671-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>( <span class="co"># visualisation en tuiles</span></span>
<span id="cb1671-3"><a href="heatmaps.html#cb1671-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb1671-4"><a href="heatmaps.html#cb1671-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> cases, <span class="co"># l&#39;axe des x est l&#39;âge du cas</span></span>
<span id="cb1671-5"><a href="heatmaps.html#cb1671-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> infectors, <span class="co"># l&#39;axe des y est l&#39;âge de l&#39;infecteur</span></span>
<span id="cb1671-6"><a href="heatmaps.html#cb1671-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> Freq))<span class="sc">+</span> <span class="co"># la couleur de la tuile correspond à la colonne Freq dans les données</span></span>
<span id="cb1671-7"><a href="heatmaps.html#cb1671-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>( <span class="co"># ajuste la couleur de remplissage des tuiles</span></span>
<span id="cb1671-8"><a href="heatmaps.html#cb1671-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb1671-9"><a href="heatmaps.html#cb1671-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;orange&quot;</span>)<span class="sc">+</span></span>
<span id="cb1671-10"><a href="heatmaps.html#cb1671-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="co"># étiquettes</span></span>
<span id="cb1671-11"><a href="heatmaps.html#cb1671-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Âge du cas&quot;</span>,</span>
<span id="cb1671-12"><a href="heatmaps.html#cb1671-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Âge du contaminateur&quot;</span>,</span>
<span id="cb1671-13"><a href="heatmaps.html#cb1671-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Qui a infecté qui&quot;</span>,</span>
<span id="cb1671-14"><a href="heatmaps.html#cb1671-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Matrice de fréquence des événements de transmission&quot;</span>,</span>
<span id="cb1671-15"><a href="heatmaps.html#cb1671-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Proportion de tous les événements de transmission&quot;</span> <span class="co"># titre de la légende</span></span>
<span id="cb1671-16"><a href="heatmaps.html#cb1671-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1273-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
</div>
<div id="rapport-sur-les-mesures-dans-le-temps" class="section level2" number="35.3">
<h2><span class="header-section-number">35.3</span> Rapport sur les mesures dans le temps</h2>
<p>Souvent, en santé publique, un objectif est d’évaluer les tendances dans le temps pour de nombreuses entités (établissements, juridictions, etc.). Une façon de visualiser ces tendances dans le temps est un diagramme de chaleur où l’axe des x est le temps et l’axe des y sont les nombreuses entités.</p>
<div id="préparation-des-données-1" class="section level3 unnumbered">
<h3>Préparation des données</h3>
<p>Nous commençons par importer un jeu de données de rapports quotidiens sur le paludisme provenant de nombreux établissements. Les rapports contiennent une date, une province, un district et un nombre de cas de paludisme. Voir la page <a href="download_book_data.html#download_book_data">Télécharger le manuel et les données</a> pour savoir comment télécharger ces données. Voici les 30 premières lignes :</p>
<div class="sourceCode" id="cb1672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1672-1"><a href="heatmaps.html#cb1672-1" aria-hidden="true" tabindex="-1"></a>facility_count_data <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;malaria_facility_count_data.rds&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-85508f0ce0d4440fcffe" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-85508f0ce0d4440fcffe">{"x":{"filter":"none","vertical":false,"data":[["Facility 1","Facility 2","Facility 3","Facility 4","Facility 5","Facility 6","Facility 6","Facility 5","Facility 5","Facility 5","Facility 7","Facility 8","Facility 9","Facility 10","Facility 11","Facility 12","Facility 13","Facility 14","Facility 15","Facility 16","Facility 17","Facility 18","Facility 19","Facility 19","Facility 20","Facility 21","Facility 19","Facility 22","Facility 23","Facility 23"],["2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-09","2020-08-08","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-11","2020-08-11","2020-08-09","2020-08-11","2020-08-11","2020-08-12"],["Spring","Bolo","Dingo","Bolo","Bolo","Dingo","Dingo","Bolo","Bolo","Bolo","Spring","Bolo","Spring","Bolo","Spring","Dingo","Bolo","Dingo","Barnard","Barnard","Barnard","Bolo","Bolo","Bolo","Barnard","Bolo","Bolo","Bolo","Dingo","Dingo"],[46,26,18,49,17,8,7,42,35,49,32,28,53,34,60,134,0,16,11,34,9,13,32,52,37,51,32,28,31,31]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>District<\/th>\n      <th>malaria_tot<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<div id="agréger-et-résumer" class="section level4 unnumbered">
<h4>Agréger et résumer</h4>
<p><strong>L’objectif de cet exemple</strong> est de transformer les comptages quotidiens de cas de paludisme <em>totaux</em> de l’établissement (vus dans l’onglet précédent) en statistiques récapitulatives <em>hebdomadaires</em> des performances de déclaration de l’établissement - dans ce cas, <em>la proportion de jours par semaine où l’établissement a déclaré des données</em>. Pour cet exemple, nous allons montrer les données uniquement pour le <strong>District de Spring</strong>.</p>
<p>Pour ce faire, nous allons procéder aux étapes suivantes de gestion des données :</p>
<ol style="list-style-type: decimal">
<li>Filtrer les données comme il convient (par lieu, par date).<br />
</li>
<li>Créer une colonne hebdomadaire en utilisant <code>floor_date()</code> du package <strong>lubridate</strong>.
<ul>
<li>Cette fonction renvoie la date de début de la semaine d’une date donnée, en utilisant une date de début spécifiée de chaque semaine (par exemple “Lundi”)<br />
</li>
</ul></li>
<li>Les données sont regroupées par les colonnes “lieu” et “semaine” pour créer des unités d’analyse de “semaine d’installation”.<br />
</li>
<li>La fonction <code>summarise()</code> crée de nouvelles colonnes pour refléter les statistiques sommaires par groupe de semaine d’installation :
<ul>
<li>Nombre de jours par semaine (7 - une valeur statique)<br />
</li>
<li>Nombre de rapports reçus de la semaine d’installation (peut être plus de 7 !)<br />
</li>
<li>Somme des cas de malaria rapportés par la semaine d’installation (juste pour l’intérêt)<br />
</li>
<li>Nombre de jours <em>uniques</em> dans la semaine d’installation pour lesquels des données ont été rapportées.<br />
<strong>Pourcentage des 7 jours par semaine d’installation pour lesquels des données ont été déclarées</strong>.<br />
</li>
</ul></li>
<li>Le cadre de données est joint avec <code>right_join()</code> à une liste complète de toutes les combinaisons possibles de semaine d’installation, pour rendre l’ensemble de données complet. La matrice de toutes les combinaisons possibles est créée en appliquant <code>expand()</code> aux deux colonnes du cadre de données tel qu’il est à ce moment-là dans la chaîne de production (représenté par <code>.</code>). Comme un <code>right_join()</code> est utilisé, toutes les lignes du cadre de données <code>expand()</code> sont conservées, et ajoutées à <code>agg_weeks</code> si nécessaire. Ces nouvelles lignes apparaissent avec des valeurs résumées <code>NA</code> (manquantes).</li>
</ol>
<p>Nous faisons ci-dessous une démonstration étape par étape :</p>
<div class="sourceCode" id="cb1673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1673-1"><a href="heatmaps.html#cb1673-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer un ensemble de données de résumé hebdomadaire</span></span>
<span id="cb1673-2"><a href="heatmaps.html#cb1673-2" aria-hidden="true" tabindex="-1"></a>agg_weeks <span class="ot">&lt;-</span> facility_count_data <span class="sc">%&gt;%</span> </span>
<span id="cb1673-3"><a href="heatmaps.html#cb1673-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1673-4"><a href="heatmaps.html#cb1673-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtrez les données comme il se doit</span></span>
<span id="cb1673-5"><a href="heatmaps.html#cb1673-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb1673-6"><a href="heatmaps.html#cb1673-6" aria-hidden="true" tabindex="-1"></a>    District <span class="sc">==</span> <span class="st">&quot;Spring&quot;</span>,</span>
<span id="cb1673-7"><a href="heatmaps.html#cb1673-7" aria-hidden="true" tabindex="-1"></a>    data_date <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-08-01&quot;</span>)) </span></code></pre></div>
<p>Maintenant, le jeu de données a 608 lignes, alors qu’il avait précédemment 3038.</p>
<p>Ensuite, nous créons une colonne <code>week</code> reflétant la date de début de la semaine pour chaque enregistrement. Ceci est réalisé avec le package <strong>lubridate</strong> et la fonction <code>floor_date()</code>, qui est définie sur “week” et pour que les semaines commencent le lundi (jour 1 de la semaine - le dimanche serait le 7). Les lignes du haut sont présentées ci-dessous.</p>
<div class="sourceCode" id="cb1674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1674-1"><a href="heatmaps.html#cb1674-1" aria-hidden="true" tabindex="-1"></a>agg_weeks <span class="ot">&lt;-</span> agg_weeks <span class="sc">%&gt;%</span> </span>
<span id="cb1674-2"><a href="heatmaps.html#cb1674-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Créez une colonne semaine à partir de data_date</span></span>
<span id="cb1674-3"><a href="heatmaps.html#cb1674-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1674-4"><a href="heatmaps.html#cb1674-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">week =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>( <span class="co"># créer une nouvelle colonne de semaines</span></span>
<span id="cb1674-5"><a href="heatmaps.html#cb1674-5" aria-hidden="true" tabindex="-1"></a>      data_date, <span class="co"># colonne de date</span></span>
<span id="cb1674-6"><a href="heatmaps.html#cb1674-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">unit =</span> <span class="st">&quot;week&quot;</span>, <span class="co"># donne le début de la semaine</span></span>
<span id="cb1674-7"><a href="heatmaps.html#cb1674-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">week_start =</span> <span class="dv">1</span>))                                <span class="co"># les semaines commencent le lundi </span></span></code></pre></div>
<p>La nouvelle colonne de semaine est visible à l’extrême droite du cadre de données.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-68cb70f6d7eba9a39e00" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-68cb70f6d7eba9a39e00">{"x":{"filter":"none","vertical":false,"data":[["Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 51","Facility 51","Facility 51","Facility 56","Facility 7","Facility 7","Facility 7","Facility 11","Facility 35","Facility 35","Facility 28","Facility 28","Facility 28","Facility 28"],["2020-07-31","2020-07-30","2020-07-29","2020-07-28","2020-07-27","2020-07-31","2020-07-30","2020-07-29","2020-07-28","2020-07-27","2020-07-26","2020-07-25","2020-07-24","2020-07-23","2020-07-22","2020-07-21","2020-07-30","2020-07-29","2020-07-28","2020-06-25","2020-07-31","2020-07-30","2020-07-29","2020-07-31","2020-07-30","2020-07-29","2020-07-30","2020-07-29","2020-07-28","2020-07-27"],["Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring"],[13,14,74,75,91,80,39,44,44,43,28,41,61,40,33,66,32,32,32,200,0,0,21,21,43,179,1,35,31,45],["2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-20","2020-07-20","2020-07-20","2020-07-20","2020-07-20","2020-07-20","2020-07-27","2020-07-27","2020-07-27","2020-06-22","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27"]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>District<\/th>\n      <th>malaria_tot<\/th>\n      <th>week<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Maintenant, nous regroupons les données en semaines d’installation et les résumons pour produire des statistiques par semaine d’installation. Consultez la page sur les <a href="descriptive_tables.html#descriptive_tables">Tableaux descriptifs</a> pour obtenir des conseils. Le regroupement en lui-même ne modifie pas la trame de données, mais il a un impact sur la façon dont les statistiques récapitulatives suivantes sont calculées.</p>
<p>Les lignes du haut sont présentées ci-dessous. Notez comment les colonnes ont complètement changé pour refléter les statistiques récapitulatives souhaitées. Chaque ligne reflète une semaine d’installation.</p>
<div class="sourceCode" id="cb1675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1675-1"><a href="heatmaps.html#cb1675-1" aria-hidden="true" tabindex="-1"></a>agg_weeks <span class="ot">&lt;-</span> agg_weeks <span class="sc">%&gt;%</span>   </span>
<span id="cb1675-2"><a href="heatmaps.html#cb1675-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1675-3"><a href="heatmaps.html#cb1675-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Regroupement en semaines d&#39;installation</span></span>
<span id="cb1675-4"><a href="heatmaps.html#cb1675-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location_name, week) <span class="sc">%&gt;%</span></span>
<span id="cb1675-5"><a href="heatmaps.html#cb1675-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1675-6"><a href="heatmaps.html#cb1675-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Créez des colonnes de statistiques récapitulatives sur les données groupées</span></span>
<span id="cb1675-7"><a href="heatmaps.html#cb1675-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb1675-8"><a href="heatmaps.html#cb1675-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_days =</span> <span class="dv">7</span>, <span class="co"># 7 jours par semaine           </span></span>
<span id="cb1675-9"><a href="heatmaps.html#cb1675-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_reports =</span> dplyr<span class="sc">::</span><span class="fu">n</span>(), <span class="co"># nombre de rapports reçus par semaine (peut être &gt;7)</span></span>
<span id="cb1675-10"><a href="heatmaps.html#cb1675-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">malaria_tot =</span> <span class="fu">sum</span>(malaria_tot, <span class="at">na.rm =</span> T), <span class="co"># nombre total de cas de paludisme signalés</span></span>
<span id="cb1675-11"><a href="heatmaps.html#cb1675-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_days_reported =</span> <span class="fu">length</span>(<span class="fu">unique</span>(data_date)), <span class="co"># nombre de jours uniques de déclaration par semaine</span></span>
<span id="cb1675-12"><a href="heatmaps.html#cb1675-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_days_reported =</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>(n_days_reported <span class="sc">/</span> n_days))) <span class="sc">%&gt;%</span>      <span class="co"># pourcentage de jours de déclaration</span></span>
<span id="cb1675-13"><a href="heatmaps.html#cb1675-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>(location_name, week)    <span class="co">#ungroup() alors expand() marche dans les prochaines etapes</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6d029b95b0b3539284ea" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6d029b95b0b3539284ea">{"x":{"filter":"none","vertical":false,"data":[["Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28"],["2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29"],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[2,7,7,7,7,7,7,4,2,8,6,2,3,1,5,2,7,6,5,7,6,5,2,7,7,7,7,7,9,7],[0,0,0,101,402,570,378,131,354,853,502,317,245,0,0,0,17,147,136,118,88,86,26,216,155,120,319,256,475,352],[2,7,7,7,7,7,7,4,2,7,6,2,3,1,5,2,5,6,5,7,6,5,2,7,7,7,7,7,7,7],[29,100,100,100,100,100,100,57,29,100,86,29,43,14,71,29,71,86,71,100,86,71,29,100,100,100,100,100,100,100]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>week<\/th>\n      <th>n_days<\/th>\n      <th>n_reports<\/th>\n      <th>malaria_tot<\/th>\n      <th>n_days_reported<\/th>\n      <th>p_days_reported<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Enfin, nous exécutons la commande ci-dessous pour nous assurer que TOUTES les semaines d’installation possibles sont présentes dans les données, même si elles étaient absentes auparavant.</p>
<p>Nous utilisons un <code>right_join()</code> sur lui-même (l’ensemble de données est représenté par “.”) mais il a été étendu pour inclure toutes les combinaisons possibles des colonnes <code>week</code> et <code>location_name</code>. Voir la documentation sur la fonction <code>expand()</code> dans la page sur <a href="pivoting_data.html#pivoting_data">Pivoter les donnees</a>. Avant d’exécuter ce code, l’ensemble de données contient 107 lignes.</p>
<div class="sourceCode" id="cb1676"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1676-1"><a href="heatmaps.html#cb1676-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Créez un cadre de données pour chaque semaine d&#39;installation possible.</span></span>
<span id="cb1676-2"><a href="heatmaps.html#cb1676-2" aria-hidden="true" tabindex="-1"></a>expanded_weeks <span class="ot">&lt;-</span> agg_weeks <span class="sc">%&gt;%</span> </span>
<span id="cb1676-3"><a href="heatmaps.html#cb1676-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(location_name, week) <span class="co"># étendre le cadre de données pour inclure toutes les combinaisons possibles établissement-semaine</span></span></code></pre></div>
<p>Voici <code>expanded_weeks</code>, avec 180 lignes:</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6e5df22f2eaee37dea19" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6e5df22f2eaee37dea19">{"x":{"filter":"none","vertical":false,"data":[["Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9"],["2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27"]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>week<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Avant d’exécuter ce code, <code>agg_weeks</code> contient 107 lignes.</p>
<div class="sourceCode" id="cb1677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1677-1"><a href="heatmaps.html#cb1677-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilisez une jointure à droite avec la liste étendue des semaines d&#39;installation pour combler les lacunes dans les données.</span></span>
<span id="cb1677-2"><a href="heatmaps.html#cb1677-2" aria-hidden="true" tabindex="-1"></a>agg_weeks <span class="ot">&lt;-</span> agg_weeks <span class="sc">%&gt;%</span>      </span>
<span id="cb1677-3"><a href="heatmaps.html#cb1677-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(expanded_weeks) <span class="sc">%&gt;%</span> <span class="co"># Assurez-vous que toutes les combinaisons possibles de semaines d&#39;installation apparaissent dans les données.</span></span>
<span id="cb1677-4"><a href="heatmaps.html#cb1677-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_days_reported =</span> <span class="fu">replace_na</span>(p_days_reported, <span class="dv">0</span>))  <span class="co"># Convertir les valeurs manquantes en 0                           </span></span></code></pre></div>
<pre><code>## Joining with `by = join_by(location_name, week)`</code></pre>
<p>Après avoir exécuté ce code, <code>agg_weeks</code> contient 180 lignes.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="créer-un-graphique-de-chaleur" class="section level3 unnumbered">
<h3>Créer un graphique de chaleur</h3>
<p>Le <code>ggplot()</code> est réalisé en utilisant <code>geom_tile()</code> du paquet <strong>ggplot2</strong> :</p>
<ul>
<li>Les semaines sur l’axe des x sont transformées en dates, permettant l’utilisation de <code>scale_x_date()</code>.<br />
</li>
<li>L’axe des ordonnées affiche tous les noms des établissements.<br />
</li>
<li>Le “remplissage” est “p_days_reported”, la performance pour cette semaine d’installation (numérique).<br />
</li>
<li><code>scale_fill_gradient()</code> est utilisé sur le remplissage numérique, en spécifiant des couleurs pour le haut, le bas, et <code>NA</code>.<br />
</li>
<li>La fonction <code>scale_x_date()</code> est utilisée sur l’axe des x pour spécifier les étiquettes toutes les 2 semaines et leur format.<br />
</li>
<li>Les thèmes d’affichage et les étiquettes peuvent être ajustés si nécessaire.</li>
</ul>
<!-- ======================================================= -->
</div>
<div id="basique" class="section level3 unnumbered">
<h3>Basique</h3>
<p>Un graphique thermique de base est produit ci-dessous, en utilisant les couleurs, les échelles, etc. par défaut. Comme expliqué ci-dessus, dans le <code>aes()</code> pour le <code>geom_tile()</code> vous devez fournir une colonne pour l’axe des x, une colonne pour l’axe des y, <strong>et</strong> une colonne pour le <code>fill =</code>. Le remplissage est la valeur numérique qui présente comme couleur de tuile.</p>
<div class="sourceCode" id="cb1679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1679-1"><a href="heatmaps.html#cb1679-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> agg_weeks)<span class="sc">+</span></span>
<span id="cb1679-2"><a href="heatmaps.html#cb1679-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(</span>
<span id="cb1679-3"><a href="heatmaps.html#cb1679-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> week,</span>
<span id="cb1679-4"><a href="heatmaps.html#cb1679-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> location_name,</span>
<span id="cb1679-5"><a href="heatmaps.html#cb1679-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> p_days_reported))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1285-1.png" width="672" /></p>
</div>
<div id="tracé-nettoyé" class="section level3 unnumbered">
<h3>Tracé nettoyé</h3>
<p>Nous pouvons améliorer l’apparence de ce graphique en ajoutant des fonctions <strong>ggplot2</strong> supplémentaires, comme indiqué ci-dessous. Voir la page sur les <a href="ggplot_tips.html#ggplot_tips">astuces de ggplot</a> pour plus de détails.</p>
<div class="sourceCode" id="cb1680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1680-1"><a href="heatmaps.html#cb1680-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> agg_weeks)<span class="sc">+</span> </span>
<span id="cb1680-2"><a href="heatmaps.html#cb1680-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1680-3"><a href="heatmaps.html#cb1680-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># affiche les données sous forme de tuiles</span></span>
<span id="cb1680-4"><a href="heatmaps.html#cb1680-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(</span>
<span id="cb1680-5"><a href="heatmaps.html#cb1680-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> week,</span>
<span id="cb1680-6"><a href="heatmaps.html#cb1680-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> location_name,</span>
<span id="cb1680-7"><a href="heatmaps.html#cb1680-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> p_days_reported),      </span>
<span id="cb1680-8"><a href="heatmaps.html#cb1680-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span> <span class="co"># lignes de grille blanches</span></span>
<span id="cb1680-9"><a href="heatmaps.html#cb1680-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1680-10"><a href="heatmaps.html#cb1680-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb1680-11"><a href="heatmaps.html#cb1680-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">&quot;orange&quot;</span>,</span>
<span id="cb1680-12"><a href="heatmaps.html#cb1680-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;darkgreen&quot;</span>,</span>
<span id="cb1680-13"><a href="heatmaps.html#cb1680-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">&quot;grey80&quot;</span>)<span class="sc">+</span></span>
<span id="cb1680-14"><a href="heatmaps.html#cb1680-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1680-15"><a href="heatmaps.html#cb1680-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># axe des dates</span></span>
<span id="cb1680-16"><a href="heatmaps.html#cb1680-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1680-17"><a href="heatmaps.html#cb1680-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="co"># supprimer l&#39;espace supplémentaire sur les côtés</span></span>
<span id="cb1680-18"><a href="heatmaps.html#cb1680-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;2 weeks&quot;</span>, <span class="co"># étiquettes toutes les 2 semaines</span></span>
<span id="cb1680-19"><a href="heatmaps.html#cb1680-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">&quot;%d</span><span class="sc">\n</span><span class="st">%b&quot;</span>)<span class="sc">+</span> <span class="co"># le format est jour sur mois (\n dans la nouvelle ligne)</span></span>
<span id="cb1680-20"><a href="heatmaps.html#cb1680-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1680-21"><a href="heatmaps.html#cb1680-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># thèmes esthétiques</span></span>
<span id="cb1680-22"><a href="heatmaps.html#cb1680-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span> <span class="co"># simplifier l&#39;arrière-plan</span></span>
<span id="cb1680-23"><a href="heatmaps.html#cb1680-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1680-24"><a href="heatmaps.html#cb1680-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1680-25"><a href="heatmaps.html#cb1680-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1680-26"><a href="heatmaps.html#cb1680-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1680-27"><a href="heatmaps.html#cb1680-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>), <span class="co"># hauteur de la clé de légende</span></span>
<span id="cb1680-28"><a href="heatmaps.html#cb1680-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fl">0.6</span>, <span class="st">&quot;cm&quot;</span>), <span class="co"># largeur de la clé de légende</span></span>
<span id="cb1680-29"><a href="heatmaps.html#cb1680-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1680-30"><a href="heatmaps.html#cb1680-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>), <span class="co"># taille du texte de l&#39;axe</span></span>
<span id="cb1680-31"><a href="heatmaps.html#cb1680-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust=</span><span class="fl">0.2</span>), <span class="co"># alignement du texte de l&#39;axe</span></span>
<span id="cb1680-32"><a href="heatmaps.html#cb1680-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">size=</span><span class="fl">0.4</span>),               </span>
<span id="cb1680-33"><a href="heatmaps.html#cb1680-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>), <span class="co"># taille et gras du titre de l&#39;axe</span></span>
<span id="cb1680-34"><a href="heatmaps.html#cb1680-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1680-35"><a href="heatmaps.html#cb1680-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="dv">14</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>), <span class="co"># titre aligné à droite, large, gras</span></span>
<span id="cb1680-36"><a href="heatmaps.html#cb1680-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>), <span class="co"># légende alignée à droite et en italique</span></span>
<span id="cb1680-37"><a href="heatmaps.html#cb1680-37" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb1680-38"><a href="heatmaps.html#cb1680-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1680-39"><a href="heatmaps.html#cb1680-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># étiquettes du graphique</span></span>
<span id="cb1680-40"><a href="heatmaps.html#cb1680-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Semaine&quot;</span>,</span>
<span id="cb1680-41"><a href="heatmaps.html#cb1680-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Nom de l&#39;établissement&quot;</span>,</span>
<span id="cb1680-42"><a href="heatmaps.html#cb1680-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Reporting</span><span class="sc">\n</span><span class="st">performance (%)&quot;</span>, <span class="co"># titre de la légende, car la légende montre le remplissage</span></span>
<span id="cb1680-43"><a href="heatmaps.html#cb1680-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Pourcentage de jours par semaine où l&#39;établissement a déclaré des données&quot;</span>,</span>
<span id="cb1680-44"><a href="heatmaps.html#cb1680-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Établissements de santé du district, mai-juillet 2020&quot;</span>,</span>
<span id="cb1680-45"><a href="heatmaps.html#cb1680-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Semaines de 7 jours commençant le lundi&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1286-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="axe-des-y-ordonné" class="section level3 unnumbered">
<h3>Axe des y ordonné</h3>
<p>Actuellement, les installations sont ordonnées “alpha-numériquement” de bas en haut. Si vous voulez ajuster l’ordre des installations de l’axe des y, convertissez-les en facteur de classe et fournissez l’ordre. Voir la page sur les <a href="factors.html#factors">Facteurs</a> pour des conseils.</p>
<p>Puisqu’il y a beaucoup d’installations et que nous ne voulons pas les écrire toutes, nous allons essayer une autre approche - classer les installations dans un cadre de données et utiliser la colonne de noms résultante comme ordre de niveau de facteur. Ci-dessous, la colonne <code>location_name</code> est convertie en un facteur, et l’ordre de ses niveaux est établi sur la base du nombre total de jours de déclaration déposés par l’installation sur l’ensemble de la période.</p>
<p>Pour ce faire, nous créons un cadre de données qui représente le nombre total de rapports par établissement, classés par ordre croissant. Nous pouvons utiliser ce vecteur pour ordonner les niveaux de facteurs dans le graphique.</p>
<div class="sourceCode" id="cb1681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1681-1"><a href="heatmaps.html#cb1681-1" aria-hidden="true" tabindex="-1"></a>facility_order <span class="ot">&lt;-</span> agg_weeks <span class="sc">%&gt;%</span> </span>
<span id="cb1681-2"><a href="heatmaps.html#cb1681-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location_name) <span class="sc">%&gt;%</span> </span>
<span id="cb1681-3"><a href="heatmaps.html#cb1681-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_reports =</span> <span class="fu">sum</span>(n_days_reported, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb1681-4"><a href="heatmaps.html#cb1681-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(tot_reports) <span class="co"># ordre ascendant</span></span></code></pre></div>
<p>Voir le cadre de données ci-dessous :</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-bac73f521e682f89199b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-bac73f521e682f89199b">{"x":{"filter":"none","vertical":false,"data":[["Facility 56","Facility 65","Facility 11","Facility 39","Facility 59","Facility 27","Facility 51","Facility 32","Facility 7","Facility 1","Facility 9","Facility 35","Facility 50","Facility 58","Facility 28"],[1,6,20,33,35,42,42,43,44,48,50,52,53,55,77]],"container":"<table class=\"white-space : nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>tot_reports<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Utilisez maintenant une colonne du cadre de données ci-dessus (<code>facility_order$location_name</code>) comme ordre des niveaux de facteur de <code>location_name</code> dans le cadre de données <code>agg_weeks</code> :</p>
<div class="sourceCode" id="cb1682"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1682-1"><a href="heatmaps.html#cb1682-1" aria-hidden="true" tabindex="-1"></a><span class="co"># charger le paquet </span></span>
<span id="cb1682-2"><a href="heatmaps.html#cb1682-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(forcats)</span>
<span id="cb1682-3"><a href="heatmaps.html#cb1682-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1682-4"><a href="heatmaps.html#cb1682-4" aria-hidden="true" tabindex="-1"></a><span class="co"># créer le facteur et définir les niveaux manuellement</span></span>
<span id="cb1682-5"><a href="heatmaps.html#cb1682-5" aria-hidden="true" tabindex="-1"></a>agg_weeks <span class="ot">&lt;-</span> agg_weeks <span class="sc">%&gt;%</span> </span>
<span id="cb1682-6"><a href="heatmaps.html#cb1682-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">location_name =</span> <span class="fu">fct_relevel</span>(</span>
<span id="cb1682-7"><a href="heatmaps.html#cb1682-7" aria-hidden="true" tabindex="-1"></a>    location_name, facility_order<span class="sc">$</span>location_name)</span>
<span id="cb1682-8"><a href="heatmaps.html#cb1682-8" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>Et maintenant, les données sont à nouveau tracées, le nom de l’emplacement étant un facteur ordonné :</p>
<div class="sourceCode" id="cb1683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1683-1"><a href="heatmaps.html#cb1683-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> agg_weeks)<span class="sc">+</span> </span>
<span id="cb1683-2"><a href="heatmaps.html#cb1683-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1683-3"><a href="heatmaps.html#cb1683-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># afficher les données sous forme de tuiles</span></span>
<span id="cb1683-4"><a href="heatmaps.html#cb1683-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(</span>
<span id="cb1683-5"><a href="heatmaps.html#cb1683-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> week,</span>
<span id="cb1683-6"><a href="heatmaps.html#cb1683-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> location_name,</span>
<span id="cb1683-7"><a href="heatmaps.html#cb1683-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> p_days_reported),      </span>
<span id="cb1683-8"><a href="heatmaps.html#cb1683-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span> <span class="co"># lignes de grille blanches</span></span>
<span id="cb1683-9"><a href="heatmaps.html#cb1683-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1683-10"><a href="heatmaps.html#cb1683-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb1683-11"><a href="heatmaps.html#cb1683-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">&quot;orange&quot;</span>,</span>
<span id="cb1683-12"><a href="heatmaps.html#cb1683-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;darkgreen&quot;</span>,</span>
<span id="cb1683-13"><a href="heatmaps.html#cb1683-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">&quot;grey80&quot;</span>)<span class="sc">+</span></span>
<span id="cb1683-14"><a href="heatmaps.html#cb1683-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1683-15"><a href="heatmaps.html#cb1683-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># axe des dates</span></span>
<span id="cb1683-16"><a href="heatmaps.html#cb1683-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1683-17"><a href="heatmaps.html#cb1683-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="co"># supprimer l&#39;espace supplémentaire sur les côtés</span></span>
<span id="cb1683-18"><a href="heatmaps.html#cb1683-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;2 weeks&quot;</span>, <span class="co"># étiquettes toutes les 2 semaines</span></span>
<span id="cb1683-19"><a href="heatmaps.html#cb1683-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">&quot;%d</span><span class="sc">\n</span><span class="st">%b&quot;</span>)<span class="sc">+</span> <span class="co"># le format est jour sur mois (\n dans la nouvelle ligne)</span></span>
<span id="cb1683-20"><a href="heatmaps.html#cb1683-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1683-21"><a href="heatmaps.html#cb1683-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># thèmes esthétiques</span></span>
<span id="cb1683-22"><a href="heatmaps.html#cb1683-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span> <span class="co"># simplifier l&#39;arrière-plan</span></span>
<span id="cb1683-23"><a href="heatmaps.html#cb1683-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1683-24"><a href="heatmaps.html#cb1683-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1683-25"><a href="heatmaps.html#cb1683-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1683-26"><a href="heatmaps.html#cb1683-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1683-27"><a href="heatmaps.html#cb1683-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>), <span class="co"># hauteur de la clé de légende</span></span>
<span id="cb1683-28"><a href="heatmaps.html#cb1683-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fl">0.6</span>, <span class="st">&quot;cm&quot;</span>), <span class="co"># largeur de la clé de légende</span></span>
<span id="cb1683-29"><a href="heatmaps.html#cb1683-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1683-30"><a href="heatmaps.html#cb1683-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>), <span class="co"># taille du texte de l&#39;axe</span></span>
<span id="cb1683-31"><a href="heatmaps.html#cb1683-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust=</span><span class="fl">0.2</span>), <span class="co"># alignement du texte de l&#39;axe</span></span>
<span id="cb1683-32"><a href="heatmaps.html#cb1683-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">size=</span><span class="fl">0.4</span>),               </span>
<span id="cb1683-33"><a href="heatmaps.html#cb1683-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>), <span class="co"># taille et gras du titre de l&#39;axe</span></span>
<span id="cb1683-34"><a href="heatmaps.html#cb1683-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1683-35"><a href="heatmaps.html#cb1683-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="dv">14</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>), <span class="co"># titre aligné à droite, large, gras</span></span>
<span id="cb1683-36"><a href="heatmaps.html#cb1683-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>), <span class="co"># légende alignée à droite et en italique</span></span>
<span id="cb1683-37"><a href="heatmaps.html#cb1683-37" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb1683-38"><a href="heatmaps.html#cb1683-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1683-39"><a href="heatmaps.html#cb1683-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># étiquettes du graphique</span></span>
<span id="cb1683-40"><a href="heatmaps.html#cb1683-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Semaine&quot;</span>,</span>
<span id="cb1683-41"><a href="heatmaps.html#cb1683-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Nom de l&#39;établissement&quot;</span>,</span>
<span id="cb1683-42"><a href="heatmaps.html#cb1683-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Reporting</span><span class="sc">\n</span><span class="st">performance (%)&quot;</span>, <span class="co"># titre de la légende, car la légende montre le remplissage</span></span>
<span id="cb1683-43"><a href="heatmaps.html#cb1683-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Pourcentage de jours par semaine où l&#39;établissement a déclaré des données&quot;</span>,</span>
<span id="cb1683-44"><a href="heatmaps.html#cb1683-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Établissements de santé du district, mai-juillet 2020&quot;</span>,</span>
<span id="cb1683-45"><a href="heatmaps.html#cb1683-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Semaines de 7 jours commençant le lundi&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1290-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="afficher-les-valeurs" class="section level3 unnumbered">
<h3>Afficher les valeurs</h3>
<p>Vous pouvez ajouter une couche <code>geom_text()</code> au dessus des tuiles, pour afficher les numéros réels de chaque tuile. Attention, cela peut ne pas être joli si vous avez beaucoup de petites tuiles !</p>
<p>Le code suivant a été ajouté : <code>geom_text(aes(label = p_days_reported))</code>. Ceci ajoute du texte sur chaque tuile. Le texte affiché est la valeur assignée à l’argument <code>label =</code>, qui dans ce cas a été fixé à la même colonne numérique <code>p_days_reported</code> qui est aussi utilisée pour créer le gradient de couleur.</p>
<div class="sourceCode" id="cb1684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1684-1"><a href="heatmaps.html#cb1684-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> agg_weeks)<span class="sc">+</span> </span>
<span id="cb1684-2"><a href="heatmaps.html#cb1684-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1684-3"><a href="heatmaps.html#cb1684-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># affiche les données sous forme de tuiles</span></span>
<span id="cb1684-4"><a href="heatmaps.html#cb1684-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(</span>
<span id="cb1684-5"><a href="heatmaps.html#cb1684-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> week,</span>
<span id="cb1684-6"><a href="heatmaps.html#cb1684-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> location_name,</span>
<span id="cb1684-7"><a href="heatmaps.html#cb1684-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> p_days_reported),      </span>
<span id="cb1684-8"><a href="heatmaps.html#cb1684-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span> <span class="co"># lignes de grille blanches</span></span>
<span id="cb1684-9"><a href="heatmaps.html#cb1684-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1684-10"><a href="heatmaps.html#cb1684-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Texte</span></span>
<span id="cb1684-11"><a href="heatmaps.html#cb1684-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb1684-12"><a href="heatmaps.html#cb1684-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb1684-13"><a href="heatmaps.html#cb1684-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> week,</span>
<span id="cb1684-14"><a href="heatmaps.html#cb1684-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> location_name,</span>
<span id="cb1684-15"><a href="heatmaps.html#cb1684-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> p_days_reported))<span class="sc">+</span> <span class="co"># ajouter le texte au dessus de la tuile</span></span>
<span id="cb1684-16"><a href="heatmaps.html#cb1684-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1684-17"><a href="heatmaps.html#cb1684-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remplir l&#39;échelle</span></span>
<span id="cb1684-18"><a href="heatmaps.html#cb1684-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb1684-19"><a href="heatmaps.html#cb1684-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">&quot;orange&quot;</span>,</span>
<span id="cb1684-20"><a href="heatmaps.html#cb1684-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;darkgreen&quot;</span>,</span>
<span id="cb1684-21"><a href="heatmaps.html#cb1684-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">&quot;grey80&quot;</span>)<span class="sc">+</span></span>
<span id="cb1684-22"><a href="heatmaps.html#cb1684-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1684-23"><a href="heatmaps.html#cb1684-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># axe des dates</span></span>
<span id="cb1684-24"><a href="heatmaps.html#cb1684-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1684-25"><a href="heatmaps.html#cb1684-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="co"># supprimer l&#39;espace supplémentaire sur les côtés</span></span>
<span id="cb1684-26"><a href="heatmaps.html#cb1684-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;2 weeks&quot;</span>, <span class="co"># étiquettes toutes les 2 semaines</span></span>
<span id="cb1684-27"><a href="heatmaps.html#cb1684-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">&quot;%d</span><span class="sc">\n</span><span class="st">%b&quot;</span>)<span class="sc">+</span> <span class="co"># le format est jour sur mois (\n dans la nouvelle ligne)</span></span>
<span id="cb1684-28"><a href="heatmaps.html#cb1684-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1684-29"><a href="heatmaps.html#cb1684-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># thèmes esthétiques</span></span>
<span id="cb1684-30"><a href="heatmaps.html#cb1684-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span> <span class="co"># simplifier l&#39;arrière-plan</span></span>
<span id="cb1684-31"><a href="heatmaps.html#cb1684-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1684-32"><a href="heatmaps.html#cb1684-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1684-33"><a href="heatmaps.html#cb1684-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1684-34"><a href="heatmaps.html#cb1684-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1684-35"><a href="heatmaps.html#cb1684-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>), <span class="co"># hauteur de la clé de légende</span></span>
<span id="cb1684-36"><a href="heatmaps.html#cb1684-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fl">0.6</span>, <span class="st">&quot;cm&quot;</span>), <span class="co"># largeur de la clé de légende</span></span>
<span id="cb1684-37"><a href="heatmaps.html#cb1684-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1684-38"><a href="heatmaps.html#cb1684-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>), <span class="co"># taille du texte de l&#39;axe</span></span>
<span id="cb1684-39"><a href="heatmaps.html#cb1684-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust=</span><span class="fl">0.2</span>), <span class="co"># alignement du texte de l&#39;axe</span></span>
<span id="cb1684-40"><a href="heatmaps.html#cb1684-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">size=</span><span class="fl">0.4</span>),               </span>
<span id="cb1684-41"><a href="heatmaps.html#cb1684-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>), <span class="co"># taille et gras du titre de l&#39;axe</span></span>
<span id="cb1684-42"><a href="heatmaps.html#cb1684-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1684-43"><a href="heatmaps.html#cb1684-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="dv">14</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>), <span class="co"># titre aligné à droite, large, gras</span></span>
<span id="cb1684-44"><a href="heatmaps.html#cb1684-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>), <span class="co"># légende alignée à droite et en italique</span></span>
<span id="cb1684-45"><a href="heatmaps.html#cb1684-45" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb1684-46"><a href="heatmaps.html#cb1684-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1684-47"><a href="heatmaps.html#cb1684-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># étiquettes du graphique</span></span>
<span id="cb1684-48"><a href="heatmaps.html#cb1684-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Semaine&quot;</span>,</span>
<span id="cb1684-49"><a href="heatmaps.html#cb1684-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Nom de l&#39;établissement&quot;</span>,</span>
<span id="cb1684-50"><a href="heatmaps.html#cb1684-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Reporting</span><span class="sc">\n</span><span class="st">performance (%)&quot;</span>, <span class="co"># titre de la légende, car la légende montre le remplissage</span></span>
<span id="cb1684-51"><a href="heatmaps.html#cb1684-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Pourcentage de jours par semaine où l&#39;établissement a déclaré des données&quot;</span>,</span>
<span id="cb1684-52"><a href="heatmaps.html#cb1684-52" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Établissements de santé du district, mai-juillet 2020&quot;</span>,</span>
<span id="cb1684-53"><a href="heatmaps.html#cb1684-53" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Semaines de 7 jours commençant le lundi&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1291-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
</div>
<div id="ressources-20" class="section level2" number="35.4">
<h2><span class="header-section-number">35.4</span> Ressources</h2>
<p><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient()</a></p>
<p><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">Galerie de graphiques R - carte thermique</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2023-05-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
